!function(t,i){if("object"==typeof exports&&"object"==typeof module)module.exports=i();else if("function"==typeof define&&define.amd)define([],i);else{var n=i();for(var s in n)("object"==typeof exports?exports:t)[s]=n[s]}}(window,(function(){return function(t){var i={};function n(s){if(i[s])return i[s].exports;var h=i[s]={i:s,l:!1,exports:{}};return t[s].call(h.exports,h,h.exports,n),h.l=!0,h.exports}return n.m=t,n.c=i,n.d=function(t,i,s){n.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:s})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"h",{value:!0})},n.t=function(t,i){if(1&i&&(t=n(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.h)return t;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var h in t)n.d(s,h,function(i){return t[i]}.bind(null,h));return s},n.n=function(t){var i=t&&t.h?function(){return t.default}:function(){return t};return n.d(i,"a",i),i},n.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},n.p="",n(n.s=0)}([function(t,i,n){"use strict";n.r(i),n.d(i,"CharacterController",(function(){return Di}));var s,h=function(){function t(){}return t.WithinEpsilon=function(t,i,n){void 0===n&&(n=1401298e-51);var s=t-i;return-n<=s&&s<=n},t.ToHex=function(t){var i=t.toString(16);return t<=15?("0"+i).toUpperCase():i.toUpperCase()},t.Sign=function(t){return 0===(t=+t)||isNaN(t)?t:t>0?1:-1},t.Clamp=function(t,i,n){return void 0===i&&(i=0),void 0===n&&(n=1),Math.min(n,Math.max(i,t))},t.Log2=function(t){return Math.log(t)*Math.LOG2E},t.Repeat=function(t,i){return t-Math.floor(t/i)*i},t.Normalize=function(t,i,n){return(t-i)/(n-i)},t.Denormalize=function(t,i,n){return t*(n-i)+i},t.DeltaAngle=function(i,n){var s=t.Repeat(n-i,360);return s>180&&(s-=360),s},t.PingPong=function(i,n){var s=t.Repeat(i,2*n);return n-Math.abs(s-n)},t.SmoothStep=function(i,n,s){var h=t.Clamp(s);return n*(h=-2*h*h*h+3*h*h)+i*(1-h)},t.MoveTowards=function(i,n,s){return Math.abs(n-i)<=s?n:i+t.Sign(n-i)*s},t.MoveTowardsAngle=function(i,n,s){var h=t.DeltaAngle(i,n),r=0;return-s<h&&h<s?r=n:(n=i+h,r=t.MoveTowards(i,n,s)),r},t.Lerp=function(t,i,n){return t+(i-t)*n},t.LerpAngle=function(i,n,s){var h=t.Repeat(n-i,360);return h>180&&(h-=360),i+h*t.Clamp(s)},t.InverseLerp=function(i,n,s){return i!=n?t.Clamp((s-i)/(n-i)):0},t.Hermite=function(t,i,n,s,h){var r=h*h,e=h*r;return t*(2*e-3*r+1)+n*(-2*e+3*r)+i*(e-2*r+h)+s*(e-r)},t.RandomRange=function(t,i){return t===i?t:Math.random()*(i-t)+t},t.RangeToPercent=function(t,i,n){return(t-i)/(n-i)},t.PercentToRange=function(t,i,n){return(n-i)*t+i},t.NormalizeRadians=function(i){return i-=t.TwoPi*Math.floor((i+Math.PI)/t.TwoPi)},t.TwoPi=2*Math.PI,t}(),r=function(){function t(){}return t.BuildArray=function(t,i){for(var n=[],s=0;s<t;++s)n.push(i());return n},t}(),e=function(){function t(){}return t.GetClass=function(t){return this.RegisteredTypes&&this.RegisteredTypes[t]?this.RegisteredTypes[t]:null},t.RegisteredTypes={},t}(),u=function(){function t(t,i){void 0===t&&(t=0),void 0===i&&(i=0),this.x=t,this.y=i}return t.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+"}"},t.prototype.getClassName=function(){return"Vector2"},t.prototype.getHashCode=function(){var t=0|this.x;return t=397*t^(0|this.y)},t.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,this},t.prototype.asArray=function(){var t=new Array;return this.toArray(t,0),t},t.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this},t.prototype.copyFromFloats=function(t,i){return this.x=t,this.y=i,this},t.prototype.set=function(t,i){return this.copyFromFloats(t,i)},t.prototype.add=function(i){return new t(this.x+i.x,this.y+i.y)},t.prototype.addToRef=function(t,i){return i.x=this.x+t.x,i.y=this.y+t.y,this},t.prototype.addInPlace=function(t){return this.x+=t.x,this.y+=t.y,this},t.prototype.addVector3=function(i){return new t(this.x+i.x,this.y+i.y)},t.prototype.subtract=function(i){return new t(this.x-i.x,this.y-i.y)},t.prototype.subtractToRef=function(t,i){return i.x=this.x-t.x,i.y=this.y-t.y,this},t.prototype.subtractInPlace=function(t){return this.x-=t.x,this.y-=t.y,this},t.prototype.multiplyInPlace=function(t){return this.x*=t.x,this.y*=t.y,this},t.prototype.multiply=function(i){return new t(this.x*i.x,this.y*i.y)},t.prototype.multiplyToRef=function(t,i){return i.x=this.x*t.x,i.y=this.y*t.y,this},t.prototype.multiplyByFloats=function(i,n){return new t(this.x*i,this.y*n)},t.prototype.divide=function(i){return new t(this.x/i.x,this.y/i.y)},t.prototype.divideToRef=function(t,i){return i.x=this.x/t.x,i.y=this.y/t.y,this},t.prototype.divideInPlace=function(t){return this.divideToRef(t,this)},t.prototype.negate=function(){return new t(-this.x,-this.y)},t.prototype.negateInPlace=function(){return this.x*=-1,this.y*=-1,this},t.prototype.negateToRef=function(t){return t.copyFromFloats(-1*this.x,-1*this.y)},t.prototype.scaleInPlace=function(t){return this.x*=t,this.y*=t,this},t.prototype.scale=function(i){var n=new t(0,0);return this.scaleToRef(i,n),n},t.prototype.scaleToRef=function(t,i){return i.x=this.x*t,i.y=this.y*t,this},t.prototype.scaleAndAddToRef=function(t,i){return i.x+=this.x*t,i.y+=this.y*t,this},t.prototype.equals=function(t){return t&&this.x===t.x&&this.y===t.y},t.prototype.equalsWithEpsilon=function(t,i){return void 0===i&&(i=.001),t&&h.WithinEpsilon(this.x,t.x,i)&&h.WithinEpsilon(this.y,t.y,i)},t.prototype.floor=function(){return new t(Math.floor(this.x),Math.floor(this.y))},t.prototype.fract=function(){return new t(this.x-Math.floor(this.x),this.y-Math.floor(this.y))},t.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},t.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y},t.prototype.normalize=function(){var t=this.length();return 0===t?this:(this.x/=t,this.y/=t,this)},t.prototype.clone=function(){return new t(this.x,this.y)},t.Zero=function(){return new t(0,0)},t.One=function(){return new t(1,1)},t.FromArray=function(i,n){return void 0===n&&(n=0),new t(i[n],i[n+1])},t.FromArrayToRef=function(t,i,n){n.x=t[i],n.y=t[i+1]},t.CatmullRom=function(i,n,s,h,r){var e=r*r,u=r*e;return new t(.5*(2*n.x+(-i.x+s.x)*r+(2*i.x-5*n.x+4*s.x-h.x)*e+(-i.x+3*n.x-3*s.x+h.x)*u),.5*(2*n.y+(-i.y+s.y)*r+(2*i.y-5*n.y+4*s.y-h.y)*e+(-i.y+3*n.y-3*s.y+h.y)*u))},t.Clamp=function(i,n,s){var h=i.x;h=(h=h>s.x?s.x:h)<n.x?n.x:h;var r=i.y;return new t(h,r=(r=r>s.y?s.y:r)<n.y?n.y:r)},t.Hermite=function(i,n,s,h,r){var e=r*r,u=r*e,o=2*u-3*e+1,f=-2*u+3*e,c=u-2*e+r,a=u-e;return new t(i.x*o+s.x*f+n.x*c+h.x*a,i.y*o+s.y*f+n.y*c+h.y*a)},t.Lerp=function(i,n,s){return new t(i.x+(n.x-i.x)*s,i.y+(n.y-i.y)*s)},t.Dot=function(t,i){return t.x*i.x+t.y*i.y},t.Normalize=function(t){var i=t.clone();return i.normalize(),i},t.Minimize=function(i,n){return new t(i.x<n.x?i.x:n.x,i.y<n.y?i.y:n.y)},t.Maximize=function(i,n){return new t(i.x>n.x?i.x:n.x,i.y>n.y?i.y:n.y)},t.Transform=function(i,n){var s=t.Zero();return t.TransformToRef(i,n,s),s},t.TransformToRef=function(t,i,n){var s=i.m,h=t.x*s[0]+t.y*s[4]+s[12],r=t.x*s[1]+t.y*s[5]+s[13];n.x=h,n.y=r},t.PointInTriangle=function(t,i,n,s){var h=.5*(-n.y*s.x+i.y*(-n.x+s.x)+i.x*(n.y-s.y)+n.x*s.y),r=h<0?-1:1,e=(i.y*s.x-i.x*s.y+(s.y-i.y)*t.x+(i.x-s.x)*t.y)*r,u=(i.x*n.y-i.y*n.x+(i.y-n.y)*t.x+(n.x-i.x)*t.y)*r;return e>0&&u>0&&e+u<2*h*r},t.Distance=function(i,n){return Math.sqrt(t.DistanceSquared(i,n))},t.DistanceSquared=function(t,i){var n=t.x-i.x,s=t.y-i.y;return n*n+s*s},t.Center=function(t,i){var n=t.add(i);return n.scaleInPlace(.5),n},t.DistanceOfPointFromSegment=function(i,n,s){var h=t.DistanceSquared(n,s);if(0===h)return t.Distance(i,n);var r=s.subtract(n),e=Math.max(0,Math.min(1,t.Dot(i.subtract(n),r)/h)),u=n.add(r.multiplyByFloats(e,e));return t.Distance(i,u)},t}(),o=function(){function t(t,i,n){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),this.u=!0,this.v=t,this.j=i,this.O=n}return Object.defineProperty(t.prototype,"x",{get:function(){return this.v},set:function(t){this.v=t,this.u=!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this.j},set:function(t){this.j=t,this.u=!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"z",{get:function(){return this.O},set:function(t){this.O=t,this.u=!0},enumerable:!1,configurable:!0}),t.prototype.toString=function(){return"{X: "+this.v+" Y:"+this.j+" Z:"+this.O+"}"},t.prototype.getClassName=function(){return"Vector3"},t.prototype.getHashCode=function(){var t=0|this.v;return t=397*(t=397*t^(0|this.j))^(0|this.O)},t.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},t.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.v,t[i+1]=this.j,t[i+2]=this.O,this},t.prototype.toQuaternion=function(){return c.RotationYawPitchRoll(this.j,this.v,this.O)},t.prototype.addInPlace=function(t){return this.addInPlaceFromFloats(t.v,t.j,t.O)},t.prototype.addInPlaceFromFloats=function(t,i,n){return this.x+=t,this.y+=i,this.z+=n,this},t.prototype.add=function(i){return new t(this.v+i.v,this.j+i.j,this.O+i.O)},t.prototype.addToRef=function(t,i){return i.copyFromFloats(this.v+t.v,this.j+t.j,this.O+t.O)},t.prototype.subtractInPlace=function(t){return this.x-=t.v,this.y-=t.j,this.z-=t.O,this},t.prototype.subtract=function(i){return new t(this.v-i.v,this.j-i.j,this.O-i.O)},t.prototype.subtractToRef=function(t,i){return this.subtractFromFloatsToRef(t.v,t.j,t.O,i)},t.prototype.subtractFromFloats=function(i,n,s){return new t(this.v-i,this.j-n,this.O-s)},t.prototype.subtractFromFloatsToRef=function(t,i,n,s){return s.copyFromFloats(this.v-t,this.j-i,this.O-n)},t.prototype.negate=function(){return new t(-this.v,-this.j,-this.O)},t.prototype.negateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},t.prototype.negateToRef=function(t){return t.copyFromFloats(-1*this.v,-1*this.j,-1*this.O)},t.prototype.scaleInPlace=function(t){return this.x*=t,this.y*=t,this.z*=t,this},t.prototype.scale=function(i){return new t(this.v*i,this.j*i,this.O*i)},t.prototype.scaleToRef=function(t,i){return i.copyFromFloats(this.v*t,this.j*t,this.O*t)},t.prototype.scaleAndAddToRef=function(t,i){return i.addInPlaceFromFloats(this.v*t,this.j*t,this.O*t)},t.prototype.projectOnPlane=function(i,n){var s=t.Zero();return this.projectOnPlaneToRef(i,n,s),s},t.prototype.projectOnPlaneToRef=function(i,n,s){var h=i.normal,r=i.d,e=l.Vector3[0];this.subtractToRef(n,e),e.normalize();var u=t.Dot(e,h),o=-(t.Dot(n,h)+r)/u,f=e.scaleInPlace(o);n.addToRef(f,s)},t.prototype.equals=function(t){return t&&this.v===t.v&&this.j===t.j&&this.O===t.O},t.prototype.equalsWithEpsilon=function(t,i){return void 0===i&&(i=.001),t&&h.WithinEpsilon(this.v,t.v,i)&&h.WithinEpsilon(this.j,t.j,i)&&h.WithinEpsilon(this.O,t.O,i)},t.prototype.equalsToFloats=function(t,i,n){return this.v===t&&this.j===i&&this.O===n},t.prototype.multiplyInPlace=function(t){return this.x*=t.v,this.y*=t.j,this.z*=t.O,this},t.prototype.multiply=function(t){return this.multiplyByFloats(t.v,t.j,t.O)},t.prototype.multiplyToRef=function(t,i){return i.copyFromFloats(this.v*t.v,this.j*t.j,this.O*t.O)},t.prototype.multiplyByFloats=function(i,n,s){return new t(this.v*i,this.j*n,this.O*s)},t.prototype.divide=function(i){return new t(this.v/i.v,this.j/i.j,this.O/i.O)},t.prototype.divideToRef=function(t,i){return i.copyFromFloats(this.v/t.v,this.j/t.j,this.O/t.O)},t.prototype.divideInPlace=function(t){return this.divideToRef(t,this)},t.prototype.minimizeInPlace=function(t){return this.minimizeInPlaceFromFloats(t.v,t.j,t.O)},t.prototype.maximizeInPlace=function(t){return this.maximizeInPlaceFromFloats(t.v,t.j,t.O)},t.prototype.minimizeInPlaceFromFloats=function(t,i,n){return t<this.v&&(this.x=t),i<this.j&&(this.y=i),n<this.O&&(this.z=n),this},t.prototype.maximizeInPlaceFromFloats=function(t,i,n){return t>this.v&&(this.x=t),i>this.j&&(this.y=i),n>this.O&&(this.z=n),this},t.prototype.isNonUniformWithinEpsilon=function(t){var i=Math.abs(this.v),n=Math.abs(this.j);if(!h.WithinEpsilon(i,n,t))return!0;var s=Math.abs(this.O);return!h.WithinEpsilon(i,s,t)||!h.WithinEpsilon(n,s,t)},Object.defineProperty(t.prototype,"isNonUniform",{get:function(){var t=Math.abs(this.v);return t!==Math.abs(this.j)||t!==Math.abs(this.O)},enumerable:!1,configurable:!0}),t.prototype.floor=function(){return new t(Math.floor(this.v),Math.floor(this.j),Math.floor(this.O))},t.prototype.fract=function(){return new t(this.v-Math.floor(this.v),this.j-Math.floor(this.j),this.O-Math.floor(this.O))},t.prototype.length=function(){return Math.sqrt(this.v*this.v+this.j*this.j+this.O*this.O)},t.prototype.lengthSquared=function(){return this.v*this.v+this.j*this.j+this.O*this.O},t.prototype.normalize=function(){return this.normalizeFromLength(this.length())},t.prototype.reorderInPlace=function(t){var i=this;return"xyz"===(t=t.toLowerCase())?this:(l.Vector3[0].copyFrom(this),["x","y","z"].forEach((function(n,s){i[n]=l.Vector3[0][t[s]]})),this)},t.prototype.rotateByQuaternionToRef=function(i,n){return i.toRotationMatrix(l.Matrix[0]),t.TransformCoordinatesToRef(this,l.Matrix[0],n),n},t.prototype.rotateByQuaternionAroundPointToRef=function(t,i,n){return this.subtractToRef(i,l.Vector3[0]),l.Vector3[0].rotateByQuaternionToRef(t,l.Vector3[0]),i.addToRef(l.Vector3[0],n),n},t.prototype.cross=function(i){return t.Cross(this,i)},t.prototype.normalizeFromLength=function(t){return 0===t||1===t?this:this.scaleInPlace(1/t)},t.prototype.normalizeToNew=function(){var i=new t(0,0,0);return this.normalizeToRef(i),i},t.prototype.normalizeToRef=function(t){var i=this.length();return 0===i||1===i?t.copyFromFloats(this.v,this.j,this.O):this.scaleToRef(1/i,t)},t.prototype.clone=function(){return new t(this.v,this.j,this.O)},t.prototype.copyFrom=function(t){return this.copyFromFloats(t.v,t.j,t.O)},t.prototype.copyFromFloats=function(t,i,n){return this.x=t,this.y=i,this.z=n,this},t.prototype.set=function(t,i,n){return this.copyFromFloats(t,i,n)},t.prototype.setAll=function(t){return this.x=this.y=this.z=t,this},t.GetClipFactor=function(i,n,s,h){var r=t.Dot(i,s)-h;return r/(r-(t.Dot(n,s)-h))},t.GetAngleBetweenVectors=function(i,n,s){var h=i.normalizeToRef(l.Vector3[1]),r=n.normalizeToRef(l.Vector3[2]),e=t.Dot(h,r),u=l.Vector3[3];return t.CrossToRef(h,r,u),t.Dot(u,s)>0?Math.acos(e):-Math.acos(e)},t.FromArray=function(i,n){return void 0===n&&(n=0),new t(i[n],i[n+1],i[n+2])},t.FromFloatArray=function(i,n){return t.FromArray(i,n)},t.FromArrayToRef=function(t,i,n){n.x=t[i],n.y=t[i+1],n.z=t[i+2]},t.FromFloatArrayToRef=function(i,n,s){return t.FromArrayToRef(i,n,s)},t.FromFloatsToRef=function(t,i,n,s){s.copyFromFloats(t,i,n)},t.Zero=function(){return new t(0,0,0)},t.One=function(){return new t(1,1,1)},t.Up=function(){return new t(0,1,0)},Object.defineProperty(t,"UpReadOnly",{get:function(){return t.A},enumerable:!1,configurable:!0}),Object.defineProperty(t,"ZeroReadOnly",{get:function(){return t.M},enumerable:!1,configurable:!0}),t.Down=function(){return new t(0,-1,0)},t.Forward=function(i){return void 0===i&&(i=!1),new t(0,0,i?-1:1)},t.Backward=function(i){return void 0===i&&(i=!1),new t(0,0,i?1:-1)},t.Right=function(){return new t(1,0,0)},t.Left=function(){return new t(-1,0,0)},t.TransformCoordinates=function(i,n){var s=t.Zero();return t.TransformCoordinatesToRef(i,n,s),s},t.TransformCoordinatesToRef=function(i,n,s){t.TransformCoordinatesFromFloatsToRef(i.v,i.j,i.O,n,s)},t.TransformCoordinatesFromFloatsToRef=function(t,i,n,s,h){var r=s.m,e=t*r[0]+i*r[4]+n*r[8]+r[12],u=t*r[1]+i*r[5]+n*r[9]+r[13],o=t*r[2]+i*r[6]+n*r[10]+r[14],f=1/(t*r[3]+i*r[7]+n*r[11]+r[15]);h.x=e*f,h.y=u*f,h.z=o*f},t.TransformNormal=function(i,n){var s=t.Zero();return t.TransformNormalToRef(i,n,s),s},t.TransformNormalToRef=function(t,i,n){this.TransformNormalFromFloatsToRef(t.v,t.j,t.O,i,n)},t.TransformNormalFromFloatsToRef=function(t,i,n,s,h){var r=s.m;h.x=t*r[0]+i*r[4]+n*r[8],h.y=t*r[1]+i*r[5]+n*r[9],h.z=t*r[2]+i*r[6]+n*r[10]},t.CatmullRom=function(i,n,s,h,r){var e=r*r,u=r*e;return new t(.5*(2*n.v+(-i.v+s.v)*r+(2*i.v-5*n.v+4*s.v-h.v)*e+(-i.v+3*n.v-3*s.v+h.v)*u),.5*(2*n.j+(-i.j+s.j)*r+(2*i.j-5*n.j+4*s.j-h.j)*e+(-i.j+3*n.j-3*s.j+h.j)*u),.5*(2*n.O+(-i.O+s.O)*r+(2*i.O-5*n.O+4*s.O-h.O)*e+(-i.O+3*n.O-3*s.O+h.O)*u))},t.Clamp=function(i,n,s){var h=new t;return t.ClampToRef(i,n,s,h),h},t.ClampToRef=function(t,i,n,s){var h=t.v;h=(h=h>n.v?n.v:h)<i.v?i.v:h;var r=t.j;r=(r=r>n.j?n.j:r)<i.j?i.j:r;var e=t.O;e=(e=e>n.O?n.O:e)<i.O?i.O:e,s.copyFromFloats(h,r,e)},t.CheckExtends=function(t,i,n){i.minimizeInPlace(t),n.maximizeInPlace(t)},t.Hermite=function(i,n,s,h,r){var e=r*r,u=r*e,o=2*u-3*e+1,f=-2*u+3*e,c=u-2*e+r,a=u-e;return new t(i.v*o+s.v*f+n.v*c+h.v*a,i.j*o+s.j*f+n.j*c+h.j*a,i.O*o+s.O*f+n.O*c+h.O*a)},t.Lerp=function(i,n,s){var h=new t(0,0,0);return t.LerpToRef(i,n,s,h),h},t.LerpToRef=function(t,i,n,s){s.x=t.v+(i.v-t.v)*n,s.y=t.j+(i.j-t.j)*n,s.z=t.O+(i.O-t.O)*n},t.Dot=function(t,i){return t.v*i.v+t.j*i.j+t.O*i.O},t.Cross=function(i,n){var s=t.Zero();return t.CrossToRef(i,n,s),s},t.CrossToRef=function(t,i,n){var s=t.j*i.O-t.O*i.j,h=t.O*i.v-t.v*i.O,r=t.v*i.j-t.j*i.v;n.copyFromFloats(s,h,r)},t.Normalize=function(i){var n=t.Zero();return t.NormalizeToRef(i,n),n},t.NormalizeToRef=function(t,i){t.normalizeToRef(i)},t.Project=function(i,n,s,h){var r=h.width,e=h.height,u=h.x,o=h.y,f=l.Matrix[1];a.FromValuesToRef(r/2,0,0,0,0,-e/2,0,0,0,0,.5,0,u+r/2,e/2+o,.5,1,f);var c=l.Matrix[0];return n.multiplyToRef(s,c),c.multiplyToRef(f,c),t.TransformCoordinates(i,c)},t.K=function(i,n,s){t.TransformCoordinatesToRef(i,n,s);var r=n.m,e=i.v*r[3]+i.j*r[7]+i.O*r[11]+r[15];h.WithinEpsilon(e,1)&&s.scaleInPlace(1/e)},t.UnprojectFromTransform=function(i,n,s,h,r){var e=l.Matrix[0];h.multiplyToRef(r,e),e.invert(),i.x=i.v/n*2-1,i.y=-(i.j/s*2-1);var u=new t;return t.K(i,e,u),u},t.Unproject=function(i,n,s,h,r,e){var u=t.Zero();return t.UnprojectToRef(i,n,s,h,r,e,u),u},t.UnprojectToRef=function(i,n,s,h,r,e,u){t.UnprojectFloatsToRef(i.v,i.j,i.O,n,s,h,r,e,u)},t.UnprojectFloatsToRef=function(i,n,s,h,r,e,u,o,f){var c=l.Matrix[0];e.multiplyToRef(u,c),c.multiplyToRef(o,c),c.invert();var a=l.Vector3[0];a.x=i/h*2-1,a.y=-(n/r*2-1),a.z=2*s-1,t.K(a,c,f)},t.Minimize=function(t,i){var n=t.clone();return n.minimizeInPlace(i),n},t.Maximize=function(t,i){var n=t.clone();return n.maximizeInPlace(i),n},t.Distance=function(i,n){return Math.sqrt(t.DistanceSquared(i,n))},t.DistanceSquared=function(t,i){var n=t.v-i.v,s=t.j-i.j,h=t.O-i.O;return n*n+s*s+h*h},t.Center=function(t,i){var n=t.add(i);return n.scaleInPlace(.5),n},t.RotationFromAxis=function(i,n,s){var h=t.Zero();return t.RotationFromAxisToRef(i,n,s,h),h},t.RotationFromAxisToRef=function(t,i,n,s){var h=l.Quaternion[0];c.RotationQuaternionFromAxisToRef(t,i,n,h),h.toEulerAnglesToRef(s)},t.A=t.Up(),t.M=t.Zero(),t}(),f=function(){function t(t,i,n,s){this.x=t,this.y=i,this.z=n,this.w=s}return t.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+" W:"+this.w+"}"},t.prototype.getClassName=function(){return"Vector4"},t.prototype.getHashCode=function(){var t=0|this.x;return t=397*(t=397*(t=397*t^(0|this.y))^(0|this.z))^(0|this.w)},t.prototype.asArray=function(){var t=new Array;return this.toArray(t,0),t},t.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t[i+3]=this.w,this},t.prototype.addInPlace=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},t.prototype.add=function(i){return new t(this.x+i.x,this.y+i.y,this.z+i.z,this.w+i.w)},t.prototype.addToRef=function(t,i){return i.x=this.x+t.x,i.y=this.y+t.y,i.z=this.z+t.z,i.w=this.w+t.w,this},t.prototype.subtractInPlace=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this},t.prototype.subtract=function(i){return new t(this.x-i.x,this.y-i.y,this.z-i.z,this.w-i.w)},t.prototype.subtractToRef=function(t,i){return i.x=this.x-t.x,i.y=this.y-t.y,i.z=this.z-t.z,i.w=this.w-t.w,this},t.prototype.subtractFromFloats=function(i,n,s,h){return new t(this.x-i,this.y-n,this.z-s,this.w-h)},t.prototype.subtractFromFloatsToRef=function(t,i,n,s,h){return h.x=this.x-t,h.y=this.y-i,h.z=this.z-n,h.w=this.w-s,this},t.prototype.negate=function(){return new t(-this.x,-this.y,-this.z,-this.w)},t.prototype.negateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1,this},t.prototype.negateToRef=function(t){return t.copyFromFloats(-1*this.x,-1*this.y,-1*this.z,-1*this.w)},t.prototype.scaleInPlace=function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},t.prototype.scale=function(i){return new t(this.x*i,this.y*i,this.z*i,this.w*i)},t.prototype.scaleToRef=function(t,i){return i.x=this.x*t,i.y=this.y*t,i.z=this.z*t,i.w=this.w*t,this},t.prototype.scaleAndAddToRef=function(t,i){return i.x+=this.x*t,i.y+=this.y*t,i.z+=this.z*t,i.w+=this.w*t,this},t.prototype.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},t.prototype.equalsWithEpsilon=function(t,i){return void 0===i&&(i=.001),t&&h.WithinEpsilon(this.x,t.x,i)&&h.WithinEpsilon(this.y,t.y,i)&&h.WithinEpsilon(this.z,t.z,i)&&h.WithinEpsilon(this.w,t.w,i)},t.prototype.equalsToFloats=function(t,i,n,s){return this.x===t&&this.y===i&&this.z===n&&this.w===s},t.prototype.multiplyInPlace=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this},t.prototype.multiply=function(i){return new t(this.x*i.x,this.y*i.y,this.z*i.z,this.w*i.w)},t.prototype.multiplyToRef=function(t,i){return i.x=this.x*t.x,i.y=this.y*t.y,i.z=this.z*t.z,i.w=this.w*t.w,this},t.prototype.multiplyByFloats=function(i,n,s,h){return new t(this.x*i,this.y*n,this.z*s,this.w*h)},t.prototype.divide=function(i){return new t(this.x/i.x,this.y/i.y,this.z/i.z,this.w/i.w)},t.prototype.divideToRef=function(t,i){return i.x=this.x/t.x,i.y=this.y/t.y,i.z=this.z/t.z,i.w=this.w/t.w,this},t.prototype.divideInPlace=function(t){return this.divideToRef(t,this)},t.prototype.minimizeInPlace=function(t){return t.x<this.x&&(this.x=t.x),t.y<this.y&&(this.y=t.y),t.z<this.z&&(this.z=t.z),t.w<this.w&&(this.w=t.w),this},t.prototype.maximizeInPlace=function(t){return t.x>this.x&&(this.x=t.x),t.y>this.y&&(this.y=t.y),t.z>this.z&&(this.z=t.z),t.w>this.w&&(this.w=t.w),this},t.prototype.floor=function(){return new t(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))},t.prototype.fract=function(){return new t(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z),this.w-Math.floor(this.w))},t.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},t.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},t.prototype.normalize=function(){var t=this.length();return 0===t?this:this.scaleInPlace(1/t)},t.prototype.toVector3=function(){return new o(this.x,this.y,this.z)},t.prototype.clone=function(){return new t(this.x,this.y,this.z,this.w)},t.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},t.prototype.copyFromFloats=function(t,i,n,s){return this.x=t,this.y=i,this.z=n,this.w=s,this},t.prototype.set=function(t,i,n,s){return this.copyFromFloats(t,i,n,s)},t.prototype.setAll=function(t){return this.x=this.y=this.z=this.w=t,this},t.FromArray=function(i,n){return n||(n=0),new t(i[n],i[n+1],i[n+2],i[n+3])},t.FromArrayToRef=function(t,i,n){n.x=t[i],n.y=t[i+1],n.z=t[i+2],n.w=t[i+3]},t.FromFloatArrayToRef=function(i,n,s){t.FromArrayToRef(i,n,s)},t.FromFloatsToRef=function(t,i,n,s,h){h.x=t,h.y=i,h.z=n,h.w=s},t.Zero=function(){return new t(0,0,0,0)},t.One=function(){return new t(1,1,1,1)},t.Normalize=function(i){var n=t.Zero();return t.NormalizeToRef(i,n),n},t.NormalizeToRef=function(t,i){i.copyFrom(t),i.normalize()},t.Minimize=function(t,i){var n=t.clone();return n.minimizeInPlace(i),n},t.Maximize=function(t,i){var n=t.clone();return n.maximizeInPlace(i),n},t.Distance=function(i,n){return Math.sqrt(t.DistanceSquared(i,n))},t.DistanceSquared=function(t,i){var n=t.x-i.x,s=t.y-i.y,h=t.z-i.z,r=t.w-i.w;return n*n+s*s+h*h+r*r},t.Center=function(t,i){var n=t.add(i);return n.scaleInPlace(.5),n},t.TransformNormal=function(i,n){var s=t.Zero();return t.TransformNormalToRef(i,n,s),s},t.TransformNormalToRef=function(t,i,n){var s=i.m,h=t.x*s[0]+t.y*s[4]+t.z*s[8],r=t.x*s[1]+t.y*s[5]+t.z*s[9],e=t.x*s[2]+t.y*s[6]+t.z*s[10];n.x=h,n.y=r,n.z=e,n.w=t.w},t.TransformNormalFromFloatsToRef=function(t,i,n,s,h,r){var e=h.m;r.x=t*e[0]+i*e[4]+n*e[8],r.y=t*e[1]+i*e[5]+n*e[9],r.z=t*e[2]+i*e[6]+n*e[10],r.w=s},t.FromVector3=function(i,n){return void 0===n&&(n=0),new t(i.v,i.j,i.O,n)},t}(),c=function(){function t(t,i,n,s){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===s&&(s=1),this.u=!0,this.v=t,this.j=i,this.O=n,this.P=s}return Object.defineProperty(t.prototype,"x",{get:function(){return this.v},set:function(t){this.v=t,this.u=!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this.j},set:function(t){this.j=t,this.u=!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"z",{get:function(){return this.O},set:function(t){this.O=t,this.u=!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"w",{get:function(){return this.P},set:function(t){this.P=t,this.u=!0},enumerable:!1,configurable:!0}),t.prototype.toString=function(){return"{X: "+this.v+" Y:"+this.j+" Z:"+this.O+" W:"+this.P+"}"},t.prototype.getClassName=function(){return"Quaternion"},t.prototype.getHashCode=function(){var t=0|this.v;return t=397*(t=397*(t=397*t^(0|this.j))^(0|this.O))^(0|this.P)},t.prototype.asArray=function(){return[this.v,this.j,this.O,this.P]},t.prototype.equals=function(t){return t&&this.v===t.v&&this.j===t.j&&this.O===t.O&&this.P===t.P},t.prototype.equalsWithEpsilon=function(t,i){return void 0===i&&(i=.001),t&&h.WithinEpsilon(this.v,t.v,i)&&h.WithinEpsilon(this.j,t.j,i)&&h.WithinEpsilon(this.O,t.O,i)&&h.WithinEpsilon(this.P,t.P,i)},t.prototype.clone=function(){return new t(this.v,this.j,this.O,this.P)},t.prototype.copyFrom=function(t){return this.x=t.v,this.y=t.j,this.z=t.O,this.w=t.P,this},t.prototype.copyFromFloats=function(t,i,n,s){return this.x=t,this.y=i,this.z=n,this.w=s,this},t.prototype.set=function(t,i,n,s){return this.copyFromFloats(t,i,n,s)},t.prototype.add=function(i){return new t(this.v+i.v,this.j+i.j,this.O+i.O,this.P+i.P)},t.prototype.addInPlace=function(t){return this.v+=t.v,this.j+=t.j,this.O+=t.O,this.P+=t.P,this},t.prototype.subtract=function(i){return new t(this.v-i.v,this.j-i.j,this.O-i.O,this.P-i.P)},t.prototype.scale=function(i){return new t(this.v*i,this.j*i,this.O*i,this.P*i)},t.prototype.scaleToRef=function(t,i){return i.x=this.v*t,i.y=this.j*t,i.z=this.O*t,i.w=this.P*t,this},t.prototype.scaleInPlace=function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},t.prototype.scaleAndAddToRef=function(t,i){return i.x+=this.v*t,i.y+=this.j*t,i.z+=this.O*t,i.w+=this.P*t,this},t.prototype.multiply=function(i){var n=new t(0,0,0,1);return this.multiplyToRef(i,n),n},t.prototype.multiplyToRef=function(t,i){var n=this.v*t.P+this.j*t.O-this.O*t.j+this.P*t.v,s=-this.v*t.O+this.j*t.P+this.O*t.v+this.P*t.j,h=this.v*t.j-this.j*t.v+this.O*t.P+this.P*t.O,r=-this.v*t.v-this.j*t.j-this.O*t.O+this.P*t.P;return i.copyFromFloats(n,s,h,r),this},t.prototype.multiplyInPlace=function(t){return this.multiplyToRef(t,this),this},t.prototype.conjugateToRef=function(t){return t.copyFromFloats(-this.v,-this.j,-this.O,this.P),this},t.prototype.conjugateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},t.prototype.conjugate=function(){return new t(-this.v,-this.j,-this.O,this.P)},t.prototype.length=function(){return Math.sqrt(this.v*this.v+this.j*this.j+this.O*this.O+this.P*this.P)},t.prototype.normalize=function(){var t=this.length();if(0===t)return this;var i=1/t;return this.x*=i,this.y*=i,this.z*=i,this.w*=i,this},t.prototype.toEulerAngles=function(t){void 0===t&&(t="YZX");var i=o.Zero();return this.toEulerAnglesToRef(i),i},t.prototype.toEulerAnglesToRef=function(t){var i=this.O,n=this.v,s=this.j,h=this.P,r=h*h,e=i*i,u=n*n,o=s*s,f=s*i-n*h;return f<-.4999999?(t.y=2*Math.atan2(s,h),t.x=Math.PI/2,t.z=0):f>.4999999?(t.y=2*Math.atan2(s,h),t.x=-Math.PI/2,t.z=0):(t.z=Math.atan2(2*(n*s+i*h),-e-u+o+r),t.x=Math.asin(-2*(i*s-n*h)),t.y=Math.atan2(2*(i*n+s*h),e-u-o+r)),this},t.prototype.toRotationMatrix=function(t){return a.FromQuaternionToRef(this,t),this},t.prototype.fromRotationMatrix=function(i){return t.FromRotationMatrixToRef(i,this),this},t.FromRotationMatrix=function(i){var n=new t;return t.FromRotationMatrixToRef(i,n),n},t.FromRotationMatrixToRef=function(t,i){var n,s=t.m,h=s[0],r=s[4],e=s[8],u=s[1],o=s[5],f=s[9],c=s[2],a=s[6],l=s[10],v=h+o+l;v>0?(n=.5/Math.sqrt(v+1),i.w=.25/n,i.x=(a-f)*n,i.y=(e-c)*n,i.z=(u-r)*n):h>o&&h>l?(n=2*Math.sqrt(1+h-o-l),i.w=(a-f)/n,i.x=.25*n,i.y=(r+u)/n,i.z=(e+c)/n):o>l?(n=2*Math.sqrt(1+o-h-l),i.w=(e-c)/n,i.x=(r+u)/n,i.y=.25*n,i.z=(f+a)/n):(n=2*Math.sqrt(1+l-h-o),i.w=(u-r)/n,i.x=(e+c)/n,i.y=(f+a)/n,i.z=.25*n)},t.Dot=function(t,i){return t.v*i.v+t.j*i.j+t.O*i.O+t.P*i.P},t.AreClose=function(i,n){return t.Dot(i,n)>=0},t.Zero=function(){return new t(0,0,0,0)},t.Inverse=function(i){return new t(-i.v,-i.j,-i.O,i.P)},t.InverseToRef=function(t,i){return i.set(-t.v,-t.j,-t.O,t.P),i},t.Identity=function(){return new t(0,0,0,1)},t.IsIdentity=function(t){return t&&0===t.v&&0===t.j&&0===t.O&&1===t.P},t.RotationAxis=function(i,n){return t.RotationAxisToRef(i,n,new t)},t.RotationAxisToRef=function(t,i,n){var s=Math.sin(i/2);return t.normalize(),n.w=Math.cos(i/2),n.x=t.v*s,n.y=t.j*s,n.z=t.O*s,n},t.FromArray=function(i,n){return n||(n=0),new t(i[n],i[n+1],i[n+2],i[n+3])},t.FromArrayToRef=function(t,i,n){n.x=t[i],n.y=t[i+1],n.z=t[i+2],n.w=t[i+3]},t.FromEulerAngles=function(i,n,s){var h=new t;return t.RotationYawPitchRollToRef(n,i,s,h),h},t.FromEulerAnglesToRef=function(i,n,s,h){return t.RotationYawPitchRollToRef(n,i,s,h),h},t.FromEulerVector=function(i){var n=new t;return t.RotationYawPitchRollToRef(i.j,i.v,i.O,n),n},t.FromEulerVectorToRef=function(i,n){return t.RotationYawPitchRollToRef(i.j,i.v,i.O,n),n},t.RotationYawPitchRoll=function(i,n,s){var h=new t;return t.RotationYawPitchRollToRef(i,n,s,h),h},t.RotationYawPitchRollToRef=function(t,i,n,s){var h=.5*n,r=.5*i,e=.5*t,u=Math.sin(h),o=Math.cos(h),f=Math.sin(r),c=Math.cos(r),a=Math.sin(e),l=Math.cos(e);s.x=l*f*o+a*c*u,s.y=a*c*o-l*f*u,s.z=l*c*u-a*f*o,s.w=l*c*o+a*f*u},t.RotationAlphaBetaGamma=function(i,n,s){var h=new t;return t.RotationAlphaBetaGammaToRef(i,n,s,h),h},t.RotationAlphaBetaGammaToRef=function(t,i,n,s){var h=.5*(n+t),r=.5*(n-t),e=.5*i;s.x=Math.cos(r)*Math.sin(e),s.y=Math.sin(r)*Math.sin(e),s.z=Math.sin(h)*Math.cos(e),s.w=Math.cos(h)*Math.cos(e)},t.RotationQuaternionFromAxis=function(i,n,s){var h=new t(0,0,0,0);return t.RotationQuaternionFromAxisToRef(i,n,s,h),h},t.RotationQuaternionFromAxisToRef=function(i,n,s,h){var r=l.Matrix[0];a.FromXYZAxesToRef(i.normalize(),n.normalize(),s.normalize(),r),t.FromRotationMatrixToRef(r,h)},t.Slerp=function(i,n,s){var h=t.Identity();return t.SlerpToRef(i,n,s,h),h},t.SlerpToRef=function(t,i,n,s){var h,r,e=t.v*i.v+t.j*i.j+t.O*i.O+t.P*i.P,u=!1;if(e<0&&(u=!0,e=-e),e>.999999)r=1-n,h=u?-n:n;else{var o=Math.acos(e),f=1/Math.sin(o);r=Math.sin((1-n)*o)*f,h=u?-Math.sin(n*o)*f:Math.sin(n*o)*f}s.x=r*t.v+h*i.v,s.y=r*t.j+h*i.j,s.z=r*t.O+h*i.O,s.w=r*t.P+h*i.P},t.Hermite=function(i,n,s,h,r){var e=r*r,u=r*e,o=2*u-3*e+1,f=-2*u+3*e,c=u-2*e+r,a=u-e;return new t(i.v*o+s.v*f+n.v*c+h.v*a,i.j*o+s.j*f+n.j*c+h.j*a,i.O*o+s.O*f+n.O*c+h.O*a,i.P*o+s.P*f+n.P*c+h.P*a)},t}(),a=function(){function t(){this.k=!1,this.T=!0,this.B=!0,this.F=!0,this.updateFlag=-1,this.C=new Float32Array(16),this._(!1)}return Object.defineProperty(t.prototype,"m",{get:function(){return this.C},enumerable:!1,configurable:!0}),t.prototype.U=function(){this.updateFlag=t.R++,this.k=!1,this.B=!1,this.T=!0,this.F=!0},t.prototype._=function(i,n,s,h){void 0===n&&(n=!1),void 0===s&&(s=!1),void 0===h&&(h=!0),this.updateFlag=t.R++,this.k=i,this.B=i||s,this.T=!this.k&&n,this.F=!this.B&&h},t.prototype.isIdentity=function(){if(this.T){this.T=!1;var t=this.C;this.k=1===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&0===t[4]&&1===t[5]&&0===t[6]&&0===t[7]&&0===t[8]&&0===t[9]&&1===t[10]&&0===t[11]&&0===t[12]&&0===t[13]&&0===t[14]&&1===t[15]}return this.k},t.prototype.isIdentityAs3x2=function(){return this.F&&(this.F=!1,1!==this.C[0]||1!==this.C[5]||1!==this.C[15]?this.B=!1:0!==this.C[1]||0!==this.C[2]||0!==this.C[3]||0!==this.C[4]||0!==this.C[6]||0!==this.C[7]||0!==this.C[8]||0!==this.C[9]||0!==this.C[10]||0!==this.C[11]||0!==this.C[12]||0!==this.C[13]||0!==this.C[14]?this.B=!1:this.B=!0),this.B},t.prototype.determinant=function(){if(!0===this.k)return 1;var t=this.C,i=t[0],n=t[1],s=t[2],h=t[3],r=t[4],e=t[5],u=t[6],o=t[7],f=t[8],c=t[9],a=t[10],l=t[11],v=t[12],b=t[13],d=t[14],g=t[15],w=a*g-d*l,m=c*g-b*l,j=c*d-b*a,O=f*g-v*l,y=f*d-a*v,A=f*b-v*c;return i*+(e*w-u*m+o*j)+n*-(r*w-u*O+o*y)+s*+(r*m-e*O+o*A)+h*-(r*j-e*y+u*A)},t.prototype.toArray=function(){return this.C},t.prototype.asArray=function(){return this.C},t.prototype.invert=function(){return this.invertToRef(this),this},t.prototype.reset=function(){return t.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._(!1),this},t.prototype.add=function(i){var n=new t;return this.addToRef(i,n),n},t.prototype.addToRef=function(t,i){for(var n=this.C,s=i.C,h=t.m,r=0;r<16;r++)s[r]=n[r]+h[r];return i.U(),this},t.prototype.addToSelf=function(t){for(var i=this.C,n=t.m,s=0;s<16;s++)i[s]+=n[s];return this.U(),this},t.prototype.invertToRef=function(i){if(!0===this.k)return t.IdentityToRef(i),this;var n=this.C,s=n[0],h=n[1],r=n[2],e=n[3],u=n[4],o=n[5],f=n[6],c=n[7],a=n[8],l=n[9],v=n[10],b=n[11],d=n[12],g=n[13],w=n[14],m=n[15],j=v*m-w*b,O=l*m-g*b,y=l*w-g*v,A=a*m-d*b,p=a*w-v*d,M=a*g-d*l,K=+(o*j-f*O+c*y),P=-(u*j-f*A+c*p),x=+(u*O-o*A+c*M),k=-(u*y-o*p+f*M),E=s*K+h*P+r*x+e*k;if(0===E)return i.copyFrom(this),this;var T=1/E,B=f*m-w*c,F=o*m-g*c,C=o*w-g*f,_=u*m-d*c,U=u*w-d*f,R=u*g-d*o,S=f*b-v*c,L=o*b-l*c,D=o*v-l*f,I=u*b-a*c,N=u*v-a*f,X=u*l-a*o,W=-(h*j-r*O+e*y),G=+(s*j-r*A+e*p),q=-(s*O-h*A+e*M),Q=+(s*y-h*p+r*M),Y=+(h*B-r*F+e*C),V=-(s*B-r*_+e*U),H=+(s*F-h*_+e*R),z=-(s*C-h*U+r*R),Z=-(h*S-r*L+e*D),J=+(s*S-r*I+e*N),$=-(s*L-h*I+e*X),tt=+(s*D-h*N+r*X);return t.FromValuesToRef(K*T,W*T,Y*T,Z*T,P*T,G*T,V*T,J*T,x*T,q*T,H*T,$*T,k*T,Q*T,z*T,tt*T,i),this},t.prototype.addAtIndex=function(t,i){return this.C[t]+=i,this.U(),this},t.prototype.multiplyAtIndex=function(t,i){return this.C[t]*=i,this.U(),this},t.prototype.setTranslationFromFloats=function(t,i,n){return this.C[12]=t,this.C[13]=i,this.C[14]=n,this.U(),this},t.prototype.addTranslationFromFloats=function(t,i,n){return this.C[12]+=t,this.C[13]+=i,this.C[14]+=n,this.U(),this},t.prototype.setTranslation=function(t){return this.setTranslationFromFloats(t.v,t.j,t.O)},t.prototype.getTranslation=function(){return new o(this.C[12],this.C[13],this.C[14])},t.prototype.getTranslationToRef=function(t){return t.x=this.C[12],t.y=this.C[13],t.z=this.C[14],this},t.prototype.removeRotationAndScaling=function(){var i=this.m;return t.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,i[12],i[13],i[14],i[15],this),this._(0===i[12]&&0===i[13]&&0===i[14]&&1===i[15]),this},t.prototype.multiply=function(i){var n=new t;return this.multiplyToRef(i,n),n},t.prototype.copyFrom=function(t){t.copyToArray(this.C);var i=t;return this._(i.k,i.T,i.B,i.F),this},t.prototype.copyToArray=function(t,i){void 0===i&&(i=0);var n=this.C;return t[i]=n[0],t[i+1]=n[1],t[i+2]=n[2],t[i+3]=n[3],t[i+4]=n[4],t[i+5]=n[5],t[i+6]=n[6],t[i+7]=n[7],t[i+8]=n[8],t[i+9]=n[9],t[i+10]=n[10],t[i+11]=n[11],t[i+12]=n[12],t[i+13]=n[13],t[i+14]=n[14],t[i+15]=n[15],this},t.prototype.multiplyToRef=function(t,i){return this.k?(i.copyFrom(t),this):t.k?(i.copyFrom(this),this):(this.multiplyToArray(t,i.C,0),i.U(),this)},t.prototype.multiplyToArray=function(t,i,n){var s=this.C,h=t.m,r=s[0],e=s[1],u=s[2],o=s[3],f=s[4],c=s[5],a=s[6],l=s[7],v=s[8],b=s[9],d=s[10],g=s[11],w=s[12],m=s[13],j=s[14],O=s[15],y=h[0],A=h[1],p=h[2],M=h[3],K=h[4],P=h[5],x=h[6],k=h[7],E=h[8],T=h[9],B=h[10],F=h[11],C=h[12],_=h[13],U=h[14],R=h[15];return i[n]=r*y+e*K+u*E+o*C,i[n+1]=r*A+e*P+u*T+o*_,i[n+2]=r*p+e*x+u*B+o*U,i[n+3]=r*M+e*k+u*F+o*R,i[n+4]=f*y+c*K+a*E+l*C,i[n+5]=f*A+c*P+a*T+l*_,i[n+6]=f*p+c*x+a*B+l*U,i[n+7]=f*M+c*k+a*F+l*R,i[n+8]=v*y+b*K+d*E+g*C,i[n+9]=v*A+b*P+d*T+g*_,i[n+10]=v*p+b*x+d*B+g*U,i[n+11]=v*M+b*k+d*F+g*R,i[n+12]=w*y+m*K+j*E+O*C,i[n+13]=w*A+m*P+j*T+O*_,i[n+14]=w*p+m*x+j*B+O*U,i[n+15]=w*M+m*k+j*F+O*R,this},t.prototype.equals=function(t){var i=t;if(!i)return!1;if((this.k||i.k)&&!this.T&&!i.T)return this.k&&i.k;var n=this.m,s=i.m;return n[0]===s[0]&&n[1]===s[1]&&n[2]===s[2]&&n[3]===s[3]&&n[4]===s[4]&&n[5]===s[5]&&n[6]===s[6]&&n[7]===s[7]&&n[8]===s[8]&&n[9]===s[9]&&n[10]===s[10]&&n[11]===s[11]&&n[12]===s[12]&&n[13]===s[13]&&n[14]===s[14]&&n[15]===s[15]},t.prototype.clone=function(){var i=new t;return i.copyFrom(this),i},t.prototype.getClassName=function(){return"Matrix"},t.prototype.getHashCode=function(){for(var t=0|this.C[0],i=1;i<16;i++)t=397*t^(0|this.C[i]);return t},t.prototype.decompose=function(i,n,s){if(this.k)return s&&s.setAll(0),i&&i.setAll(1),n&&n.copyFromFloats(0,0,0,1),!0;var h=this.C;if(s&&s.copyFromFloats(h[12],h[13],h[14]),(i=i||l.Vector3[0]).x=Math.sqrt(h[0]*h[0]+h[1]*h[1]+h[2]*h[2]),i.y=Math.sqrt(h[4]*h[4]+h[5]*h[5]+h[6]*h[6]),i.z=Math.sqrt(h[8]*h[8]+h[9]*h[9]+h[10]*h[10]),this.determinant()<=0&&(i.y*=-1),0===i.v||0===i.j||0===i.O)return n&&n.copyFromFloats(0,0,0,1),!1;if(n){var r=1/i.v,e=1/i.j,u=1/i.O;t.FromValuesToRef(h[0]*r,h[1]*r,h[2]*r,0,h[4]*e,h[5]*e,h[6]*e,0,h[8]*u,h[9]*u,h[10]*u,0,0,0,0,1,l.Matrix[0]),c.FromRotationMatrixToRef(l.Matrix[0],n)}return!0},t.prototype.getRow=function(t){if(t<0||t>3)return null;var i=4*t;return new f(this.C[i+0],this.C[i+1],this.C[i+2],this.C[i+3])},t.prototype.setRow=function(t,i){return this.setRowFromFloats(t,i.x,i.y,i.z,i.w)},t.prototype.transpose=function(){return t.Transpose(this)},t.prototype.transposeToRef=function(i){return t.TransposeToRef(this,i),this},t.prototype.setRowFromFloats=function(t,i,n,s,h){if(t<0||t>3)return this;var r=4*t;return this.C[r+0]=i,this.C[r+1]=n,this.C[r+2]=s,this.C[r+3]=h,this.U(),this},t.prototype.scale=function(i){var n=new t;return this.scaleToRef(i,n),n},t.prototype.scaleToRef=function(t,i){for(var n=0;n<16;n++)i.C[n]=this.C[n]*t;return i.U(),this},t.prototype.scaleAndAddToRef=function(t,i){for(var n=0;n<16;n++)i.C[n]+=this.C[n]*t;return i.U(),this},t.prototype.toNormalMatrix=function(i){var n=l.Matrix[0];this.invertToRef(n),n.transposeToRef(i);var s=i.C;t.FromValuesToRef(s[0],s[1],s[2],0,s[4],s[5],s[6],0,s[8],s[9],s[10],0,0,0,0,1,i)},t.prototype.getRotationMatrix=function(){var i=new t;return this.getRotationMatrixToRef(i),i},t.prototype.getRotationMatrixToRef=function(i){var n=l.Vector3[0];if(!this.decompose(n))return t.IdentityToRef(i),this;var s=this.C,h=1/n.v,r=1/n.j,e=1/n.O;return t.FromValuesToRef(s[0]*h,s[1]*h,s[2]*h,0,s[4]*r,s[5]*r,s[6]*r,0,s[8]*e,s[9]*e,s[10]*e,0,0,0,0,1,i),this},t.prototype.toggleModelMatrixHandInPlace=function(){var t=this.C;t[2]*=-1,t[6]*=-1,t[8]*=-1,t[9]*=-1,t[14]*=-1,this.U()},t.prototype.toggleProjectionMatrixHandInPlace=function(){var t=this.C;t[8]*=-1,t[9]*=-1,t[10]*=-1,t[11]*=-1,this.U()},t.FromArray=function(i,n){void 0===n&&(n=0);var s=new t;return t.FromArrayToRef(i,n,s),s},t.FromArrayToRef=function(t,i,n){for(var s=0;s<16;s++)n.C[s]=t[s+i];n.U()},t.FromFloat32ArrayToRefScaled=function(t,i,n,s){for(var h=0;h<16;h++)s.C[h]=t[h+i]*n;s.U()},Object.defineProperty(t,"IdentityReadOnly",{get:function(){return t.S},enumerable:!1,configurable:!0}),t.FromValuesToRef=function(t,i,n,s,h,r,e,u,o,f,c,a,l,v,b,d,g){var w=g.C;w[0]=t,w[1]=i,w[2]=n,w[3]=s,w[4]=h,w[5]=r,w[6]=e,w[7]=u,w[8]=o,w[9]=f,w[10]=c,w[11]=a,w[12]=l,w[13]=v,w[14]=b,w[15]=d,g.U()},t.FromValues=function(i,n,s,h,r,e,u,o,f,c,a,l,v,b,d,g){var w=new t,m=w.C;return m[0]=i,m[1]=n,m[2]=s,m[3]=h,m[4]=r,m[5]=e,m[6]=u,m[7]=o,m[8]=f,m[9]=c,m[10]=a,m[11]=l,m[12]=v,m[13]=b,m[14]=d,m[15]=g,w.U(),w},t.Compose=function(i,n,s){var h=new t;return t.ComposeToRef(i,n,s,h),h},t.ComposeToRef=function(t,i,n,s){var h=s.C,r=i.v,e=i.j,u=i.O,o=i.P,f=r+r,c=e+e,a=u+u,l=r*f,v=r*c,b=r*a,d=e*c,g=e*a,w=u*a,m=o*f,j=o*c,O=o*a,y=t.v,A=t.j,p=t.O;h[0]=(1-(d+w))*y,h[1]=(v+O)*y,h[2]=(b-j)*y,h[3]=0,h[4]=(v-O)*A,h[5]=(1-(l+w))*A,h[6]=(g+m)*A,h[7]=0,h[8]=(b+j)*p,h[9]=(g-m)*p,h[10]=(1-(l+d))*p,h[11]=0,h[12]=n.v,h[13]=n.j,h[14]=n.O,h[15]=1,s.U()},t.Identity=function(){var i=t.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return i._(!0),i},t.IdentityToRef=function(i){t.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,i),i._(!0)},t.Zero=function(){var i=t.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return i._(!1),i},t.RotationX=function(i){var n=new t;return t.RotationXToRef(i,n),n},t.Invert=function(i){var n=new t;return i.invertToRef(n),n},t.RotationXToRef=function(i,n){var s=Math.sin(i),h=Math.cos(i);t.FromValuesToRef(1,0,0,0,0,h,s,0,0,-s,h,0,0,0,0,1,n),n._(1===h&&0===s)},t.RotationY=function(i){var n=new t;return t.RotationYToRef(i,n),n},t.RotationYToRef=function(i,n){var s=Math.sin(i),h=Math.cos(i);t.FromValuesToRef(h,0,-s,0,0,1,0,0,s,0,h,0,0,0,0,1,n),n._(1===h&&0===s)},t.RotationZ=function(i){var n=new t;return t.RotationZToRef(i,n),n},t.RotationZToRef=function(i,n){var s=Math.sin(i),h=Math.cos(i);t.FromValuesToRef(h,s,0,0,-s,h,0,0,0,0,1,0,0,0,0,1,n),n._(1===h&&0===s)},t.RotationAxis=function(i,n){var s=new t;return t.RotationAxisToRef(i,n,s),s},t.RotationAxisToRef=function(t,i,n){var s=Math.sin(-i),h=Math.cos(-i),r=1-h;t.normalize();var e=n.C;e[0]=t.v*t.v*r+h,e[1]=t.v*t.j*r-t.O*s,e[2]=t.v*t.O*r+t.j*s,e[3]=0,e[4]=t.j*t.v*r+t.O*s,e[5]=t.j*t.j*r+h,e[6]=t.j*t.O*r-t.v*s,e[7]=0,e[8]=t.O*t.v*r-t.j*s,e[9]=t.O*t.j*r+t.v*s,e[10]=t.O*t.O*r+h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,n.U()},t.RotationAlignToRef=function(t,i,n){var s=o.Cross(i,t),h=o.Dot(i,t),r=1/(1+h),e=n.C;e[0]=s.v*s.v*r+h,e[1]=s.j*s.v*r-s.O,e[2]=s.O*s.v*r+s.j,e[3]=0,e[4]=s.v*s.j*r+s.O,e[5]=s.j*s.j*r+h,e[6]=s.O*s.j*r-s.v,e[7]=0,e[8]=s.v*s.O*r-s.j,e[9]=s.j*s.O*r+s.v,e[10]=s.O*s.O*r+h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,n.U()},t.RotationYawPitchRoll=function(i,n,s){var h=new t;return t.RotationYawPitchRollToRef(i,n,s,h),h},t.RotationYawPitchRollToRef=function(t,i,n,s){c.RotationYawPitchRollToRef(t,i,n,l.Quaternion[0]),l.Quaternion[0].toRotationMatrix(s)},t.Scaling=function(i,n,s){var h=new t;return t.ScalingToRef(i,n,s,h),h},t.ScalingToRef=function(i,n,s,h){t.FromValuesToRef(i,0,0,0,0,n,0,0,0,0,s,0,0,0,0,1,h),h._(1===i&&1===n&&1===s)},t.Translation=function(i,n,s){var h=new t;return t.TranslationToRef(i,n,s,h),h},t.TranslationToRef=function(i,n,s,h){t.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,i,n,s,1,h),h._(0===i&&0===n&&0===s)},t.Lerp=function(i,n,s){var h=new t;return t.LerpToRef(i,n,s,h),h},t.LerpToRef=function(t,i,n,s){for(var h=s.C,r=t.m,e=i.m,u=0;u<16;u++)h[u]=r[u]*(1-n)+e[u]*n;s.U()},t.DecomposeLerp=function(i,n,s){var h=new t;return t.DecomposeLerpToRef(i,n,s,h),h},t.DecomposeLerpToRef=function(i,n,s,h){var r=l.Vector3[0],e=l.Quaternion[0],u=l.Vector3[1];i.decompose(r,e,u);var f=l.Vector3[2],a=l.Quaternion[1],v=l.Vector3[3];n.decompose(f,a,v);var b=l.Vector3[4];o.LerpToRef(r,f,s,b);var d=l.Quaternion[2];c.SlerpToRef(e,a,s,d);var g=l.Vector3[5];o.LerpToRef(u,v,s,g),t.ComposeToRef(b,d,g,h)},t.LookAtLH=function(i,n,s){var h=new t;return t.LookAtLHToRef(i,n,s,h),h},t.LookAtLHToRef=function(i,n,s,h){var r=l.Vector3[0],e=l.Vector3[1],u=l.Vector3[2];n.subtractToRef(i,u),u.normalize(),o.CrossToRef(s,u,r);var f=r.lengthSquared();0===f?r.x=1:r.normalizeFromLength(Math.sqrt(f)),o.CrossToRef(u,r,e),e.normalize();var c=-o.Dot(r,i),a=-o.Dot(e,i),v=-o.Dot(u,i);t.FromValuesToRef(r.v,e.v,u.v,0,r.j,e.j,u.j,0,r.O,e.O,u.O,0,c,a,v,1,h)},t.LookAtRH=function(i,n,s){var h=new t;return t.LookAtRHToRef(i,n,s,h),h},t.LookAtRHToRef=function(i,n,s,h){var r=l.Vector3[0],e=l.Vector3[1],u=l.Vector3[2];i.subtractToRef(n,u),u.normalize(),o.CrossToRef(s,u,r);var f=r.lengthSquared();0===f?r.x=1:r.normalizeFromLength(Math.sqrt(f)),o.CrossToRef(u,r,e),e.normalize();var c=-o.Dot(r,i),a=-o.Dot(e,i),v=-o.Dot(u,i);t.FromValuesToRef(r.v,e.v,u.v,0,r.j,e.j,u.j,0,r.O,e.O,u.O,0,c,a,v,1,h)},t.OrthoLH=function(i,n,s,h){var r=new t;return t.OrthoLHToRef(i,n,s,h,r),r},t.OrthoLHToRef=function(i,n,s,h,r){var e=2/i,u=2/n,o=2/(h-s),f=-(h+s)/(h-s);t.FromValuesToRef(e,0,0,0,0,u,0,0,0,0,o,0,0,0,f,1,r),r._(1===e&&1===u&&1===o&&0===f)},t.OrthoOffCenterLH=function(i,n,s,h,r,e){var u=new t;return t.OrthoOffCenterLHToRef(i,n,s,h,r,e,u),u},t.OrthoOffCenterLHToRef=function(i,n,s,h,r,e,u){var o=2/(n-i),f=2/(h-s),c=2/(e-r),a=-(e+r)/(e-r),l=(i+n)/(i-n),v=(h+s)/(s-h);t.FromValuesToRef(o,0,0,0,0,f,0,0,0,0,c,0,l,v,a,1,u),u.U()},t.OrthoOffCenterRH=function(i,n,s,h,r,e){var u=new t;return t.OrthoOffCenterRHToRef(i,n,s,h,r,e,u),u},t.OrthoOffCenterRHToRef=function(i,n,s,h,r,e,u){t.OrthoOffCenterLHToRef(i,n,s,h,r,e,u),u.C[10]*=-1},t.PerspectiveLH=function(i,n,s,h){var r=new t,e=2*s/i,u=2*s/n,o=(h+s)/(h-s),f=-2*h*s/(h-s);return t.FromValuesToRef(e,0,0,0,0,u,0,0,0,0,o,1,0,0,f,0,r),r._(!1),r},t.PerspectiveFovLH=function(i,n,s,h){var r=new t;return t.PerspectiveFovLHToRef(i,n,s,h,r),r},t.PerspectiveFovLHToRef=function(i,n,s,h,r,e){void 0===e&&(e=!0);var u=s,o=h,f=1/Math.tan(.5*i),c=e?f/n:f,a=e?f:f*n,l=(o+u)/(o-u),v=-2*o*u/(o-u);t.FromValuesToRef(c,0,0,0,0,a,0,0,0,0,l,1,0,0,v,0,r),r._(!1)},t.PerspectiveFovReverseLHToRef=function(i,n,s,h,r,e){void 0===e&&(e=!0);var u=1/Math.tan(.5*i),o=e?u/n:u,f=e?u:u*n;t.FromValuesToRef(o,0,0,0,0,f,0,0,0,0,-s,1,0,0,1,0,r),r._(!1)},t.PerspectiveFovRH=function(i,n,s,h){var r=new t;return t.PerspectiveFovRHToRef(i,n,s,h,r),r},t.PerspectiveFovRHToRef=function(i,n,s,h,r,e){void 0===e&&(e=!0);var u=s,o=h,f=1/Math.tan(.5*i),c=e?f/n:f,a=e?f:f*n,l=-(o+u)/(o-u),v=-2*o*u/(o-u);t.FromValuesToRef(c,0,0,0,0,a,0,0,0,0,l,-1,0,0,v,0,r),r._(!1)},t.PerspectiveFovReverseRHToRef=function(i,n,s,h,r,e){void 0===e&&(e=!0);var u=1/Math.tan(.5*i),o=e?u/n:u,f=e?u:u*n;t.FromValuesToRef(o,0,0,0,0,f,0,0,0,0,-s,-1,0,0,-1,0,r),r._(!1)},t.PerspectiveFovWebVRToRef=function(t,i,n,s,h){void 0===h&&(h=!1);var r=h?-1:1,e=Math.tan(t.upDegrees*Math.PI/180),u=Math.tan(t.downDegrees*Math.PI/180),o=Math.tan(t.leftDegrees*Math.PI/180),f=Math.tan(t.rightDegrees*Math.PI/180),c=2/(o+f),a=2/(e+u),l=s.C;l[0]=c,l[1]=l[2]=l[3]=l[4]=0,l[5]=a,l[6]=l[7]=0,l[8]=(o-f)*c*.5,l[9]=-(e-u)*a*.5,l[10]=-n/(i-n),l[11]=1*r,l[12]=l[13]=l[15]=0,l[14]=-2*n*i/(n-i),s.U()},t.GetFinalMatrix=function(i,n,s,h,r,e){var u=i.width,o=i.height,f=i.x,c=i.y,a=t.FromValues(u/2,0,0,0,0,-o/2,0,0,0,0,e-r,0,f+u/2,o/2+c,r,1),v=l.Matrix[0];return n.multiplyToRef(s,v),v.multiplyToRef(h,v),v.multiply(a)},t.GetAsMatrix2x2=function(t){var i=t.m;return new Float32Array([i[0],i[1],i[4],i[5]])},t.GetAsMatrix3x3=function(t){var i=t.m;return new Float32Array([i[0],i[1],i[2],i[4],i[5],i[6],i[8],i[9],i[10]])},t.Transpose=function(i){var n=new t;return t.TransposeToRef(i,n),n},t.TransposeToRef=function(t,i){var n=i.C,s=t.m;n[0]=s[0],n[1]=s[4],n[2]=s[8],n[3]=s[12],n[4]=s[1],n[5]=s[5],n[6]=s[9],n[7]=s[13],n[8]=s[2],n[9]=s[6],n[10]=s[10],n[11]=s[14],n[12]=s[3],n[13]=s[7],n[14]=s[11],n[15]=s[15],i._(t.k,t.T)},t.Reflection=function(i){var n=new t;return t.ReflectionToRef(i,n),n},t.ReflectionToRef=function(i,n){i.normalize();var s=i.normal.x,h=i.normal.y,r=i.normal.z,e=-2*s,u=-2*h,o=-2*r;t.FromValuesToRef(e*s+1,u*s,o*s,0,e*h,u*h+1,o*h,0,e*r,u*r,o*r+1,0,e*i.d,u*i.d,o*i.d,1,n)},t.FromXYZAxesToRef=function(i,n,s,h){t.FromValuesToRef(i.v,i.j,i.O,0,n.v,n.j,n.O,0,s.v,s.j,s.O,0,0,0,0,1,h)},t.FromQuaternionToRef=function(t,i){var n=t.v*t.v,s=t.j*t.j,h=t.O*t.O,r=t.v*t.j,e=t.O*t.P,u=t.O*t.v,o=t.j*t.P,f=t.j*t.O,c=t.v*t.P;i.C[0]=1-2*(s+h),i.C[1]=2*(r+e),i.C[2]=2*(u-o),i.C[3]=0,i.C[4]=2*(r-e),i.C[5]=1-2*(h+n),i.C[6]=2*(f+c),i.C[7]=0,i.C[8]=2*(u+o),i.C[9]=2*(f-c),i.C[10]=1-2*(s+n),i.C[11]=0,i.C[12]=0,i.C[13]=0,i.C[14]=0,i.C[15]=1,i.U()},t.R=0,t.S=t.Identity(),t}(),l=function(){function t(){}return t.Vector3=r.BuildArray(6,o.Zero),t.Matrix=r.BuildArray(2,a.Identity),t.Quaternion=r.BuildArray(3,c.Zero),t}(),v=function(){function t(){}return t.Vector2=r.BuildArray(3,u.Zero),t.Vector3=r.BuildArray(13,o.Zero),t.Vector4=r.BuildArray(3,f.Zero),t.Quaternion=r.BuildArray(2,c.Zero),t.Matrix=r.BuildArray(8,a.Identity),t}();e.RegisteredTypes["BABYLON.Vector2"]=u,e.RegisteredTypes["BABYLON.Vector3"]=o,e.RegisteredTypes["BABYLON.Vector4"]=f,e.RegisteredTypes["BABYLON.Matrix"]=a,function(t){t[t.LOCAL=0]="LOCAL",t[t.WORLD=1]="WORLD",t[t.BONE=2]="BONE"}(s||(s={}));var b=function(){function t(){}return t.X=new o(1,0,0),t.Y=new o(0,1,0),t.Z=new o(0,0,1),t}(),d=function(){function t(t,i,n){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),this.r=t,this.g=i,this.b=n}return t.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"},t.prototype.getClassName=function(){return"Color3"},t.prototype.getHashCode=function(){var t=255*this.r|0;return t=397*(t=397*t^(255*this.g|0))^(255*this.b|0)},t.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.r,t[i+1]=this.g,t[i+2]=this.b,this},t.prototype.toColor4=function(t){return void 0===t&&(t=1),new g(this.r,this.g,this.b,t)},t.prototype.asArray=function(){var t=new Array;return this.toArray(t,0),t},t.prototype.toLuminance=function(){return.3*this.r+.59*this.g+.11*this.b},t.prototype.multiply=function(i){return new t(this.r*i.r,this.g*i.g,this.b*i.b)},t.prototype.multiplyToRef=function(t,i){return i.r=this.r*t.r,i.g=this.g*t.g,i.b=this.b*t.b,this},t.prototype.equals=function(t){return t&&this.r===t.r&&this.g===t.g&&this.b===t.b},t.prototype.equalsFloats=function(t,i,n){return this.r===t&&this.g===i&&this.b===n},t.prototype.scale=function(i){return new t(this.r*i,this.g*i,this.b*i)},t.prototype.scaleToRef=function(t,i){return i.r=this.r*t,i.g=this.g*t,i.b=this.b*t,this},t.prototype.scaleAndAddToRef=function(t,i){return i.r+=this.r*t,i.g+=this.g*t,i.b+=this.b*t,this},t.prototype.clampToRef=function(t,i,n){return void 0===t&&(t=0),void 0===i&&(i=1),n.r=h.Clamp(this.r,t,i),n.g=h.Clamp(this.g,t,i),n.b=h.Clamp(this.b,t,i),this},t.prototype.add=function(i){return new t(this.r+i.r,this.g+i.g,this.b+i.b)},t.prototype.addToRef=function(t,i){return i.r=this.r+t.r,i.g=this.g+t.g,i.b=this.b+t.b,this},t.prototype.subtract=function(i){return new t(this.r-i.r,this.g-i.g,this.b-i.b)},t.prototype.subtractToRef=function(t,i){return i.r=this.r-t.r,i.g=this.g-t.g,i.b=this.b-t.b,this},t.prototype.clone=function(){return new t(this.r,this.g,this.b)},t.prototype.copyFrom=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},t.prototype.copyFromFloats=function(t,i,n){return this.r=t,this.g=i,this.b=n,this},t.prototype.set=function(t,i,n){return this.copyFromFloats(t,i,n)},t.prototype.toHexString=function(){var t=255*this.r|0,i=255*this.g|0,n=255*this.b|0;return"#"+h.ToHex(t)+h.ToHex(i)+h.ToHex(n)},t.prototype.toLinearSpace=function(){var i=new t;return this.toLinearSpaceToRef(i),i},t.prototype.toHSV=function(){var i=new t;return this.toHSVToRef(i),i},t.prototype.toHSVToRef=function(t){var i=this.r,n=this.g,s=this.b,h=Math.max(i,n,s),r=Math.min(i,n,s),e=0,u=0,o=h,f=h-r;0!==h&&(u=f/h),h!=r&&(h==i?(e=(n-s)/f,n<s&&(e+=6)):h==n?e=(s-i)/f+2:h==s&&(e=(i-n)/f+4),e*=60),t.r=e,t.g=u,t.b=o},t.prototype.toLinearSpaceToRef=function(t){return t.r=Math.pow(this.r,2.2),t.g=Math.pow(this.g,2.2),t.b=Math.pow(this.b,2.2),this},t.prototype.toGammaSpace=function(){var i=new t;return this.toGammaSpaceToRef(i),i},t.prototype.toGammaSpaceToRef=function(t){return t.r=Math.pow(this.r,1/2.2),t.g=Math.pow(this.g,1/2.2),t.b=Math.pow(this.b,1/2.2),this},t.HSVtoRGBToRef=function(t,i,n,s){var h=n*i,r=t/60,e=h*(1-Math.abs(r%2-1)),u=0,o=0,f=0;r>=0&&r<=1?(u=h,o=e):r>=1&&r<=2?(u=e,o=h):r>=2&&r<=3?(o=h,f=e):r>=3&&r<=4?(o=e,f=h):r>=4&&r<=5?(u=e,f=h):r>=5&&r<=6&&(u=h,f=e);var c=n-h;s.set(u+c,o+c,f+c)},t.FromHexString=function(i){if("#"!==i.substring(0,1)||7!==i.length)return new t(0,0,0);var n=parseInt(i.substring(1,3),16),s=parseInt(i.substring(3,5),16),h=parseInt(i.substring(5,7),16);return t.FromInts(n,s,h)},t.FromArray=function(i,n){return void 0===n&&(n=0),new t(i[n],i[n+1],i[n+2])},t.FromInts=function(i,n,s){return new t(i/255,n/255,s/255)},t.Lerp=function(i,n,s){var h=new t(0,0,0);return t.LerpToRef(i,n,s,h),h},t.LerpToRef=function(t,i,n,s){s.r=t.r+(i.r-t.r)*n,s.g=t.g+(i.g-t.g)*n,s.b=t.b+(i.b-t.b)*n},t.Red=function(){return new t(1,0,0)},t.Green=function(){return new t(0,1,0)},t.Blue=function(){return new t(0,0,1)},t.Black=function(){return new t(0,0,0)},Object.defineProperty(t,"BlackReadOnly",{get:function(){return t.L},enumerable:!1,configurable:!0}),t.White=function(){return new t(1,1,1)},t.Purple=function(){return new t(.5,0,.5)},t.Magenta=function(){return new t(1,0,1)},t.Yellow=function(){return new t(1,1,0)},t.Gray=function(){return new t(.5,.5,.5)},t.Teal=function(){return new t(0,1,1)},t.Random=function(){return new t(Math.random(),Math.random(),Math.random())},t.L=t.Black(),t}(),g=function(){function t(t,i,n,s){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===s&&(s=1),this.r=t,this.g=i,this.b=n,this.a=s}return t.prototype.addInPlace=function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this.a+=t.a,this},t.prototype.asArray=function(){var t=new Array;return this.toArray(t,0),t},t.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.r,t[i+1]=this.g,t[i+2]=this.b,t[i+3]=this.a,this},t.prototype.equals=function(t){return t&&this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a},t.prototype.add=function(i){return new t(this.r+i.r,this.g+i.g,this.b+i.b,this.a+i.a)},t.prototype.subtract=function(i){return new t(this.r-i.r,this.g-i.g,this.b-i.b,this.a-i.a)},t.prototype.subtractToRef=function(t,i){return i.r=this.r-t.r,i.g=this.g-t.g,i.b=this.b-t.b,i.a=this.a-t.a,this},t.prototype.scale=function(i){return new t(this.r*i,this.g*i,this.b*i,this.a*i)},t.prototype.scaleToRef=function(t,i){return i.r=this.r*t,i.g=this.g*t,i.b=this.b*t,i.a=this.a*t,this},t.prototype.scaleAndAddToRef=function(t,i){return i.r+=this.r*t,i.g+=this.g*t,i.b+=this.b*t,i.a+=this.a*t,this},t.prototype.clampToRef=function(t,i,n){return void 0===t&&(t=0),void 0===i&&(i=1),n.r=h.Clamp(this.r,t,i),n.g=h.Clamp(this.g,t,i),n.b=h.Clamp(this.b,t,i),n.a=h.Clamp(this.a,t,i),this},t.prototype.multiply=function(i){return new t(this.r*i.r,this.g*i.g,this.b*i.b,this.a*i.a)},t.prototype.multiplyToRef=function(t,i){return i.r=this.r*t.r,i.g=this.g*t.g,i.b=this.b*t.b,i.a=this.a*t.a,i},t.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"},t.prototype.getClassName=function(){return"Color4"},t.prototype.getHashCode=function(){var t=255*this.r|0;return t=397*(t=397*(t=397*t^(255*this.g|0))^(255*this.b|0))^(255*this.a|0)},t.prototype.clone=function(){return new t(this.r,this.g,this.b,this.a)},t.prototype.copyFrom=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this},t.prototype.copyFromFloats=function(t,i,n,s){return this.r=t,this.g=i,this.b=n,this.a=s,this},t.prototype.set=function(t,i,n,s){return this.copyFromFloats(t,i,n,s)},t.prototype.toHexString=function(t){void 0===t&&(t=!1);var i=255*this.r|0,n=255*this.g|0,s=255*this.b|0;if(t)return"#"+h.ToHex(i)+h.ToHex(n)+h.ToHex(s);var r=255*this.a|0;return"#"+h.ToHex(i)+h.ToHex(n)+h.ToHex(s)+h.ToHex(r)},t.prototype.toLinearSpace=function(){var i=new t;return this.toLinearSpaceToRef(i),i},t.prototype.toLinearSpaceToRef=function(t){return t.r=Math.pow(this.r,2.2),t.g=Math.pow(this.g,2.2),t.b=Math.pow(this.b,2.2),t.a=this.a,this},t.prototype.toGammaSpace=function(){var i=new t;return this.toGammaSpaceToRef(i),i},t.prototype.toGammaSpaceToRef=function(t){return t.r=Math.pow(this.r,1/2.2),t.g=Math.pow(this.g,1/2.2),t.b=Math.pow(this.b,1/2.2),t.a=this.a,this},t.FromHexString=function(i){if("#"!==i.substring(0,1)||9!==i.length)return new t(0,0,0,0);var n=parseInt(i.substring(1,3),16),s=parseInt(i.substring(3,5),16),h=parseInt(i.substring(5,7),16),r=parseInt(i.substring(7,9),16);return t.FromInts(n,s,h,r)},t.Lerp=function(i,n,s){var h=new t(0,0,0,0);return t.LerpToRef(i,n,s,h),h},t.LerpToRef=function(t,i,n,s){s.r=t.r+(i.r-t.r)*n,s.g=t.g+(i.g-t.g)*n,s.b=t.b+(i.b-t.b)*n,s.a=t.a+(i.a-t.a)*n},t.FromColor3=function(i,n){return void 0===n&&(n=1),new t(i.r,i.g,i.b,n)},t.FromArray=function(i,n){return void 0===n&&(n=0),new t(i[n],i[n+1],i[n+2],i[n+3])},t.FromInts=function(i,n,s,h){return new t(i/255,n/255,s/255,h/255)},t.CheckColors4=function(t,i){if(t.length===3*i){for(var n=[],s=0;s<t.length;s+=3){var h=s/3*4;n[h]=t[s],n[h+1]=t[s+1],n[h+2]=t[s+2],n[h+3]=1}return n}return t},t}(),w=function(){function t(){}return t.Color3=r.BuildArray(3,d.Black),t.Color4=r.BuildArray(3,(function(){return new g(0,0,0,0)})),t}();e.RegisteredTypes["BABYLON.Color3"]=d,e.RegisteredTypes["BABYLON.Color4"]=g;var m,j=function(){function t(t,i,n,s){this.normal=new o(t,i,n),this.d=s}return t.prototype.asArray=function(){return[this.normal.x,this.normal.y,this.normal.z,this.d]},t.prototype.clone=function(){return new t(this.normal.x,this.normal.y,this.normal.z,this.d)},t.prototype.getClassName=function(){return"Plane"},t.prototype.getHashCode=function(){var t=this.normal.getHashCode();return t=397*t^(0|this.d)},t.prototype.normalize=function(){var t=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),i=0;return 0!==t&&(i=1/t),this.normal.x*=i,this.normal.y*=i,this.normal.z*=i,this.d*=i,this},t.prototype.transform=function(i){var n=t.D;i.invertToRef(n);var s=n.m,h=this.normal.x,r=this.normal.y,e=this.normal.z,u=this.d;return new t(h*s[0]+r*s[1]+e*s[2]+u*s[3],h*s[4]+r*s[5]+e*s[6]+u*s[7],h*s[8]+r*s[9]+e*s[10]+u*s[11],h*s[12]+r*s[13]+e*s[14]+u*s[15])},t.prototype.dotCoordinate=function(t){return this.normal.x*t.x+this.normal.y*t.y+this.normal.z*t.z+this.d},t.prototype.copyFromPoints=function(t,i,n){var s,h=i.x-t.x,r=i.y-t.y,e=i.z-t.z,u=n.x-t.x,o=n.y-t.y,f=n.z-t.z,c=r*f-e*o,a=e*u-h*f,l=h*o-r*u,v=Math.sqrt(c*c+a*a+l*l);return s=0!==v?1/v:0,this.normal.x=c*s,this.normal.y=a*s,this.normal.z=l*s,this.d=-(this.normal.x*t.x+this.normal.y*t.y+this.normal.z*t.z),this},t.prototype.isFrontFacingTo=function(t,i){return o.Dot(this.normal,t)<=i},t.prototype.signedDistanceTo=function(t){return o.Dot(t,this.normal)+this.d},t.FromArray=function(i){return new t(i[0],i[1],i[2],i[3])},t.FromPoints=function(i,n,s){var h=new t(0,0,0,0);return h.copyFromPoints(i,n,s),h},t.FromPositionAndNormal=function(i,n){var s=new t(0,0,0,0);return n.normalize(),s.normal=n,s.d=-(n.x*i.x+n.y*i.y+n.z*i.z),s},t.SignedDistanceToPlaneFromPositionAndNormal=function(t,i,n){var s=-(i.x*t.x+i.y*t.y+i.z*t.z);return o.Dot(n,i)+s},t.D=a.Identity(),t}(),O=function(){function t(){}return t.GetPlanes=function(i){for(var n=[],s=0;s<6;s++)n.push(new j(0,0,0,0));return t.GetPlanesToRef(i,n),n},t.GetNearPlaneToRef=function(t,i){var n=t.m;i.normal.x=n[3]+n[2],i.normal.y=n[7]+n[6],i.normal.z=n[11]+n[10],i.d=n[15]+n[14],i.normalize()},t.GetFarPlaneToRef=function(t,i){var n=t.m;i.normal.x=n[3]-n[2],i.normal.y=n[7]-n[6],i.normal.z=n[11]-n[10],i.d=n[15]-n[14],i.normalize()},t.GetLeftPlaneToRef=function(t,i){var n=t.m;i.normal.x=n[3]+n[0],i.normal.y=n[7]+n[4],i.normal.z=n[11]+n[8],i.d=n[15]+n[12],i.normalize()},t.GetRightPlaneToRef=function(t,i){var n=t.m;i.normal.x=n[3]-n[0],i.normal.y=n[7]-n[4],i.normal.z=n[11]-n[8],i.d=n[15]-n[12],i.normalize()},t.GetTopPlaneToRef=function(t,i){var n=t.m;i.normal.x=n[3]-n[1],i.normal.y=n[7]-n[5],i.normal.z=n[11]-n[9],i.d=n[15]-n[13],i.normalize()},t.GetBottomPlaneToRef=function(t,i){var n=t.m;i.normal.x=n[3]+n[1],i.normal.y=n[7]+n[5],i.normal.z=n[11]+n[9],i.d=n[15]+n[13],i.normalize()},t.GetPlanesToRef=function(i,n){t.GetNearPlaneToRef(i,n[0]),t.GetFarPlaneToRef(i,n[1]),t.GetLeftPlaneToRef(i,n[2]),t.GetRightPlaneToRef(i,n[3]),t.GetTopPlaneToRef(i,n[4]),t.GetBottomPlaneToRef(i,n[5])},t}();!function(t){t[t.CW=0]="CW",t[t.CCW=1]="CCW"}(m||(m={}));!function(){function t(){}t.Interpolate=function(t,i,n,s,h){for(var r=1-3*s+3*i,e=3*s-6*i,u=3*i,o=t,f=0;f<5;f++){var c=o*o;o-=(r*(c*o)+e*c+u*o-t)*(1/(3*r*c+2*e*o+u)),o=Math.min(1,Math.max(0,o))}return 3*Math.pow(1-o,2)*o*n+3*(1-o)*Math.pow(o,2)*h+Math.pow(o,3)}}();var y=function(){function t(t){this.I=t,this.I<0&&(this.I+=2*Math.PI)}return t.prototype.degrees=function(){return 180*this.I/Math.PI},t.prototype.radians=function(){return this.I},t.BetweenTwoPoints=function(i,n){var s=n.subtract(i);return new t(Math.atan2(s.y,s.x))},t.FromRadians=function(i){return new t(i)},t.FromDegrees=function(i){return new t(i*Math.PI/180)},t}(),A=function(t,i,n){this.startPoint=t,this.midPoint=i,this.endPoint=n;var s=Math.pow(i.x,2)+Math.pow(i.y,2),h=(Math.pow(t.x,2)+Math.pow(t.y,2)-s)/2,r=(s-Math.pow(n.x,2)-Math.pow(n.y,2))/2,e=(t.x-i.x)*(i.y-n.y)-(i.x-n.x)*(t.y-i.y);this.centerPoint=new u((h*(i.y-n.y)-r*(t.y-i.y))/e,((t.x-i.x)*r-(i.x-n.x)*h)/e),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=y.BetweenTwoPoints(this.centerPoint,this.startPoint);var o=this.startAngle.degrees(),f=y.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),c=y.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();f-o>180&&(f-=360),f-o<-180&&(f+=360),c-f>180&&(c-=360),c-f<-180&&(c+=360),this.orientation=f-o<0?m.CW:m.CCW,this.angle=y.FromDegrees(this.orientation===m.CW?o-c:c-o)},p=(function(){function t(t,i){this.N=new Array,this.W=0,this.closed=!1,this.N.push(new u(t,i))}t.prototype.addLineTo=function(t,i){if(this.closed)return this;var n=new u(t,i),s=this.N[this.N.length-1];return this.N.push(n),this.W+=n.subtract(s).length(),this},t.prototype.addArcTo=function(t,i,n,s,h){if(void 0===h&&(h=36),this.closed)return this;var r=this.N[this.N.length-1],e=new u(t,i),o=new u(n,s),f=new A(r,e,o),c=f.angle.radians()/h;f.orientation===m.CW&&(c*=-1);for(var a=f.startAngle.radians()+c,l=0;l<h;l++){var v=Math.cos(a)*f.radius+f.centerPoint.x,b=Math.sin(a)*f.radius+f.centerPoint.y;this.addLineTo(v,b),a+=c}return this},t.prototype.close=function(){return this.closed=!0,this},t.prototype.length=function(){var t=this.W;if(this.closed){var i=this.N[this.N.length-1];t+=this.N[0].subtract(i).length()}return t},t.prototype.getPoints=function(){return this.N},t.prototype.getPointAtLengthPosition=function(t){if(t<0||t>1)return u.Zero();for(var i=t*this.length(),n=0,s=0;s<this.N.length;s++){var h=(s+1)%this.N.length,r=this.N[s],e=this.N[h].subtract(r),o=e.length()+n;if(i>=n&&i<=o){var f=e.normalize(),c=i-n;return new u(r.x+f.x*c,r.y+f.y*c)}n=o}return u.Zero()},t.StartingAt=function(i,n){return new t(i,n)}}(),function(){function t(t,i,n,s){void 0===i&&(i=null),void 0===s&&(s=!1),this.path=t,this.G=new Array,this.q=new Array,this.V=new Array,this.H=new Array,this.J=new Array,this.$={id:0,point:o.Zero(),previousPointArrayIndex:0,position:0,subPosition:0,interpolateReady:!1,interpolationMatrix:a.Identity()};for(var h=0;h<t.length;h++)this.G[h]=t[h].clone();this.tt=n||!1,this.it=s,this.nt(i,s)}t.prototype.getCurve=function(){return this.G},t.prototype.getPoints=function(){return this.G},t.prototype.length=function(){return this.q[this.q.length-1]},t.prototype.getTangents=function(){return this.V},t.prototype.getNormals=function(){return this.H},t.prototype.getBinormals=function(){return this.J},t.prototype.getDistances=function(){return this.q},t.prototype.getPointAt=function(t){return this.st(t).point},t.prototype.getTangentAt=function(t,i){return void 0===i&&(i=!1),this.st(t,i),i?o.TransformCoordinates(o.Forward(),this.$.interpolationMatrix):this.V[this.$.previousPointArrayIndex]},t.prototype.getNormalAt=function(t,i){return void 0===i&&(i=!1),this.st(t,i),i?o.TransformCoordinates(o.Right(),this.$.interpolationMatrix):this.H[this.$.previousPointArrayIndex]},t.prototype.getBinormalAt=function(t,i){return void 0===i&&(i=!1),this.st(t,i),i?o.TransformCoordinates(o.UpReadOnly,this.$.interpolationMatrix):this.J[this.$.previousPointArrayIndex]},t.prototype.getDistanceAt=function(t){return this.length()*t},t.prototype.getPreviousPointIndexAt=function(t){return this.st(t),this.$.previousPointArrayIndex},t.prototype.getSubPositionAt=function(t){return this.st(t),this.$.subPosition},t.prototype.getClosestPositionTo=function(t){for(var i=Number.MAX_VALUE,n=0,s=0;s<this.G.length-1;s++){var h=this.G[s+0],r=this.G[s+1].subtract(h).normalize(),e=this.q[s+1]-this.q[s+0],u=Math.min(Math.max(o.Dot(r,t.subtract(h).normalize()),0)*o.Distance(h,t)/e,1),f=o.Distance(h.add(r.scale(u*e)),t);f<i&&(i=f,n=(this.q[s+0]+e*u)/this.length())}return n},t.prototype.slice=function(i,n){if(void 0===i&&(i=0),void 0===n&&(n=1),i<0&&(i=1- -1*i%1),n<0&&(n=1- -1*n%1),i>n){var s=i;i=n,n=s}var h=this.getCurve(),r=this.getPointAt(i),e=this.getPreviousPointIndexAt(i),u=this.getPointAt(n),o=this.getPreviousPointIndexAt(n)+1,f=[];return 0!==i&&(e++,f.push(r)),f.push.apply(f,h.slice(e,o)),1===n&&1!==i||f.push(u),new t(f,this.getNormalAt(i),this.tt,this.it)},t.prototype.update=function(t,i,n){void 0===i&&(i=null),void 0===n&&(n=!1);for(var s=0;s<t.length;s++)this.G[s].x=t[s].x,this.G[s].y=t[s].y,this.G[s].z=t[s].z;return this.nt(i,n),this},t.prototype.nt=function(t,i){void 0===i&&(i=!1);var n=this.G.length;this.V[0]=this.ht(0),this.tt||this.V[0].normalize(),this.V[n-1]=this.G[n-1].subtract(this.G[n-2]),this.tt||this.V[n-1].normalize();var s,h,r,e,u,f=this.V[0],c=this.rt(f,t);this.H[0]=c,this.tt||this.H[0].normalize(),this.J[0]=o.Cross(f,this.H[0]),this.tt||this.J[0].normalize(),this.q[0]=0;for(var a=1;a<n;a++)s=this.et(a),a<n-1&&(h=this.ht(a),this.V[a]=i?h:s.add(h),this.V[a].normalize()),this.q[a]=this.q[a-1]+this.G[a].subtract(this.G[a-1]).length(),r=this.V[a],u=this.J[a-1],this.H[a]=o.Cross(u,r),this.tt||(0===this.H[a].length()?(e=this.H[a-1],this.H[a]=e.clone()):this.H[a].normalize()),this.J[a]=o.Cross(r,this.H[a]),this.tt||this.J[a].normalize();this.$.id=NaN},t.prototype.ht=function(t){for(var i=1,n=this.G[t+i].subtract(this.G[t]);0===n.length()&&t+i+1<this.G.length;)i++,n=this.G[t+i].subtract(this.G[t]);return n},t.prototype.et=function(t){for(var i=1,n=this.G[t].subtract(this.G[t-i]);0===n.length()&&t>i+1;)i++,n=this.G[t].subtract(this.G[t-i]);return n},t.prototype.rt=function(t,i){var n,s,r=t.length();(0===r&&(r=1),null==i)?(s=h.WithinEpsilon(Math.abs(t.y)/r,1,.001)?h.WithinEpsilon(Math.abs(t.x)/r,1,.001)?h.WithinEpsilon(Math.abs(t.z)/r,1,.001)?o.Zero():new o(0,0,1):new o(1,0,0):new o(0,-1,0),n=o.Cross(t,s)):(n=o.Cross(t,i),o.CrossToRef(n,t,n));return n.normalize(),n},t.prototype.st=function(t,i){if(void 0===i&&(i=!1),this.$.id===t)return this.$.interpolateReady||this.ut(),this.$;this.$.id=t;var n=this.getPoints();if(t<=0)return this.ot(0,0,n[0],0,i);if(t>=1)return this.ot(1,1,n[n.length-1],n.length-1,i);for(var s,h=n[0],r=0,e=t*this.length(),u=1;u<n.length;u++){s=n[u];var f=o.Distance(h,s);if((r+=f)===e)return this.ot(t,1,s,u,i);if(r>e){var c=(r-e)/f,a=h.subtract(s),l=s.add(a.scaleInPlace(c));return this.ot(t,1-c,l,u-1,i)}h=s}return this.$},t.prototype.ot=function(t,i,n,s,h){return this.$.point=n,this.$.position=t,this.$.subPosition=i,this.$.previousPointArrayIndex=s,this.$.interpolateReady=h,h&&this.ut(),this.$},t.prototype.ut=function(){this.$.interpolationMatrix=a.Identity();var t=this.$.previousPointArrayIndex;if(t!==this.V.length-1){var i=t+1,n=this.V[t].clone(),s=this.H[t].clone(),h=this.J[t].clone(),r=this.V[i].clone(),e=this.H[i].clone(),u=this.J[i].clone(),o=c.RotationQuaternionFromAxis(s,h,n),f=c.RotationQuaternionFromAxis(e,u,r);c.Slerp(o,f,this.$.subPosition).toRotationMatrix(this.$.interpolationMatrix)}}}(),function(){function t(t){this.W=0,this.N=t,this.W=this.ft(t)}t.CreateQuadraticBezier=function(i,n,s,h){h=h>2?h:3;for(var r=new Array,e=function(t,i,n,s){return(1-t)*(1-t)*i+2*t*(1-t)*n+t*t*s},u=0;u<=h;u++)r.push(new o(e(u/h,i.x,n.x,s.x),e(u/h,i.y,n.y,s.y),e(u/h,i.z,n.z,s.z)));return new t(r)},t.CreateCubicBezier=function(i,n,s,h,r){r=r>3?r:4;for(var e=new Array,u=function(t,i,n,s,h){return(1-t)*(1-t)*(1-t)*i+3*t*(1-t)*(1-t)*n+3*t*t*(1-t)*s+t*t*t*h},f=0;f<=r;f++)e.push(new o(u(f/r,i.x,n.x,s.x,h.x),u(f/r,i.y,n.y,s.y,h.y),u(f/r,i.z,n.z,s.z,h.z)));return new t(e)},t.CreateHermiteSpline=function(i,n,s,h,r){for(var e=new Array,u=1/r,f=0;f<=r;f++)e.push(o.Hermite(i,n,s,h,f*u));return new t(e)},t.CreateCatmullRomSpline=function(i,n,s){var h=new Array,r=1/n,e=0;if(s){for(var u=i.length,f=0;f<u;f++){e=0;for(var c=0;c<n;c++)h.push(o.CatmullRom(i[f%u],i[(f+1)%u],i[(f+2)%u],i[(f+3)%u],e)),e+=r}h.push(h[0])}else{var a=new Array;a.push(i[0].clone()),Array.prototype.push.apply(a,i),a.push(i[i.length-1].clone());for(f=0;f<a.length-3;f++){e=0;for(c=0;c<n;c++)h.push(o.CatmullRom(a[f],a[f+1],a[f+2],a[f+3],e)),e+=r}f--,h.push(o.CatmullRom(a[f],a[f+1],a[f+2],a[f+3],e))}return new t(h)},t.prototype.getPoints=function(){return this.N},t.prototype.length=function(){return this.W},t.prototype.continue=function(i){for(var n=this.N[this.N.length-1],s=this.N.slice(),h=i.getPoints(),r=1;r<h.length;r++)s.push(h[r].subtract(h[0]).add(n));return new t(s)},t.prototype.ft=function(t){for(var i=0,n=1;n<t.length;n++)i+=t[n].subtract(t[n-1]).length();return i}}(),function(){function t(t,i){this.width=t,this.height=i}t.prototype.toString=function(){return"{W: "+this.width+", H: "+this.height+"}"},t.prototype.getClassName=function(){return"Size"},t.prototype.getHashCode=function(){var t=0|this.width;return t=397*t^(0|this.height)},t.prototype.copyFrom=function(t){this.width=t.width,this.height=t.height},t.prototype.copyFromFloats=function(t,i){return this.width=t,this.height=i,this},t.prototype.set=function(t,i){return this.copyFromFloats(t,i)},t.prototype.multiplyByFloats=function(i,n){return new t(this.width*i,this.height*n)},t.prototype.clone=function(){return new t(this.width,this.height)},t.prototype.equals=function(t){return!!t&&(this.width===t.width&&this.height===t.height)},Object.defineProperty(t.prototype,"surface",{get:function(){return this.width*this.height},enumerable:!1,configurable:!0}),t.Zero=function(){return new t(0,0)},t.prototype.add=function(i){return new t(this.width+i.width,this.height+i.height)},t.prototype.subtract=function(i){return new t(this.width-i.width,this.height-i.height)},t.Lerp=function(i,n,s){return new t(i.width+(n.width-i.width)*s,i.height+(n.height-i.height)*s)}}(),function(){function t(t,i){void 0===t&&(t=o.Zero()),void 0===i&&(i=o.Up()),this.position=t,this.normal=i}t.prototype.clone=function(){return new t(this.position.clone(),this.normal.clone())}}(),function(){function t(t,i,n){void 0===t&&(t=o.Zero()),void 0===i&&(i=o.Up()),void 0===n&&(n=u.Zero()),this.position=t,this.normal=i,this.uv=n}t.prototype.clone=function(){return new t(this.position.clone(),this.normal.clone(),this.uv.clone())}}(),function(){function t(t,i,n,s){this.x=t,this.y=i,this.width=n,this.height=s}return t.prototype.toGlobal=function(i,n){return new t(this.x*i,this.y*n,this.width*i,this.height*n)},t.prototype.toGlobalToRef=function(t,i,n){return n.x=this.x*t,n.y=this.y*i,n.width=this.width*t,n.height=this.height*i,this},t.prototype.clone=function(){return new t(this.x,this.y,this.width,this.height)},t}()),M=function(){function t(t,i,n,s,h,r,e,u){void 0===s&&(s=0),void 0===h&&(h=!1),void 0===r&&(r=!1),void 0===e&&(e=!1),t.getScene?this.ct=t.getScene().getEngine():this.ct=t,this.at=n,this.lt=r,this.vt=u||1,this.bt=i,this.byteStride=e?s:s*Float32Array.BYTES_PER_ELEMENT,h||this.create()}return t.prototype.createVertexBuffer=function(t,i,n,s,h,r,e){void 0===r&&(r=!1);var u=r?i:i*Float32Array.BYTES_PER_ELEMENT,o=s?r?s:s*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new K(this.ct,this,t,this.at,!0,o,void 0===h?this.lt:h,u,n,void 0,void 0,!0,this.vt||e)},t.prototype.isUpdatable=function(){return this.at},t.prototype.getData=function(){return this.bt},t.prototype.getBuffer=function(){return this.dt},t.prototype.getStrideSize=function(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT},t.prototype.create=function(t){void 0===t&&(t=null),!t&&this.dt||(t=t||this.bt)&&(this.dt?this.at&&(this.ct.updateDynamicVertexBuffer(this.dt,t),this.bt=t):this.at?(this.dt=this.ct.createDynamicVertexBuffer(t),this.bt=t):this.dt=this.ct.createVertexBuffer(t))},t.prototype.gt=function(){this.dt=null,this.create(this.bt)},t.prototype.update=function(t){this.create(t)},t.prototype.updateDirectly=function(t,i,n,s){void 0===s&&(s=!1),this.dt&&this.at&&(this.ct.updateDynamicVertexBuffer(this.dt,t,s?i:i*Float32Array.BYTES_PER_ELEMENT,n?n*this.byteStride:void 0),this.bt=null)},t.prototype.dispose=function(){this.dt&&this.ct.wt(this.dt)&&(this.dt=null)},t}(),K=function(){function t(i,n,s,h,r,e,u,o,f,c,a,l,v){if(void 0===a&&(a=!1),void 0===l&&(l=!1),void 0===v&&(v=1),n instanceof M?(this.dt=n,this.jt=!1):(this.dt=new M(i,n,h,e,r,u,l),this.jt=!0),this.Ot=s,null==c){var b=this.getData();this.type=t.FLOAT,b instanceof Int8Array?this.type=t.BYTE:b instanceof Uint8Array?this.type=t.UNSIGNED_BYTE:b instanceof Int16Array?this.type=t.SHORT:b instanceof Uint16Array?this.type=t.UNSIGNED_SHORT:b instanceof Int32Array?this.type=t.INT:b instanceof Uint32Array&&(this.type=t.UNSIGNED_INT)}else this.type=c;var d=t.GetTypeByteLength(this.type);l?(this.yt=f||(e?e/d:t.DeduceStride(s)),this.byteStride=e||this.dt.byteStride||this.yt*d,this.byteOffset=o||0):(this.yt=f||e||t.DeduceStride(s),this.byteStride=e?e*d:this.dt.byteStride||this.yt*d,this.byteOffset=(o||0)*d),this.normalized=a,this.lt=void 0!==u&&u,this.At=u?v:0}return Object.defineProperty(t.prototype,"instanceDivisor",{get:function(){return this.At},set:function(t){this.At=t,this.lt=0!=t},enumerable:!1,configurable:!0}),t.prototype.gt=function(){this.dt&&this.dt.gt()},t.prototype.getKind=function(){return this.Ot},t.prototype.isUpdatable=function(){return this.dt.isUpdatable()},t.prototype.getData=function(){return this.dt.getData()},t.prototype.getBuffer=function(){return this.dt.getBuffer()},t.prototype.getStrideSize=function(){return this.byteStride/t.GetTypeByteLength(this.type)},t.prototype.getOffset=function(){return this.byteOffset/t.GetTypeByteLength(this.type)},t.prototype.getSize=function(){return this.yt},t.prototype.getIsInstanced=function(){return this.lt},t.prototype.getInstanceDivisor=function(){return this.At},t.prototype.create=function(t){this.dt.create(t)},t.prototype.update=function(t){this.dt.update(t)},t.prototype.updateDirectly=function(t,i,n){void 0===n&&(n=!1),this.dt.updateDirectly(t,i,void 0,n)},t.prototype.dispose=function(){this.jt&&this.dt.dispose()},t.prototype.forEach=function(i,n){t.ForEach(this.dt.getData(),this.byteOffset,this.byteStride,this.yt,this.type,i,this.normalized,n)},t.DeduceStride=function(i){switch(i){case t.UVKind:case t.UV2Kind:case t.UV3Kind:case t.UV4Kind:case t.UV5Kind:case t.UV6Kind:return 2;case t.NormalKind:case t.PositionKind:return 3;case t.ColorKind:case t.MatricesIndicesKind:case t.MatricesIndicesExtraKind:case t.MatricesWeightsKind:case t.MatricesWeightsExtraKind:case t.TangentKind:return 4;default:throw new Error("Invalid kind '"+i+"'")}},t.GetTypeByteLength=function(i){switch(i){case t.BYTE:case t.UNSIGNED_BYTE:return 1;case t.SHORT:case t.UNSIGNED_SHORT:return 2;case t.INT:case t.UNSIGNED_INT:case t.FLOAT:return 4;default:throw new Error("Invalid type '"+i+"'")}},t.ForEach=function(i,n,s,h,r,e,u,o){if(i instanceof Array)for(var f=n/4,c=s/4,a=0;a<e;a+=h){for(var l=0;l<h;l++)o(i[f+l],a+l);f+=c}else{var v=i instanceof ArrayBuffer?new DataView(i):new DataView(i.buffer,i.byteOffset,i.byteLength),b=t.GetTypeByteLength(r);for(a=0;a<e;a+=h){var d=n;for(l=0;l<h;l++){o(t.pt(v,r,d,u),a+l),d+=b}n+=s}}},t.pt=function(i,n,s,h){switch(n){case t.BYTE:var r=i.getInt8(s);return h&&(r=Math.max(r/127,-1)),r;case t.UNSIGNED_BYTE:r=i.getUint8(s);return h&&(r/=255),r;case t.SHORT:r=i.getInt16(s,!0);return h&&(r=Math.max(r/32767,-1)),r;case t.UNSIGNED_SHORT:r=i.getUint16(s,!0);return h&&(r/=65535),r;case t.INT:return i.getInt32(s,!0);case t.UNSIGNED_INT:return i.getUint32(s,!0);case t.FLOAT:return i.getFloat32(s,!0);default:throw new Error("Invalid component type "+n)}},t.BYTE=5120,t.UNSIGNED_BYTE=5121,t.SHORT=5122,t.UNSIGNED_SHORT=5123,t.INT=5124,t.UNSIGNED_INT=5125,t.FLOAT=5126,t.PositionKind="position",t.NormalKind="normal",t.TangentKind="tangent",t.UVKind="uv",t.UV2Kind="uv2",t.UV3Kind="uv3",t.UV4Kind="uv4",t.UV5Kind="uv5",t.UV6Kind="uv6",t.ColorKind="color",t.MatricesIndicesKind="matricesIndices",t.MatricesWeightsKind="matricesWeights",t.MatricesIndicesExtraKind="matricesIndicesExtra",t.MatricesWeightsExtraKind="matricesWeightsExtra",t}(),P=function(){function t(){this.Mt=!1,this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshFaceId=-1,this.subMeshId=0,this.pickedSprite=null,this.originMesh=null,this.ray=null}return t.prototype.getNormal=function(t,i){if(void 0===t&&(t=!1),void 0===i&&(i=!0),!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(K.NormalKind))return null;var n,s=this.pickedMesh.getIndices();if(!s)return null;if(i){var h=this.pickedMesh.getVerticesData(K.NormalKind),r=o.FromArray(h,3*s[3*this.faceId]),e=o.FromArray(h,3*s[3*this.faceId+1]),u=o.FromArray(h,3*s[3*this.faceId+2]);r=r.scale(this.bu),e=e.scale(this.bv),u=u.scale(1-this.bu-this.bv),n=new o(r.x+e.x+u.x,r.y+e.y+u.y,r.z+e.z+u.z)}else{var f=this.pickedMesh.getVerticesData(K.PositionKind),c=o.FromArray(f,3*s[3*this.faceId]),a=o.FromArray(f,3*s[3*this.faceId+1]),l=o.FromArray(f,3*s[3*this.faceId+2]),b=c.subtract(a),d=l.subtract(a);n=o.Cross(b,d)}if(t){var g=this.pickedMesh.getWorldMatrix();this.pickedMesh.nonUniformScaling&&(v.Matrix[0].copyFrom(g),(g=v.Matrix[0]).setTranslationFromFloats(0,0,0),g.invert(),g.transposeToRef(v.Matrix[1]),g=v.Matrix[1]),n=o.TransformNormal(n,g)}return n.normalize(),n},t.prototype.getTextureCoordinates=function(){if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(K.UVKind))return null;var t=this.pickedMesh.getIndices();if(!t)return null;var i=this.pickedMesh.getVerticesData(K.UVKind);if(!i)return null;var n=u.FromArray(i,2*t[3*this.faceId]),s=u.FromArray(i,2*t[3*this.faceId+1]),h=u.FromArray(i,2*t[3*this.faceId+2]);return n=n.scale(this.bu),s=s.scale(this.bv),h=h.scale(1-this.bu-this.bv),new u(n.x+s.x+h.x,n.y+s.y+h.y)},t}(),x=function(t,i,n){this.bu=t,this.bv=i,this.distance=n,this.faceId=0,this.subMeshId=0},k=function(t,i){return(k=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n])})(t,i)};function E(t,i){function n(){this.constructor=t}k(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}var T=function(){return(T=Object.assign||function(t){for(var i,n=1,s=arguments.length;n<s;n++)for(var h in i=arguments[n])Object.prototype.hasOwnProperty.call(i,h)&&(t[h]=i[h]);return t}).apply(this,arguments)};function B(t,i,n,s){var h,r=arguments.length,e=r<3?i:null===s?s=Object.getOwnPropertyDescriptor(i,n):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)e=Reflect.decorate(t,i,n,s);else for(var u=t.length-1;u>=0;u--)(h=t[u])&&(e=(r<3?h(e):r>3?h(i,n,e):h(i,n))||e);return r>3&&e&&Object.defineProperty(i,n,e),e}var F=function(){function t(t,i,n,s){void 0===i&&(i=!1),this.initalize(t,i,n,s)}return t.prototype.initalize=function(t,i,n,s){return void 0===i&&(i=!1),this.mask=t,this.skipNextObservers=i,this.target=n,this.currentTarget=s,this},t}(),C=function(t,i,n){void 0===n&&(n=null),this.callback=t,this.mask=i,this.scope=n,this.Kt=!1,this.unregisterOnNextCall=!1},_=(function(){function t(){}t.prototype.dispose=function(){if(this.Pt&&this.xt)for(var t=0;t<this.Pt.length;t++)this.xt[t].remove(this.Pt[t]);this.Pt=null,this.xt=null},t.Watch=function(i,n,s,h){void 0===s&&(s=-1),void 0===h&&(h=null);var r=new t;r.Pt=new Array,r.xt=i;for(var e=0,u=i;e<u.length;e++){var o=u[e].add(n,s,!1,h);o&&r.Pt.push(o)}return r}}(),function(){function t(t){this.Pt=new Array,this.kt=new F(0),t&&(this.Et=t)}return Object.defineProperty(t.prototype,"observers",{get:function(){return this.Pt},enumerable:!1,configurable:!0}),t.prototype.add=function(t,i,n,s,h){if(void 0===i&&(i=-1),void 0===n&&(n=!1),void 0===s&&(s=null),void 0===h&&(h=!1),!t)return null;var r=new C(t,i,s);return r.unregisterOnNextCall=h,n?this.Pt.unshift(r):this.Pt.push(r),this.Et&&this.Et(r),r},t.prototype.addOnce=function(t){return this.add(t,void 0,void 0,void 0,!0)},t.prototype.remove=function(t){return!!t&&(-1!==this.Pt.indexOf(t)&&(this.Tt(t),!0))},t.prototype.removeCallback=function(t,i){for(var n=0;n<this.Pt.length;n++){var s=this.Pt[n];if(!s.Kt&&(s.callback===t&&(!i||i===s.scope)))return this.Tt(s),!0}return!1},t.prototype.Tt=function(t){var i=this;t.unregisterOnNextCall=!1,t.Kt=!0,setTimeout((function(){i.Bt(t)}),0)},t.prototype.Bt=function(t){if(!t)return!1;var i=this.Pt.indexOf(t);return-1!==i&&(this.Pt.splice(i,1),!0)},t.prototype.makeObserverTopPriority=function(t){this.Bt(t),this.Pt.unshift(t)},t.prototype.makeObserverBottomPriority=function(t){this.Bt(t),this.Pt.push(t)},t.prototype.notifyObservers=function(t,i,n,s){if(void 0===i&&(i=-1),!this.Pt.length)return!0;var h=this.kt;h.mask=i,h.target=n,h.currentTarget=s,h.skipNextObservers=!1,h.lastReturnValue=t;for(var r=0,e=this.Pt;r<e.length;r++){var u=e[r];if(!u.Kt&&(u.mask&i&&(u.scope?h.lastReturnValue=u.callback.apply(u.scope,[t,h]):h.lastReturnValue=u.callback(t,h),u.unregisterOnNextCall&&this.Tt(u)),h.skipNextObservers))return!1}return!0},t.prototype.notifyObserversWithPromise=function(t,i,n,s){var h=this;void 0===i&&(i=-1);var r=Promise.resolve(t);if(!this.Pt.length)return r;var e=this.kt;return e.mask=i,e.target=n,e.currentTarget=s,e.skipNextObservers=!1,this.Pt.forEach((function(n){e.skipNextObservers||n.Kt||n.mask&i&&(r=n.scope?r.then((function(i){return e.lastReturnValue=i,n.callback.apply(n.scope,[t,e])})):r.then((function(i){return e.lastReturnValue=i,n.callback(t,e)})),n.unregisterOnNextCall&&h.Tt(n))})),r.then((function(){return t}))},t.prototype.notifyObserver=function(t,i,n){void 0===n&&(n=-1);var s=this.kt;s.mask=n,s.skipNextObservers=!1,t.callback(i,s)},t.prototype.hasObservers=function(){return this.Pt.length>0},t.prototype.clear=function(){this.Pt=new Array,this.Et=null},t.prototype.clone=function(){var i=new t;return i.Pt=this.Pt.slice(0),i},t.prototype.hasSpecificMask=function(t){void 0===t&&(t=-1);for(var i=0,n=this.Pt;i<n.length;i++){var s=n[i];if(s.mask&t||s.mask===t)return!0}return!1},t}()),U=function(){function t(){}return t.IsWindowObjectExist=function(){return"undefined"!=typeof window},t.IsNavigatorAvailable=function(){return"undefined"!=typeof navigator},t.IsDocumentAvailable=function(){return"undefined"!=typeof document},t.GetDOMTextContent=function(t){for(var i="",n=t.firstChild;n;)3===n.nodeType&&(i+=n.textContent),n=n.nextSibling;return i},t}(),R=function(){function t(){}return t.Ft=function(i){t.Ct=i+t.Ct,t.OnNewCacheEntry&&t.OnNewCacheEntry(i)},t._t=function(t){var i=function(t){return t<10?"0"+t:""+t},n=new Date;return"["+i(n.getHours())+":"+i(n.getMinutes())+":"+i(n.getSeconds())+"]: "+t},t.Ut=function(t){},t.Rt=function(i){var n=t._t(i);console.log("BJS - "+n);var s="<div style='color:white'>"+n+"</div><br>";t.Ft(s)},t.St=function(t){},t.Lt=function(i){var n=t._t(i);console.warn("BJS - "+n);var s="<div style='color:orange'>"+n+"</div><br>";t.Ft(s)},t.Dt=function(t){},t.It=function(i){t.errorsCount++;var n=t._t(i);console.error("BJS - "+n);var s="<div style='color:red'>"+n+"</div><br>";t.Ft(s)},Object.defineProperty(t,"LogCache",{get:function(){return t.Ct},enumerable:!1,configurable:!0}),t.ClearLogCache=function(){t.Ct="",t.errorsCount=0},Object.defineProperty(t,"LogLevels",{set:function(i){(i&t.MessageLogLevel)===t.MessageLogLevel?t.Log=t.Rt:t.Log=t.Ut,(i&t.WarningLogLevel)===t.WarningLogLevel?t.Warn=t.Lt:t.Warn=t.St,(i&t.ErrorLogLevel)===t.ErrorLogLevel?t.Error=t.It:t.Error=t.Dt},enumerable:!1,configurable:!0}),t.NoneLogLevel=0,t.MessageLogLevel=1,t.WarningLogLevel=2,t.ErrorLogLevel=4,t.AllLogLevel=7,t.Ct="",t.errorsCount=0,t.Log=t.Rt,t.Warn=t.Lt,t.Error=t.It,t}(),S=function(){function t(){}return t.EndsWith=function(t,i){return-1!==t.indexOf(i,t.length-i.length)},t.StartsWith=function(t,i){return!!t&&0===t.indexOf(i)},t.Decode=function(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);for(var i="",n=0;n<t.byteLength;n++)i+=String.fromCharCode(t[n]);return i},t.EncodeArrayBufferToBase64=function(t){for(var i,n,s,h,r,e,u,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",f="",c=0,a=ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):new Uint8Array(t);c<a.length;)h=(i=a[c++])>>2,r=(3&i)<<4|(n=c<a.length?a[c++]:Number.NaN)>>4,e=(15&n)<<2|(s=c<a.length?a[c++]:Number.NaN)>>6,u=63&s,isNaN(n)?e=u=64:isNaN(s)&&(u=64),f+=o.charAt(h)+o.charAt(r)+o.charAt(e)+o.charAt(u);return f},t.PadNumber=function(t,i){for(var n=String(t);n.length<i;)n="0"+n;return n},t}(),L=function(t,i){return t?t.getClassName&&"Mesh"===t.getClassName()?null:t.getClassName&&"SubMesh"===t.getClassName()?t.clone(i):t.clone?t.clone():null:null};var D,I=function(){function t(){}return t.DeepCopy=function(t,i,n,s){for(var h=0,r=function(t){var i=[];do{Object.getOwnPropertyNames(t).forEach((function(t){-1===i.indexOf(t)&&i.push(t)}))}while(t=Object.getPrototypeOf(t));return i}(t);h<r.length;h++){var e=r[h];if(("_"!==e[0]||s&&-1!==s.indexOf(e))&&!(S.EndsWith(e,"Observable")||n&&-1!==n.indexOf(e))){var u=t[e],o=typeof u;if("function"!==o)try{if("object"===o)if(u instanceof Array){if(i[e]=[],u.length>0)if("object"==typeof u[0])for(var f=0;f<u.length;f++){var c=L(u[f],i);-1===i[e].indexOf(c)&&i[e].push(c)}else i[e]=u.slice(0)}else i[e]=L(u,i);else i[e]=u}catch(t){R.Warn(t.message)}}}},t}(),N=function(){function t(){}return Object.defineProperty(t,"Now",{get:function(){return U.IsWindowObjectExist()&&window.performance&&window.performance.now?window.performance.now():Date.now()},enumerable:!1,configurable:!0}),t}(),X=function(){function t(){}return t.WarnImport=function(t){return t+" needs to be imported before as it contains a side-effect required by your code."},t}(),W=function(){function t(){this.Nt=new XMLHttpRequest}return t.prototype.Xt=function(){for(var i in t.CustomRequestHeaders){var n=t.CustomRequestHeaders[i];n&&this.Nt.setRequestHeader(i,n)}},Object.defineProperty(t.prototype,"onprogress",{get:function(){return this.Nt.onprogress},set:function(t){this.Nt.onprogress=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"readyState",{get:function(){return this.Nt.readyState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"status",{get:function(){return this.Nt.status},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"statusText",{get:function(){return this.Nt.statusText},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"response",{get:function(){return this.Nt.response},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"responseURL",{get:function(){return this.Nt.responseURL},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"responseText",{get:function(){return this.Nt.responseText},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"responseType",{get:function(){return this.Nt.responseType},set:function(t){this.Nt.responseType=t},enumerable:!1,configurable:!0}),t.prototype.addEventListener=function(t,i,n){this.Nt.addEventListener(t,i,n)},t.prototype.removeEventListener=function(t,i,n){this.Nt.removeEventListener(t,i,n)},t.prototype.abort=function(){this.Nt.abort()},t.prototype.send=function(i){t.CustomRequestHeaders&&this.Xt(),this.Nt.send(i)},t.prototype.open=function(i,n){for(var s=0,h=t.CustomRequestModifiers;s<h.length;s++){(0,h[s])(this.Nt,n)}return n=(n=n.replace("file:http:","http:")).replace("file:https:","https:"),this.Nt.open(i,n,!0)},t.prototype.setRequestHeader=function(t,i){this.Nt.setRequestHeader(t,i)},t.prototype.getResponseHeader=function(t){return this.Nt.getResponseHeader(t)},t.CustomRequestHeaders={},t.CustomRequestModifiers=new Array,t}(),G=function(){function t(){}return Object.defineProperty(t,"LastCreatedEngine",{get:function(){return 0===this.Instances.length?null:this.Instances[this.Instances.length-1]},enumerable:!1,configurable:!0}),Object.defineProperty(t,"LastCreatedScene",{get:function(){return this.Wt},enumerable:!1,configurable:!0}),t.Instances=new Array,t.Wt=null,t.UseFallbackTexture=!0,t.FallbackTexture="",t}(),q=function(){function t(){}return t.FilesToLoad={},t}(),Q=function(){function t(){}return t.ExponentialBackoff=function(t,i){return void 0===t&&(t=3),void 0===i&&(i=500),function(n,s,h){return 0!==s.status||h>=t||-1!==n.indexOf("file:")?-1:Math.pow(2,h)*i}},t}(),Y=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return E(i,t),i.Gt=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t},i}(Error),V=function(){function t(){this.children=[]}return t.prototype.isValid=function(t){return!0},t.prototype.process=function(t,i){var n="";if(this.line){var s=this.line,h=i.processor;if(h){if(h.lineProcessor&&(s=h.lineProcessor(s,i.isFragment)),h.attributeProcessor&&S.StartsWith(this.line,"attribute"))s=h.attributeProcessor(this.line);else if(h.varyingProcessor&&S.StartsWith(this.line,"varying"))s=h.varyingProcessor(this.line,i.isFragment);else if((h.uniformProcessor||h.uniformBufferProcessor)&&S.StartsWith(this.line,"uniform")){/uniform (.+) (.+)/.test(this.line)?h.uniformProcessor&&(s=h.uniformProcessor(this.line,i.isFragment)):h.uniformBufferProcessor&&(s=h.uniformBufferProcessor(this.line,i.isFragment),i.lookForClosingBracketForUniformBuffer=!0)}h.endOfUniformBufferProcessor&&i.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(i.lookForClosingBracketForUniformBuffer=!1,s=h.endOfUniformBufferProcessor(this.line,i.isFragment))}n+=s+"\r\n"}return this.children.forEach((function(s){n+=s.process(t,i)})),this.additionalDefineKey&&(t[this.additionalDefineKey]=this.additionalDefineValue||"true"),n},t}(),H=function(){function t(){}return Object.defineProperty(t.prototype,"currentLine",{get:function(){return this.qt[this.lineIndex]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"canRead",{get:function(){return this.lineIndex<this.qt.length-1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lines",{set:function(t){this.qt=[];for(var i=0,n=t;i<n.length;i++){var s=n[i];if("#"!==s[0])for(var h=s.split(";"),r=0;r<h.length;r++){var e=h[r];(e=e.trim())&&this.qt.push(e+(r!==h.length-1?";":""))}else this.qt.push(s)}},enumerable:!1,configurable:!0}),t}(),z=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return E(i,t),i.prototype.process=function(t,i){for(var n=0;n<this.children.length;n++){var s=this.children[n];if(s.isValid(t))return s.process(t,i)}return""},i}(V),Z=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return E(i,t),i.prototype.isValid=function(t){return this.testExpression.isTrue(t)},i}(V),J=function(){function t(){}return t.prototype.isTrue=function(t){return!0},t.postfixToInfix=function(i){for(var n=[],s=0,h=i;s<h.length;s++){var r=h[s];if(void 0===t.Qt[r])n.push(r);else{var e=n[n.length-1],u=n[n.length-2];n.length-=2,n.push("("+u+r+e+")")}}return n[n.length-1]},t.infixToPostfix=function(i){for(var n=[],s=-1,h=function(){""!==(f=f.trim())&&(n.push(f),f="")},r=function(i){s<t.Yt.length-1&&(t.Yt[++s]=i)},e=function(){return t.Yt[s]},u=function(){return-1===s?"!!INVALID EXPRESSION!!":t.Yt[s--]},o=0,f="";o<i.length;){var c=i.charAt(o),a=o<i.length-1?i.substr(o,2):"";if("("===c)f="",r(c);else if(")"===c){for(h();-1!==s&&"("!==e();)n.push(u());u()}else if(t.Qt[a]>1){for(h();-1!==s&&t.Qt[e()]>=t.Qt[a];)n.push(u());r(a),o++}else f+=c;o++}for(h();-1!==s;)"("===e()?u():n.push(u());return n},t.Qt={")":0,"(":1,"||":2,"&&":3},t.Yt=["","","","","","","","","","","","","","","","","","","",""],t}(),$=function(t){function i(i,n){void 0===n&&(n=!1);var s=t.call(this)||this;return s.define=i,s.not=n,s}return E(i,t),i.prototype.isTrue=function(t){var i=void 0!==t[this.define];return this.not&&(i=!i),i},i}(J),tt=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return E(i,t),i.prototype.isTrue=function(t){return this.leftOperand.isTrue(t)||this.rightOperand.isTrue(t)},i}(J),it=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return E(i,t),i.prototype.isTrue=function(t){return this.leftOperand.isTrue(t)&&this.rightOperand.isTrue(t)},i}(J),nt=function(t){function i(i,n,s){var h=t.call(this)||this;return h.define=i,h.operand=n,h.testValue=s,h}return E(i,t),i.prototype.isTrue=function(t){var i=t[this.define];void 0===i&&(i=this.define);var n=!1,s=parseInt(i),h=parseInt(this.testValue);switch(this.operand){case">":n=s>h;break;case"<":n=s<h;break;case"<=":n=s<=h;break;case">=":n=s>=h;break;case"==":n=s===h}return n},i}(J),st=/defined\s*?\((.+?)\)/g,ht=/defined\s*?\[(.+?)\]/g,rt=function(){function t(){}return t.Process=function(t,i,n){var s=this;this.Vt(t,i,(function(t){var h=s.Ht(t,i);n(h)}))},t.zt=function(t,i){var n=i.shouldUseHighPrecisionShader;return-1===t.indexOf("precision highp float")?t=n?"precision highp float;\n"+t:"precision mediump float;\n"+t:n||(t=t.replace("precision highp float","precision mediump float")),t},t.Zt=function(t){var i=/defined\((.+)\)/.exec(t);if(i&&i.length)return new $(i[1].trim(),"!"===t[0]);for(var n="",s=0,h=0,r=["==",">=","<=","<",">"];h<r.length&&(n=r[h],!((s=t.indexOf(n))>-1));h++);if(-1===s)return new $(t);var e=t.substring(0,s).trim(),u=t.substring(s+n.length).trim();return new nt(e,n,u)},t.Jt=function(t){t=t.replace(st,"defined[$1]");for(var i=[],n=0,s=J.infixToPostfix(t);n<s.length;n++){var h=s[n];if("||"!==h&&"&&"!==h)i.push(h);else if(i.length>=2){var r=i[i.length-1],e=i[i.length-2];i.length-=2;var u="&&"==h?new it:new tt;"string"==typeof r&&(r=r.replace(ht,"defined($1)")),"string"==typeof e&&(e=e.replace(ht,"defined($1)")),u.leftOperand="string"==typeof e?this.Zt(e):e,u.rightOperand="string"==typeof r?this.Zt(r):r,i.push(u)}}var o=i[i.length-1];return"string"==typeof o&&(o=o.replace(ht,"defined($1)")),"string"==typeof o?this.Zt(o):o},t.$t=function(t,i){var n=new Z,s=t.substring(0,i),h=t.substring(i);return h=h.substring(0,(h.indexOf("//")+1||h.length+1)-1).trim(),n.testExpression="#ifdef"===s?new $(h):"#ifndef"===s?new $(h,!0):this.Jt(h),n},t.ti=function(t,i,n){for(var s=t.currentLine;this.ii(t,n);){var h=(s=t.currentLine).substring(0,5).toLowerCase();if("#else"===h){var r=new V;return i.children.push(r),void this.ii(t,r)}if("#elif"===h){var e=this.$t(s,5);i.children.push(e),n=e}}},t.ii=function(t,i){for(;t.canRead;){t.lineIndex++;var n=t.currentLine,s=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/.exec(n);if(s&&s.length){switch(s[0]){case"#ifdef":var h=new z;i.children.push(h);var r=this.$t(n,6);h.children.push(r),this.ti(t,h,r);break;case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":h=new z;i.children.push(h);r=this.$t(n,7);h.children.push(r),this.ti(t,h,r);break;case"#if":h=new z,r=this.$t(n,3);i.children.push(h),h.children.push(r),this.ti(t,h,r)}}else{var e=new V;if(e.line=n,i.children.push(e),"#"===n[0]&&"d"===n[1]){var u=n.replace(";","").split(" ");e.additionalDefineKey=u[1],3===u.length&&(e.additionalDefineValue=u[2])}}}return!1},t.ni=function(t,i,n){var s=new V,h=new H;return h.lineIndex=-1,h.lines=t.split("\n"),this.ii(h,s),s.process(i,n)},t.si=function(t){for(var i={},n=0,s=t.defines;n<s.length;n++){var h=s[n].replace("#define","").replace(";","").trim().split(" ");i[h[0]]=h.length>1?h[1]:""}return i.GL_ES="true",i.hi=t.version,i[t.platformName]="true",i},t.Ht=function(t,i){var n=this.zt(t,i);if(!i.processor)return n;if(-1!==n.indexOf("#version 3"))return n.replace("#version 300 es","");var s=i.defines,h=this.si(i);return i.processor.preProcessor&&(n=i.processor.preProcessor(n,s,i.isFragment)),n=this.ni(n,h,i),i.processor.postProcessor&&(n=i.processor.postProcessor(n,s,i.isFragment)),n},t.Vt=function(i,n,s){for(var h=this,r=/#include<(.+)>(\((.*)\))*(\[(.*)\])*/g,e=r.exec(i),u=new String(i),o=!1;null!=e;){var f=e[1];if(-1!==f.indexOf("__decl__")&&(f=f.replace(/__decl__/,""),n.supportsUniformBuffers&&(f=(f=f.replace(/Vertex/,"Ubo")).replace(/Fragment/,"Ubo")),f+="Declaration"),!n.includesShadersStore[f]){var c=n.shadersRepository+"ShadersInclude/"+f+".fx";return void t.ri(c,(function(t){n.includesShadersStore[f]=t,h.Vt(u,n,s)}))}var a=n.includesShadersStore[f];if(e[2])for(var l=e[3].split(","),v=0;v<l.length;v+=2){var b=new RegExp(l[v],"g"),d=l[v+1];a=a.replace(b,d)}if(e[4]){var g=e[5];if(-1!==g.indexOf("..")){var w=g.split(".."),m=parseInt(w[0]),j=parseInt(w[1]),O=a.slice(0);a="",isNaN(j)&&(j=n.indexParameters[w[1]]);for(var y=m;y<j;y++)n.supportsUniformBuffers||(O=O.replace(/light\{X\}.(\w*)/g,(function(t,i){return i+"{X}"}))),a+=O.replace(/\{X\}/g,y.toString())+"\n"}else n.supportsUniformBuffers||(a=a.replace(/light\{X\}.(\w*)/g,(function(t,i){return i+"{X}"}))),a=a.replace(/\{X\}/g,g)}u=u.replace(e[0],a),o=o||a.indexOf("#include<")>=0,e=r.exec(i)}o?this.Vt(u.toString(),n,s):s(u)},t.ri=function(t,i,n,s,h,r){throw X.WarnImport("FileTools")},t}(),et=function(){function t(i,n,s,h,r,e,u,o,f,c){var a,l=this;void 0===h&&(h=null),void 0===e&&(e=null),void 0===u&&(u=null),void 0===o&&(o=null),void 0===f&&(f=null),this.name=null,this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new _,this.onErrorObservable=new _,this.ei=null,this.ui=!1,this.oi=!1,this.fi=!1,this.ci={},this.ai={},this.li=!1,this.vi="",this.bi=!1,this.di={},this.gi="",this.wi=null,this.mi="",this.ji="",this.Oi="",this.yi="",this.Ai=null,this.pi=null,this.Mi={},this.name=i;var v,b,d=null;if(n.attributes){var g=n;if(this.ct=s,this.Ki=g.attributes,this.Pi=g.uniformsNames.concat(g.samplers),this.xi=g.samplers.slice(),this.defines=g.defines,this.onError=g.onError,this.onCompiled=g.onCompiled,this.wi=g.fallbacks,this.ki=g.indexParameters,this.Ai=g.transformFeedbackVaryings||null,this.fi=!!g.multiTarget,g.uniformBuffersNames){this.Ei=g.uniformBuffersNames.slice();for(var w=0;w<g.uniformBuffersNames.length;w++)this.ci[g.uniformBuffersNames[w]]=w}d=null!==(a=g.processFinalCode)&&void 0!==a?a:null}else this.ct=r,this.defines=null==e?"":e,this.Pi=s.concat(h),this.xi=h?h.slice():[],this.Ki=n,this.Ei=[],this.onError=f,this.onCompiled=o,this.ki=c,this.wi=u;this.Ti={},this.uniqueId=t.Bi++;var m=U.IsWindowObjectExist()?this.ct.getHostDocument():null;i.vertexSource?v="source:"+i.vertexSource:i.vertexElement?(v=m?m.getElementById(i.vertexElement):null)||(v=i.vertexElement):v=i.vertex||i,i.fragmentSource?b="source:"+i.fragmentSource:i.fragmentElement?(b=m?m.getElementById(i.fragmentElement):null)||(b=i.fragmentElement):b=i.fragment||i;var j={defines:this.defines.split("\n"),indexParameters:this.ki,isFragment:!1,shouldUseHighPrecisionShader:this.ct.Fi,processor:this.ct.Ci,supportsUniformBuffers:this.ct.supportsUniformBuffers,shadersRepository:t.ShadersRepository,includesShadersStore:t.IncludesShadersStore,version:(100*this.ct.webGLVersion).toString(),platformName:this.ct.webGLVersion>=2?"WEBGL2":"WEBGL1"};this._i(v,"Vertex","",(function(t){l._i(b,"Fragment","Pixel",(function(n){rt.Process(t,j,(function(t){d&&(t=d("vertex",t)),j.isFragment=!0,rt.Process(n,j,(function(n){d&&(n=d("fragment",n)),l.Ui(t,n,i)}))}))}))}))}return Object.defineProperty(t.prototype,"onBindObservable",{get:function(){return this.ei||(this.ei=new _),this.ei},enumerable:!1,configurable:!0}),t.prototype.Ui=function(t,i,n){if(n){var s=n.vertexElement||n.vertex||n.spectorName||n,h=n.fragmentElement||n.fragment||n.spectorName||n;this.mi="#define SHADER_NAME vertex:"+s+"\n"+t,this.ji="#define SHADER_NAME fragment:"+h+"\n"+i}else this.mi=t,this.ji=i;this.Ri()},Object.defineProperty(t.prototype,"key",{get:function(){return this.gi},enumerable:!1,configurable:!0}),t.prototype.isReady=function(){try{return this.Si()}catch(t){return!1}},t.prototype.Si=function(){return!!this.li||!!this.pi&&this.pi.isReady},t.prototype.getEngine=function(){return this.ct},t.prototype.getPipelineContext=function(){return this.pi},t.prototype.getAttributesNames=function(){return this.Ki},t.prototype.getAttributeLocation=function(t){return this.Li[t]},t.prototype.getAttributeLocationByName=function(t){return this.Ti[t]},t.prototype.getAttributesCount=function(){return this.Li.length},t.prototype.getUniformIndex=function(t){return this.Pi.indexOf(t)},t.prototype.getUniform=function(t){return this.di[t]},t.prototype.getSamplers=function(){return this.xi},t.prototype.getUniformNames=function(){return this.Pi},t.prototype.getUniformBuffersNames=function(){return this.Ei},t.prototype.getIndexParameters=function(){return this.ki},t.prototype.getCompilationError=function(){return this.vi},t.prototype.allFallbacksProcessed=function(){return this.bi},t.prototype.executeWhenCompiled=function(t){var i=this;this.isReady()?t(this):(this.onCompileObservable.add((function(i){t(i)})),this.pi&&!this.pi.isAsync||setTimeout((function(){i.Di(null)}),16))},t.prototype.Di=function(t){var i=this;try{if(this.Si())return}catch(i){return void this.Ii(i,t)}setTimeout((function(){i.Di(t)}),16)},t.prototype._i=function(i,n,s,h){var r;if("undefined"!=typeof HTMLElement&&i instanceof HTMLElement)return void h(U.GetDOMTextContent(i));"source:"!==i.substr(0,7)?"base64:"!==i.substr(0,7)?t.ShadersStore[i+n+"Shader"]?h(t.ShadersStore[i+n+"Shader"]):s&&t.ShadersStore[i+s+"Shader"]?h(t.ShadersStore[i+s+"Shader"]):(r="."===i[0]||"/"===i[0]||i.indexOf("http")>-1?i:t.ShadersRepository+i,this.ct.Ni(r+"."+n.toLowerCase()+".fx",h)):h(window.atob(i.substr(7))):h(i.substr(7))},Object.defineProperty(t.prototype,"vertexSourceCode",{get:function(){return this.Oi&&this.yi?this.Oi:this.mi},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fragmentSourceCode",{get:function(){return this.Oi&&this.yi?this.yi:this.ji},enumerable:!1,configurable:!0}),t.prototype.Xi=function(t,i,n,s){var h=this;this.li=!1,this.Oi=t,this.yi=i,this.onError=function(t,i){s&&s(i)},this.onCompiled=function(){var t=h.getEngine().scenes;if(t)for(var i=0;i<t.length;i++)t[i].markAllMaterialsAsDirty(31);h.pi.Wi(n)},this.wi=null,this.Ri()},t.prototype.Ri=function(){var t=this,i=this.Ki,n=this.defines;this.Mi={};var s=this.pi;try{var h=this.ct;this.pi=h.createPipelineContext();var r=this.Xi.bind(this);this.Oi&&this.yi?h.Gi(this.pi,this.Oi,this.yi,!0,r,null,this.Ai):h.Gi(this.pi,this.mi,this.ji,!1,r,n,this.Ai),h.qi(this.pi,(function(){if(h.supportsUniformBuffers)for(var n in t.ci)t.bindUniformBlock(n,t.ci[n]);var r;if(h.getUniforms(t.pi,t.Pi).forEach((function(i,n){t.di[t.Pi[n]]=i})),t.Li=h.getAttributes(t.pi,i),i)for(var e=0;e<i.length;e++){var u=i[e];t.Ti[u]=t.Li[e]}for(r=0;r<t.xi.length;r++){null==t.getUniform(t.xi[r])&&(t.xi.splice(r,1),r--)}t.xi.forEach((function(i,n){t.ai[i]=n})),h.bindSamplers(t),t.vi="",t.li=!0,t.onCompiled&&t.onCompiled(t),t.onCompileObservable.notifyObservers(t),t.onCompileObservable.clear(),t.wi&&t.wi.unBindMesh(),s&&t.getEngine().Qi(s)})),this.pi.isAsync&&this.Di(s)}catch(t){this.Ii(t,s)}},t.prototype.Yi=function(t,i,n){var s=n?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/,h=null;if(i&&t){var r=i.match(s);if(r&&2===r.length){var e=parseInt(r[1]),u=t.split("\n",-1);u.length>=e&&(h="Offending line ["+e+"] in "+(n?"fragment":"vertex")+" code: "+u[e-1])}}return[t,h]},t.prototype.Ii=function(i,n){var s,h,r,e,u;void 0===n&&(n=null),this.vi=i.message;var o=this.Ki,f=this.wi;if(R.Error("Unable to compile effect:"),R.Error("Uniforms: "+this.Pi.map((function(t){return" "+t}))),R.Error("Attributes: "+o.map((function(t){return" "+t}))),R.Error("Defines:\r\n"+this.defines),t.LogShaderCodeOnCompilationError){var c=null,a=null,l=null;(null===(r=this.pi)||void 0===r?void 0:r.Vi())&&(l=(s=this.Yi(this.pi.Vi(),this.vi,!1))[0],c=s[1],l&&(R.Error("Vertex code:"),R.Error(l))),(null===(e=this.pi)||void 0===e?void 0:e.Hi())&&(l=(h=this.Yi(null===(u=this.pi)||void 0===u?void 0:u.Hi(),this.vi,!0))[0],a=h[1],l&&(R.Error("Fragment code:"),R.Error(l))),c&&R.Error(c),a&&R.Error(a)}R.Error("Error: "+this.vi),n&&(this.pi=n,this.li=!0,this.onError&&this.onError(this,this.vi),this.onErrorObservable.notifyObservers(this)),f?(this.pi=null,f.hasMoreFallbacks?(this.bi=!1,R.Error("Trying next fallback."),this.defines=f.reduce(this.defines,this),this.Ri()):(this.bi=!0,this.onError&&this.onError(this,this.vi),this.onErrorObservable.notifyObservers(this),this.onErrorObservable.clear(),this.wi&&this.wi.unBindMesh())):this.bi=!0},Object.defineProperty(t.prototype,"isSupported",{get:function(){return""===this.vi},enumerable:!1,configurable:!0}),t.prototype.zi=function(t,i){this.ct.zi(this.ai[t],i)},t.prototype.setTexture=function(t,i){this.ct.setTexture(this.ai[t],this.di[t],i)},t.prototype.setDepthStencilTexture=function(t,i){this.ct.setDepthStencilTexture(this.ai[t],this.di[t],i)},t.prototype.setTextureArray=function(t,i){var n=t+"Ex";if(-1===this.xi.indexOf(n+"0")){for(var s=this.xi.indexOf(t),h=1;h<i.length;h++){var r=n+(h-1).toString();this.xi.splice(s+h,0,r)}for(var e=0,u=0,o=this.xi;u<o.length;u++){var f=o[u];this.ai[f]=e,e+=1}}this.ct.setTextureArray(this.ai[t],this.di[t],i)},t.prototype.setTextureFromPostProcess=function(t,i){this.ct.setTextureFromPostProcess(this.ai[t],i)},t.prototype.setTextureFromPostProcessOutput=function(t,i){this.ct.setTextureFromPostProcessOutput(this.ai[t],i)},t.prototype.Zi=function(t,i){var n=this.Mi[t],s=i.updateFlag;return(void 0===n||n!==s)&&(this.Mi[t]=s,!0)},t.prototype.Ji=function(t,i,n){var s=this.Mi[t];if(!s||2!==s.length)return s=[i,n],this.Mi[t]=s,!0;var h=!1;return s[0]!==i&&(s[0]=i,h=!0),s[1]!==n&&(s[1]=n,h=!0),h},t.prototype.$i=function(t,i,n,s){var h=this.Mi[t];if(!h||3!==h.length)return h=[i,n,s],this.Mi[t]=h,!0;var r=!1;return h[0]!==i&&(h[0]=i,r=!0),h[1]!==n&&(h[1]=n,r=!0),h[2]!==s&&(h[2]=s,r=!0),r},t.prototype.tn=function(t,i,n,s,h){var r=this.Mi[t];if(!r||4!==r.length)return r=[i,n,s,h],this.Mi[t]=r,!0;var e=!1;return r[0]!==i&&(r[0]=i,e=!0),r[1]!==n&&(r[1]=n,e=!0),r[2]!==s&&(r[2]=s,e=!0),r[3]!==h&&(r[3]=h,e=!0),e},t.prototype.bindUniformBuffer=function(i,n){var s=this.ci[n];void 0!==s&&t.in[s]!==i&&(t.in[s]=i,this.ct.bindUniformBufferBase(i,s))},t.prototype.bindUniformBlock=function(t,i){this.ct.bindUniformBlock(this.pi,t,i)},t.prototype.setInt=function(t,i){var n=this.Mi[t];return void 0!==n&&n===i?this:(this.Mi[t]=i,this.ct.setInt(this.di[t],i),this)},t.prototype.setIntArray=function(t,i){return this.Mi[t]=null,this.ct.setIntArray(this.di[t],i),this},t.prototype.setIntArray2=function(t,i){return this.Mi[t]=null,this.ct.setIntArray2(this.di[t],i),this},t.prototype.setIntArray3=function(t,i){return this.Mi[t]=null,this.ct.setIntArray3(this.di[t],i),this},t.prototype.setIntArray4=function(t,i){return this.Mi[t]=null,this.ct.setIntArray4(this.di[t],i),this},t.prototype.setFloatArray=function(t,i){return this.Mi[t]=null,this.ct.setArray(this.di[t],i),this},t.prototype.setFloatArray2=function(t,i){return this.Mi[t]=null,this.ct.setArray2(this.di[t],i),this},t.prototype.setFloatArray3=function(t,i){return this.Mi[t]=null,this.ct.setArray3(this.di[t],i),this},t.prototype.setFloatArray4=function(t,i){return this.Mi[t]=null,this.ct.setArray4(this.di[t],i),this},t.prototype.setArray=function(t,i){return this.Mi[t]=null,this.ct.setArray(this.di[t],i),this},t.prototype.setArray2=function(t,i){return this.Mi[t]=null,this.ct.setArray2(this.di[t],i),this},t.prototype.setArray3=function(t,i){return this.Mi[t]=null,this.ct.setArray3(this.di[t],i),this},t.prototype.setArray4=function(t,i){return this.Mi[t]=null,this.ct.setArray4(this.di[t],i),this},t.prototype.setMatrices=function(t,i){return i?(this.Mi[t]=null,this.ct.setMatrices(this.di[t],i),this):this},t.prototype.setMatrix=function(t,i){return this.Zi(t,i)&&this.ct.setMatrices(this.di[t],i.toArray()),this},t.prototype.setMatrix3x3=function(t,i){return this.Mi[t]=null,this.ct.setMatrix3x3(this.di[t],i),this},t.prototype.setMatrix2x2=function(t,i){return this.Mi[t]=null,this.ct.setMatrix2x2(this.di[t],i),this},t.prototype.setFloat=function(t,i){var n=this.Mi[t];return void 0!==n&&n===i?this:(this.Mi[t]=i,this.ct.setFloat(this.di[t],i),this)},t.prototype.setBool=function(t,i){var n=this.Mi[t];return void 0!==n&&n===i?this:(this.Mi[t]=i,this.ct.setInt(this.di[t],i?1:0),this)},t.prototype.setVector2=function(t,i){return this.Ji(t,i.x,i.y)&&this.ct.setFloat2(this.di[t],i.x,i.y),this},t.prototype.setFloat2=function(t,i,n){return this.Ji(t,i,n)&&this.ct.setFloat2(this.di[t],i,n),this},t.prototype.setVector3=function(t,i){return this.$i(t,i.x,i.y,i.z)&&this.ct.setFloat3(this.di[t],i.x,i.y,i.z),this},t.prototype.setFloat3=function(t,i,n,s){return this.$i(t,i,n,s)&&this.ct.setFloat3(this.di[t],i,n,s),this},t.prototype.setVector4=function(t,i){return this.tn(t,i.x,i.y,i.z,i.w)&&this.ct.setFloat4(this.di[t],i.x,i.y,i.z,i.w),this},t.prototype.setFloat4=function(t,i,n,s,h){return this.tn(t,i,n,s,h)&&this.ct.setFloat4(this.di[t],i,n,s,h),this},t.prototype.setColor3=function(t,i){return this.$i(t,i.r,i.g,i.b)&&this.ct.setFloat3(this.di[t],i.r,i.g,i.b),this},t.prototype.setColor4=function(t,i,n){return this.tn(t,i.r,i.g,i.b,n)&&this.ct.setFloat4(this.di[t],i.r,i.g,i.b,n),this},t.prototype.setDirectColor4=function(t,i){return this.tn(t,i.r,i.g,i.b,i.a)&&this.ct.setFloat4(this.di[t],i.r,i.g,i.b,i.a),this},t.prototype.dispose=function(){this.ct.nn(this)},t.RegisterShader=function(i,n,s){n&&(t.ShadersStore[i+"PixelShader"]=n),s&&(t.ShadersStore[i+"VertexShader"]=s)},t.ResetCache=function(){t.in={}},t.ShadersRepository="src/Shaders/",t.LogShaderCodeOnCompilationError=!0,t.Bi=0,t.in={},t.ShadersStore={},t.IncludesShadersStore={},t}(),ut=function(){function t(){this.sn=!1,this.hn=!1,this.rn=!1,this.en=!1,this.un=!1,this.on=!1,this.fn=!1,this.reset()}return Object.defineProperty(t.prototype,"isDirty",{get:function(){return this.rn||this.sn||this.hn||this.en||this.un||this.on||this.fn},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"zOffset",{get:function(){return this.cn},set:function(t){this.cn!==t&&(this.cn=t,this.on=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cullFace",{get:function(){return this.an},set:function(t){this.an!==t&&(this.an=t,this.en=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cull",{get:function(){return this.ln},set:function(t){this.ln!==t&&(this.ln=t,this.un=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"depthFunc",{get:function(){return this.vn},set:function(t){this.vn!==t&&(this.vn=t,this.rn=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"depthMask",{get:function(){return this.bn},set:function(t){this.bn!==t&&(this.bn=t,this.hn=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"depthTest",{get:function(){return this.dn},set:function(t){this.dn!==t&&(this.dn=t,this.sn=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"frontFace",{get:function(){return this.gn},set:function(t){this.gn!==t&&(this.gn=t,this.fn=!0)},enumerable:!1,configurable:!0}),t.prototype.reset=function(){this.bn=!0,this.dn=!0,this.vn=null,this.an=null,this.ln=null,this.cn=0,this.gn=null,this.sn=!0,this.hn=!0,this.rn=!1,this.en=!1,this.un=!1,this.on=!1,this.fn=!1},t.prototype.apply=function(t){this.isDirty&&(this.un&&(this.cull?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),this.un=!1),this.en&&(t.cullFace(this.cullFace),this.en=!1),this.hn&&(t.depthMask(this.depthMask),this.hn=!1),this.sn&&(this.depthTest?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),this.sn=!1),this.rn&&(t.depthFunc(this.depthFunc),this.rn=!1),this.on&&(this.zOffset?(t.enable(t.POLYGON_OFFSET_FILL),t.polygonOffset(this.zOffset,0)):t.disable(t.POLYGON_OFFSET_FILL),this.on=!1),this.fn&&(t.frontFace(this.frontFace),this.fn=!1))},t}(),ot=function(){function t(){this.wn=!1,this.mn=!1,this.jn=!1,this.On=!1,this.reset()}return Object.defineProperty(t.prototype,"isDirty",{get:function(){return this.wn||this.mn||this.jn||this.On},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stencilFunc",{get:function(){return this.yn},set:function(t){this.yn!==t&&(this.yn=t,this.jn=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stencilFuncRef",{get:function(){return this.An},set:function(t){this.An!==t&&(this.An=t,this.jn=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stencilFuncMask",{get:function(){return this.pn},set:function(t){this.pn!==t&&(this.pn=t,this.jn=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stencilOpStencilFail",{get:function(){return this.Mn},set:function(t){this.Mn!==t&&(this.Mn=t,this.On=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stencilOpDepthFail",{get:function(){return this.Kn},set:function(t){this.Kn!==t&&(this.Kn=t,this.On=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stencilOpStencilDepthPass",{get:function(){return this.Pn},set:function(t){this.Pn!==t&&(this.Pn=t,this.On=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stencilMask",{get:function(){return this.xn},set:function(t){this.xn!==t&&(this.xn=t,this.mn=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stencilTest",{get:function(){return this.kn},set:function(t){this.kn!==t&&(this.kn=t,this.wn=!0)},enumerable:!1,configurable:!0}),t.prototype.reset=function(){this.kn=!1,this.xn=255,this.yn=t.ALWAYS,this.An=1,this.pn=255,this.Mn=t.KEEP,this.Kn=t.KEEP,this.Pn=t.REPLACE,this.wn=!0,this.mn=!0,this.jn=!0,this.On=!0},t.prototype.apply=function(t){this.isDirty&&(this.wn&&(this.stencilTest?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),this.wn=!1),this.mn&&(t.stencilMask(this.stencilMask),this.mn=!1),this.jn&&(t.stencilFunc(this.stencilFunc,this.stencilFuncRef,this.stencilFuncMask),this.jn=!1),this.On&&(t.stencilOp(this.stencilOpStencilFail,this.stencilOpDepthFail,this.stencilOpStencilDepthPass),this.On=!1))},t.ALWAYS=519,t.KEEP=7680,t.REPLACE=7681,t}(),ft=function(){function t(){this.En=!1,this.Tn=!1,this.Bn=!1,this.Fn=!1,this.Cn=!1,this._n=new Array(4),this.Un=new Array(2),this.Rn=new Array(4),this.reset()}return Object.defineProperty(t.prototype,"isDirty",{get:function(){return this.En||this.Tn},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"alphaBlend",{get:function(){return this.Cn},set:function(t){this.Cn!==t&&(this.Cn=t,this.En=!0)},enumerable:!1,configurable:!0}),t.prototype.setAlphaBlendConstants=function(t,i,n,s){this.Rn[0]===t&&this.Rn[1]===i&&this.Rn[2]===n&&this.Rn[3]===s||(this.Rn[0]=t,this.Rn[1]=i,this.Rn[2]=n,this.Rn[3]=s,this.Fn=!0)},t.prototype.setAlphaBlendFunctionParameters=function(t,i,n,s){this._n[0]===t&&this._n[1]===i&&this._n[2]===n&&this._n[3]===s||(this._n[0]=t,this._n[1]=i,this._n[2]=n,this._n[3]=s,this.Tn=!0)},t.prototype.setAlphaEquationParameters=function(t,i){this.Un[0]===t&&this.Un[1]===i||(this.Un[0]=t,this.Un[1]=i,this.Bn=!0)},t.prototype.reset=function(){this.Cn=!1,this._n[0]=null,this._n[1]=null,this._n[2]=null,this._n[3]=null,this.Un[0]=null,this.Un[1]=null,this.Rn[0]=null,this.Rn[1]=null,this.Rn[2]=null,this.Rn[3]=null,this.En=!0,this.Tn=!1,this.Bn=!1,this.Fn=!1},t.prototype.apply=function(t){this.isDirty&&(this.En&&(this.Cn?t.enable(t.BLEND):t.disable(t.BLEND),this.En=!1),this.Tn&&(t.blendFuncSeparate(this._n[0],this._n[1],this._n[2],this._n[3]),this.Tn=!1),this.Bn&&(t.blendEquationSeparate(this.Un[0],this.Un[1]),this.Bn=!1),this.Fn&&(t.blendColor(this.Rn[0],this.Rn[1],this.Rn[2],this.Rn[3]),this.Fn=!1))},t}(),ct=function(){};!function(t){t[t.Unknown=0]="Unknown",t[t.Url=1]="Url",t[t.Temp=2]="Temp",t[t.Raw=3]="Raw",t[t.Dynamic=4]="Dynamic",t[t.RenderTarget=5]="RenderTarget",t[t.MultiRenderTarget=6]="MultiRenderTarget",t[t.Cube=7]="Cube",t[t.CubeRaw=8]="CubeRaw",t[t.CubePrefiltered=9]="CubePrefiltered",t[t.Raw3D=10]="Raw3D",t[t.Raw2DArray=11]="Raw2DArray",t[t.Depth=12]="Depth",t[t.CubeRawRGBD=13]="CubeRawRGBD"}(D||(D={}));var at,lt=function(){function t(t,i,n){void 0===n&&(n=!1),this.isReady=!1,this.isCube=!1,this.is3D=!1,this.is2DArray=!1,this.isMultiview=!1,this.url="",this.samplingMode=-1,this.generateMipMaps=!1,this.samples=0,this.type=-1,this.format=-1,this.onLoadedObservable=new _,this.width=0,this.height=0,this.depth=0,this.baseWidth=0,this.baseHeight=0,this.baseDepth=0,this.invertY=!1,this.Sn=!1,this.Ln=-1,this.Dn=D.Unknown,this.dt=null,this.In=null,this.Nn=null,this.Xn=null,this.yt=0,this.Wn="",this.Gn=null,this.qn=null,this.Qn=null,this.Yn=null,this.Vn=null,this.Hn=null,this.zn=null,this.Zn=null,this.Jn=null,this.$n=null,this.ts=null,this.ns=null,this.ss=null,this.hs=null,this.rs=!1,this.es=null,this.us=!1,this.os=!1,this.fs=0,this.cs=null,this.as=0,this.ls=0,this.vs=null,this.bs=null,this.ds=null,this.gs=null,this.ws=null,this.ms=!1,this.js=!1,this.Os=null,this.ys=null,this.As=1,this.ct=t,this.Dn=i,n||(this.ys=t.ps())}return t.prototype.getEngine=function(){return this.ct},Object.defineProperty(t.prototype,"source",{get:function(){return this.Dn},enumerable:!1,configurable:!0}),t.prototype.incrementReferences=function(){this.As++},t.prototype.updateSize=function(t,i,n){void 0===n&&(n=1),this.width=t,this.height=i,this.depth=n,this.baseWidth=t,this.baseHeight=i,this.baseDepth=n,this.yt=t*i*n},t.prototype.gt=function(){var i,n=this;switch(this.isReady=!1,this.$n=null,this.ts=null,this.ns=null,this.hs=null,this.source){case D.Temp:return;case D.Url:return void(i=this.ct.createTexture(this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,(function(){i.Ms(n),n.isReady=!0}),null,this.dt,void 0,this.format));case D.Raw:return(i=this.ct.createRawTexture(this.In,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this.es)).Ms(this),void(this.isReady=!0);case D.Raw3D:return(i=this.ct.createRawTexture3D(this.In,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this.es)).Ms(this),void(this.isReady=!0);case D.Raw2DArray:return(i=this.ct.createRawTexture2DArray(this.In,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this.es)).Ms(this),void(this.isReady=!0);case D.Dynamic:return(i=this.ct.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode)).Ms(this),void this.ct.updateDynamicTexture(this,this.ct.getRenderingCanvas(),this.invertY,void 0,void 0,!0);case D.RenderTarget:var s=new ct;if(s.generateDepthBuffer=this.os,s.generateMipMaps=this.generateMipMaps,s.generateStencilBuffer=this.us,s.samplingMode=this.samplingMode,s.type=this.type,this.isCube)i=this.ct.createRenderTargetCubeTexture(this.width,s);else{var h={width:this.width,height:this.height,layers:this.is2DArray?this.depth:void 0};i=this.ct.createRenderTargetTexture(h,s)}return i.Ms(this),void(this.isReady=!0);case D.Depth:var r={bilinearFiltering:2!==this.samplingMode,comparisonFunction:this.fs,generateStencil:this.us,isCube:this.isCube},e={width:this.width,height:this.height,layers:this.is2DArray?this.depth:void 0};return(i=this.ct.createDepthStencilTexture(e,r)).Ms(this),void(this.isReady=!0);case D.Cube:return void(i=this.ct.createCubeTexture(this.url,null,this.Gn,!this.generateMipMaps,(function(){i.Ms(n),n.isReady=!0}),null,this.format,this.Wn));case D.CubeRaw:return(i=this.ct.createRawCubeTexture(this.Nn,this.width,this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this.es)).Ms(this),void(this.isReady=!0);case D.CubeRawRGBD:return i=this.ct.createRawCubeTexture(null,this.width,this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this.es),void t.Ks(i,this.Xn,this.cs,this.as,this.ls).then((function(){i.Ms(n),n.isReady=!0}));case D.CubePrefiltered:return void((i=this.ct.createPrefilteredCubeTexture(this.url,null,this.as,this.ls,(function(t){t&&t.Ms(n),n.isReady=!0}),null,this.format,this.Wn)).cs=this.cs)}},t.prototype.Ms=function(t){t.ys=this.ys,t.ms=this.ms,this.Yn&&(t.Yn=this.Yn),this.Vn&&(t.Vn=this.Vn),t.Ps=this.Ps,this.ds&&(t.ds&&t.ds.dispose(),t.ds=this.ds),this.gs&&(t.gs&&t.gs.dispose(),t.gs=this.gs),this.ws&&(t.ws&&t.ws.dispose(),t.ws=this.ws),this.Os&&(t.Os&&t.Os.dispose(),t.Os=this.Os);var i,n=this.ct.getLoadedTexturesCache();-1!==(i=n.indexOf(this))&&n.splice(i,1),-1===(i=n.indexOf(t))&&n.push(t)},t.prototype.dispose=function(){this.ys&&(this.As--,0===this.As&&(this.ct.xs(this),this.ys=null))},t.Ks=function(t,i,n,s,h){throw X.WarnImport("environmentTextureTools")},t}(),vt=function(){function t(){}return t.prototype.attributeProcessor=function(t){return t.replace("attribute","in")},t.prototype.varyingProcessor=function(t,i){return t.replace("varying",i?"in":"out")},t.prototype.postProcessor=function(t,i,n){var s=-1!==t.search(/#extension.+GL_EXT_draw_buffers.+require/);if(t=(t=t.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\s*\(/g,"texture("),n)t=(t=(t=(t=(t=(t=(t=t.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(s?"":"out vec4 glFragColor;\n")+"void main(");else if(-1!==i.indexOf("#define MULTIVIEW"))return"#extension GL_OVR_multiview2 : require\nlayout (num_views = 2) in;\n"+t;return t},t}(),bt=function(t){function i(i){var n=t.call(this)||this;return n.dt=i,n}return E(i,t),Object.defineProperty(i.prototype,"underlyingResource",{get:function(){return this.dt},enumerable:!1,configurable:!0}),i}(function(){function t(){this.references=0,this.capacity=0,this.is32Bits=!1}return Object.defineProperty(t.prototype,"underlyingResource",{get:function(){return null},enumerable:!1,configurable:!0}),t}()),dt=function(){function t(){this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null}return Object.defineProperty(t.prototype,"isAsync",{get:function(){return this.isParallelCompiled},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isReady",{get:function(){return!!this.program&&(!this.isParallelCompiled||this.engine.ks(this))},enumerable:!1,configurable:!0}),t.prototype.Wi=function(t){t&&this.program&&t(this.program)},t.prototype.Vi=function(){return this.vertexShader?this.engine.Es(this.vertexShader):null},t.prototype.Hi=function(){return this.fragmentShader?this.engine.Es(this.fragmentShader):null},t}(),gt=function(){function t(){}return t.CreateCanvas=function(t,i){if("undefined"==typeof document)return new OffscreenCanvas(t,i);var n=document.createElement("canvas");return n.width=t,n.height=i,n},t}(),wt=function(){},mt=function(){function t(i,n,s,h){var r=this;void 0===h&&(h=!1),this.forcePOTTextures=!1,this.isFullscreen=!1,this.cullBackFaces=!0,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this.validateShaderPrograms=!1,this.useReverseDepthBuffer=!1,this.disableUniformBuffers=!1,this.Ts=new Array,this.Bs=1,this.Fs=!1,this.Cs=!0,this._s=!1,this.Us=!1,this.Rs=!1,this.Ss=new Array,this.onContextLostObservable=new _,this.onContextRestoredObservable=new _,this.Ls=!1,this.Ds=!1,this.disableVertexArrayObjects=!1,this.Is=!0,this.Ns=!0,this.Xs=new ut,this.Ws=new ot,this.Gs=new ft,this.qs=1,this.Qs=0,this.Ys=new Array,this.Vs=0,this.Hs=-1,this.zs={},this.Zs={},this.Js=[],this.$s=!1,this.th=new Array,this.ih=null,this.nh=null,this.sh=new Array,this.hh=new Array,this.rh=new Array,this.eh=!1,this.uh=!1,this.oh=new Array,this.fh=0,this.ah=new Array,this.lh=null,this.premultipliedAlpha=!0,this.onBeforeTextureInitObservable=new _,this.vh={x:0,y:0,z:0,w:0},this.bh=null,this.enableUnpackFlipYCached=!0,this.dh=function(t,i,n,s,h,e){var u=r.gh,o=u.createRenderbuffer();return u.bindRenderbuffer(u.RENDERBUFFER,o),n>1&&u.renderbufferStorageMultisample?u.renderbufferStorageMultisample(u.RENDERBUFFER,n,h,t,i):u.renderbufferStorage(u.RENDERBUFFER,s,t,i),u.framebufferRenderbuffer(u.FRAMEBUFFER,e,u.RENDERBUFFER,o),u.bindRenderbuffer(u.RENDERBUFFER,null),o},this.wh={};var e=null;if(i){if(s=s||{},i.getContext){if(e=i,this.mh=e,null!=n&&(s.antialias=n),void 0===s.deterministicLockstep&&(s.deterministicLockstep=!1),void 0===s.lockstepMaxSteps&&(s.lockstepMaxSteps=4),void 0===s.timeStep&&(s.timeStep=1/60),void 0===s.preserveDrawingBuffer&&(s.preserveDrawingBuffer=!1),void 0===s.audioEngine&&(s.audioEngine=!0),void 0===s.stencil&&(s.stencil=!0),!1===s.premultipliedAlpha&&(this.premultipliedAlpha=!1),void 0===s.xrCompatible&&(s.xrCompatible=!0),this.Ds=!!s.doNotHandleContextLost,navigator&&navigator.userAgent)for(var u=navigator.userAgent,o=0,f=t.ExceptionList;o<f.length;o++){var c=f[o],a=c.key,l=c.targets;if(new RegExp(a).test(u)){if(c.capture&&c.captureConstraint){var v=c.capture,b=c.captureConstraint,d=new RegExp(v).exec(u);if(d&&d.length>0)if(parseInt(d[d.length-1])>=b)continue}for(var g=0,w=l;g<w.length;g++){switch(w[g]){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0}}}}if(this.Ds||(this.jh=function(t){t.preventDefault(),r.Ls=!0,R.Warn("WebGL context lost."),r.onContextLostObservable.notifyObservers(r)},this.Oh=function(){setTimeout((function(){r.yh(),r.Ah(),r.ph(),r.Mh(),r.wipeCaches(!0),R.Warn("WebGL context successfully restored."),r.onContextRestoredObservable.notifyObservers(r),r.Ls=!1}),0)},e.addEventListener("webglcontextlost",this.jh,!1),e.addEventListener("webglcontextrestored",this.Oh,!1),s.powerPreference="high-performance"),!s.disableWebGL2Support)try{this.gh=e.getContext("webgl2",s)||e.getContext("experimental-webgl2",s),this.gh&&(this.Bs=2,this.gh.deleteQuery||(this.Bs=1))}catch(t){}if(!this.gh){if(!e)throw new Error("The provided canvas is null or undefined.");try{this.gh=e.getContext("webgl",s)||e.getContext("experimental-webgl",s)}catch(t){throw new Error("WebGL not supported")}}if(!this.gh)throw new Error("WebGL not supported")}else{this.gh=i,this.mh=this.gh.canvas,this.gh.renderbufferStorageMultisample&&(this.Bs=2);var m=this.gh.getContextAttributes();m&&(s.stencil=m.stencil)}this.gh.pixelStorei(this.gh.UNPACK_COLORSPACE_CONVERSION_WEBGL,this.gh.NONE),void 0!==s.useHighPrecisionFloats&&(this.Cs=s.useHighPrecisionFloats);var j=U.IsWindowObjectExist()&&window.devicePixelRatio||1,O=s.limitDeviceRatio||j;this.Kh=h?1/Math.min(O,j):1,this.resize(),this.Ph=!!s.stencil,this.yh();for(var y=0;y<this.xh.maxVertexAttribs;y++)this.sh[y]=new wt;this.webGLVersion>1&&(this.Ci=new vt),this._s=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent),this.Us=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),this.kh=s,console.log("Babylon.js v"+t.Version+" - "+this.description)}}return Object.defineProperty(t,"NpmPackage",{get:function(){return"babylonjs@4.2.0-alpha.22"},enumerable:!1,configurable:!0}),Object.defineProperty(t,"Version",{get:function(){return"4.2.0-alpha.22"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"description",{get:function(){var t="WebGL"+this.webGLVersion;return this.xh.parallelShaderCompile&&(t+=" - Parallel shader compilation"),t},enumerable:!1,configurable:!0}),Object.defineProperty(t,"ShadersRepository",{get:function(){return et.ShadersRepository},set:function(t){et.ShadersRepository=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"supportsUniformBuffers",{get:function(){return this.webGLVersion>1&&!this.disableUniformBuffers},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Fi",{get:function(){return!(!this.xh.highPrecisionShaderSupported||!this.Cs)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"needPOTTextures",{get:function(){return this.Bs<2||this.forcePOTTextures},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"doNotHandleContextLost",{get:function(){return this.Ds},set:function(t){this.Ds=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Eh",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"framebufferDimensionsObject",{set:function(t){this.Th=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentViewport",{get:function(){return this.Bh},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"emptyTexture",{get:function(){return this.Fh||(this.Fh=this.createRawTexture(new Uint8Array(4),1,1,5,!1,!1,1)),this.Fh},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"emptyTexture3D",{get:function(){return this.Ch||(this.Ch=this.createRawTexture3D(new Uint8Array(4),1,1,1,5,!1,!1,1)),this.Ch},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"emptyTexture2DArray",{get:function(){return this._h||(this._h=this.createRawTexture2DArray(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._h},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"emptyCubeTexture",{get:function(){if(!this.Uh){var t=new Uint8Array(4),i=[t,t,t,t,t,t];this.Uh=this.createRawCubeTexture(i,1,5,0,!1,!1,1)}return this.Uh},enumerable:!1,configurable:!0}),t.prototype.ph=function(){for(var t=0,i=this.Ys.slice();t<i.length;t++){i[t].gt()}},t.prototype.Ah=function(){for(var t in this.Zs){this.Zs[t].Ri()}et.ResetCache()},t.prototype.areAllEffectsReady=function(){for(var t in this.Zs){if(!this.Zs[t].isReady())return!1}return!0},t.prototype.Mh=function(){for(var t=0,i=this.Ts;t<i.length;t++){i[t].gt()}},t.prototype.yh=function(){this.xh={maxTexturesImageUnits:this.gh.getParameter(this.gh.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this.gh.getParameter(this.gh.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this.gh.getParameter(this.gh.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this.gh.getParameter(this.gh.MAX_TEXTURE_SIZE),maxSamples:this.Bs>1?this.gh.getParameter(this.gh.MAX_SAMPLES):1,maxCubemapTextureSize:this.gh.getParameter(this.gh.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this.gh.getParameter(this.gh.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this.gh.getParameter(this.gh.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this.gh.getParameter(this.gh.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this.gh.getParameter(this.gh.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this.gh.getParameter(this.gh.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this.gh.getExtension("KHR_parallel_shader_compile"),standardDerivatives:this.Bs>1||null!==this.gh.getExtension("OES_standard_derivatives"),maxAnisotropy:1,astc:this.gh.getExtension("WEBGL_compressed_texture_astc")||this.gh.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),s3tc:this.gh.getExtension("WEBGL_compressed_texture_s3tc")||this.gh.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),pvrtc:this.gh.getExtension("WEBGL_compressed_texture_pvrtc")||this.gh.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this.gh.getExtension("WEBGL_compressed_texture_etc1")||this.gh.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this.gh.getExtension("WEBGL_compressed_texture_etc")||this.gh.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this.gh.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this.gh.getExtension("EXT_texture_filter_anisotropic")||this.gh.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this.gh.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:this.Bs>1||null!==this.gh.getExtension("OES_element_index_uint"),fragmentDepthSupported:this.Bs>1||null!==this.gh.getExtension("EXT_frag_depth"),highPrecisionShaderSupported:!1,timerQuery:this.gh.getExtension("EXT_disjoint_timer_query_webgl2")||this.gh.getExtension("EXT_disjoint_timer_query"),canUseTimestampForTimerQuery:!1,drawBuffersExtension:!1,maxMSAASamples:1,colorBufferFloat:this.Bs>1&&this.gh.getExtension("EXT_color_buffer_float"),textureFloat:!!(this.Bs>1||this.gh.getExtension("OES_texture_float")),textureHalfFloat:!!(this.Bs>1||this.gh.getExtension("OES_texture_half_float")),textureHalfFloatRender:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloatLinearFiltering:!1,vertexArrayObject:!1,instancedArrays:!1,textureLOD:!!(this.Bs>1||this.gh.getExtension("EXT_shader_texture_lod")),blendMinMax:!1,multiview:this.gh.getExtension("OVR_multiview2"),oculusMultiview:this.gh.getExtension("OCULUS_multiview"),depthTextureExtension:!1},this.Rh=this.gh.getParameter(this.gh.VERSION);var t=this.gh.getExtension("WEBGL_debug_renderer_info");if(null!=t&&(this.Sh=this.gh.getParameter(t.UNMASKED_RENDERER_WEBGL),this.Lh=this.gh.getParameter(t.UNMASKED_VENDOR_WEBGL)),this.Lh||(this.Lh="Unknown vendor"),this.Sh||(this.Sh="Unknown renderer"),36193!==this.gh.HALF_FLOAT_OES&&(this.gh.HALF_FLOAT_OES=36193),34842!==this.gh.RGBA16F&&(this.gh.RGBA16F=34842),34836!==this.gh.RGBA32F&&(this.gh.RGBA32F=34836),35056!==this.gh.DEPTH24_STENCIL8&&(this.gh.DEPTH24_STENCIL8=35056),this.xh.timerQuery&&(1===this.Bs&&(this.gh.getQuery=this.xh.timerQuery.getQueryEXT.bind(this.xh.timerQuery)),this.xh.canUseTimestampForTimerQuery=this.gh.getQuery(this.xh.timerQuery.TIMESTAMP_EXT,this.xh.timerQuery.QUERY_COUNTER_BITS_EXT)>0),this.xh.maxAnisotropy=this.xh.textureAnisotropicFilterExtension?this.gh.getParameter(this.xh.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this.xh.textureFloatLinearFiltering=!(!this.xh.textureFloat||!this.gh.getExtension("OES_texture_float_linear")),this.xh.textureFloatRender=!(!this.xh.textureFloat||!this.Dh()),this.xh.textureHalfFloatLinearFiltering=!!(this.Bs>1||this.xh.textureHalfFloat&&this.gh.getExtension("OES_texture_half_float_linear")),this.Bs>1&&5131!==this.gh.HALF_FLOAT_OES&&(this.gh.HALF_FLOAT_OES=5131),this.xh.textureHalfFloatRender=this.xh.textureHalfFloat&&this.Ih(),this.Bs>1)this.xh.drawBuffersExtension=!0,this.xh.maxMSAASamples=this.gh.getParameter(this.gh.MAX_SAMPLES);else{var i=this.gh.getExtension("WEBGL_draw_buffers");if(null!==i){this.xh.drawBuffersExtension=!0,this.gh.drawBuffers=i.drawBuffersWEBGL.bind(i),this.gh.DRAW_FRAMEBUFFER=this.gh.FRAMEBUFFER;for(var n=0;n<16;n++)this.gh["COLOR_ATTACHMENT"+n+"_WEBGL"]=i["COLOR_ATTACHMENT"+n+"_WEBGL"]}}if(this.Bs>1)this.xh.depthTextureExtension=!0;else{var s=this.gh.getExtension("WEBGL_depth_texture");null!=s&&(this.xh.depthTextureExtension=!0,this.gh.UNSIGNED_INT_24_8=s.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this.xh.vertexArrayObject=!1;else if(this.Bs>1)this.xh.vertexArrayObject=!0;else{var h=this.gh.getExtension("OES_vertex_array_object");null!=h&&(this.xh.vertexArrayObject=!0,this.gh.createVertexArray=h.createVertexArrayOES.bind(h),this.gh.bindVertexArray=h.bindVertexArrayOES.bind(h),this.gh.deleteVertexArray=h.deleteVertexArrayOES.bind(h))}if(this.Bs>1)this.xh.instancedArrays=!0;else{var r=this.gh.getExtension("ANGLE_instanced_arrays");null!=r?(this.xh.instancedArrays=!0,this.gh.drawArraysInstanced=r.drawArraysInstancedANGLE.bind(r),this.gh.drawElementsInstanced=r.drawElementsInstancedANGLE.bind(r),this.gh.vertexAttribDivisor=r.vertexAttribDivisorANGLE.bind(r)):this.xh.instancedArrays=!1}if(this.gh.getShaderPrecisionFormat){var e=this.gh.getShaderPrecisionFormat(this.gh.VERTEX_SHADER,this.gh.HIGH_FLOAT),u=this.gh.getShaderPrecisionFormat(this.gh.FRAGMENT_SHADER,this.gh.HIGH_FLOAT);e&&u&&(this.xh.highPrecisionShaderSupported=0!==e.precision&&0!==u.precision)}if(this.Bs>1)this.xh.blendMinMax=!0;else{var o=this.gh.getExtension("EXT_blend_minmax");null!=o&&(this.xh.blendMinMax=!0,this.gh.MAX=o.MAX_EXT,this.gh.MIN=o.MIN_EXT)}this.Xs.depthTest=!0,this.Xs.depthFunc=this.gh.LEQUAL,this.Xs.depthMask=!0,this.fh=this.xh.maxCombinedTexturesImageUnits;for(var f=0;f<this.fh;f++)this.oh.push(f)},Object.defineProperty(t.prototype,"webGLVersion",{get:function(){return this.Bs},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"ThinEngine"},Object.defineProperty(t.prototype,"isStencilEnable",{get:function(){return this.Ph},enumerable:!1,configurable:!0}),t.prototype.Nh=function(){if(!this.qn){this.qn=gt.CreateCanvas(1,1);var t=this.qn.getContext("2d");t&&(this.Qn=t)}},t.prototype.resetTextureCache=function(){for(var t in this.zs)this.zs.hasOwnProperty(t)&&(this.zs[t]=null);this.Hs=-1},t.prototype.getGlInfo=function(){return{vendor:this.Lh,renderer:this.Sh,version:this.Rh}},t.prototype.setHardwareScalingLevel=function(t){this.Kh=t,this.resize()},t.prototype.getHardwareScalingLevel=function(){return this.Kh},t.prototype.getLoadedTexturesCache=function(){return this.Ys},t.prototype.getCaps=function(){return this.xh},t.prototype.stopRenderLoop=function(t){if(t){var i=this.Ss.indexOf(t);i>=0&&this.Ss.splice(i,1)}else this.Ss=[]},t.prototype.Xh=function(){if(!this.Ls){var t=!0;if(!this.renderEvenInBackground&&this.Fs&&(t=!1),t){this.beginFrame();for(var i=0;i<this.Ss.length;i++){(0,this.Ss[i])()}this.endFrame()}}this.Ss.length>0?this.Wh=this.Gh(this.qh,this.getHostWindow()):this.Rs=!1},t.prototype.getRenderingCanvas=function(){return this.mh},t.prototype.getHostWindow=function(){return U.IsWindowObjectExist()?this.mh&&this.mh.ownerDocument&&this.mh.ownerDocument.defaultView?this.mh.ownerDocument.defaultView:window:null},t.prototype.getRenderWidth=function(t){return void 0===t&&(t=!1),!t&&this.Qh?this.Qh.width:this.Th?this.Th.framebufferWidth:this.gh.drawingBufferWidth},t.prototype.getRenderHeight=function(t){return void 0===t&&(t=!1),!t&&this.Qh?this.Qh.height:this.Th?this.Th.framebufferHeight:this.gh.drawingBufferHeight},t.prototype.Gh=function(i,n){return t.QueueNewFrame(i,n)},t.prototype.runRenderLoop=function(t){-1===this.Ss.indexOf(t)&&(this.Ss.push(t),this.Rs||(this.Rs=!0,this.qh=this.Xh.bind(this),this.Wh=this.Gh(this.qh,this.getHostWindow())))},t.prototype.clear=function(t,i,n,s){void 0===s&&(s=!1),this.applyStates();var h=0;i&&t&&(this.gh.clearColor(t.r,t.g,t.b,void 0!==t.a?t.a:1),h|=this.gh.COLOR_BUFFER_BIT),n&&(this.useReverseDepthBuffer?(this.Xs.depthFunc=this.gh.GREATER,this.gh.clearDepth(0)):this.gh.clearDepth(1),h|=this.gh.DEPTH_BUFFER_BIT),s&&(this.gh.clearStencil(0),h|=this.gh.STENCIL_BUFFER_BIT),this.gh.clear(h)},t.prototype.Yh=function(t,i,n,s){t===this.vh.x&&i===this.vh.y&&n===this.vh.z&&s===this.vh.w||(this.vh.x=t,this.vh.y=i,this.vh.z=n,this.vh.w=s,this.gh.viewport(t,i,n,s))},t.prototype.setViewport=function(t,i,n){var s=i||this.getRenderWidth(),h=n||this.getRenderHeight(),r=t.x||0,e=t.y||0;this.Bh=t,this.Yh(r*s,e*h,s*t.width,h*t.height)},t.prototype.beginFrame=function(){},t.prototype.endFrame=function(){this._s&&this.flushFramebuffer()},t.prototype.resize=function(){var t,i;U.IsWindowObjectExist()?(t=this.mh?this.mh.clientWidth||this.mh.width:window.innerWidth,i=this.mh?this.mh.clientHeight||this.mh.height:window.innerHeight):(t=this.mh?this.mh.width:100,i=this.mh?this.mh.height:100),this.setSize(t/this.Kh,i/this.Kh)},t.prototype.setSize=function(t,i){return!!this.mh&&(t|=0,i|=0,(this.mh.width!==t||this.mh.height!==i)&&(this.mh.width=t,this.mh.height=i,!0))},t.prototype.bindFramebuffer=function(t,i,n,s,h,r,e){void 0===i&&(i=0),void 0===r&&(r=0),void 0===e&&(e=0),this.Qh&&this.unBindFramebuffer(this.Qh),this.Qh=t,this.Vh(t.Hn?t.Hn:t.Yn);var u=this.gh;t.is2DArray?u.framebufferTextureLayer(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,t.ys,r,e):t.isCube&&u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_CUBE_MAP_POSITIVE_X+i,t.ys,r);var o=t.Ps;if(o){var f=o.us?u.DEPTH_STENCIL_ATTACHMENT:u.DEPTH_ATTACHMENT;t.is2DArray?u.framebufferTextureLayer(u.FRAMEBUFFER,f,o.ys,r,e):t.isCube?u.framebufferTexture2D(u.FRAMEBUFFER,f,u.TEXTURE_CUBE_MAP_POSITIVE_X+i,o.ys,r):u.framebufferTexture2D(u.FRAMEBUFFER,f,u.TEXTURE_2D,o.ys,r)}this.Bh&&!h?this.setViewport(this.Bh,n,s):(n||(n=t.width,r&&(n/=Math.pow(2,r))),s||(s=t.height,r&&(s/=Math.pow(2,r))),this.Yh(0,0,n,s)),this.wipeCaches()},t.prototype.Vh=function(t){this.ih!==t&&(this.gh.bindFramebuffer(this.gh.FRAMEBUFFER,t),this.ih=t)},t.prototype.unBindFramebuffer=function(t,i,n){void 0===i&&(i=!1),this.Qh=null;var s=this.gh;if(t.Hn){if(t.Jn)return void this.unBindMultiColorAttachmentFramebuffer(t.Jn,i,n);s.bindFramebuffer(s.READ_FRAMEBUFFER,t.Hn),s.bindFramebuffer(s.DRAW_FRAMEBUFFER,t.Yn),s.blitFramebuffer(0,0,t.width,t.height,0,0,t.width,t.height,s.COLOR_BUFFER_BIT,s.NEAREST)}!t.generateMipMaps||i||t.isCube||(this.Hh(s.TEXTURE_2D,t,!0),s.generateMipmap(s.TEXTURE_2D),this.Hh(s.TEXTURE_2D,null)),n&&(t.Hn&&this.Vh(t.Yn),n()),this.Vh(null)},t.prototype.flushFramebuffer=function(){this.gh.flush()},t.prototype.restoreDefaultFramebuffer=function(){this.Qh?this.unBindFramebuffer(this.Qh):this.Vh(null),this.Bh&&this.setViewport(this.Bh),this.wipeCaches()},t.prototype.zh=function(){this.bindArrayBuffer(null),this.Zh=null},t.prototype.createVertexBuffer=function(t){return this.Jh(t,this.gh.STATIC_DRAW)},t.prototype.Jh=function(t,i){var n=this.gh.createBuffer();if(!n)throw new Error("Unable to create vertex buffer");var s=new bt(n);return this.bindArrayBuffer(s),t instanceof Array?this.gh.bufferData(this.gh.ARRAY_BUFFER,new Float32Array(t),this.gh.STATIC_DRAW):this.gh.bufferData(this.gh.ARRAY_BUFFER,t,this.gh.STATIC_DRAW),this.zh(),s.references=1,s},t.prototype.createDynamicVertexBuffer=function(t){return this.Jh(t,this.gh.DYNAMIC_DRAW)},t.prototype.$h=function(){this.bindIndexBuffer(null),this.tr=null},t.prototype.createIndexBuffer=function(t,i){var n=this.gh.createBuffer(),s=new bt(n);if(!n)throw new Error("Unable to create index buffer");this.bindIndexBuffer(s);var h=this.ir(t);return this.gh.bufferData(this.gh.ELEMENT_ARRAY_BUFFER,h,i?this.gh.DYNAMIC_DRAW:this.gh.STATIC_DRAW),this.$h(),s.references=1,s.is32Bits=4===h.BYTES_PER_ELEMENT,s},t.prototype.ir=function(t){if(t instanceof Uint16Array)return t;if(this.xh.uintIndices){if(t instanceof Uint32Array)return t;for(var i=0;i<t.length;i++)if(t[i]>=65535)return new Uint32Array(t);return new Uint16Array(t)}return new Uint16Array(t)},t.prototype.bindArrayBuffer=function(t){this.eh||this.nr(),this.bindBuffer(t,this.gh.ARRAY_BUFFER)},t.prototype.bindUniformBlock=function(t,i,n){var s=t.program,h=this.gh.getUniformBlockIndex(s,i);this.gh.uniformBlockBinding(s,h,n)},t.prototype.bindIndexBuffer=function(t){this.eh||this.nr(),this.bindBuffer(t,this.gh.ELEMENT_ARRAY_BUFFER)},t.prototype.bindBuffer=function(t,i){(this.eh||this.th[i]!==t)&&(this.gh.bindBuffer(i,t?t.underlyingResource:null),this.th[i]=t)},t.prototype.updateArrayBuffer=function(t){this.gh.bufferSubData(this.gh.ARRAY_BUFFER,0,t)},t.prototype.sr=function(t,i,n,s,h,r,e){var u=this.sh[i],o=!1;u.active?(u.buffer!==t&&(u.buffer=t,o=!0),u.size!==n&&(u.size=n,o=!0),u.type!==s&&(u.type=s,o=!0),u.normalized!==h&&(u.normalized=h,o=!0),u.stride!==r&&(u.stride=r,o=!0),u.offset!==e&&(u.offset=e,o=!0)):(o=!0,u.active=!0,u.index=i,u.size=n,u.type=s,u.normalized=h,u.stride=r,u.offset=e,u.buffer=t),(o||this.eh)&&(this.bindArrayBuffer(t),this.gh.vertexAttribPointer(i,n,s,h,r,e))},t.prototype.hr=function(t){null!=t&&this.tr!==t&&(this.tr=t,this.bindIndexBuffer(t),this.$s=t.is32Bits)},t.prototype.rr=function(t,i){var n=i.getAttributesNames();this.eh||this.nr(),this.unbindAllAttributes();for(var s=0;s<n.length;s++){var h=i.getAttributeLocation(s);if(h>=0){var r=t[n[s]];if(!r)continue;this.gh.enableVertexAttribArray(h),this.eh||(this.Js[h]=!0);var e=r.getBuffer();e&&(this.sr(e,h,r.getSize(),r.type,r.normalized,r.byteStride,r.byteOffset),r.getIsInstanced()&&(this.gh.vertexAttribDivisor(h,r.getInstanceDivisor()),this.eh||(this.hh.push(h),this.rh.push(e))))}}},t.prototype.recordVertexArrayObject=function(t,i,n){var s=this.gh.createVertexArray();return this.eh=!0,this.gh.bindVertexArray(s),this.uh=!0,this.rr(t,n),this.bindIndexBuffer(i),this.eh=!1,this.gh.bindVertexArray(null),s},t.prototype.bindVertexArrayObject=function(t,i){this.er!==t&&(this.er=t,this.gh.bindVertexArray(t),this.Zh=null,this.tr=null,this.$s=null!=i&&i.is32Bits,this.uh=!0)},t.prototype.bindBuffersDirectly=function(t,i,n,s,h){if(this.Zh!==t||this.ur!==h){this.Zh=t,this.ur=h;var r=h.getAttributesCount();this.nr(),this.unbindAllAttributes();for(var e=0,u=0;u<r;u++)if(u<n.length){var o=h.getAttributeLocation(u);o>=0&&(this.gh.enableVertexAttribArray(o),this.Js[o]=!0,this.sr(t,o,n[u],this.gh.FLOAT,!1,s,e)),e+=4*n[u]}}this.hr(i)},t.prototype.nr=function(){this.er&&(this.er=null,this.gh.bindVertexArray(null))},t.prototype.bindBuffers=function(t,i,n){this.Zh===t&&this.ur===n||(this.Zh=t,this.ur=n,this.rr(t,n)),this.hr(i)},t.prototype.unbindInstanceAttributes=function(){for(var t,i=0,n=this.hh.length;i<n;i++){var s=this.rh[i];t!=s&&s.references&&(t=s,this.bindArrayBuffer(s));var h=this.hh[i];this.gh.vertexAttribDivisor(h,0)}this.rh.length=0,this.hh.length=0},t.prototype.releaseVertexArrayObject=function(t){this.gh.deleteVertexArray(t)},t.prototype.wt=function(t){return t.references--,0===t.references&&(this.or(t),!0)},t.prototype.or=function(t){this.gh.deleteBuffer(t.underlyingResource)},t.prototype.updateAndBindInstancesBuffer=function(t,i,n){if(this.bindArrayBuffer(t),i&&this.gh.bufferSubData(this.gh.ARRAY_BUFFER,0,i),void 0!==n[0].index)this.bindInstancesBuffer(t,n,!0);else for(var s=0;s<4;s++){var h=n[s];this.Js[h]||(this.gh.enableVertexAttribArray(h),this.Js[h]=!0),this.sr(t,h,4,this.gh.FLOAT,!1,64,16*s),this.gh.vertexAttribDivisor(h,1),this.hh.push(h),this.rh.push(t)}},t.prototype.bindInstancesBuffer=function(t,i,n){void 0===n&&(n=!0),this.bindArrayBuffer(t);var s=0;if(n)for(var h=0;h<i.length;h++){s+=4*(r=i[h]).attributeSize}for(h=0;h<i.length;h++){var r;void 0===(r=i[h]).index&&(r.index=this.cr.getAttributeLocationByName(r.attributeName)),r.index<0||(this.Js[r.index]||(this.gh.enableVertexAttribArray(r.index),this.Js[r.index]=!0),this.sr(t,r.index,r.attributeSize,r.attributeType||this.gh.FLOAT,r.normalized||!1,s,r.offset),this.gh.vertexAttribDivisor(r.index,void 0===r.divisor?1:r.divisor),this.hh.push(r.index),this.rh.push(t))}},t.prototype.disableInstanceAttributeByName=function(t){if(this.cr){var i=this.cr.getAttributeLocationByName(t);this.disableInstanceAttribute(i)}},t.prototype.disableInstanceAttribute=function(t){for(var i,n=!1;-1!==(i=this.hh.indexOf(t));)this.hh.splice(i,1),this.rh.splice(i,1),n=!0,i=this.hh.indexOf(t);n&&(this.gh.vertexAttribDivisor(t,0),this.disableAttributeByIndex(t))},t.prototype.disableAttributeByIndex=function(t){this.gh.disableVertexAttribArray(t),this.Js[t]=!1,this.sh[t].active=!1},t.prototype.draw=function(t,i,n,s){this.drawElementsType(t?0:1,i,n,s)},t.prototype.drawPointClouds=function(t,i,n){this.drawArraysType(2,t,i,n)},t.prototype.drawUnIndexed=function(t,i,n,s){this.drawArraysType(t?0:1,i,n,s)},t.prototype.drawElementsType=function(t,i,n,s){this.applyStates(),this.ar();var h=this.lr(t),r=this.$s?this.gh.UNSIGNED_INT:this.gh.UNSIGNED_SHORT,e=this.$s?4:2;s?this.gh.drawElementsInstanced(h,n,r,i*e,s):this.gh.drawElements(h,n,r,i*e)},t.prototype.drawArraysType=function(t,i,n,s){this.applyStates(),this.ar();var h=this.lr(t);s?this.gh.drawArraysInstanced(h,i,n,s):this.gh.drawArrays(h,i,n)},t.prototype.lr=function(t){switch(t){case 0:return this.gh.TRIANGLES;case 2:return this.gh.POINTS;case 1:return this.gh.LINES;case 3:return this.gh.POINTS;case 4:return this.gh.LINES;case 5:return this.gh.LINE_LOOP;case 6:return this.gh.LINE_STRIP;case 7:return this.gh.TRIANGLE_STRIP;case 8:return this.gh.TRIANGLE_FAN;default:return this.gh.TRIANGLES}},t.prototype.ar=function(){},t.prototype.nn=function(t){this.Zs[t.gi]&&(delete this.Zs[t.gi],this.Qi(t.getPipelineContext()))},t.prototype.Qi=function(t){var i=t;i&&i.program&&(i.program.vr=null,this.gh.deleteProgram(i.program))},t.prototype.createEffect=function(t,i,n,s,h,r,e,u,o){var f=(t.vertexElement||t.vertex||t.vertexToken||t)+"+"+(t.fragmentElement||t.fragment||t.fragmentToken||t)+"@"+(h||i.defines);if(this.Zs[f]){var c=this.Zs[f];return e&&c.isReady()&&e(c),c}var a=new et(t,i,n,s,this,h,r,e,u,o);return a.gi=f,this.Zs[f]=a,a},t.br=function(t,i,n){return void 0===n&&(n=""),n+(i?i+"\n":"")+t},t.prototype.dr=function(i,n,s,h){return this.gr(t.br(i,s,h),n)},t.prototype.gr=function(t,i){var n=this.gh,s=n.createShader("vertex"===i?n.VERTEX_SHADER:n.FRAGMENT_SHADER);if(!s)throw new Error("Something went wrong while compile the shader.");return n.shaderSource(s,t),n.compileShader(s),s},t.prototype.Es=function(t){return this.gh.getShaderSource(t)},t.prototype.createRawShaderProgram=function(t,i,n,s,h){void 0===h&&(h=null),s=s||this.gh;var r=this.gr(i,"vertex"),e=this.gr(n,"fragment");return this.wr(t,r,e,s,h)},t.prototype.createShaderProgram=function(t,i,n,s,h,r){void 0===r&&(r=null),h=h||this.gh;var e=this.Bs>1?"#version 300 es\n#define WEBGL2 \n":"",u=this.dr(i,"vertex",s,e),o=this.dr(n,"fragment",s,e);return this.wr(t,u,o,h,r)},t.prototype.createPipelineContext=function(){var t=new dt;return t.engine=this,this.xh.parallelShaderCompile&&(t.isParallelCompiled=!0),t},t.prototype.wr=function(t,i,n,s,h){void 0===h&&(h=null);var r=s.createProgram();if(t.program=r,!r)throw new Error("Unable to create program");return s.attachShader(r,i),s.attachShader(r,n),s.linkProgram(r),t.context=s,t.vertexShader=i,t.fragmentShader=n,t.isParallelCompiled||this.mr(t),r},t.prototype.mr=function(t){var i=t.context,n=t.vertexShader,s=t.fragmentShader,h=t.program;if(!i.getProgramParameter(h,i.LINK_STATUS)){var r,e;if(!this.gh.getShaderParameter(n,this.gh.COMPILE_STATUS))if(r=this.gh.getShaderInfoLog(n))throw t.vertexCompilationError=r,new Error("VERTEX SHADER "+r);if(!this.gh.getShaderParameter(s,this.gh.COMPILE_STATUS))if(r=this.gh.getShaderInfoLog(s))throw t.fragmentCompilationError=r,new Error("FRAGMENT SHADER "+r);if(e=i.getProgramInfoLog(h))throw t.programLinkError=e,new Error(e)}if(this.validateShaderPrograms&&(i.validateProgram(h),!i.getProgramParameter(h,i.VALIDATE_STATUS)&&(e=i.getProgramInfoLog(h))))throw t.programValidationError=e,new Error(e);i.deleteShader(n),i.deleteShader(s),t.vertexShader=void 0,t.fragmentShader=void 0,t.onCompiled&&(t.onCompiled(),t.onCompiled=void 0)},t.prototype.Gi=function(t,i,n,s,h,r,e){var u=t;u.program=s?this.createRawShaderProgram(u,i,n,void 0,e):this.createShaderProgram(u,i,n,r,void 0,e),u.program.vr=h},t.prototype.ks=function(t){var i=t;return!!this.gh.getProgramParameter(i.program,this.xh.parallelShaderCompile.COMPLETION_STATUS_KHR)&&(this.mr(i),!0)},t.prototype.qi=function(t,i){var n=t;if(n.isParallelCompiled){var s=n.onCompiled;n.onCompiled=s?function(){s(),i()}:i}else i()},t.prototype.getUniforms=function(t,i){for(var n=new Array,s=t,h=0;h<i.length;h++)n.push(this.gh.getUniformLocation(s.program,i[h]));return n},t.prototype.getAttributes=function(t,i){for(var n=[],s=t,h=0;h<i.length;h++)try{n.push(this.gh.getAttribLocation(s.program,i[h]))}catch(t){n.push(-1)}return n},t.prototype.enableEffect=function(t){t&&t!==this.cr&&(this.bindSamplers(t),this.cr=t,t.onBind&&t.onBind(t),t.ei&&t.ei.notifyObservers(t))},t.prototype.setInt=function(t,i){t&&this.gh.uniform1i(t,i)},t.prototype.setIntArray=function(t,i){t&&this.gh.uniform1iv(t,i)},t.prototype.setIntArray2=function(t,i){t&&i.length%2==0&&this.gh.uniform2iv(t,i)},t.prototype.setIntArray3=function(t,i){t&&i.length%3==0&&this.gh.uniform3iv(t,i)},t.prototype.setIntArray4=function(t,i){t&&i.length%4==0&&this.gh.uniform4iv(t,i)},t.prototype.setArray=function(t,i){t&&this.gh.uniform1fv(t,i)},t.prototype.setArray2=function(t,i){t&&i.length%2==0&&this.gh.uniform2fv(t,i)},t.prototype.setArray3=function(t,i){t&&i.length%3==0&&this.gh.uniform3fv(t,i)},t.prototype.setArray4=function(t,i){t&&i.length%4==0&&this.gh.uniform4fv(t,i)},t.prototype.setMatrices=function(t,i){t&&this.gh.uniformMatrix4fv(t,!1,i)},t.prototype.setMatrix3x3=function(t,i){t&&this.gh.uniformMatrix3fv(t,!1,i)},t.prototype.setMatrix2x2=function(t,i){t&&this.gh.uniformMatrix2fv(t,!1,i)},t.prototype.setFloat=function(t,i){t&&this.gh.uniform1f(t,i)},t.prototype.setFloat2=function(t,i,n){t&&this.gh.uniform2f(t,i,n)},t.prototype.setFloat3=function(t,i,n,s){t&&this.gh.uniform3f(t,i,n,s)},t.prototype.setFloat4=function(t,i,n,s,h){t&&this.gh.uniform4f(t,i,n,s,h)},t.prototype.applyStates=function(){if(this.Xs.apply(this.gh),this.Ws.apply(this.gh),this.Gs.apply(this.gh),this.Ns){this.Ns=!1;var t=this.Is;this.gh.colorMask(t,t,t,t)}},t.prototype.setColorWrite=function(t){t!==this.Is&&(this.Ns=!0,this.Is=t)},t.prototype.getColorWrite=function(){return this.Is},Object.defineProperty(t.prototype,"depthCullingState",{get:function(){return this.Xs},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"alphaState",{get:function(){return this.Gs},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stencilState",{get:function(){return this.Ws},enumerable:!1,configurable:!0}),t.prototype.clearInternalTexturesCache=function(){this.Ys=[]},t.prototype.wipeCaches=function(t){this.preventCacheWipeBetweenFrames&&!t||(this.cr=null,this.vh.x=0,this.vh.y=0,this.vh.z=0,this.vh.w=0,this.nr(),t&&(this.jr=null,this.resetTextureCache(),this.Ws.reset(),this.Xs.reset(),this.Xs.depthFunc=this.gh.LEQUAL,this.Gs.reset(),this.qs=1,this.Qs=0,this.Is=!0,this.Ns=!0,this.bh=null,this.gh.pixelStorei(this.gh.UNPACK_COLORSPACE_CONVERSION_WEBGL,this.gh.NONE),this.gh.pixelStorei(this.gh.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this.uh=!0,this.unbindAllAttributes()),this.zh(),this.tr=null,this.ur=null,this.bindIndexBuffer(null))},t.prototype.Or=function(t,i){var n=this.gh,s=n.NEAREST,h=n.NEAREST;switch(t){case 11:s=n.LINEAR,h=i?n.LINEAR_MIPMAP_NEAREST:n.LINEAR;break;case 3:s=n.LINEAR,h=i?n.LINEAR_MIPMAP_LINEAR:n.LINEAR;break;case 8:s=n.NEAREST,h=i?n.NEAREST_MIPMAP_LINEAR:n.NEAREST;break;case 4:s=n.NEAREST,h=i?n.NEAREST_MIPMAP_NEAREST:n.NEAREST;break;case 5:s=n.NEAREST,h=i?n.LINEAR_MIPMAP_NEAREST:n.LINEAR;break;case 6:s=n.NEAREST,h=i?n.LINEAR_MIPMAP_LINEAR:n.LINEAR;break;case 7:s=n.NEAREST,h=n.LINEAR;break;case 1:s=n.NEAREST,h=n.NEAREST;break;case 9:s=n.LINEAR,h=i?n.NEAREST_MIPMAP_NEAREST:n.NEAREST;break;case 10:s=n.LINEAR,h=i?n.NEAREST_MIPMAP_LINEAR:n.NEAREST;break;case 2:s=n.LINEAR,h=n.LINEAR;break;case 12:s=n.LINEAR,h=n.NEAREST}return{min:h,mag:s}},t.prototype.ps=function(){var t=this.gh.createTexture();if(!t)throw new Error("Unable to create texture");return t},t.prototype.createTexture=function(i,n,s,h,r,e,u,o,f,c,a,l){var v=this;void 0===r&&(r=3),void 0===e&&(e=null),void 0===u&&(u=null),void 0===o&&(o=null),void 0===f&&(f=null),void 0===c&&(c=null),void 0===a&&(a=null);var b="data:"===(i=i||"").substr(0,5),d="blob:"===i.substr(0,5),g=b&&-1!==i.indexOf(";base64,"),w=f||new lt(this,D.Url),m=i;!this.lh||g||f||o||(i=this.lh(i));for(var j=i.lastIndexOf("."),O=a||(j>-1?i.substring(j).toLowerCase():""),y=null,A=0,p=t.yr;A<p.length;A++){var M=p[A];if(M.canLoad(O,l)){y=M;break}}h&&h.Ar(w),w.url=i,w.generateMipMaps=!n,w.samplingMode=r,w.invertY=s,this.Ds||(w.dt=o);var K=null;e&&!f&&(K=w.onLoadedObservable.add(e)),f||this.Ys.push(w);var P=function(t,s){h&&h.pr(w),i===m?(K&&w.onLoadedObservable.remove(K),G.UseFallbackTexture&&v.createTexture(G.FallbackTexture,n,w.invertY,h,r,null,u,o,w),u&&u((t||"Unknown error")+(G.UseFallbackTexture?" - Fallback texture was used":""),s)):(R.Warn("Failed to load "+i+", falling back to "+m),v.createTexture(m,n,w.invertY,h,r,e,u,o,w,c,a,l))};if(y){var x=function(t){y.loadData(t,w,(function(t,i,n,s,e,u){u?P("TextureLoader failed to load data"):v.Mr(w,h,t,i,w.invertY,!n,s,(function(){return e(),!1}),r)}))};o?o instanceof ArrayBuffer?x(new Uint8Array(o)):ArrayBuffer.isView(o)?x(o):u&&u("Unable to load: only ArrayBuffer or ArrayBufferView is supported",null):this.Ni(i,(function(t){return x(new Uint8Array(t))}),void 0,h?h.offlineProvider:void 0,!0,(function(t,i){P("Unable to load "+(t&&t.responseURL,i))}))}else{var k=function(t){d&&!v.Ds&&(w.dt=t),v.Mr(w,h,t.width,t.height,w.invertY,n,!1,(function(i,n,s){var r=v.gh,e=t.width===i&&t.height===n,u=c?v.Kr(c):".jpg"===O?r.RGB:r.RGBA;if(e)return r.texImage2D(r.TEXTURE_2D,0,u,u,r.UNSIGNED_BYTE,t),!1;var o=v.xh.maxTextureSize;if(t.width>o||t.height>o||!v.Eh)return v.Nh(),!(!v.qn||!v.Qn)&&(v.qn.width=i,v.qn.height=n,v.Qn.drawImage(t,0,0,t.width,t.height,0,0,i,n),r.texImage2D(r.TEXTURE_2D,0,u,u,r.UNSIGNED_BYTE,v.qn),w.width=i,w.height=n,!1);var f=new lt(v,D.Temp);return v.Hh(r.TEXTURE_2D,f,!0),r.texImage2D(r.TEXTURE_2D,0,u,u,r.UNSIGNED_BYTE,t),v.Pr(f,w,h,u,(function(){v.xs(f),v.Hh(r.TEXTURE_2D,w,!0),s()})),!0}),r)};!b||g?o&&(o.decoding||o.close)?k(o):t.xr(i,k,P,h?h.offlineProvider:null,l):"string"==typeof o||o instanceof ArrayBuffer||ArrayBuffer.isView(o)||o instanceof Blob?t.xr(o,k,P,h?h.offlineProvider:null,l):o&&k(o)}return w},t.xr=function(t,i,n,s,h){throw X.WarnImport("FileTools")},t.prototype.Pr=function(t,i,n,s,h){},t.prototype.createRawTexture=function(t,i,n,s,h,r,e,u,o){throw void 0===u&&(u=null),void 0===o&&(o=0),X.WarnImport("Engine.RawTexture")},t.prototype.createRawCubeTexture=function(t,i,n,s,h,r,e,u){throw void 0===u&&(u=null),X.WarnImport("Engine.RawTexture")},t.prototype.createRawTexture3D=function(t,i,n,s,h,r,e,u,o,f){throw void 0===o&&(o=null),void 0===f&&(f=0),X.WarnImport("Engine.RawTexture")},t.prototype.createRawTexture2DArray=function(t,i,n,s,h,r,e,u,o,f){throw void 0===o&&(o=null),void 0===f&&(f=0),X.WarnImport("Engine.RawTexture")},t.prototype.kr=function(t){this.bh!==t&&(this.gh.pixelStorei(this.gh.UNPACK_FLIP_Y_WEBGL,t?1:0),this.enableUnpackFlipYCached&&(this.bh=t))},t.prototype.Er=function(){return this.gh.getParameter(this.gh.UNPACK_ALIGNMENT)},t.prototype.Tr=function(t){return t.isCube?this.gh.TEXTURE_CUBE_MAP:t.is3D?this.gh.TEXTURE_3D:t.is2DArray||t.isMultiview?this.gh.TEXTURE_2D_ARRAY:this.gh.TEXTURE_2D},t.prototype.updateTextureSamplingMode=function(t,i,n){void 0===n&&(n=!1);var s=this.Tr(i),h=this.Or(t,i.generateMipMaps||n);this.Br(s,this.gh.TEXTURE_MAG_FILTER,h.mag,i),this.Br(s,this.gh.TEXTURE_MIN_FILTER,h.min),n&&(i.generateMipMaps=!0,this.gh.generateMipmap(s)),this.Hh(s,null),i.samplingMode=t},t.prototype.updateTextureWrappingMode=function(t,i,n,s){void 0===n&&(n=null),void 0===s&&(s=null);var h=this.Tr(t);null!==i&&(this.Br(h,this.gh.TEXTURE_WRAP_S,this.Fr(i),t),t.ts=i),null!==n&&(this.Br(h,this.gh.TEXTURE_WRAP_T,this.Fr(n),t),t.ns=n),(t.is2DArray||t.is3D)&&null!==s&&(this.Br(h,this.gh.TEXTURE_WRAP_R,this.Fr(s),t),t.ss=s),this.Hh(h,null)},t.prototype.Cr=function(t,i,n,s,h){var r=i.width||i,e=i.height||i,u=i.layers||0;t.baseWidth=r,t.baseHeight=e,t.width=r,t.height=e,t.is2DArray=u>0,t.depth=u,t.isReady=!0,t.samples=1,t.generateMipMaps=!1,t.os=!0,t.us=n,t.samplingMode=s?2:1,t.type=0,t.fs=h;var o=this.gh,f=this.Tr(t),c=this.Or(t.samplingMode,!1);o.texParameteri(f,o.TEXTURE_MAG_FILTER,c.mag),o.texParameteri(f,o.TEXTURE_MIN_FILTER,c.min),o.texParameteri(f,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(f,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),0===h?(o.texParameteri(f,o.TEXTURE_COMPARE_FUNC,515),o.texParameteri(f,o.TEXTURE_COMPARE_MODE,o.NONE)):(o.texParameteri(f,o.TEXTURE_COMPARE_FUNC,h),o.texParameteri(f,o.TEXTURE_COMPARE_MODE,o.COMPARE_REF_TO_TEXTURE))},t.prototype._r=function(t,i,n,s,h,r,e){void 0===r&&(r=0),void 0===e&&(e=0);var u=this.gh,o=u.TEXTURE_2D;t.isCube&&(o=u.TEXTURE_CUBE_MAP_POSITIVE_X+r),this.gh.compressedTexImage2D(o,e,i,n,s,0,h)},t.prototype.Ur=function(t,i,n,s,h,r){void 0===n&&(n=0),void 0===s&&(s=0),void 0===r&&(r=!1);var e=this.gh,u=this.Rr(t.type),o=this.Kr(t.format),f=void 0===h?this.Sr(t.type,t.format):this.Kr(h);this.kr(t.invertY);var c=e.TEXTURE_2D;t.isCube&&(c=e.TEXTURE_CUBE_MAP_POSITIVE_X+n);var a=Math.round(Math.log(t.width)*Math.LOG2E),l=Math.round(Math.log(t.height)*Math.LOG2E),v=r?t.width:Math.pow(2,Math.max(a-s,0)),b=r?t.height:Math.pow(2,Math.max(l-s,0));e.texImage2D(c,s,f,v,b,0,o,u,i)},t.prototype.updateTextureData=function(t,i,n,s,h,r,e,u){void 0===e&&(e=0),void 0===u&&(u=0);var o=this.gh,f=this.Rr(t.type),c=this.Kr(t.format);this.kr(t.invertY);var a=o.TEXTURE_2D;t.isCube&&(a=o.TEXTURE_CUBE_MAP_POSITIVE_X+e),o.texSubImage2D(a,u,n,s,h,r,c,f,i)},t.prototype.Lr=function(t,i,n,s){void 0===n&&(n=0),void 0===s&&(s=0);var h=this.gh,r=t.isCube?h.TEXTURE_CUBE_MAP:h.TEXTURE_2D;this.Hh(r,t,!0),this.Ur(t,i,n,s),this.Hh(r,null,!0)},t.prototype.Dr=function(t,i,n,s,h){var r=this.gh;if(r){var e=this.Or(h,!n);r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,e.mag),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,e.min),n||s||r.generateMipmap(r.TEXTURE_2D),this.Hh(r.TEXTURE_2D,null),i&&i.pr(t),t.onLoadedObservable.notifyObservers(t),t.onLoadedObservable.clear()}},t.prototype.Mr=function(i,n,s,h,r,e,u,o,f){var c=this;void 0===f&&(f=3);var a=this.getCaps().maxTextureSize,l=Math.min(a,this.needPOTTextures?t.GetExponentOfTwo(s,a):s),v=Math.min(a,this.needPOTTextures?t.GetExponentOfTwo(h,a):h),b=this.gh;b&&(i.ys?(this.Hh(b.TEXTURE_2D,i,!0),this.kr(void 0===r||!!r),i.baseWidth=s,i.baseHeight=h,i.width=l,i.height=v,i.isReady=!0,o(l,v,(function(){c.Dr(i,n,e,u,f)}))||this.Dr(i,n,e,u,f)):n&&n.pr(i))},t.prototype.Ir=function(t,i,n,s,h){void 0===h&&(h=1);var r=this.gh;if(t&&i)return this.dh(n,s,h,r.DEPTH_STENCIL,r.DEPTH24_STENCIL8,r.DEPTH_STENCIL_ATTACHMENT);if(i){var e=r.DEPTH_COMPONENT16;return this.Bs>1&&(e=r.DEPTH_COMPONENT32F),this.dh(n,s,h,e,e,r.DEPTH_ATTACHMENT)}return t?this.dh(n,s,h,r.STENCIL_INDEX8,r.STENCIL_INDEX8,r.STENCIL_ATTACHMENT):null},t.prototype.Nr=function(t){var i=this.gh;t.Yn&&(i.deleteFramebuffer(t.Yn),t.Yn=null),t.Vn&&(i.deleteRenderbuffer(t.Vn),t.Vn=null),t.Hn&&(i.deleteFramebuffer(t.Hn),t.Hn=null),t.zn&&(i.deleteRenderbuffer(t.zn),t.zn=null)},t.prototype.xs=function(t){this.Nr(t),this.Xr(t.ys),this.unbindAllTextures();var i=this.Ys.indexOf(t);-1!==i&&this.Ys.splice(i,1),t.ds&&t.ds.dispose(),t.gs&&t.gs.dispose(),t.ws&&t.ws.dispose(),t.Os&&t.Os.dispose()},t.prototype.Xr=function(t){this.gh.deleteTexture(t)},t.prototype.Wr=function(t){this.jr!==t&&(this.gh.useProgram(t),this.jr=t)},t.prototype.bindSamplers=function(t){var i=t.getPipelineContext();this.Wr(i.program);for(var n=t.getSamplers(),s=0;s<n.length;s++){var h=t.getUniform(n[s]);h&&(this.wh[s]=h)}this.cr=null},t.prototype.Gr=function(){this.Hs!==this.Vs&&(this.gh.activeTexture(this.gh.TEXTURE0+this.Vs),this.Hs=this.Vs)},t.prototype.Hh=function(t,i,n,s){void 0===n&&(n=!1),void 0===s&&(s=!1);var h=!1,r=i&&i.Ln>-1;return n&&r&&(this.Vs=i.Ln),this.zs[this.Vs]!==i||s?(this.Gr(),i&&i.isMultiview?this.gh.bindTexture(t,i?i.vs:null):this.gh.bindTexture(t,i?i.ys:null),this.zs[this.Vs]=i,i&&(i.Ln=this.Vs)):n&&(h=!0,this.Gr()),r&&!n&&this.qr(i.Ln,this.Vs),h},t.prototype.zi=function(t,i){if(void 0!==t){i&&(i.Ln=t),this.Vs=t;var n=i?this.Tr(i):this.gh.TEXTURE_2D;this.Hh(n,i)}},t.prototype.unbindAllTextures=function(){for(var t=0;t<this.fh;t++)this.Vs=t,this.Hh(this.gh.TEXTURE_2D,null),this.Hh(this.gh.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this.Hh(this.gh.TEXTURE_3D,null),this.Hh(this.gh.TEXTURE_2D_ARRAY,null))},t.prototype.setTexture=function(t,i,n){void 0!==t&&(i&&(this.wh[t]=i),this.Qr(t,n))},t.prototype.qr=function(t,i){var n=this.wh[t];n&&n.Yr!==i&&(this.gh.uniform1i(n,i),n.Yr=i)},t.prototype.Fr=function(t){switch(t){case 1:return this.gh.REPEAT;case 0:return this.gh.CLAMP_TO_EDGE;case 2:return this.gh.MIRRORED_REPEAT}return this.gh.REPEAT},t.prototype.Qr=function(t,i,n,s){if(void 0===n&&(n=!1),void 0===s&&(s=!1),!i)return null!=this.zs[t]&&(this.Vs=t,this.Hh(this.gh.TEXTURE_2D,null),this.Hh(this.gh.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this.Hh(this.gh.TEXTURE_3D,null),this.Hh(this.gh.TEXTURE_2D_ARRAY,null))),!1;if(i.video)this.Vs=t,i.update();else if(4===i.delayLoadState)return i.delayLoad(),!1;var h;h=s?i.depthStencilTexture:i.isReady()?i.getInternalTexture():i.isCube?this.emptyCubeTexture:i.is3D?this.emptyTexture3D:i.is2DArray?this.emptyTexture2DArray:this.emptyTexture,!n&&h&&(h.Ln=t);var r=!0;this.zs[t]===h&&(n||this.qr(h.Ln,t),r=!1),this.Vs=t;var e=this.Tr(h);if(r&&this.Hh(e,h,n),h&&!h.isMultiview){if(h.isCube&&h.$n!==i.coordinatesMode){h.$n=i.coordinatesMode;var u=3!==i.coordinatesMode&&5!==i.coordinatesMode?1:0;i.wrapU=u,i.wrapV=u}h.ts!==i.wrapU&&(h.ts=i.wrapU,this.Br(e,this.gh.TEXTURE_WRAP_S,this.Fr(i.wrapU),h)),h.ns!==i.wrapV&&(h.ns=i.wrapV,this.Br(e,this.gh.TEXTURE_WRAP_T,this.Fr(i.wrapV),h)),h.is3D&&h.ss!==i.wrapR&&(h.ss=i.wrapR,this.Br(e,this.gh.TEXTURE_WRAP_R,this.Fr(i.wrapR),h)),this.Vr(e,h,i.anisotropicFilteringLevel)}return!0},t.prototype.setTextureArray=function(t,i,n){if(void 0!==t&&i){this.Hr&&this.Hr.length===n.length||(this.Hr=new Int32Array(n.length));for(var s=0;s<n.length;s++){var h=n[s].getInternalTexture();h?(this.Hr[s]=t+s,h.Ln=t+s):this.Hr[s]=-1}this.gh.uniform1iv(i,this.Hr);for(var r=0;r<n.length;r++)this.Qr(this.Hr[r],n[r],!0)}},t.prototype.Vr=function(t,i,n){var s=this.xh.textureAnisotropicFilterExtension;11!==i.samplingMode&&3!==i.samplingMode&&2!==i.samplingMode&&(n=1),s&&i.hs!==n&&(this.zr(t,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(n,this.xh.maxAnisotropy),i),i.hs=n)},t.prototype.zr=function(t,i,n,s){this.Hh(t,s,!0,!0),this.gh.texParameterf(t,i,n)},t.prototype.Br=function(t,i,n,s){s&&this.Hh(t,s,!0,!0),this.gh.texParameteri(t,i,n)},t.prototype.unbindAllAttributes=function(){if(this.uh){this.uh=!1;for(var t=0;t<this.xh.maxVertexAttribs;t++)this.disableAttributeByIndex(t)}else{t=0;for(var i=this.Js.length;t<i;t++)t>=this.xh.maxVertexAttribs||!this.Js[t]||this.disableAttributeByIndex(t)}},t.prototype.releaseEffects=function(){for(var t in this.Zs){var i=this.Zs[t].getPipelineContext();this.Qi(i)}this.Zs={}},t.prototype.dispose=function(){this.stopRenderLoop(),this.onBeforeTextureInitObservable&&this.onBeforeTextureInitObservable.clear(),this.Fh&&(this.xs(this.Fh),this.Fh=null),this.Uh&&(this.xs(this.Uh),this.Uh=null),this.nh&&this.gh.deleteFramebuffer(this.nh),this.releaseEffects(),this.unbindAllAttributes(),this.wh=[],U.IsWindowObjectExist()&&this.mh&&(this.Ds||(this.mh.removeEventListener("webglcontextlost",this.jh),this.mh.removeEventListener("webglcontextrestored",this.Oh))),this.qn=null,this.Qn=null,this.sh=[],this.mh=null,this.jr=null,this.qh=null,et.ResetCache();for(var t=0,i=this.ah;t<i.length;t++){i[t].abort()}},t.prototype.attachContextLostEvent=function(t){this.mh&&this.mh.addEventListener("webglcontextlost",t,!1)},t.prototype.attachContextRestoredEvent=function(t){this.mh&&this.mh.addEventListener("webglcontextrestored",t,!1)},t.prototype.getError=function(){return this.gh.getError()},t.prototype.Dh=function(){return this.Bs>1?this.xh.colorBufferFloat:this.Zr(1)},t.prototype.Ih=function(){return this.Bs>1?this.xh.colorBufferFloat:this.Zr(2)},t.prototype.Zr=function(t){for(var i=this.gh;i.getError()!==i.NO_ERROR;);var n=!0,s=i.createTexture();i.bindTexture(i.TEXTURE_2D,s),i.texImage2D(i.TEXTURE_2D,0,this.Sr(t),1,1,0,i.RGBA,this.Rr(t),null),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST);var h=i.createFramebuffer();i.bindFramebuffer(i.FRAMEBUFFER,h),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,s,0);var r=i.checkFramebufferStatus(i.FRAMEBUFFER);if((n=(n=n&&r===i.FRAMEBUFFER_COMPLETE)&&i.getError()===i.NO_ERROR)&&(i.clear(i.COLOR_BUFFER_BIT),n=n&&i.getError()===i.NO_ERROR),n){i.bindFramebuffer(i.FRAMEBUFFER,null);var e=i.RGBA,u=i.UNSIGNED_BYTE,o=new Uint8Array(4);i.readPixels(0,0,1,1,e,u,o),n=n&&i.getError()===i.NO_ERROR}for(i.deleteTexture(s),i.deleteFramebuffer(h),i.bindFramebuffer(i.FRAMEBUFFER,null);!n&&i.getError()!==i.NO_ERROR;);return n},t.prototype.Rr=function(t){if(1===this.Bs){switch(t){case 1:return this.gh.FLOAT;case 2:return this.gh.HALF_FLOAT_OES;case 0:return this.gh.UNSIGNED_BYTE;case 8:return this.gh.UNSIGNED_SHORT_4_4_4_4;case 9:return this.gh.UNSIGNED_SHORT_5_5_5_1;case 10:return this.gh.UNSIGNED_SHORT_5_6_5}return this.gh.UNSIGNED_BYTE}switch(t){case 3:return this.gh.BYTE;case 0:return this.gh.UNSIGNED_BYTE;case 4:return this.gh.SHORT;case 5:return this.gh.UNSIGNED_SHORT;case 6:return this.gh.INT;case 7:return this.gh.UNSIGNED_INT;case 1:return this.gh.FLOAT;case 2:return this.gh.HALF_FLOAT;case 8:return this.gh.UNSIGNED_SHORT_4_4_4_4;case 9:return this.gh.UNSIGNED_SHORT_5_5_5_1;case 10:return this.gh.UNSIGNED_SHORT_5_6_5;case 11:return this.gh.UNSIGNED_INT_2_10_10_10_REV;case 12:return this.gh.UNSIGNED_INT_24_8;case 13:return this.gh.UNSIGNED_INT_10F_11F_11F_REV;case 14:return this.gh.UNSIGNED_INT_5_9_9_9_REV;case 15:return this.gh.FLOAT_32_UNSIGNED_INT_24_8_REV}return this.gh.UNSIGNED_BYTE},t.prototype.Kr=function(t){var i=this.gh.RGBA;switch(t){case 0:i=this.gh.ALPHA;break;case 1:i=this.gh.LUMINANCE;break;case 2:i=this.gh.LUMINANCE_ALPHA;break;case 6:i=this.gh.RED;break;case 7:i=this.gh.RG;break;case 4:i=this.gh.RGB;break;case 5:i=this.gh.RGBA}if(this.Bs>1)switch(t){case 8:i=this.gh.RED_INTEGER;break;case 9:i=this.gh.RG_INTEGER;break;case 10:i=this.gh.RGB_INTEGER;break;case 11:i=this.gh.RGBA_INTEGER}return i},t.prototype.Sr=function(t,i){if(1===this.Bs){if(void 0!==i)switch(i){case 0:return this.gh.ALPHA;case 1:return this.gh.LUMINANCE;case 2:return this.gh.LUMINANCE_ALPHA;case 4:return this.gh.RGB}return this.gh.RGBA}switch(t){case 3:switch(i){case 6:return this.gh.R8_SNORM;case 7:return this.gh.RG8_SNORM;case 4:return this.gh.RGB8_SNORM;case 8:return this.gh.R8I;case 9:return this.gh.RG8I;case 10:return this.gh.RGB8I;case 11:return this.gh.RGBA8I;default:return this.gh.RGBA8_SNORM}case 0:switch(i){case 6:return this.gh.R8;case 7:return this.gh.RG8;case 4:return this.gh.RGB8;case 5:return this.gh.RGBA8;case 8:return this.gh.R8UI;case 9:return this.gh.RG8UI;case 10:return this.gh.RGB8UI;case 11:return this.gh.RGBA8UI;case 0:return this.gh.ALPHA;case 1:return this.gh.LUMINANCE;case 2:return this.gh.LUMINANCE_ALPHA;default:return this.gh.RGBA8}case 4:switch(i){case 8:return this.gh.R16I;case 9:return this.gh.RG16I;case 10:return this.gh.RGB16I;case 11:default:return this.gh.RGBA16I}case 5:switch(i){case 8:return this.gh.R16UI;case 9:return this.gh.RG16UI;case 10:return this.gh.RGB16UI;case 11:default:return this.gh.RGBA16UI}case 6:switch(i){case 8:return this.gh.R32I;case 9:return this.gh.RG32I;case 10:return this.gh.RGB32I;case 11:default:return this.gh.RGBA32I}case 7:switch(i){case 8:return this.gh.R32UI;case 9:return this.gh.RG32UI;case 10:return this.gh.RGB32UI;case 11:default:return this.gh.RGBA32UI}case 1:switch(i){case 6:return this.gh.R32F;case 7:return this.gh.RG32F;case 4:return this.gh.RGB32F;case 5:default:return this.gh.RGBA32F}case 2:switch(i){case 6:return this.gh.R16F;case 7:return this.gh.RG16F;case 4:return this.gh.RGB16F;case 5:default:return this.gh.RGBA16F}case 10:return this.gh.RGB565;case 13:return this.gh.R11F_G11F_B10F;case 14:return this.gh.RGB9_E5;case 8:return this.gh.RGBA4;case 9:return this.gh.RGB5_A1;case 11:switch(i){case 5:return this.gh.RGB10_A2;case 11:return this.gh.RGB10_A2UI;default:return this.gh.RGB10_A2}}return this.gh.RGBA8},t.prototype.Jr=function(t){return 1===t?this.gh.RGBA32F:2===t?this.gh.RGBA16F:this.gh.RGBA8},t.prototype.Ni=function(i,n,s,h,r,e){var u=this,o=t.ri(i,n,s,h,r,e);return this.ah.push(o),o.onCompleteObservable.add((function(t){u.ah.splice(u.ah.indexOf(t),1)})),o},t.ri=function(t,i,n,s,h,r){throw X.WarnImport("FileTools")},t.prototype.readPixels=function(t,i,n,s,h){void 0===h&&(h=!0);var r=h?4:3,e=h?this.gh.RGBA:this.gh.RGB,u=new Uint8Array(s*n*r);return this.gh.readPixels(t,i,n,s,e,this.gh.UNSIGNED_BYTE,u),u},t.isSupported=function(){if(null===this.$r)try{var t=gt.CreateCanvas(1,1),i=t.getContext("webgl")||t.getContext("experimental-webgl");this.$r=null!=i&&!!window.WebGLRenderingContext}catch(t){this.$r=!1}return this.$r},t.CeilingPOT=function(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t},t.FloorPOT=function(t){return t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,(t|=t>>16)-(t>>1)},t.NearestPOT=function(i){var n=t.CeilingPOT(i),s=t.FloorPOT(i);return n-i>i-s?s:n},t.GetExponentOfTwo=function(i,n,s){var h;switch(void 0===s&&(s=2),s){case 1:h=t.FloorPOT(i);break;case 2:h=t.NearestPOT(i);break;case 3:default:h=t.CeilingPOT(i)}return Math.min(h,n)},t.QueueNewFrame=function(t,i){return U.IsWindowObjectExist()?(i||(i=window),i.requestPostAnimationFrame?i.requestPostAnimationFrame(t):i.requestAnimationFrame?i.requestAnimationFrame(t):i.msRequestAnimationFrame?i.msRequestAnimationFrame(t):i.webkitRequestAnimationFrame?i.webkitRequestAnimationFrame(t):i.mozRequestAnimationFrame?i.mozRequestAnimationFrame(t):i.oRequestAnimationFrame?i.oRequestAnimationFrame(t):window.setTimeout(t,16)):"undefined"!=typeof requestAnimationFrame?requestAnimationFrame(t):setTimeout(t,16)},t.prototype.getHostDocument=function(){return this.mh&&this.mh.ownerDocument?this.mh.ownerDocument:document},t.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]}],t.yr=[],t.CollisionsEpsilon=.001,t.$r=null,t}(),jt=function(t){function i(n,s){var h=t.call(this,n)||this;return h.name="LoadFileError",Y.Gt(h,i.prototype),s instanceof W?h.request=s:h.file=s,h}return E(i,t),i}(Y),Ot=function(t){function i(n,s){var h=t.call(this,n)||this;return h.request=s,h.name="RequestFileError",Y.Gt(h,i.prototype),h}return E(i,t),i}(Y),yt=function(t){function i(n,s){var h=t.call(this,n)||this;return h.file=s,h.name="ReadFileError",Y.Gt(h,i.prototype),h}return E(i,t),i}(Y),At=function(){function t(){}return t.te=function(t){return t=t.replace(/#/gm,"%23")},t.SetCorsBehavior=function(i,n){if((!i||0!==i.indexOf("data:"))&&t.CorsBehavior)if("string"==typeof t.CorsBehavior||this.CorsBehavior instanceof String)n.crossOrigin=t.CorsBehavior;else{var s=t.CorsBehavior(i);s&&(n.crossOrigin=s)}},t.LoadImage=function(i,n,s,h,r){var e;void 0===r&&(r="");var u=!1;if(i instanceof ArrayBuffer||ArrayBuffer.isView(i)?"undefined"!=typeof Blob?(e=URL.createObjectURL(new Blob([i],{type:r})),u=!0):e="data:"+r+";base64,"+S.EncodeArrayBufferToBase64(i):i instanceof Blob?(e=URL.createObjectURL(i),u=!0):(e=t.te(i),e=t.PreprocessUrl(i)),"undefined"==typeof Image)return t.LoadFile(e,(function(t){createImageBitmap(new Blob([t],{type:r})).then((function(t){n(t),u&&URL.revokeObjectURL(e)})).catch((function(t){s&&s("Error while trying to load image: "+i,t)}))}),void 0,h||void 0,!0,(function(t,n){s&&s("Error while trying to load image: "+i,n)})),null;var o=new Image;t.SetCorsBehavior(e,o);var f=function(){o.removeEventListener("load",f),o.removeEventListener("error",c),n(o),u&&o.src&&URL.revokeObjectURL(o.src)},c=function(t){if(o.removeEventListener("load",f),o.removeEventListener("error",c),s){var n=i.toString();s("Error while trying to load image: "+(n.length<32?n:n.slice(0,32)+"..."),t)}u&&o.src&&URL.revokeObjectURL(o.src)};o.addEventListener("load",f),o.addEventListener("error",c);var a=function(){o.src=e};if("data:"!==e.substr(0,5)&&h&&h.enableTexturesOffline)h.open((function(){h&&h.loadImage(e,o)}),a);else{if(-1!==e.indexOf("file:")){var l=decodeURIComponent(e.substring(5).toLowerCase());if(q.FilesToLoad[l]){try{var v;try{v=URL.createObjectURL(q.FilesToLoad[l])}catch(t){v=URL.createObjectURL(q.FilesToLoad[l])}o.src=v,u=!0}catch(t){o.src=""}return o}}a()}return o},t.ReadFile=function(t,i,n,s,h){var r=new FileReader,e={onCompleteObservable:new _,abort:function(){return r.abort()}};return r.onloadend=function(t){return e.onCompleteObservable.notifyObservers(e)},h&&(r.onerror=function(i){h(new yt("Unable to read "+t.name,t))}),r.onload=function(t){i(t.target.result)},n&&(r.onprogress=n),s?r.readAsArrayBuffer(t):r.readAsText(t),e},t.LoadFile=function(i,n,s,h,r,e){if(-1!==i.indexOf("file:")){var u=decodeURIComponent(i.substring(5).toLowerCase());0===u.indexOf("./")&&(u=u.substring(2));var o=q.FilesToLoad[u];if(o)return t.ReadFile(o,n,s,r,e?function(t){return e(void 0,new jt(t.message,t.file))}:void 0)}return t.RequestFile(i,(function(t,i){n(t,i?i.responseURL:void 0)}),s,h,r,e?function(t){e(t.request,new jt(t.message,t.request))}:void 0)},t.RequestFile=function(i,n,s,h,r,e,u){i=t.te(i),i=t.PreprocessUrl(i);var o=t.BaseUrl+i,f=!1,c={onCompleteObservable:new _,abort:function(){return f=!0}},a=function(){var i=new W,h=null;c.abort=function(){f=!0,i.readyState!==(XMLHttpRequest.DONE||4)&&i.abort(),null!==h&&(clearTimeout(h),h=null)};var a=function(l){i.open("GET",o),u&&u(i),r&&(i.responseType="arraybuffer"),s&&i.addEventListener("progress",s);var v=function(){i.removeEventListener("loadend",v),c.onCompleteObservable.notifyObservers(c),c.onCompleteObservable.clear()};i.addEventListener("loadend",v);var b=function(){if(!f&&i.readyState===(XMLHttpRequest.DONE||4)){if(i.removeEventListener("readystatechange",b),i.status>=200&&i.status<300||0===i.status&&(!U.IsWindowObjectExist()||t.IsFileURL()))return void n(r?i.response:i.responseText,i);var s=t.DefaultRetryStrategy;if(s){var u=s(o,i,l);if(-1!==u)return i.removeEventListener("loadend",v),i=new W,void(h=setTimeout((function(){return a(l+1)}),u))}var c=new Ot("Error status: "+i.status+" "+i.statusText+" - Unable to load "+o,i);e&&e(c)}};i.addEventListener("readystatechange",b),i.send()};a(0)};if(h&&h.enableSceneOffline){var l=function(t){t&&t.status>400?e&&e(t):a()};h.open((function(){h&&h.loadFile(t.BaseUrl+i,(function(t){f||n(t),c.onCompleteObservable.notifyObservers(c)}),s?function(t){f||s(t)}:void 0,l,r)}),l)}else a();return c},t.IsFileURL=function(){return"file:"===location.protocol},t.DefaultRetryStrategy=Q.ExponentialBackoff(),t.BaseUrl="",t.CorsBehavior="anonymous",t.PreprocessUrl=function(t){return t},t}();mt.xr=At.LoadImage.bind(At),mt.ri=At.LoadFile.bind(At),rt.ri=At.LoadFile.bind(At),function(t){t[t.Pending=0]="Pending",t[t.Fulfilled=1]="Fulfilled",t[t.Rejected=2]="Rejected"}(at||(at={}));var pt=function(){this.count=0,this.target=0,this.results=[]},Mt=function(){function t(t){var i=this;if(this.ie=at.Pending,this.ne=new Array,this.se=!1,t)try{t((function(t){i.he(t)}),(function(t){i.re(t)}))}catch(t){this.re(t)}}return Object.defineProperty(t.prototype,"ee",{get:function(){return this.ue},set:function(t){this.ue=t,this.oe&&void 0===this.oe.ee&&(this.oe.ee=t)},enumerable:!1,configurable:!0}),t.prototype.catch=function(t){return this.then(void 0,t)},t.prototype.then=function(i,n){var s=this,h=new t;return h.fe=i,h.ce=n,this.ne.push(h),h.oe=this,this.ie!==at.Pending&&setTimeout((function(){if(s.ie===at.Fulfilled||s.se){var t=h.he(s.ee);if(null!=t)if(void 0!==t.ie){var i=t;h.ne.push(i),i.oe=h,h=i}else h.ee=t}else h.re(s.ae)})),h},t.prototype.le=function(t){var i,n=this;if((i=this.ne).push.apply(i,t.splice(0,t.length)),this.ne.forEach((function(t){t.oe=n})),this.ie===at.Fulfilled)for(var s=0,h=this.ne;s<h.length;s++){h[s].he(this.ee)}else if(this.ie===at.Rejected)for(var r=0,e=this.ne;r<e.length;r++){e[r].re(this.ae)}},t.prototype.he=function(t){try{this.ie=at.Fulfilled;var i=null;if(this.fe&&(i=this.fe(t)),null!=i)if(void 0!==i.ie){var n=i;n.oe=this,n.le(this.ne),t=n.ee}else t=i;this.ee=t;for(var s=0,h=this.ne;s<h.length;s++){h[s].he(t)}this.ne.length=0,delete this.fe,delete this.ce}catch(t){this.re(t,!0)}},t.prototype.re=function(t,i){if(void 0===i&&(i=!1),this.ie=at.Rejected,this.ae=t,this.ce&&!i)try{this.ce(t),this.se=!0}catch(i){t=i}for(var n=0,s=this.ne;n<s.length;n++){var h=s[n];this.se?h.he(null):h.re(t)}this.ne.length=0,delete this.fe,delete this.ce},t.resolve=function(i){var n=new t;return n.he(i),n},t.ve=function(t,i,n){t.then((function(t){return i.results[n]=t,i.count++,i.count===i.target&&i.rootPromise.he(i.results),null}),(function(t){i.rootPromise.ie!==at.Rejected&&i.rootPromise.re(t)}))},t.all=function(i){var n=new t,s=new pt;if(s.target=i.length,s.rootPromise=n,i.length)for(var h=0;h<i.length;h++)t.ve(i[h],s,h);else n.he([]);return n},t.race=function(i){var n=new t;if(i.length)for(var s=0,h=i;s<h.length;s++){h[s].then((function(t){return n&&(n.he(t),n=null),null}),(function(t){n&&(n.re(t),n=null)}))}return n},t}(),Kt=function(){function t(){}return t.Apply=function(t){(void 0===t&&(t=!1),t||"undefined"==typeof Promise)&&(window.Promise=Mt)},t}(),Pt=function(){function t(){}return t.SetImmediate=function(t){U.IsWindowObjectExist()&&window.setImmediate?window.setImmediate(t):setTimeout(t,1)},t}(),xt=function(){function t(){}return t.Instantiate=function(t){if(this.RegisteredExternalClasses&&this.RegisteredExternalClasses[t])return this.RegisteredExternalClasses[t];var i=e.GetClass(t);if(i)return i;R.Warn(t+" not found, you may have missed an import.");for(var n=t.split("."),s=window||this,h=0,r=n.length;h<r;h++)s=s[n[h]];return"function"!=typeof s?null:s},t.RegisteredExternalClasses={},t}(),kt=function(){function t(){}return t.RandomId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var i=16*Math.random()|0;return("x"===t?i:3&i|8).toString(16)}))},t}(),Et=function(){function t(){}return Object.defineProperty(t,"BaseUrl",{get:function(){return At.BaseUrl},set:function(t){At.BaseUrl=t},enumerable:!1,configurable:!0}),Object.defineProperty(t,"DefaultRetryStrategy",{get:function(){return At.DefaultRetryStrategy},set:function(t){At.DefaultRetryStrategy=t},enumerable:!1,configurable:!0}),Object.defineProperty(t,"CorsBehavior",{get:function(){return At.CorsBehavior},set:function(t){At.CorsBehavior=t},enumerable:!1,configurable:!0}),Object.defineProperty(t,"UseFallbackTexture",{get:function(){return G.UseFallbackTexture},set:function(t){G.UseFallbackTexture=t},enumerable:!1,configurable:!0}),Object.defineProperty(t,"RegisteredExternalClasses",{get:function(){return xt.RegisteredExternalClasses},set:function(t){xt.RegisteredExternalClasses=t},enumerable:!1,configurable:!0}),Object.defineProperty(t,"fallbackTexture",{get:function(){return G.FallbackTexture},set:function(t){G.FallbackTexture=t},enumerable:!1,configurable:!0}),t.FetchToRef=function(t,i,n,s,h,r){var e=4*((Math.abs(t)*n%n|0)+(Math.abs(i)*s%s|0)*n);r.r=h[e]/255,r.g=h[e+1]/255,r.b=h[e+2]/255,r.a=h[e+3]/255},t.Mix=function(t,i,n){return t*(1-n)+i*n},t.Instantiate=function(t){return xt.Instantiate(t)},t.Slice=function(t,i,n){return t.slice?t.slice(i,n):Array.prototype.slice.call(t,i,n)},t.SetImmediate=function(t){Pt.SetImmediate(t)},t.IsExponentOfTwo=function(t){var i=1;do{i*=2}while(i<t);return i===t},t.FloatRound=function(i){return Math.fround?Math.fround(i):t.be[0]=i},t.GetFilename=function(t){var i=t.lastIndexOf("/");return i<0?t:t.substring(i+1)},t.GetFolderPath=function(t,i){void 0===i&&(i=!1);var n=t.lastIndexOf("/");return n<0?i?t:"":t.substring(0,n+1)},t.ToDegrees=function(t){return 180*t/Math.PI},t.ToRadians=function(t){return t*Math.PI/180},t.MakeArray=function(t,i){return!0===i||void 0!==t&&null!=t?Array.isArray(t)?t:[t]:null},t.GetPointerPrefix=function(t){var i="pointer";return U.IsWindowObjectExist()&&!window.PointerEvent&&U.IsNavigatorAvailable()&&!navigator.pointerEnabled&&(i="mouse"),!t.Us||t._s||document&&"ontouchend"in document||(i="mouse"),i},t.SetCorsBehavior=function(t,i){At.SetCorsBehavior(t,i)},t.CleanUrl=function(t){return t=t.replace(/#/gm,"%23")},Object.defineProperty(t,"PreprocessUrl",{get:function(){return At.PreprocessUrl},set:function(t){At.PreprocessUrl=t},enumerable:!1,configurable:!0}),t.LoadImage=function(t,i,n,s,h){return At.LoadImage(t,i,n,s,h)},t.LoadFile=function(t,i,n,s,h,r){return At.LoadFile(t,i,n,s,h,r)},t.LoadFileAsync=function(t,i){return void 0===i&&(i=!0),new Promise((function(n,s){At.LoadFile(t,(function(t){n(t)}),void 0,void 0,i,(function(t,i){s(i)}))}))},t.LoadScript=function(t,i,n,s){if(U.IsWindowObjectExist()){var h=document.getElementsByTagName("head")[0],r=document.createElement("script");r.setAttribute("type","text/javascript"),r.setAttribute("src",t),s&&(r.id=s),r.onload=function(){i&&i()},r.onerror=function(i){n&&n("Unable to load script '"+t+"'",i)},h.appendChild(r)}},t.LoadScriptAsync=function(t,i){var n=this;return new Promise((function(i,s){n.LoadScript(t,(function(){i()}),(function(t,i){s(i)}))}))},t.ReadFileAsDataURL=function(t,i,n){var s=new FileReader,h={onCompleteObservable:new _,abort:function(){return s.abort()}};return s.onloadend=function(t){h.onCompleteObservable.notifyObservers(h)},s.onload=function(t){i(t.target.result)},s.onprogress=n,s.readAsDataURL(t),h},t.ReadFile=function(t,i,n,s,h){return At.ReadFile(t,i,n,s,h)},t.FileAsURL=function(t){var i=new Blob([t]);return(window.URL||window.webkitURL).createObjectURL(i)},t.Format=function(t,i){return void 0===i&&(i=2),t.toFixed(i)},t.DeepCopy=function(t,i,n,s){I.DeepCopy(t,i,n,s)},t.IsEmpty=function(t){for(var i in t)if(t.hasOwnProperty(i))return!1;return!0},t.RegisterTopRootEvents=function(t,i){for(var n=0;n<i.length;n++){var s=i[n];t.addEventListener(s.name,s.handler,!1);try{window.parent&&window.parent.addEventListener(s.name,s.handler,!1)}catch(t){}}},t.UnregisterTopRootEvents=function(t,i){for(var n=0;n<i.length;n++){var s=i[n];t.removeEventListener(s.name,s.handler);try{t.parent&&t.parent.removeEventListener(s.name,s.handler)}catch(t){}}},t.DumpFramebuffer=function(i,n,s,h,r,e){void 0===r&&(r="image/png");for(var u=4*i,o=n/2,f=s.readPixels(0,0,i,n),c=0;c<o;c++)for(var a=0;a<u;a++){var l=a+c*u,v=a+(n-c-1)*u,b=f[l];f[l]=f[v],f[v]=b}t.de||(t.de=document.createElement("canvas")),t.de.width=i,t.de.height=n;var d=t.de.getContext("2d");if(d){var g=d.createImageData(i,n);g.data.set(f),d.putImageData(g,0,0),t.EncodeScreenshotCanvasData(h,r,e)}},t.ToBlob=function(t,i,n){void 0===n&&(n="image/png"),t.toBlob||(t.toBlob=function(t,i,n){var s=this;setTimeout((function(){for(var h=atob(s.toDataURL(i,n).split(",")[1]),r=h.length,e=new Uint8Array(r),u=0;u<r;u++)e[u]=h.charCodeAt(u);t(new Blob([e]))}))}),t.toBlob((function(t){i(t)}),n)},t.EncodeScreenshotCanvasData=function(i,n,s){(void 0===n&&(n="image/png"),i)?i(t.de.toDataURL(n)):this.ToBlob(t.de,(function(i){if("download"in document.createElement("a")){if(!s){var n=new Date,h=(n.getFullYear()+"-"+(n.getMonth()+1)).slice(2)+"-"+n.getDate()+"_"+n.getHours()+"-"+("0"+n.getMinutes()).slice(-2);s="screenshot_"+h+".png"}t.Download(i,s)}else{var r=URL.createObjectURL(i),e=window.open("");if(!e)return;var u=e.document.createElement("img");u.onload=function(){URL.revokeObjectURL(r)},u.src=r,e.document.body.appendChild(u)}}),n)},t.Download=function(t,i){if(navigator&&navigator.msSaveBlob)navigator.msSaveBlob(t,i);else{var n=window.URL.createObjectURL(t),s=document.createElement("a");document.body.appendChild(s),s.style.display="none",s.href=n,s.download=i,s.addEventListener("click",(function(){s.parentElement&&s.parentElement.removeChild(s)})),s.click(),window.URL.revokeObjectURL(n)}},t.CreateScreenshot=function(t,i,n,s,h){throw void 0===h&&(h="image/png"),X.WarnImport("ScreenshotTools")},t.CreateScreenshotAsync=function(t,i,n,s){throw void 0===s&&(s="image/png"),X.WarnImport("ScreenshotTools")},t.CreateScreenshotUsingRenderTarget=function(t,i,n,s,h,r,e,u){throw void 0===h&&(h="image/png"),void 0===r&&(r=1),void 0===e&&(e=!1),X.WarnImport("ScreenshotTools")},t.CreateScreenshotUsingRenderTargetAsync=function(t,i,n,s,h,r,e){throw void 0===s&&(s="image/png"),void 0===h&&(h=1),void 0===r&&(r=!1),X.WarnImport("ScreenshotTools")},t.RandomId=function(){return kt.RandomId()},t.IsBase64=function(t){return!(t.length<5)&&"data:"===t.substr(0,5)},t.DecodeBase64=function(t){for(var i=atob(t.split(",")[1]),n=i.length,s=new Uint8Array(new ArrayBuffer(n)),h=0;h<n;h++)s[h]=i.charCodeAt(h);return s.buffer},t.GetAbsoluteUrl=function(t){var i=document.createElement("a");return i.href=t,i.href},Object.defineProperty(t,"errorsCount",{get:function(){return R.errorsCount},enumerable:!1,configurable:!0}),t.Log=function(t){R.Log(t)},t.Warn=function(t){R.Warn(t)},t.Error=function(t){R.Error(t)},Object.defineProperty(t,"LogCache",{get:function(){return R.LogCache},enumerable:!1,configurable:!0}),t.ClearLogCache=function(){R.ClearLogCache()},Object.defineProperty(t,"LogLevels",{set:function(t){R.LogLevels=t},enumerable:!1,configurable:!0}),Object.defineProperty(t,"PerformanceLogLevel",{set:function(i){return(i&t.PerformanceUserMarkLogLevel)===t.PerformanceUserMarkLogLevel?(t.StartPerformanceCounter=t.ge,void(t.EndPerformanceCounter=t.we)):(i&t.PerformanceConsoleLogLevel)===t.PerformanceConsoleLogLevel?(t.StartPerformanceCounter=t.me,void(t.EndPerformanceCounter=t.je)):(t.StartPerformanceCounter=t.Oe,void(t.EndPerformanceCounter=t.ye))},enumerable:!1,configurable:!0}),t.Oe=function(t,i){},t.ye=function(t,i){},t.ge=function(i,n){if(void 0===n&&(n=!0),!t.Ae){if(!U.IsWindowObjectExist())return;t.Ae=window.performance}n&&t.Ae.mark&&t.Ae.mark(i+"-Begin")},t.we=function(i,n){void 0===n&&(n=!0),n&&t.Ae.mark&&(t.Ae.mark(i+"-End"),t.Ae.measure(i,i+"-Begin",i+"-End"))},t.me=function(i,n){void 0===n&&(n=!0),n&&(t.ge(i,n),console.time&&console.time(i))},t.je=function(i,n){void 0===n&&(n=!0),n&&(t.we(i,n),console.timeEnd(i))},Object.defineProperty(t,"Now",{get:function(){return N.Now},enumerable:!1,configurable:!0}),t.GetClassName=function(t,i){void 0===i&&(i=!1);var n=null;if(!i&&t.getClassName)n=t.getClassName();else{if(t instanceof Object)n=(i?t:Object.getPrototypeOf(t)).constructor.pe;n||(n=typeof t)}return n},t.First=function(t,i){for(var n=0,s=t;n<s.length;n++){var h=s[n];if(i(h))return h}return null},t.getFullClassName=function(t,i){void 0===i&&(i=!1);var n=null,s=null;if(!i&&t.getClassName)n=t.getClassName();else{if(t instanceof Object){var h=i?t:Object.getPrototypeOf(t);n=h.constructor.pe,s=h.constructor.Me}n||(n=typeof t)}return n?(null!=s?s+".":"")+n:null},t.DelayAsync=function(t){return new Promise((function(i){setTimeout((function(){i()}),t)}))},t.IsSafari=function(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)},t.UseCustomRequestHeaders=!1,t.CustomRequestHeaders=W.CustomRequestHeaders,t.be=new Float32Array(1),t.GetDOMTextContent=U.GetDOMTextContent,t.NoneLogLevel=R.NoneLogLevel,t.MessageLogLevel=R.MessageLogLevel,t.WarningLogLevel=R.WarningLogLevel,t.ErrorLogLevel=R.ErrorLogLevel,t.AllLogLevel=R.AllLogLevel,t.IsWindowObjectExist=U.IsWindowObjectExist,t.PerformanceNoneLogLevel=0,t.PerformanceUserMarkLogLevel=1,t.PerformanceConsoleLogLevel=2,t.StartPerformanceCounter=t.Oe,t.EndPerformanceCounter=t.ye,t}();!function(){function t(t,i,n,s){void 0===s&&(s=0),this.iterations=t,this.index=s-1,this.Ke=!1,this.Pe=i,this.xe=n}t.prototype.executeNext=function(){this.Ke||(this.index+1<this.iterations?(++this.index,this.Pe(this)):this.breakLoop())},t.prototype.breakLoop=function(){this.Ke=!0,this.xe()},t.Run=function(i,n,s,h){void 0===h&&(h=0);var r=new t(i,n,s,h);return r.executeNext(),r},t.SyncAsyncForLoop=function(i,n,s,h,r,e){return void 0===e&&(e=0),t.Run(Math.ceil(i/n),(function(t){r&&r()?t.breakLoop():setTimeout((function(){for(var h=0;h<n;++h){var e=t.index*n+h;if(e>=i)break;if(s(e),r&&r()){t.breakLoop();break}}t.executeNext()}),e)}),h)}}();G.FallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z",Kt.Apply();var Tt=function(){function t(i){this.length=0,this.data=new Array(i),this.ke=t.Ee++}return t.prototype.push=function(t){this.data[this.length++]=t,this.length>this.data.length&&(this.data.length*=2)},t.prototype.forEach=function(t){for(var i=0;i<this.length;i++)t(this.data[i])},t.prototype.sort=function(t){this.data.sort(t)},t.prototype.reset=function(){this.length=0},t.prototype.dispose=function(){this.reset(),this.data&&(this.data.length=0,this.data=[])},t.prototype.concat=function(t){if(0!==t.length){this.length+t.length>this.data.length&&(this.data.length=2*(this.length+t.length));for(var i=0;i<t.length;i++)this.data[this.length++]=(t.data||t)[i]}},t.prototype.indexOf=function(t){var i=this.data.indexOf(t);return i>=this.length?-1:i},t.prototype.contains=function(t){return-1!==this.indexOf(t)},t.Ee=0,t}(),Bt=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.Te=0,i}return E(i,t),i.prototype.push=function(i){t.prototype.push.call(this,i),i.Be||(i.Be={}),i.Be[this.ke]=this.Te},i.prototype.pushNoDuplicate=function(t){return(!t.Be||t.Be[this.ke]!==this.Te)&&(this.push(t),!0)},i.prototype.reset=function(){t.prototype.reset.call(this),this.Te++},i.prototype.concatWithNoDuplicate=function(t){if(0!==t.length){this.length+t.length>this.data.length&&(this.data.length=2*(this.length+t.length));for(var i=0;i<t.length;i++){var n=(t.data||t)[i];this.pushNoDuplicate(n)}}},i}(Tt),Ft=function(){function t(){this.Fe=0,this.bt={}}return t.prototype.copyFrom=function(t){var i=this;this.clear(),t.forEach((function(t,n){return i.add(t,n)}))},t.prototype.get=function(t){var i=this.bt[t];if(void 0!==i)return i},t.prototype.getOrAddWithFactory=function(t,i){var n=this.get(t);return void 0!==n?n:((n=i(t))&&this.add(t,n),n)},t.prototype.getOrAdd=function(t,i){var n=this.get(t);return void 0!==n?n:(this.add(t,i),i)},t.prototype.contains=function(t){return void 0!==this.bt[t]},t.prototype.add=function(t,i){return void 0===this.bt[t]&&(this.bt[t]=i,++this.Fe,!0)},t.prototype.set=function(t,i){return void 0!==this.bt[t]&&(this.bt[t]=i,!0)},t.prototype.getAndRemove=function(t){var i=this.get(t);return void 0!==i?(delete this.bt[t],--this.Fe,i):null},t.prototype.remove=function(t){return!!this.contains(t)&&(delete this.bt[t],--this.Fe,!0)},t.prototype.clear=function(){this.bt={},this.Fe=0},Object.defineProperty(t.prototype,"count",{get:function(){return this.Fe},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t){for(var i in this.bt){t(i,this.bt[i])}},t.prototype.first=function(t){for(var i in this.bt){var n=t(i,this.bt[i]);if(n)return n}return null},t}(),Ct=function(){function t(){}return t.Eval=function(i,n){return"true"===(i=i.match(/\([^\(\)]*\)/g)?i.replace(/\([^\(\)]*\)/g,(function(i){return i=i.slice(1,i.length-1),t.Ce(i,n)})):t.Ce(i,n))||"false"!==i&&t.Eval(i,n)},t.Ce=function(i,n){var s;n=n||function(t){return"true"===t};var h=i.split("||");for(var r in h)if(h.hasOwnProperty(r)){var e=t._e(h[r].trim()),u=e.split("&&");if(u.length>1)for(var o=0;o<u.length;++o){var f=t._e(u[o].trim());if(!(s="true"!==f&&"false"!==f?"!"===f[0]?!n(f.substring(1)):n(f):"true"===f)){e="false";break}}if(s||"true"===e){s=!0;break}s="true"!==e&&"false"!==e?"!"===e[0]?!n(e.substring(1)):n(e):"true"===e}return s?"true":"false"},t._e=function(t){return"!true"===(t=(t=t.replace(/^[\s!]+/,(function(t){return(t=t.replace(/[\s]/g,(function(){return""}))).length%2?"!":""}))).trim())?t="false":"!false"===t&&(t="true"),t},t}(),_t=function(){function t(){}return t.EnableFor=function(i){i.Ue=i.Ue||{},i.hasTags=function(){return t.HasTags(i)},i.addTags=function(n){return t.AddTagsTo(i,n)},i.removeTags=function(n){return t.RemoveTagsFrom(i,n)},i.matchesTagsQuery=function(n){return t.MatchesQuery(i,n)}},t.DisableFor=function(t){delete t.Ue,delete t.hasTags,delete t.addTags,delete t.removeTags,delete t.matchesTagsQuery},t.HasTags=function(t){if(!t.Ue)return!1;var i=t.Ue;for(var n in i)if(i.hasOwnProperty(n))return!0;return!1},t.GetTags=function(t,i){if(void 0===i&&(i=!0),!t.Ue)return null;if(i){var n=[];for(var s in t.Ue)t.Ue.hasOwnProperty(s)&&!0===t.Ue[s]&&n.push(s);return n.join(" ")}return t.Ue},t.AddTagsTo=function(i,n){n&&("string"==typeof n&&n.split(" ").forEach((function(n,s,h){t.Re(i,n)})))},t.Re=function(i,n){""!==(n=n.trim())&&"true"!==n&&"false"!==n&&(n.match(/[\s]/)||n.match(/^([!]|([|]|[&]){2})/)||(t.EnableFor(i),i.Ue[n]=!0))},t.RemoveTagsFrom=function(i,n){if(t.HasTags(i)){var s=n.split(" ");for(var h in s)t.Se(i,s[h])}},t.Se=function(t,i){delete t.Ue[i]},t.MatchesQuery=function(i,n){return void 0===n||(""===n?t.HasTags(i):Ct.Eval(n,(function(n){return t.HasTags(i)&&i.Ue[n]})))},t}(),Ut={},Rt={},St=function(t,i,n){var s=t();_t&&_t.AddTagsTo(s,i.tags);var h=Lt(s);for(var r in h){var e=h[r],u=i[r],o=e.type;if(null!=u&&"uniqueId"!==r)switch(o){case 0:case 6:case 11:s[r]=u;break;case 1:s[r]=n||u.isRenderTarget?u:u.clone();break;case 2:case 3:case 4:case 5:case 7:case 10:case 12:s[r]=n?u:u.clone()}}return s};function Lt(t){var i=t.getClassName();if(Rt[i])return Rt[i];Rt[i]={};for(var n=Rt[i],s=t,h=i;h;){var r=Ut[h];for(var e in r)n[e]=r[e];var u=void 0,o=!1;do{if(!(u=Object.getPrototypeOf(s)).getClassName){o=!0;break}if(u.getClassName()!==h)break;s=u}while(u);if(o)break;h=u.getClassName(),s=u}return n}function Dt(t,i){return function(n,s){var h=function(t){var i=t.getClassName();return Ut[i]||(Ut[i]={}),Ut[i]}(n);h[s]||(h[s]={type:t,sourceName:i})}}function It(t,i){return void 0===i&&(i=null),function(t,i){return void 0===i&&(i=null),function(n,s){var h=i||"_"+s;Object.defineProperty(n,s,{get:function(){return this[h]},set:function(i){this[h]!==i&&(this[h]=i,n[t].apply(this))},enumerable:!0,configurable:!0})}}(t,i)}function Nt(t){return Dt(0,t)}function Xt(t){return Dt(1,t)}function Wt(t){return Dt(2,t)}function Gt(t){return Dt(5,t)}function qt(t){return Dt(8,t)}var Qt=function(){function t(){}return t.AppendSerializedAnimations=function(t,i){if(t.animations){i.animations=[];for(var n=0;n<t.animations.length;n++){var s=t.animations[n];i.animations.push(s.serialize())}}},t.Serialize=function(t,i){i||(i={}),_t&&(i.tags=_t.GetTags(t));var n=Lt(t);for(var s in n){var h=n[s],r=h.sourceName||s,e=h.type,u=t[s];if(null!=u)switch(e){case 0:i[r]=u;break;case 1:i[r]=u.serialize();break;case 2:i[r]=u.asArray();break;case 3:i[r]=u.serialize();break;case 4:case 5:i[r]=u.asArray();break;case 6:i[r]=u.id;break;case 7:i[r]=u.serialize();break;case 8:i[r]=u.asArray();break;case 9:i[r]=u.serialize();break;case 10:i[r]=u.asArray();break;case 11:i[r]=u.id;case 12:i[r]=u.asArray()}}return i},t.Parse=function(i,n,s,h){void 0===h&&(h=null);var r=i();h||(h=""),_t&&_t.AddTagsTo(r,n.tags);var e=Lt(r);for(var f in e){var l=e[f],v=n[l.sourceName||f],b=l.type;if(null!=v){var w=r;switch(b){case 0:w[f]=v;break;case 1:s&&(w[f]=t.Le(v,s,h));break;case 2:w[f]=d.FromArray(v);break;case 3:w[f]=t.De(v);break;case 4:w[f]=u.FromArray(v);break;case 5:w[f]=o.FromArray(v);break;case 6:s&&(w[f]=s.getLastMeshByID(v));break;case 7:w[f]=t.Ie(v);break;case 8:w[f]=g.FromArray(v);break;case 9:w[f]=t.Ne(v);break;case 10:w[f]=c.FromArray(v);break;case 11:s&&(w[f]=s.getCameraByID(v));case 12:w[f]=a.FromArray(v)}}}return r},t.Clone=function(t,i){return St(t,i,!1)},t.Instanciate=function(t,i){return St(t,i,!0)},t.Ne=function(t){throw X.WarnImport("ImageProcessingConfiguration")},t.De=function(t){throw X.WarnImport("FresnelParameters")},t.Ie=function(t){throw X.WarnImport("ColorCurves")},t.Le=function(t,i,n){throw X.WarnImport("Texture")},t}(),Yt=function(){function t(t,i){void 0===i&&(i=null),this.state="",this.metadata=null,this.reservedDataStore=null,this.Xe=!1,this.We=!1,this.animations=new Array,this.Ge={},this.onReady=null,this.qe=!0,this.Qe=!0,this.li=!0,this.Ye=-1,this.Ve=-1,this.He=-1,this.ze=null,this.Ze={},this.Je=null,this.ne=null,this.$e=a.Identity(),this.tu=0,this.iu=!0,this.nu=-1,this.su=null,this.hu=!0,this.onDisposeObservable=new _,this.ru=null,this.eu=new Array,this.name=t,this.id=t,this.uu=i||G.LastCreatedScene,this.uniqueId=this.uu.getUniqueId(),this.ou()}return t.AddNodeConstructor=function(t,i){this.fu[t]=i},t.Construct=function(t,i,n,s){var h=this.fu[t];return h?h(i,n,s):null},Object.defineProperty(t.prototype,"doNotSerialize",{get:function(){return!!this.Xe||!!this.Je&&this.Je.doNotSerialize},set:function(t){this.Xe=t},enumerable:!1,configurable:!0}),t.prototype.isDisposed=function(){return this.We},Object.defineProperty(t.prototype,"parent",{get:function(){return this.Je},set:function(t){if(this.Je!==t){var i=this.Je;if(this.Je&&void 0!==this.Je.ne&&null!==this.Je.ne){var n=this.Je.ne.indexOf(this);-1!==n&&this.Je.ne.splice(n,1),t||this.We||this.cu()}this.Je=t,this.Je&&(void 0!==this.Je.ne&&null!==this.Je.ne||(this.Je.ne=new Array),this.Je.ne.push(this),i||this.au()),this.lu()}},enumerable:!1,configurable:!0}),t.prototype.cu=function(){-1===this.nu&&(this.nu=this.uu.rootNodes.length,this.uu.rootNodes.push(this))},t.prototype.au=function(){if(-1!==this.nu){var t=this.uu.rootNodes,i=t.length-1;t[this.nu]=t[i],t[this.nu].nu=this.nu,this.uu.rootNodes.pop(),this.nu=-1}},Object.defineProperty(t.prototype,"animationPropertiesOverride",{get:function(){return this.su?this.su:this.uu.animationPropertiesOverride},set:function(t){this.su=t},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"Node"},Object.defineProperty(t.prototype,"onDispose",{set:function(t){this.ru&&this.onDisposeObservable.remove(this.ru),this.ru=this.onDisposeObservable.add(t)},enumerable:!1,configurable:!0}),t.prototype.getScene=function(){return this.uu},t.prototype.getEngine=function(){return this.uu.getEngine()},t.prototype.addBehavior=function(t,i){var n=this;return void 0===i&&(i=!1),-1!==this.eu.indexOf(t)?this:(t.init(),this.uu.isLoading&&!i?this.uu.onDataLoadedObservable.addOnce((function(){t.attach(n)})):t.attach(this),this.eu.push(t),this)},t.prototype.removeBehavior=function(t){var i=this.eu.indexOf(t);return-1===i?this:(this.eu[i].detach(),this.eu.splice(i,1),this)},Object.defineProperty(t.prototype,"behaviors",{get:function(){return this.eu},enumerable:!1,configurable:!0}),t.prototype.getBehaviorByName=function(t){for(var i=0,n=this.eu;i<n.length;i++){var s=n[i];if(s.name===t)return s}return null},t.prototype.getWorldMatrix=function(){return this.Ye!==this.uu.getRenderId()&&this.computeWorldMatrix(),this.$e},t.prototype.vu=function(){return this.iu&&(this.iu=!1,this.tu=this.$e.determinant()),this.tu},Object.defineProperty(t.prototype,"worldMatrixFromCache",{get:function(){return this.$e},enumerable:!1,configurable:!0}),t.prototype.ou=function(){this.Ze={},this.Ze.parent=void 0},t.prototype.updateCache=function(t){!t&&this.isSynchronized()||(this.Ze.parent=this.parent,this.du())},t.prototype.gu=function(t,i){return void 0===i&&(i=!0),this.parent?this.parent.gu(t,!1):null},t.prototype.du=function(t){},t.prototype.wu=function(){return!0},t.prototype.mu=function(){this.Je&&(this.Ve=this.Je.He)},t.prototype.isSynchronizedWithParent=function(){return!this.Je||this.Ve===this.Je.He&&this.Je.isSynchronized()},t.prototype.isSynchronized=function(){return this.Ze.parent!=this.Je?(this.Ze.parent=this.Je,!1):!(this.Je&&!this.isSynchronizedWithParent())&&this.wu()},t.prototype.isReady=function(t){return void 0===t&&(t=!1),this.li},t.prototype.isEnabled=function(t){return void 0===t&&(t=!0),!1===t?this.qe:!!this.qe&&this.Qe},t.prototype.lu=function(){this.Qe=!this.Je||this.Je.isEnabled(),this.ne&&this.ne.forEach((function(t){t.lu()}))},t.prototype.setEnabled=function(t){this.qe=t,this.lu()},t.prototype.isDescendantOf=function(t){return!!this.parent&&(this.parent===t||this.parent.isDescendantOf(t))},t.prototype.ju=function(t,i,n){if(void 0===i&&(i=!1),this.ne)for(var s=0;s<this.ne.length;s++){var h=this.ne[s];n&&!n(h)||t.push(h),i||h.ju(t,!1,n)}},t.prototype.getDescendants=function(t,i){var n=new Array;return this.ju(n,t,i),n},t.prototype.getChildMeshes=function(t,i){var n=[];return this.ju(n,t,(function(t){return(!i||i(t))&&void 0!==t.cullingStrategy})),n},t.prototype.getChildren=function(t,i){return void 0===i&&(i=!0),this.getDescendants(i,t)},t.prototype.Ou=function(t){t!==this.li&&(t?(this.onReady&&this.onReady(this),this.li=!0):this.li=!1)},t.prototype.getAnimationByName=function(t){for(var i=0;i<this.animations.length;i++){var n=this.animations[i];if(n.name===t)return n}return null},t.prototype.createAnimationRange=function(i,n,s){if(!this.Ge[i]){this.Ge[i]=t.yu(i,n,s);for(var h=0,r=this.animations.length;h<r;h++)this.animations[h]&&this.animations[h].createRange(i,n,s)}},t.prototype.deleteAnimationRange=function(t,i){void 0===i&&(i=!0);for(var n=0,s=this.animations.length;n<s;n++)this.animations[n]&&this.animations[n].deleteRange(t,i);this.Ge[t]=null},t.prototype.getAnimationRange=function(t){return this.Ge[t]||null},t.prototype.getAnimationRanges=function(){var t,i=[];for(t in this.Ge)i.push(this.Ge[t]);return i},t.prototype.beginAnimation=function(t,i,n,s){var h=this.getAnimationRange(t);return h?this.uu.beginAnimation(this,h.from,h.to,i,n,s):null},t.prototype.serializeAnimationRanges=function(){var t=[];for(var i in this.Ge){var n=this.Ge[i];if(n){var s={};s.name=i,s.from=n.from,s.to=n.to,t.push(s)}}return t},t.prototype.computeWorldMatrix=function(t){return this.$e||(this.$e=a.Identity()),this.$e},t.prototype.dispose=function(t,i){if(void 0===i&&(i=!1),this.We=!0,!t)for(var n=0,s=this.getDescendants(!0);n<s.length;n++){s[n].dispose(t,i)}this.parent?this.parent=null:this.au(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear();for(var h=0,r=this.eu;h<r.length;h++){r[h].detach()}this.eu=[]},t.ParseAnimationRanges=function(t,i,n){if(i.ranges)for(var s=0;s<i.ranges.length;s++){var h=i.ranges[s];t.createAnimationRange(h.name,h.from,h.to)}},t.prototype.getHierarchyBoundingVectors=function(t,i){var n,s;void 0===t&&(t=!0),void 0===i&&(i=null),this.getScene().incrementRenderId(),this.computeWorldMatrix(!0);if(this.getBoundingInfo&&this.subMeshes){var h=this.getBoundingInfo();n=h.boundingBox.minimumWorld.clone(),s=h.boundingBox.maximumWorld.clone()}else n=new o(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),s=new o(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(t)for(var r=0,e=this.getDescendants(!1);r<e.length;r++){var u=e[r];if(u.computeWorldMatrix(!0),(!i||i(u))&&u.getBoundingInfo&&0!==u.getTotalVertices()){var f=u.getBoundingInfo().boundingBox,c=f.minimumWorld,a=f.maximumWorld;o.CheckExtends(c,n,s),o.CheckExtends(a,n,s)}}return{min:n,max:s}},t.yu=function(t,i,n){throw X.WarnImport("AnimationRange")},t.fu={},B([Nt()],t.prototype,"name",void 0),B([Nt()],t.prototype,"id",void 0),B([Nt()],t.prototype,"uniqueId",void 0),B([Nt()],t.prototype,"state",void 0),B([Nt()],t.prototype,"metadata",void 0),t}(),Vt=function(t){function i(n,s,h){void 0===s&&(s=null),void 0===h&&(h=!0);var r=t.call(this,n,s)||this;return r.Au=new o(0,0,1),r.pu=new o(0,0,-1),r.Mu=new o(0,1,0),r.Ku=new o(1,0,0),r.Pu=new o(-1,0,0),r.xu=o.Zero(),r.ku=o.Zero(),r.Eu=null,r.Tu=o.One(),r.u=!1,r.Bu=null,r.Fu=!1,r.Cu=i.BILLBOARDMODE_NONE,r._u=!1,r.scalingDeterminant=1,r.Uu=!1,r.ignoreNonUniformScaling=!1,r.reIntegrateRotationIntoRotationQuaternion=!1,r.Ru=null,r.Su=a.Zero(),r.Lu=!1,r.Du=o.Zero(),r.Iu=o.Zero(),r.Nu=c.Identity(),r.Xu=a.Identity(),r.Wu=!1,r.Gu=!1,r.qu=-1,r.onAfterWorldMatrixUpdateObservable=new _,r.Qu=!1,h&&r.getScene().addTransformNode(r),r}var n;return E(i,t),Object.defineProperty(i.prototype,"billboardMode",{get:function(){return this.Cu},set:function(t){this.Cu!==t&&(this.Cu=t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"preserveParentRotationForBillboard",{get:function(){return this._u},set:function(t){t!==this._u&&(this._u=t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"infiniteDistance",{get:function(){return this.Uu},set:function(t){this.Uu!==t&&(this.Uu=t)},enumerable:!1,configurable:!0}),i.prototype.getClassName=function(){return"TransformNode"},Object.defineProperty(i.prototype,"position",{get:function(){return this.xu},set:function(t){this.xu=t,this.u=!0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"rotation",{get:function(){return this.ku},set:function(t){this.ku=t,this.Eu=null,this.u=!0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"scaling",{get:function(){return this.Tu},set:function(t){this.Tu=t,this.u=!0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"rotationQuaternion",{get:function(){return this.Eu},set:function(t){this.Eu=t,t&&this.ku.setAll(0),this.u=!0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"forward",{get:function(){return o.Normalize(o.TransformNormal(this.getScene().useRightHandedSystem?this.pu:this.Au,this.getWorldMatrix()))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"up",{get:function(){return o.Normalize(o.TransformNormal(this.Mu,this.getWorldMatrix()))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"right",{get:function(){return o.Normalize(o.TransformNormal(this.getScene().useRightHandedSystem?this.Pu:this.Ku,this.getWorldMatrix()))},enumerable:!1,configurable:!0}),i.prototype.updatePoseMatrix=function(t){return this.Ru?(this.Ru.copyFrom(t),this):(this.Ru=t.clone(),this)},i.prototype.getPoseMatrix=function(){return this.Ru||(this.Ru=a.Identity()),this.Ru},i.prototype.wu=function(){var t=this.Ze;return this.billboardMode===t.billboardMode&&this.billboardMode===i.BILLBOARDMODE_NONE&&(!t.pivotMatrixUpdated&&(!this.infiniteDistance&&(!this.position.u&&(!this.scaling.u&&!(this.Eu&&this.Eu.u||this.rotation.u)))))},i.prototype.ou=function(){t.prototype.ou.call(this);var i=this.Ze;i.localMatrixUpdated=!1,i.billboardMode=-1,i.infiniteDistance=!1},i.prototype.markAsDirty=function(t){return this.Ye=Number.MAX_VALUE,this.u=!0,this},Object.defineProperty(i.prototype,"absolutePosition",{get:function(){return this.Du},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"absoluteScaling",{get:function(){return this.Yu(),this.Iu},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"absoluteRotationQuaternion",{get:function(){return this.Yu(),this.Nu},enumerable:!1,configurable:!0}),i.prototype.setPreTransformMatrix=function(t){return this.setPivotMatrix(t,!1)},i.prototype.setPivotMatrix=function(t,i){return void 0===i&&(i=!0),this.Xu.copyFrom(t),this.Lu=!this.Xu.isIdentity(),this.Ze.pivotMatrixUpdated=!0,this.Wu=i,this.Wu&&(this.Vu?this.Xu.invertToRef(this.Vu):this.Vu=a.Invert(this.Xu)),this},i.prototype.getPivotMatrix=function(){return this.Xu},i.prototype.instantiateHierarchy=function(t,i,n){void 0===t&&(t=null);var s=this.clone("Clone of "+(this.name||this.id),t||this.parent,!0);s&&n&&n(this,s);for(var h=0,r=this.getChildTransformNodes(!0);h<r.length;h++){r[h].instantiateHierarchy(s,i,n)}return s},i.prototype.freezeWorldMatrix=function(t){return void 0===t&&(t=null),t?this.$e=t:(this.Gu=!1,this.computeWorldMatrix(!0)),this.u=!1,this.Gu=!0,this},i.prototype.unfreezeWorldMatrix=function(){return this.Gu=!1,this.computeWorldMatrix(!0),this},Object.defineProperty(i.prototype,"isWorldMatrixFrozen",{get:function(){return this.Gu},enumerable:!1,configurable:!0}),i.prototype.getAbsolutePosition=function(){return this.computeWorldMatrix(),this.Du},i.prototype.setAbsolutePosition=function(t){if(!t)return this;var i,n,s;if(void 0===t.x){if(arguments.length<3)return this;i=arguments[0],n=arguments[1],s=arguments[2]}else i=t.x,n=t.y,s=t.z;if(this.parent){var h=v.Matrix[0];this.parent.getWorldMatrix().invertToRef(h),o.TransformCoordinatesFromFloatsToRef(i,n,s,h,this.position)}else this.position.x=i,this.position.y=n,this.position.z=s;return this.Du.copyFrom(t),this},i.prototype.setPositionWithLocalVector=function(t){return this.computeWorldMatrix(),this.position=o.TransformNormal(t,this.Su),this},i.prototype.getPositionExpressedInLocalSpace=function(){this.computeWorldMatrix();var t=v.Matrix[0];return this.Su.invertToRef(t),o.TransformNormal(this.position,t)},i.prototype.locallyTranslate=function(t){return this.computeWorldMatrix(!0),this.position=o.TransformCoordinates(t,this.Su),this},i.prototype.lookAt=function(t,n,h,r,e){void 0===n&&(n=0),void 0===h&&(h=0),void 0===r&&(r=0),void 0===e&&(e=s.LOCAL);var u=i.Hu,o=e===s.LOCAL?this.position:this.getAbsolutePosition();if(t.subtractToRef(o,u),this.setDirection(u,n,h,r),e===s.WORLD&&this.parent)if(this.rotationQuaternion){var f=v.Matrix[0];this.rotationQuaternion.toRotationMatrix(f);var a=v.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(a),a.invert(),f.multiplyToRef(a,f),this.rotationQuaternion.fromRotationMatrix(f)}else{var l=v.Quaternion[0];c.FromEulerVectorToRef(this.rotation,l);f=v.Matrix[0];l.toRotationMatrix(f);a=v.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(a),a.invert(),f.multiplyToRef(a,f),l.fromRotationMatrix(f),l.toEulerAnglesToRef(this.rotation)}return this},i.prototype.getDirection=function(t){var i=o.Zero();return this.getDirectionToRef(t,i),i},i.prototype.getDirectionToRef=function(t,i){return o.TransformNormalToRef(t,this.getWorldMatrix(),i),this},i.prototype.setDirection=function(t,i,n,s){void 0===i&&(i=0),void 0===n&&(n=0),void 0===s&&(s=0);var h=-Math.atan2(t.z,t.x)+Math.PI/2,r=Math.sqrt(t.x*t.x+t.z*t.z),e=-Math.atan2(t.y,r);return this.rotationQuaternion?c.RotationYawPitchRollToRef(h+i,e+n,s,this.rotationQuaternion):(this.rotation.x=e+n,this.rotation.y=h+i,this.rotation.z=s),this},i.prototype.setPivotPoint=function(t,i){void 0===i&&(i=s.LOCAL),0==this.getScene().getRenderId()&&this.computeWorldMatrix(!0);var n=this.getWorldMatrix();if(i==s.WORLD){var h=v.Matrix[0];n.invertToRef(h),t=o.TransformCoordinates(t,h)}return this.setPivotMatrix(a.Translation(-t.x,-t.y,-t.z),!0)},i.prototype.getPivotPoint=function(){var t=o.Zero();return this.getPivotPointToRef(t),t},i.prototype.getPivotPointToRef=function(t){return t.x=-this.Xu.m[12],t.y=-this.Xu.m[13],t.z=-this.Xu.m[14],this},i.prototype.getAbsolutePivotPoint=function(){var t=o.Zero();return this.getAbsolutePivotPointToRef(t),t},i.prototype.getAbsolutePivotPointToRef=function(t){return this.getPivotPointToRef(t),o.TransformCoordinatesToRef(t,this.getWorldMatrix(),t),this},i.prototype.setParent=function(t){if(!t&&!this.parent)return this;var i=v.Quaternion[0],n=v.Vector3[0],s=v.Vector3[1];if(t){var h=v.Matrix[0],r=v.Matrix[1];this.computeWorldMatrix(!0),t.computeWorldMatrix(!0),t.getWorldMatrix().invertToRef(r),this.getWorldMatrix().multiplyToRef(r,h),h.decompose(s,i,n)}else this.computeWorldMatrix(!0),this.getWorldMatrix().decompose(s,i,n);return this.rotationQuaternion?this.rotationQuaternion.copyFrom(i):i.toEulerAnglesToRef(this.rotation),this.scaling.copyFrom(s),this.position.copyFrom(n),this.parent=t,this},Object.defineProperty(i.prototype,"nonUniformScaling",{get:function(){return this.Qu},enumerable:!1,configurable:!0}),i.prototype.zu=function(t){return this.Qu!==t&&(this.Qu=t,!0)},i.prototype.attachToBone=function(t,i){return this.Bu=i,this.parent=t,t.getSkeleton().prepare(),t.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this},i.prototype.detachFromBone=function(){return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this.Bu=null,this.parent=null,this):this},i.prototype.rotate=function(t,n,h){var r;if(t.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.setAll(0)),h&&h!==s.LOCAL){if(this.parent){var e=v.Matrix[0];this.parent.getWorldMatrix().invertToRef(e),t=o.TransformNormal(t,e)}(r=c.RotationAxisToRef(t,n,i.Zu)).multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else r=c.RotationAxisToRef(t,n,i.Zu),this.rotationQuaternion.multiplyToRef(r,this.rotationQuaternion);return this},i.prototype.rotateAround=function(t,i,n){i.normalize(),this.rotationQuaternion||(this.rotationQuaternion=c.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.setAll(0));var s=v.Vector3[0],h=v.Vector3[1],r=v.Vector3[2],e=v.Quaternion[0],u=v.Matrix[0],o=v.Matrix[1],f=v.Matrix[2],l=v.Matrix[3];return t.subtractToRef(this.position,s),a.TranslationToRef(s.x,s.y,s.z,u),a.TranslationToRef(-s.x,-s.y,-s.z,o),a.RotationAxisToRef(i,n,f),o.multiplyToRef(f,l),l.multiplyToRef(u,l),l.decompose(h,e,r),this.position.addInPlace(r),e.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this},i.prototype.translate=function(t,i,n){var h=t.scale(i);if(n&&n!==s.LOCAL)this.setAbsolutePosition(this.getAbsolutePosition().add(h));else{var r=this.getPositionExpressedInLocalSpace().add(h);this.setPositionWithLocalVector(r)}return this},i.prototype.addRotation=function(t,i,n){var s;this.rotationQuaternion?s=this.rotationQuaternion:(s=v.Quaternion[1],c.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,s));var h=v.Quaternion[0];return c.RotationYawPitchRollToRef(i,t,n,h),s.multiplyInPlace(h),this.rotationQuaternion||s.toEulerAnglesToRef(this.rotation),this},i.prototype.Ju=function(){return this.parent},i.prototype.computeWorldMatrix=function(t){if(this.Gu&&!this.u)return this.$e;var n=this.getScene().getRenderId();if(!this.u&&!t&&this.isSynchronized())return this.Ye=n,this.$e;var s=this.getScene().activeCamera,h=0!=(this.Cu&i.BILLBOARDMODE_USE_POSITION),r=this.Cu!==i.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard;r&&s&&h&&(this.lookAt(s.position),(this.billboardMode&i.BILLBOARDMODE_X)!==i.BILLBOARDMODE_X&&(this.rotation.x=0),(this.billboardMode&i.BILLBOARDMODE_Y)!==i.BILLBOARDMODE_Y&&(this.rotation.y=0),(this.billboardMode&i.BILLBOARDMODE_Z)!==i.BILLBOARDMODE_Z&&(this.rotation.z=0)),this.du();var e=this.Ze;e.pivotMatrixUpdated=!1,e.billboardMode=this.billboardMode,e.infiniteDistance=this.infiniteDistance,this.Ye=n,this.He++,this.u=!1,this.xu.u=!1,this.ku.u=!1,this.Tu.u=!1;var u,f=this.Ju(),l=i.$u,b=this.xu;if(this.Uu&&!this.parent&&s){var d=s.getWorldMatrix(),g=new o(d.m[12],d.m[13],d.m[14]);(b=i.io).copyFromFloats(this.xu.x+g.x,this.xu.y+g.y,this.xu.z+g.z)}(l.copyFromFloats(this.Tu.x*this.scalingDeterminant,this.Tu.y*this.scalingDeterminant,this.Tu.z*this.scalingDeterminant),this.Eu)?(this.Eu.u=!1,u=this.Eu,this.reIntegrateRotationIntoRotationQuaternion&&this.rotation.lengthSquared()&&(this.Eu.multiplyInPlace(c.RotationYawPitchRoll(this.ku.y,this.ku.x,this.ku.z)),this.ku.copyFromFloats(0,0,0))):(u=i.no,c.RotationYawPitchRollToRef(this.ku.y,this.ku.x,this.ku.z,u));if(this.Lu){var w=v.Matrix[1];a.ScalingToRef(l.x,l.y,l.z,w);var m=v.Matrix[0];u.toRotationMatrix(m),this.Xu.multiplyToRef(w,v.Matrix[4]),v.Matrix[4].multiplyToRef(m,this.Su),this.Wu&&this.Su.multiplyToRef(this.Vu,this.Su),this.Su.addTranslationFromFloats(b.x,b.y,b.z)}else a.ComposeToRef(l,u,b,this.Su);if(f&&f.getWorldMatrix){if(t&&f.computeWorldMatrix(),r){this.Bu?f.getWorldMatrix().multiplyToRef(this.Bu.getWorldMatrix(),v.Matrix[7]):v.Matrix[7].copyFrom(f.getWorldMatrix());var j=v.Vector3[5],O=v.Vector3[6];v.Matrix[7].decompose(O,void 0,j),a.ScalingToRef(O.x,O.y,O.z,v.Matrix[7]),v.Matrix[7].setTranslation(j),this.Su.multiplyToRef(v.Matrix[7],this.$e)}else this.Bu?(this.Su.multiplyToRef(f.getWorldMatrix(),v.Matrix[6]),v.Matrix[6].multiplyToRef(this.Bu.getWorldMatrix(),this.$e)):this.Su.multiplyToRef(f.getWorldMatrix(),this.$e);this.mu()}else this.$e.copyFrom(this.Su);if(r&&s&&this.billboardMode&&!h){var y=v.Vector3[0];if(this.$e.getTranslationToRef(y),v.Matrix[1].copyFrom(s.getViewMatrix()),v.Matrix[1].setTranslationFromFloats(0,0,0),v.Matrix[1].invertToRef(v.Matrix[0]),(this.billboardMode&i.BILLBOARDMODE_ALL)!==i.BILLBOARDMODE_ALL){v.Matrix[0].decompose(void 0,v.Quaternion[0],void 0);var A=v.Vector3[1];v.Quaternion[0].toEulerAnglesToRef(A),(this.billboardMode&i.BILLBOARDMODE_X)!==i.BILLBOARDMODE_X&&(A.x=0),(this.billboardMode&i.BILLBOARDMODE_Y)!==i.BILLBOARDMODE_Y&&(A.y=0),(this.billboardMode&i.BILLBOARDMODE_Z)!==i.BILLBOARDMODE_Z&&(A.z=0),a.RotationYawPitchRollToRef(A.y,A.x,A.z,v.Matrix[0])}this.$e.setTranslationFromFloats(0,0,0),this.$e.multiplyToRef(v.Matrix[0],this.$e),this.$e.setTranslation(v.Vector3[0])}return this.ignoreNonUniformScaling?this.zu(!1):this.Tu.isNonUniformWithinEpsilon(1e-6)?this.zu(!0):f&&f.Qu?this.zu(f.Qu):this.zu(!1),this.so(),this.Du.copyFromFloats(this.$e.m[12],this.$e.m[13],this.$e.m[14]),this.Fu=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this.Ru||(this.Ru=a.Invert(this.$e)),this.iu=!0,this.$e},i.prototype.resetLocalMatrix=function(t){if(void 0===t&&(t=!0),this.computeWorldMatrix(),t)for(var i=this.getChildren(),n=0;n<i.length;++n){var s=i[n];if(s){s.computeWorldMatrix();var h=v.Matrix[0];s.Su.multiplyToRef(this.Su,h);var r=v.Quaternion[0];h.decompose(s.scaling,r,s.position),s.rotationQuaternion?s.rotationQuaternion=r:r.toEulerAnglesToRef(s.rotation)}}this.scaling.copyFromFloats(1,1,1),this.position.copyFromFloats(0,0,0),this.rotation.copyFromFloats(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=c.Identity()),this.$e=a.Identity()},i.prototype.so=function(){},i.prototype.registerAfterWorldMatrixUpdate=function(t){return this.onAfterWorldMatrixUpdateObservable.add(t),this},i.prototype.unregisterAfterWorldMatrixUpdate=function(t){return this.onAfterWorldMatrixUpdateObservable.removeCallback(t),this},i.prototype.getPositionInCameraSpace=function(t){return void 0===t&&(t=null),t||(t=this.getScene().activeCamera),o.TransformCoordinates(this.getAbsolutePosition(),t.getViewMatrix())},i.prototype.getDistanceToCamera=function(t){return void 0===t&&(t=null),t||(t=this.getScene().activeCamera),this.getAbsolutePosition().subtract(t.globalPosition).length()},i.prototype.clone=function(t,n,s){var h=this,r=Qt.Clone((function(){return new i(t,h.getScene())}),this);if(r.name=t,r.id=t,n&&(r.parent=n),!s)for(var e=this.getDescendants(!0),u=0;u<e.length;u++){var o=e[u];o.clone&&o.clone(t+"."+o.name,r)}return r},i.prototype.serialize=function(t){var i=Qt.Serialize(this,t);return i.type=this.getClassName(),this.parent&&(i.parentId=this.parent.id),i.localMatrix=this.getPivotMatrix().asArray(),i.isEnabled=this.isEnabled(),this.parent&&(i.parentId=this.parent.id),i},i.Parse=function(t,n,s){var h=Qt.Parse((function(){return new i(t.name,n)}),t,n,s);return t.localMatrix?h.setPreTransformMatrix(a.FromArray(t.localMatrix)):t.pivotMatrix&&h.setPivotMatrix(a.FromArray(t.pivotMatrix)),h.setEnabled(t.isEnabled),t.parentId&&(h.ze=t.parentId),h},i.prototype.getChildTransformNodes=function(t,n){var s=[];return this.ju(s,t,(function(t){return(!n||n(t))&&t instanceof i})),s},i.prototype.dispose=function(i,n){if(void 0===n&&(n=!1),this.getScene().stopAnimation(this),this.getScene().removeTransformNode(this),this.onAfterWorldMatrixUpdateObservable.clear(),i)for(var s=0,h=this.getChildTransformNodes(!0);s<h.length;s++){var r=h[s];r.parent=null,r.computeWorldMatrix(!0)}t.prototype.dispose.call(this,i,n)},i.prototype.normalizeToUnitCube=function(t,i,n){void 0===t&&(t=!0),void 0===i&&(i=!1);var s=null,h=null;i&&(this.rotationQuaternion?(h=this.rotationQuaternion.clone(),this.rotationQuaternion.copyFromFloats(0,0,0,1)):this.rotation&&(s=this.rotation.clone(),this.rotation.copyFromFloats(0,0,0)));var r=this.getHierarchyBoundingVectors(t,n),e=r.max.subtract(r.min),u=Math.max(e.x,e.y,e.z);if(0===u)return this;var o=1/u;return this.scaling.scaleInPlace(o),i&&(this.rotationQuaternion&&h?this.rotationQuaternion.copyFrom(h):this.rotation&&s&&this.rotation.copyFrom(s)),this},i.prototype.Yu=function(){this.Fu||(this.$e.decompose(this.Iu,this.Nu),this.Fu=!0)},i.BILLBOARDMODE_NONE=0,i.BILLBOARDMODE_X=1,i.BILLBOARDMODE_Y=2,i.BILLBOARDMODE_Z=4,i.BILLBOARDMODE_ALL=7,i.BILLBOARDMODE_USE_POSITION=128,i.no=c.Zero(),i.$u=o.Zero(),i.io=o.Zero(),i.Hu=new o(0,0,0),i.Zu=new c,B([Gt("position")],i.prototype,"_position",void 0),B([Gt("rotation")],i.prototype,"_rotation",void 0),B([(n="rotationQuaternion",Dt(10,n))],i.prototype,"_rotationQuaternion",void 0),B([Gt("scaling")],i.prototype,"_scaling",void 0),B([Nt("billboardMode")],i.prototype,"_billboardMode",void 0),B([Nt()],i.prototype,"scalingDeterminant",void 0),B([Nt("infiniteDistance")],i.prototype,"_infiniteDistance",void 0),B([Nt()],i.prototype,"ignoreNonUniformScaling",void 0),B([Nt()],i.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0),i}(Yt),Ht=function(){function t(t){void 0===t&&(t=30),this.ho=!0,this.ro=new zt(t)}return t.prototype.sampleFrame=function(t){if(void 0===t&&(t=N.Now),this.ho){if(null!=this.eo){var i=t-this.eo;this.ro.add(i)}this.eo=t}},Object.defineProperty(t.prototype,"averageFrameTime",{get:function(){return this.ro.average},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"averageFrameTimeVariance",{get:function(){return this.ro.variance},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"instantaneousFrameTime",{get:function(){return this.ro.history(0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"averageFPS",{get:function(){return 1e3/this.ro.average},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"instantaneousFPS",{get:function(){var t=this.ro.history(0);return 0===t?0:1e3/t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isSaturated",{get:function(){return this.ro.isSaturated()},enumerable:!1,configurable:!0}),t.prototype.enable=function(){this.ho=!0},t.prototype.disable=function(){this.ho=!1,this.eo=null},Object.defineProperty(t.prototype,"isEnabled",{get:function(){return this.ho},enumerable:!1,configurable:!0}),t.prototype.reset=function(){this.eo=null,this.ro.reset()},t}(),zt=function(){function t(t){this.uo=new Array(t),this.reset()}return t.prototype.add=function(t){var i;if(this.isSaturated()){var n=this.uo[this.oo];i=n-this.average,this.average-=i/(this.fo-1),this.co-=i*(n-this.average)}else this.fo++;i=t-this.average,this.average+=i/this.fo,this.co+=i*(t-this.average),this.variance=this.co/(this.fo-1),this.uo[this.oo]=t,this.oo++,this.oo%=this.uo.length},t.prototype.history=function(t){if(t>=this.fo||t>=this.uo.length)return 0;var i=this.ao(this.oo-1);return this.uo[this.ao(i-t)]},t.prototype.isSaturated=function(){return this.fo>=this.uo.length},t.prototype.reset=function(){this.average=0,this.variance=0,this.fo=0,this.oo=0,this.co=0},t.prototype.ao=function(t){var i=this.uo.length;return(t%i+i)%i},t}(),Zt=function(){function t(){this.lo=0,this.vo=0,this.bo=0,this.do=0,this.wo=0,this.mo=0,this.jo=0,this.Oo=0,this.yo=0,this.Ao=0,this.po=0}return Object.defineProperty(t.prototype,"min",{get:function(){return this.vo},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"max",{get:function(){return this.bo},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"average",{get:function(){return this.do},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lastSecAverage",{get:function(){return this.wo},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"current",{get:function(){return this.mo},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"total",{get:function(){return this.Oo},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"count",{get:function(){return this.jo},enumerable:!1,configurable:!0}),t.prototype.fetchNewFrame=function(){this.jo++,this.mo=0,this.po++},t.prototype.addCount=function(i,n){t.Enabled&&(this.mo+=i,n&&this.Mo())},t.prototype.beginMonitoring=function(){t.Enabled&&(this.lo=N.Now)},t.prototype.endMonitoring=function(i){if(void 0===i&&(i=!0),t.Enabled){i&&this.fetchNewFrame();var n=N.Now;this.mo=n-this.lo,i&&this.Mo()}},t.prototype.Mo=function(){this.Oo+=this.mo,this.yo+=this.mo,this.vo=Math.min(this.vo,this.mo),this.bo=Math.max(this.bo,this.mo),this.do=this.Oo/this.jo;var t=N.Now;t-this.Ao>1e3&&(this.wo=this.yo/this.po,this.Ao=t,this.yo=0,this.po=0)},t.Enabled=!0,t}();mt.prototype.setAlphaConstants=function(t,i,n,s){this.Gs.setAlphaBlendConstants(t,i,n,s)},mt.prototype.setAlphaMode=function(t,i){if(void 0===i&&(i=!1),this.qs!==t){switch(t){case 0:this.Gs.alphaBlend=!1;break;case 7:this.Gs.setAlphaBlendFunctionParameters(this.gh.ONE,this.gh.ONE_MINUS_SRC_ALPHA,this.gh.ONE,this.gh.ONE),this.Gs.alphaBlend=!0;break;case 8:this.Gs.setAlphaBlendFunctionParameters(this.gh.ONE,this.gh.ONE_MINUS_SRC_ALPHA,this.gh.ONE,this.gh.ONE_MINUS_SRC_ALPHA),this.Gs.alphaBlend=!0;break;case 2:this.Gs.setAlphaBlendFunctionParameters(this.gh.SRC_ALPHA,this.gh.ONE_MINUS_SRC_ALPHA,this.gh.ONE,this.gh.ONE),this.Gs.alphaBlend=!0;break;case 6:this.Gs.setAlphaBlendFunctionParameters(this.gh.ONE,this.gh.ONE,this.gh.ZERO,this.gh.ONE),this.Gs.alphaBlend=!0;break;case 1:this.Gs.setAlphaBlendFunctionParameters(this.gh.SRC_ALPHA,this.gh.ONE,this.gh.ZERO,this.gh.ONE),this.Gs.alphaBlend=!0;break;case 3:this.Gs.setAlphaBlendFunctionParameters(this.gh.ZERO,this.gh.ONE_MINUS_SRC_COLOR,this.gh.ONE,this.gh.ONE),this.Gs.alphaBlend=!0;break;case 4:this.Gs.setAlphaBlendFunctionParameters(this.gh.DST_COLOR,this.gh.ZERO,this.gh.ONE,this.gh.ONE),this.Gs.alphaBlend=!0;break;case 5:this.Gs.setAlphaBlendFunctionParameters(this.gh.SRC_ALPHA,this.gh.ONE_MINUS_SRC_COLOR,this.gh.ONE,this.gh.ONE),this.Gs.alphaBlend=!0;break;case 9:this.Gs.setAlphaBlendFunctionParameters(this.gh.CONSTANT_COLOR,this.gh.ONE_MINUS_CONSTANT_COLOR,this.gh.CONSTANT_ALPHA,this.gh.ONE_MINUS_CONSTANT_ALPHA),this.Gs.alphaBlend=!0;break;case 10:this.Gs.setAlphaBlendFunctionParameters(this.gh.ONE,this.gh.ONE_MINUS_SRC_COLOR,this.gh.ONE,this.gh.ONE_MINUS_SRC_ALPHA),this.Gs.alphaBlend=!0;break;case 11:this.Gs.setAlphaBlendFunctionParameters(this.gh.ONE,this.gh.ONE,this.gh.ONE,this.gh.ONE),this.Gs.alphaBlend=!0;break;case 12:this.Gs.setAlphaBlendFunctionParameters(this.gh.DST_ALPHA,this.gh.ONE,this.gh.ZERO,this.gh.ZERO),this.Gs.alphaBlend=!0;break;case 13:this.Gs.setAlphaBlendFunctionParameters(this.gh.ONE_MINUS_DST_COLOR,this.gh.ONE_MINUS_SRC_COLOR,this.gh.ONE_MINUS_DST_ALPHA,this.gh.ONE_MINUS_SRC_ALPHA),this.Gs.alphaBlend=!0;break;case 14:this.Gs.setAlphaBlendFunctionParameters(this.gh.ONE,this.gh.ONE_MINUS_SRC_ALPHA,this.gh.ONE,this.gh.ONE_MINUS_SRC_ALPHA),this.Gs.alphaBlend=!0;break;case 15:this.Gs.setAlphaBlendFunctionParameters(this.gh.ONE,this.gh.ONE,this.gh.ONE,this.gh.ZERO),this.Gs.alphaBlend=!0;break;case 16:this.Gs.setAlphaBlendFunctionParameters(this.gh.ONE_MINUS_DST_COLOR,this.gh.ONE_MINUS_SRC_COLOR,this.gh.ZERO,this.gh.ONE),this.Gs.alphaBlend=!0}i||(this.depthCullingState.depthMask=0===t),this.qs=t}},mt.prototype.getAlphaMode=function(){return this.qs},mt.prototype.setAlphaEquation=function(t){if(this.Qs!==t){switch(t){case 0:this.Gs.setAlphaEquationParameters(this.gh.FUNC_ADD,this.gh.FUNC_ADD);break;case 1:this.Gs.setAlphaEquationParameters(this.gh.FUNC_SUBTRACT,this.gh.FUNC_SUBTRACT);break;case 2:this.Gs.setAlphaEquationParameters(this.gh.FUNC_REVERSE_SUBTRACT,this.gh.FUNC_REVERSE_SUBTRACT);break;case 3:this.Gs.setAlphaEquationParameters(this.gh.MAX,this.gh.MAX);break;case 4:this.Gs.setAlphaEquationParameters(this.gh.MIN,this.gh.MIN);break;case 5:this.Gs.setAlphaEquationParameters(this.gh.MIN,this.gh.FUNC_ADD)}this.Qs=t}},mt.prototype.getAlphaEquation=function(){return this.Qs},mt.prototype.Ko=function(t,i,n,s,h,r){void 0===s&&(s=-1),void 0===h&&(h=0),void 0===r&&(r=null);var e=this.gh;if(!e)throw new Error("Engine does not have gl rendering context.");if(!this.nh){var u=e.createFramebuffer();if(!u)throw new Error("Unable to create dummy framebuffer");this.nh=u}e.bindFramebuffer(e.FRAMEBUFFER,this.nh),s>-1?e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+s,t.ys,h):e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t.ys,h);var o=void 0!==t.type?this.Rr(t.type):e.UNSIGNED_BYTE;switch(o){case e.UNSIGNED_BYTE:r||(r=new Uint8Array(4*i*n)),o=e.UNSIGNED_BYTE;break;default:r||(r=new Float32Array(4*i*n)),o=e.FLOAT}return e.readPixels(0,0,i,n,e.RGBA,o,r),e.bindFramebuffer(e.FRAMEBUFFER,this.ih),r};var Jt=function(t){function i(n,s,h,r){void 0===r&&(r=!1);var e=t.call(this,n,s,h,r)||this;if(e.enableOfflineSupport=!1,e.disableManifestCheck=!1,e.scenes=new Array,e.onNewSceneAddedObservable=new _,e.postProcesses=new Array,e.isPointerLock=!1,e.onResizeObservable=new _,e.onCanvasBlurObservable=new _,e.onCanvasFocusObservable=new _,e.onCanvasPointerOutObservable=new _,e.onBeginFrameObservable=new _,e.customAnimationFrameRequester=null,e.onEndFrameObservable=new _,e.onBeforeShaderCompilationObservable=new _,e.onAfterShaderCompilationObservable=new _,e.Po=!1,e.xo=4,e.ko=1/60,e.Eo=60,e.To=0,e.Bo=new Zt,e.canvasTabIndex=1,e.disablePerformanceMonitorInBackground=!1,e.Fo=new Ht,!n)return e;if(h=e.kh,i.Instances.push(e),n.getContext){var u=n;if(e.Co=function(){e.onCanvasFocusObservable.notifyObservers(e)},e._o=function(){e.onCanvasBlurObservable.notifyObservers(e)},u.addEventListener("focus",e.Co),u.addEventListener("blur",e._o),e.Uo=function(){e.disablePerformanceMonitorInBackground&&e.Fo.disable(),e.Fs=!0},e.Ro=function(){e.disablePerformanceMonitorInBackground&&e.Fo.enable(),e.Fs=!1},e.So=function(t){e.onCanvasPointerOutObservable.notifyObservers(t)},u.addEventListener("pointerout",e.So),U.IsWindowObjectExist()){var o=e.getHostWindow();o.addEventListener("blur",e.Uo),o.addEventListener("focus",e.Ro);var f=document;e.Lo=function(){void 0!==f.fullscreen?e.isFullscreen=f.fullscreen:void 0!==f.mozFullScreen?e.isFullscreen=f.mozFullScreen:void 0!==f.webkitIsFullScreen?e.isFullscreen=f.webkitIsFullScreen:void 0!==f.msIsFullScreen&&(e.isFullscreen=f.msIsFullScreen),e.isFullscreen&&e.Do&&u&&i.Io(u)},document.addEventListener("fullscreenchange",e.Lo,!1),document.addEventListener("mozfullscreenchange",e.Lo,!1),document.addEventListener("webkitfullscreenchange",e.Lo,!1),document.addEventListener("msfullscreenchange",e.Lo,!1),e.No=function(){e.isPointerLock=f.mozPointerLockElement===u||f.webkitPointerLockElement===u||f.msPointerLockElement===u||f.pointerLockElement===u},document.addEventListener("pointerlockchange",e.No,!1),document.addEventListener("mspointerlockchange",e.No,!1),document.addEventListener("mozpointerlockchange",e.No,!1),document.addEventListener("webkitpointerlockchange",e.No,!1),!i.audioEngine&&h.audioEngine&&i.AudioEngineFactory&&(i.audioEngine=i.AudioEngineFactory(e.getRenderingCanvas()))}e.Xo(),e.enableOfflineSupport=void 0!==i.OfflineProviderFactory,h.doNotHandleTouchAction||e.Wo(),e.Po=!!h.deterministicLockstep,e.xo=h.lockstepMaxSteps||0,e.ko=h.timeStep||1/60}return e.Go(),h.autoEnableWebVR&&e.initWebVR(),e}return E(i,t),Object.defineProperty(i,"NpmPackage",{get:function(){return mt.NpmPackage},enumerable:!1,configurable:!0}),Object.defineProperty(i,"Version",{get:function(){return mt.Version},enumerable:!1,configurable:!0}),Object.defineProperty(i,"Instances",{get:function(){return G.Instances},enumerable:!1,configurable:!0}),Object.defineProperty(i,"LastCreatedEngine",{get:function(){return G.LastCreatedEngine},enumerable:!1,configurable:!0}),Object.defineProperty(i,"LastCreatedScene",{get:function(){return G.LastCreatedScene},enumerable:!1,configurable:!0}),i.MarkAllMaterialsAsDirty=function(t,n){for(var s=0;s<i.Instances.length;s++)for(var h=i.Instances[s],r=0;r<h.scenes.length;r++)h.scenes[r].markAllMaterialsAsDirty(t,n)},i.DefaultLoadingScreenFactory=function(t){throw X.WarnImport("LoadingScreen")},Object.defineProperty(i.prototype,"Eh",{get:function(){return!!i.qo},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"performanceMonitor",{get:function(){return this.Fo},enumerable:!1,configurable:!0}),i.prototype.getInputElement=function(){return this.mh},i.prototype.getAspectRatio=function(t,i){void 0===i&&(i=!1);var n=t.viewport;return this.getRenderWidth(i)*n.width/(this.getRenderHeight(i)*n.height)},i.prototype.getScreenAspectRatio=function(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)},i.prototype.getRenderingCanvasClientRect=function(){return this.mh?this.mh.getBoundingClientRect():null},i.prototype.getInputElementClientRect=function(){return this.mh?this.getInputElement().getBoundingClientRect():null},i.prototype.isDeterministicLockStep=function(){return this.Po},i.prototype.getLockstepMaxSteps=function(){return this.xo},i.prototype.getTimeStep=function(){return 1e3*this.ko},i.prototype.generateMipMapsForCubemap=function(t,i){if(void 0===i&&(i=!0),t.generateMipMaps){var n=this.gh;this.Hh(n.TEXTURE_CUBE_MAP,t,!0),n.generateMipmap(n.TEXTURE_CUBE_MAP),i&&this.Hh(n.TEXTURE_CUBE_MAP,null)}},i.prototype.setState=function(t,i,n,s){void 0===i&&(i=0),void 0===s&&(s=!1),(this.Xs.cull!==t||n)&&(this.Xs.cull=t);var h=this.cullBackFaces?this.gh.BACK:this.gh.FRONT;(this.Xs.cullFace!==h||n)&&(this.Xs.cullFace=h),this.setZOffset(i);var r=s?this.gh.CW:this.gh.CCW;(this.Xs.frontFace!==r||n)&&(this.Xs.frontFace=r)},i.prototype.setZOffset=function(t){this.Xs.zOffset=t},i.prototype.getZOffset=function(){return this.Xs.zOffset},i.prototype.setDepthBuffer=function(t){this.Xs.depthTest=t},i.prototype.getDepthWrite=function(){return this.Xs.depthMask},i.prototype.setDepthWrite=function(t){this.Xs.depthMask=t},i.prototype.getStencilBuffer=function(){return this.Ws.stencilTest},i.prototype.setStencilBuffer=function(t){this.Ws.stencilTest=t},i.prototype.getStencilMask=function(){return this.Ws.stencilMask},i.prototype.setStencilMask=function(t){this.Ws.stencilMask=t},i.prototype.getStencilFunction=function(){return this.Ws.stencilFunc},i.prototype.getStencilFunctionReference=function(){return this.Ws.stencilFuncRef},i.prototype.getStencilFunctionMask=function(){return this.Ws.stencilFuncMask},i.prototype.setStencilFunction=function(t){this.Ws.stencilFunc=t},i.prototype.setStencilFunctionReference=function(t){this.Ws.stencilFuncRef=t},i.prototype.setStencilFunctionMask=function(t){this.Ws.stencilFuncMask=t},i.prototype.getStencilOperationFail=function(){return this.Ws.stencilOpStencilFail},i.prototype.getStencilOperationDepthFail=function(){return this.Ws.stencilOpDepthFail},i.prototype.getStencilOperationPass=function(){return this.Ws.stencilOpStencilDepthPass},i.prototype.setStencilOperationFail=function(t){this.Ws.stencilOpStencilFail=t},i.prototype.setStencilOperationDepthFail=function(t){this.Ws.stencilOpDepthFail=t},i.prototype.setStencilOperationPass=function(t){this.Ws.stencilOpStencilDepthPass=t},i.prototype.setDitheringState=function(t){t?this.gh.enable(this.gh.DITHER):this.gh.disable(this.gh.DITHER)},i.prototype.setRasterizerState=function(t){t?this.gh.disable(this.gh.RASTERIZER_DISCARD):this.gh.enable(this.gh.RASTERIZER_DISCARD)},i.prototype.getDepthFunction=function(){return this.Xs.depthFunc},i.prototype.setDepthFunction=function(t){this.Xs.depthFunc=t},i.prototype.setDepthFunctionToGreater=function(){this.Xs.depthFunc=this.gh.GREATER},i.prototype.setDepthFunctionToGreaterOrEqual=function(){this.Xs.depthFunc=this.gh.GEQUAL},i.prototype.setDepthFunctionToLess=function(){this.Xs.depthFunc=this.gh.LESS},i.prototype.setDepthFunctionToLessOrEqual=function(){this.Xs.depthFunc=this.gh.LEQUAL},i.prototype.cacheStencilState=function(){this.Qo=this.getStencilBuffer(),this.Yo=this.getStencilFunction(),this.Vo=this.getStencilMask(),this.Ho=this.getStencilOperationPass(),this.zo=this.getStencilOperationFail(),this.Zo=this.getStencilOperationDepthFail(),this.Jo=this.getStencilFunctionReference()},i.prototype.restoreStencilState=function(){this.setStencilFunction(this.Yo),this.setStencilMask(this.Vo),this.setStencilBuffer(this.Qo),this.setStencilOperationPass(this.Ho),this.setStencilOperationFail(this.zo),this.setStencilOperationDepthFail(this.Zo),this.setStencilFunctionReference(this.Jo)},i.prototype.setDirectViewport=function(t,i,n,s){var h=this.Bh;return this.Bh=null,this.Yh(t,i,n,s),h},i.prototype.scissorClear=function(t,i,n,s,h){this.enableScissor(t,i,n,s),this.clear(h,!0,!0,!0),this.disableScissor()},i.prototype.enableScissor=function(t,i,n,s){var h=this.gh;h.enable(h.SCISSOR_TEST),h.scissor(t,i,n,s)},i.prototype.disableScissor=function(){var t=this.gh;t.disable(t.SCISSOR_TEST)},i.prototype.ar=function(){this.Bo.addCount(1,!1)},i.prototype.initWebVR=function(){throw X.WarnImport("WebVRCamera")},i.prototype.Go=function(){},i.prototype.Xo=function(t,i){},i.prototype.$o=function(){},i.prototype.disableVR=function(){},i.prototype.isVRPresenting=function(){return!1},i.prototype.tf=function(){},i.prototype.if=function(t,i,n){var s=this;return new Promise((function(h,r){s.Ni(t,(function(t){h(t)}),void 0,i,n,(function(t,i){r(i)}))}))},i.prototype.getVertexShaderSource=function(t){var i=this.gh.getAttachedShaders(t);return i?this.gh.getShaderSource(i[0]):null},i.prototype.getFragmentShaderSource=function(t){var i=this.gh.getAttachedShaders(t);return i?this.gh.getShaderSource(i[1]):null},i.prototype.setDepthStencilTexture=function(t,i,n){void 0!==t&&(i&&(this.wh[t]=i),n&&n.depthStencilTexture?this.Qr(t,n,!1,!0):this.Qr(t,null))},i.prototype.setTextureFromPostProcess=function(t,i){this.zi(t,i?i.nf.data[i.sf]:null)},i.prototype.setTextureFromPostProcessOutput=function(t,i){this.zi(t,i?i.hf:null)},i.prototype.Mh=function(){for(var i=0,n=this.scenes;i<n.length;i++){var s=n[i];s.resetCachedMaterial(),s.rf(),s.ef()}t.prototype.Mh.call(this)},i.prototype.uf=function(){for(var t=0;t<this.Ss.length;t++){(0,this.Ss[t])()}},i.prototype.Xh=function(){if(!this.Ls){var t=!0;!this.renderEvenInBackground&&this.Fs&&(t=!1),t&&(this.beginFrame(),this.ff()||this.uf(),this.endFrame())}this.Ss.length>0?this.customAnimationFrameRequester?(this.customAnimationFrameRequester.requestID=this.Gh(this.customAnimationFrameRequester.renderFunction||this.qh,this.customAnimationFrameRequester),this.Wh=this.customAnimationFrameRequester.requestID):this.isVRPresenting()?this.tf():this.Wh=this.Gh(this.qh,this.getHostWindow()):this.Rs=!1},i.prototype.ff=function(){return!1},i.prototype.switchFullscreen=function(t){this.isFullscreen?this.exitFullscreen():this.enterFullscreen(t)},i.prototype.enterFullscreen=function(t){this.isFullscreen||(this.Do=t,this.mh&&i.cf(this.mh))},i.prototype.exitFullscreen=function(){this.isFullscreen&&i.af()},i.prototype.enterPointerlock=function(){this.mh&&i.Io(this.mh)},i.prototype.exitPointerlock=function(){i.lf()},i.prototype.beginFrame=function(){this.vf(),this.onBeginFrameObservable.notifyObservers(this),t.prototype.beginFrame.call(this)},i.prototype.endFrame=function(){t.prototype.endFrame.call(this),this.$o(),this.onEndFrameObservable.notifyObservers(this)},i.prototype.resize=function(){this.isVRPresenting()||t.prototype.resize.call(this)},i.prototype.setSize=function(i,n){if(!this.mh)return!1;if(!t.prototype.setSize.call(this,i,n))return!1;if(this.scenes){for(var s=0;s<this.scenes.length;s++)for(var h=this.scenes[s],r=0;r<h.cameras.length;r++){h.cameras[r].Ye=0}this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this)}return!0},i.prototype.updateDynamicVertexBuffer=function(t,i,n,s){this.bindArrayBuffer(t),void 0===n&&(n=0);var h=i.length||i.byteLength;void 0===s||s>=h&&0===n?i instanceof Array?this.gh.bufferSubData(this.gh.ARRAY_BUFFER,n,new Float32Array(i)):this.gh.bufferSubData(this.gh.ARRAY_BUFFER,n,i):i instanceof Array?this.gh.bufferSubData(this.gh.ARRAY_BUFFER,0,new Float32Array(i).subarray(n,n+s)):(i=i instanceof ArrayBuffer?new Uint8Array(i,n,s):new Uint8Array(i.buffer,i.byteOffset+n,s),this.gh.bufferSubData(this.gh.ARRAY_BUFFER,0,i)),this.zh()},i.prototype.Qi=function(i){var n=i;n&&n.program&&n.transformFeedback&&(this.deleteTransformFeedback(n.transformFeedback),n.transformFeedback=null),t.prototype.Qi.call(this,i)},i.prototype.createShaderProgram=function(i,n,s,h,r,e){void 0===e&&(e=null),r=r||this.gh,this.onBeforeShaderCompilationObservable.notifyObservers(this);var u=t.prototype.createShaderProgram.call(this,i,n,s,h,r,e);return this.onAfterShaderCompilationObservable.notifyObservers(this),u},i.prototype.wr=function(t,i,n,s,h){void 0===h&&(h=null);var r=s.createProgram();if(t.program=r,!r)throw new Error("Unable to create program");if(s.attachShader(r,i),s.attachShader(r,n),this.webGLVersion>1&&h){var e=this.createTransformFeedback();this.bindTransformFeedback(e),this.setTranformFeedbackVaryings(r,h),t.transformFeedback=e}return s.linkProgram(r),this.webGLVersion>1&&h&&this.bindTransformFeedback(null),t.context=s,t.vertexShader=i,t.fragmentShader=n,t.isParallelCompiled||this.mr(t),r},i.prototype.xs=function(i){t.prototype.xs.call(this,i),this.scenes.forEach((function(t){t.postProcesses.forEach((function(t){t.hf==i&&(t.hf=null)})),t.cameras.forEach((function(t){t.bf.forEach((function(t){t&&t.hf==i&&(t.hf=null)}))}))}))},i.prototype.Pr=function(t,n,s,h,r){var e=this;this.gh.texParameteri(this.gh.TEXTURE_2D,this.gh.TEXTURE_MAG_FILTER,this.gh.LINEAR),this.gh.texParameteri(this.gh.TEXTURE_2D,this.gh.TEXTURE_MIN_FILTER,this.gh.LINEAR),this.gh.texParameteri(this.gh.TEXTURE_2D,this.gh.TEXTURE_WRAP_S,this.gh.CLAMP_TO_EDGE),this.gh.texParameteri(this.gh.TEXTURE_2D,this.gh.TEXTURE_WRAP_T,this.gh.CLAMP_TO_EDGE);var u=this.createRenderTargetTexture({width:n.width,height:n.height},{generateMipMaps:!1,type:0,samplingMode:2,generateDepthBuffer:!1,generateStencilBuffer:!1});!this.df&&i.qo&&(this.df=i.qo(this)),this.df.getEffect().executeWhenCompiled((function(){e.df.onApply=function(i){i.zi("textureSampler",t)};var i=s;i||(i=e.scenes[e.scenes.length-1]),i.postProcessManager.directRender([e.df],u,!0),e.Hh(e.gh.TEXTURE_2D,n,!0),e.gh.copyTexImage2D(e.gh.TEXTURE_2D,0,h,0,0,n.width,n.height,0),e.unBindFramebuffer(u),e.xs(u),r&&r()}))},i.prototype.getFps=function(){return this.Eo},i.prototype.getDeltaTime=function(){return this.To},i.prototype.vf=function(){this.Fo.sampleFrame(),this.Eo=this.Fo.averageFPS,this.To=this.Fo.instantaneousFrameTime||0},i.prototype.gf=function(t,i,n,s){void 0===n&&(n=0),void 0===s&&(s=0);var h=this.gh,r=this.Rr(t.type),e=this.Kr(t.format),u=this.Sr(t.type,e),o=t.isCube?h.TEXTURE_CUBE_MAP:h.TEXTURE_2D;this.Hh(o,t,!0),this.kr(t.invertY);var f=h.TEXTURE_2D;t.isCube&&(f=h.TEXTURE_CUBE_MAP_POSITIVE_X+n),h.texImage2D(f,s,u,e,r,i),this.Hh(o,null,!0)},i.prototype.updateDynamicIndexBuffer=function(t,i,n){var s;void 0===n&&(n=0),this.th[this.gh.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(t),s=i instanceof Uint16Array||i instanceof Uint32Array?i:t.is32Bits?new Uint32Array(i):new Uint16Array(i),this.gh.bufferData(this.gh.ELEMENT_ARRAY_BUFFER,s,this.gh.DYNAMIC_DRAW),this.$h()},i.prototype.updateRenderTargetTextureSampleCount=function(t,i){if(this.webGLVersion<2||!t)return 1;if(t.samples===i)return i;var n=this.gh;if(i=Math.min(i,this.getCaps().maxMSAASamples),t.Vn&&(n.deleteRenderbuffer(t.Vn),t.Vn=null),t.Hn&&(n.deleteFramebuffer(t.Hn),t.Hn=null),t.zn&&(n.deleteRenderbuffer(t.zn),t.zn=null),i>1&&n.renderbufferStorageMultisample){var s=n.createFramebuffer();if(!s)throw new Error("Unable to create multi sampled framebuffer");t.Hn=s,this.Vh(t.Hn);var h=n.createRenderbuffer();if(!h)throw new Error("Unable to create multi sampled framebuffer");n.bindRenderbuffer(n.RENDERBUFFER,h),n.renderbufferStorageMultisample(n.RENDERBUFFER,i,this.Jr(t.type),t.width,t.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,h),t.zn=h}else this.Vh(t.Yn);return t.samples=i,t.Vn=this.Ir(t.us,t.os,t.width,t.height,i),this.Vh(null),i},i.prototype.updateTextureComparisonFunction=function(t,i){if(1!==this.webGLVersion){var n=this.gh;t.isCube?(this.Hh(this.gh.TEXTURE_CUBE_MAP,t,!0),0===i?(n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_COMPARE_FUNC,515),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_COMPARE_MODE,n.NONE)):(n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_COMPARE_FUNC,i),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE)),this.Hh(this.gh.TEXTURE_CUBE_MAP,null)):(this.Hh(this.gh.TEXTURE_2D,t,!0),0===i?(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_COMPARE_FUNC,515),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_COMPARE_MODE,n.NONE)):(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_COMPARE_FUNC,i),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE)),this.Hh(this.gh.TEXTURE_2D,null)),t.fs=i}else R.Error("WebGL 1 does not support texture comparison.")},i.prototype.createInstancesBuffer=function(t){var i=this.gh.createBuffer();if(!i)throw new Error("Unable to create instance buffer");var n=new bt(i);return n.capacity=t,this.bindArrayBuffer(n),this.gh.bufferData(this.gh.ARRAY_BUFFER,t,this.gh.DYNAMIC_DRAW),n},i.prototype.deleteInstancesBuffer=function(t){this.gh.deleteBuffer(t)},i.prototype.wf=function(t,i,n){void 0===i&&(i=0),void 0===n&&(n=10);var s=this.gh;return new Promise((function(h,r){var e=function(){var u=s.clientWaitSync(t,i,0);u!=s.WAIT_FAILED?u!=s.TIMEOUT_EXPIRED?h():setTimeout(e,n):r()};e()}))},i.prototype.mf=function(t,i,n,s,h,r,e){if(this.Bs<2)throw new Error("_readPixelsAsync only work on WebGL2+");var u=this.gh,o=u.createBuffer();u.bindBuffer(u.PIXEL_PACK_BUFFER,o),u.bufferData(u.PIXEL_PACK_BUFFER,e.byteLength,u.STREAM_READ),u.readPixels(t,i,n,s,h,r,0),u.bindBuffer(u.PIXEL_PACK_BUFFER,null);var f=u.fenceSync(u.SYNC_GPU_COMMANDS_COMPLETE,0);return f?(u.flush(),this.wf(f,0,10).then((function(){return u.deleteSync(f),u.bindBuffer(u.PIXEL_PACK_BUFFER,o),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,e),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),u.deleteBuffer(o),e}))):null},i.prototype.dispose=function(){for(this.hideLoadingUI(),this.onNewSceneAddedObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(this.df&&this.df.dispose();this.scenes.length;)this.scenes[0].dispose();1===i.Instances.length&&i.audioEngine&&i.audioEngine.dispose(),this.disableVR(),U.IsWindowObjectExist()&&(window.removeEventListener("blur",this.Uo),window.removeEventListener("focus",this.Ro),this.mh&&(this.mh.removeEventListener("focus",this.Co),this.mh.removeEventListener("blur",this._o),this.mh.removeEventListener("pointerout",this.So)),U.IsDocumentAvailable()&&(document.removeEventListener("fullscreenchange",this.Lo),document.removeEventListener("mozfullscreenchange",this.Lo),document.removeEventListener("webkitfullscreenchange",this.Lo),document.removeEventListener("msfullscreenchange",this.Lo),document.removeEventListener("pointerlockchange",this.No),document.removeEventListener("mspointerlockchange",this.No),document.removeEventListener("mozpointerlockchange",this.No),document.removeEventListener("webkitpointerlockchange",this.No))),t.prototype.dispose.call(this);var n=i.Instances.indexOf(this);n>=0&&i.Instances.splice(n,1),this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear()},i.prototype.Wo=function(){this.mh&&this.mh.setAttribute&&(this.mh.setAttribute("touch-action","none"),this.mh.style.touchAction="none",this.mh.style.msTouchAction="none")},i.prototype.displayLoadingUI=function(){if(U.IsWindowObjectExist()){var t=this.loadingScreen;t&&t.displayLoadingUI()}},i.prototype.hideLoadingUI=function(){if(U.IsWindowObjectExist()){var t=this.jf;t&&t.hideLoadingUI()}},Object.defineProperty(i.prototype,"loadingScreen",{get:function(){return!this.jf&&this.mh&&(this.jf=i.DefaultLoadingScreenFactory(this.mh)),this.jf},set:function(t){this.jf=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"loadingUIText",{set:function(t){this.loadingScreen.loadingUIText=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"loadingUIBackgroundColor",{set:function(t){this.loadingScreen.loadingUIBackgroundColor=t},enumerable:!1,configurable:!0}),i.Io=function(t){t.requestPointerLock=t.requestPointerLock||t.msRequestPointerLock||t.mozRequestPointerLock||t.webkitRequestPointerLock,t.requestPointerLock&&t.requestPointerLock()},i.lf=function(){var t=document;document.exitPointerLock=document.exitPointerLock||t.msExitPointerLock||t.mozExitPointerLock||t.webkitExitPointerLock,document.exitPointerLock&&document.exitPointerLock()},i.cf=function(t){var i=t.requestFullscreen||t.msRequestFullscreen||t.webkitRequestFullscreen||t.mozRequestFullScreen;i&&i.call(t)},i.af=function(){var t=document;document.exitFullscreen?document.exitFullscreen():t.mozCancelFullScreen?t.mozCancelFullScreen():t.webkitCancelFullScreen?t.webkitCancelFullScreen():t.msCancelFullScreen&&t.msCancelFullScreen()},i.ALPHA_DISABLE=0,i.ALPHA_ADD=1,i.ALPHA_COMBINE=2,i.ALPHA_SUBTRACT=3,i.ALPHA_MULTIPLY=4,i.ALPHA_MAXIMIZED=5,i.ALPHA_ONEONE=6,i.ALPHA_PREMULTIPLIED=7,i.ALPHA_PREMULTIPLIED_PORTERDUFF=8,i.ALPHA_INTERPOLATE=9,i.ALPHA_SCREENMODE=10,i.DELAYLOADSTATE_NONE=0,i.DELAYLOADSTATE_LOADED=1,i.DELAYLOADSTATE_LOADING=2,i.DELAYLOADSTATE_NOTLOADED=4,i.NEVER=512,i.ALWAYS=519,i.LESS=513,i.EQUAL=514,i.LEQUAL=515,i.GREATER=516,i.GEQUAL=518,i.NOTEQUAL=517,i.KEEP=7680,i.REPLACE=7681,i.INCR=7682,i.DECR=7683,i.INVERT=5386,i.INCR_WRAP=34055,i.DECR_WRAP=34056,i.TEXTURE_CLAMP_ADDRESSMODE=0,i.TEXTURE_WRAP_ADDRESSMODE=1,i.TEXTURE_MIRROR_ADDRESSMODE=2,i.TEXTUREFORMAT_ALPHA=0,i.TEXTUREFORMAT_LUMINANCE=1,i.TEXTUREFORMAT_LUMINANCE_ALPHA=2,i.TEXTUREFORMAT_RGB=4,i.TEXTUREFORMAT_RGBA=5,i.TEXTUREFORMAT_RED=6,i.TEXTUREFORMAT_R=6,i.TEXTUREFORMAT_RG=7,i.TEXTUREFORMAT_RED_INTEGER=8,i.TEXTUREFORMAT_R_INTEGER=8,i.TEXTUREFORMAT_RG_INTEGER=9,i.TEXTUREFORMAT_RGB_INTEGER=10,i.TEXTUREFORMAT_RGBA_INTEGER=11,i.TEXTURETYPE_UNSIGNED_BYTE=0,i.TEXTURETYPE_UNSIGNED_INT=0,i.TEXTURETYPE_FLOAT=1,i.TEXTURETYPE_HALF_FLOAT=2,i.TEXTURETYPE_BYTE=3,i.TEXTURETYPE_SHORT=4,i.TEXTURETYPE_UNSIGNED_SHORT=5,i.TEXTURETYPE_INT=6,i.TEXTURETYPE_UNSIGNED_INTEGER=7,i.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,i.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,i.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,i.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,i.TEXTURETYPE_UNSIGNED_INT_24_8=12,i.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,i.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,i.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,i.TEXTURE_NEAREST_SAMPLINGMODE=1,i.TEXTURE_BILINEAR_SAMPLINGMODE=2,i.TEXTURE_TRILINEAR_SAMPLINGMODE=3,i.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,i.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,i.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,i.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,i.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,i.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,i.TEXTURE_NEAREST_LINEAR=7,i.TEXTURE_NEAREST_NEAREST=1,i.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,i.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,i.TEXTURE_LINEAR_LINEAR=2,i.TEXTURE_LINEAR_NEAREST=12,i.TEXTURE_EXPLICIT_MODE=0,i.TEXTURE_SPHERICAL_MODE=1,i.TEXTURE_PLANAR_MODE=2,i.TEXTURE_CUBIC_MODE=3,i.TEXTURE_PROJECTION_MODE=4,i.TEXTURE_SKYBOX_MODE=5,i.TEXTURE_INVCUBIC_MODE=6,i.TEXTURE_EQUIRECTANGULAR_MODE=7,i.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,i.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,i.SCALEMODE_FLOOR=1,i.SCALEMODE_NEAREST=2,i.SCALEMODE_CEILING=3,i.qo=null,i}(mt),$t=function(){function t(){}return t.prototype.set=function(t,i){switch(t.length||R.Warn("Setting vertex data kind '"+i+"' with an empty array"),i){case K.PositionKind:this.positions=t;break;case K.NormalKind:this.normals=t;break;case K.TangentKind:this.tangents=t;break;case K.UVKind:this.uvs=t;break;case K.UV2Kind:this.uvs2=t;break;case K.UV3Kind:this.uvs3=t;break;case K.UV4Kind:this.uvs4=t;break;case K.UV5Kind:this.uvs5=t;break;case K.UV6Kind:this.uvs6=t;break;case K.ColorKind:this.colors=t;break;case K.MatricesIndicesKind:this.matricesIndices=t;break;case K.MatricesWeightsKind:this.matricesWeights=t;break;case K.MatricesIndicesExtraKind:this.matricesIndicesExtra=t;break;case K.MatricesWeightsExtraKind:this.matricesWeightsExtra=t}},t.prototype.applyToMesh=function(t,i){return this.Of(t,i),this},t.prototype.applyToGeometry=function(t,i){return this.Of(t,i),this},t.prototype.updateMesh=function(t){return this.yf(t),this},t.prototype.updateGeometry=function(t){return this.yf(t),this},t.prototype.Of=function(t,i){return void 0===i&&(i=!1),this.positions&&t.setVerticesData(K.PositionKind,this.positions,i),this.normals&&t.setVerticesData(K.NormalKind,this.normals,i),this.tangents&&t.setVerticesData(K.TangentKind,this.tangents,i),this.uvs&&t.setVerticesData(K.UVKind,this.uvs,i),this.uvs2&&t.setVerticesData(K.UV2Kind,this.uvs2,i),this.uvs3&&t.setVerticesData(K.UV3Kind,this.uvs3,i),this.uvs4&&t.setVerticesData(K.UV4Kind,this.uvs4,i),this.uvs5&&t.setVerticesData(K.UV5Kind,this.uvs5,i),this.uvs6&&t.setVerticesData(K.UV6Kind,this.uvs6,i),this.colors&&t.setVerticesData(K.ColorKind,this.colors,i),this.matricesIndices&&t.setVerticesData(K.MatricesIndicesKind,this.matricesIndices,i),this.matricesWeights&&t.setVerticesData(K.MatricesWeightsKind,this.matricesWeights,i),this.matricesIndicesExtra&&t.setVerticesData(K.MatricesIndicesExtraKind,this.matricesIndicesExtra,i),this.matricesWeightsExtra&&t.setVerticesData(K.MatricesWeightsExtraKind,this.matricesWeightsExtra,i),this.indices?t.setIndices(this.indices,null,i):t.setIndices([],null),this},t.prototype.yf=function(t,i,n){return this.positions&&t.updateVerticesData(K.PositionKind,this.positions,i,n),this.normals&&t.updateVerticesData(K.NormalKind,this.normals,i,n),this.tangents&&t.updateVerticesData(K.TangentKind,this.tangents,i,n),this.uvs&&t.updateVerticesData(K.UVKind,this.uvs,i,n),this.uvs2&&t.updateVerticesData(K.UV2Kind,this.uvs2,i,n),this.uvs3&&t.updateVerticesData(K.UV3Kind,this.uvs3,i,n),this.uvs4&&t.updateVerticesData(K.UV4Kind,this.uvs4,i,n),this.uvs5&&t.updateVerticesData(K.UV5Kind,this.uvs5,i,n),this.uvs6&&t.updateVerticesData(K.UV6Kind,this.uvs6,i,n),this.colors&&t.updateVerticesData(K.ColorKind,this.colors,i,n),this.matricesIndices&&t.updateVerticesData(K.MatricesIndicesKind,this.matricesIndices,i,n),this.matricesWeights&&t.updateVerticesData(K.MatricesWeightsKind,this.matricesWeights,i,n),this.matricesIndicesExtra&&t.updateVerticesData(K.MatricesIndicesExtraKind,this.matricesIndicesExtra,i,n),this.matricesWeightsExtra&&t.updateVerticesData(K.MatricesWeightsExtraKind,this.matricesWeightsExtra,i,n),this.indices&&t.setIndices(this.indices,null),this},t.prototype.transform=function(t){var i,n=t.m[0]*t.m[5]*t.m[10]<0,s=o.Zero();if(this.positions){var h=o.Zero();for(i=0;i<this.positions.length;i+=3)o.FromArrayToRef(this.positions,i,h),o.TransformCoordinatesToRef(h,t,s),this.positions[i]=s.x,this.positions[i+1]=s.y,this.positions[i+2]=s.z}if(this.normals){var r=o.Zero();for(i=0;i<this.normals.length;i+=3)o.FromArrayToRef(this.normals,i,r),o.TransformNormalToRef(r,t,s),this.normals[i]=s.x,this.normals[i+1]=s.y,this.normals[i+2]=s.z}if(this.tangents){var e=f.Zero(),u=f.Zero();for(i=0;i<this.tangents.length;i+=4)f.FromArrayToRef(this.tangents,i,e),f.TransformNormalToRef(e,t,u),this.tangents[i]=u.x,this.tangents[i+1]=u.y,this.tangents[i+2]=u.z,this.tangents[i+3]=u.w}if(n&&this.indices)for(i=0;i<this.indices.length;i+=3){var c=this.indices[i+1];this.indices[i+1]=this.indices[i+2],this.indices[i+2]=c}return this},t.prototype.merge=function(t,i){if(void 0===i&&(i=!1),this.Af(),t.Af(),!this.normals!=!t.normals||!this.tangents!=!t.tangents||!this.uvs!=!t.uvs||!this.uvs2!=!t.uvs2||!this.uvs3!=!t.uvs3||!this.uvs4!=!t.uvs4||!this.uvs5!=!t.uvs5||!this.uvs6!=!t.uvs6||!this.colors!=!t.colors||!this.matricesIndices!=!t.matricesIndices||!this.matricesWeights!=!t.matricesWeights||!this.matricesIndicesExtra!=!t.matricesIndicesExtra||!this.matricesWeightsExtra!=!t.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(t.indices){this.indices||(this.indices=[]);var n=this.positions?this.positions.length/3:0;if(void 0!==this.indices.BYTES_PER_ELEMENT){var s=this.indices.length+t.indices.length,h=i||this.indices instanceof Uint32Array?new Uint32Array(s):new Uint16Array(s);h.set(this.indices);for(var r=this.indices.length,e=0;e<t.indices.length;e++)h[r+e]=t.indices[e]+n;this.indices=h}else for(e=0;e<t.indices.length;e++)this.indices.push(t.indices[e]+n)}return this.positions=this.pf(this.positions,t.positions),this.normals=this.pf(this.normals,t.normals),this.tangents=this.pf(this.tangents,t.tangents),this.uvs=this.pf(this.uvs,t.uvs),this.uvs2=this.pf(this.uvs2,t.uvs2),this.uvs3=this.pf(this.uvs3,t.uvs3),this.uvs4=this.pf(this.uvs4,t.uvs4),this.uvs5=this.pf(this.uvs5,t.uvs5),this.uvs6=this.pf(this.uvs6,t.uvs6),this.colors=this.pf(this.colors,t.colors),this.matricesIndices=this.pf(this.matricesIndices,t.matricesIndices),this.matricesWeights=this.pf(this.matricesWeights,t.matricesWeights),this.matricesIndicesExtra=this.pf(this.matricesIndicesExtra,t.matricesIndicesExtra),this.matricesWeightsExtra=this.pf(this.matricesWeightsExtra,t.matricesWeightsExtra),this},t.prototype.pf=function(t,i){if(!t)return i;if(!i)return t;var n=i.length+t.length,s=t instanceof Float32Array,h=i instanceof Float32Array;if(s){var r=new Float32Array(n);return r.set(t),r.set(i,t.length),r}if(h){var e=t.slice(0),u=0;for(n=i.length;u<n;u++)e.push(i[u]);return e}return t.concat(i)},t.prototype.Af=function(){if(!this.positions)throw new Error("Positions are required");var t=function(t,i){var n=K.DeduceStride(t);if(i.length%n!=0)throw new Error("The "+t+"s array count must be a multiple of "+n);return i.length/n},i=t(K.PositionKind,this.positions),n=function(n,s){var h=t(n,s);if(h!==i)throw new Error("The "+n+"s element count ("+h+") does not match the positions count ("+i+")")};this.normals&&n(K.NormalKind,this.normals),this.tangents&&n(K.TangentKind,this.tangents),this.uvs&&n(K.UVKind,this.uvs),this.uvs2&&n(K.UV2Kind,this.uvs2),this.uvs3&&n(K.UV3Kind,this.uvs3),this.uvs4&&n(K.UV4Kind,this.uvs4),this.uvs5&&n(K.UV5Kind,this.uvs5),this.uvs6&&n(K.UV6Kind,this.uvs6),this.colors&&n(K.ColorKind,this.colors),this.matricesIndices&&n(K.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&n(K.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&n(K.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&n(K.MatricesWeightsExtraKind,this.matricesWeightsExtra)},t.prototype.serialize=function(){var t=this.serialize();return this.positions&&(t.positions=this.positions),this.normals&&(t.normals=this.normals),this.tangents&&(t.tangents=this.tangents),this.uvs&&(t.uvs=this.uvs),this.uvs2&&(t.uvs2=this.uvs2),this.uvs3&&(t.uvs3=this.uvs3),this.uvs4&&(t.uvs4=this.uvs4),this.uvs5&&(t.uvs5=this.uvs5),this.uvs6&&(t.uvs6=this.uvs6),this.colors&&(t.colors=this.colors),this.matricesIndices&&(t.matricesIndices=this.matricesIndices,t.matricesIndices.Mf=!0),this.matricesWeights&&(t.matricesWeights=this.matricesWeights),this.matricesIndicesExtra&&(t.matricesIndicesExtra=this.matricesIndicesExtra,t.matricesIndicesExtra.Mf=!0),this.matricesWeightsExtra&&(t.matricesWeightsExtra=this.matricesWeightsExtra),t.indices=this.indices,t},t.ExtractFromMesh=function(i,n,s){return t.Kf(i,n,s)},t.ExtractFromGeometry=function(i,n,s){return t.Kf(i,n,s)},t.Kf=function(i,n,s){var h=new t;return i.isVerticesDataPresent(K.PositionKind)&&(h.positions=i.getVerticesData(K.PositionKind,n,s)),i.isVerticesDataPresent(K.NormalKind)&&(h.normals=i.getVerticesData(K.NormalKind,n,s)),i.isVerticesDataPresent(K.TangentKind)&&(h.tangents=i.getVerticesData(K.TangentKind,n,s)),i.isVerticesDataPresent(K.UVKind)&&(h.uvs=i.getVerticesData(K.UVKind,n,s)),i.isVerticesDataPresent(K.UV2Kind)&&(h.uvs2=i.getVerticesData(K.UV2Kind,n,s)),i.isVerticesDataPresent(K.UV3Kind)&&(h.uvs3=i.getVerticesData(K.UV3Kind,n,s)),i.isVerticesDataPresent(K.UV4Kind)&&(h.uvs4=i.getVerticesData(K.UV4Kind,n,s)),i.isVerticesDataPresent(K.UV5Kind)&&(h.uvs5=i.getVerticesData(K.UV5Kind,n,s)),i.isVerticesDataPresent(K.UV6Kind)&&(h.uvs6=i.getVerticesData(K.UV6Kind,n,s)),i.isVerticesDataPresent(K.ColorKind)&&(h.colors=i.getVerticesData(K.ColorKind,n,s)),i.isVerticesDataPresent(K.MatricesIndicesKind)&&(h.matricesIndices=i.getVerticesData(K.MatricesIndicesKind,n,s)),i.isVerticesDataPresent(K.MatricesWeightsKind)&&(h.matricesWeights=i.getVerticesData(K.MatricesWeightsKind,n,s)),i.isVerticesDataPresent(K.MatricesIndicesExtraKind)&&(h.matricesIndicesExtra=i.getVerticesData(K.MatricesIndicesExtraKind,n,s)),i.isVerticesDataPresent(K.MatricesWeightsExtraKind)&&(h.matricesWeightsExtra=i.getVerticesData(K.MatricesWeightsExtraKind,n,s)),h.indices=i.getIndices(n,s),h},t.CreateRibbon=function(t){throw X.WarnImport("ribbonBuilder")},t.CreateBox=function(t){throw X.WarnImport("boxBuilder")},t.CreateTiledBox=function(t){throw X.WarnImport("tiledBoxBuilder")},t.CreateTiledPlane=function(t){throw X.WarnImport("tiledPlaneBuilder")},t.CreateSphere=function(t){throw X.WarnImport("sphereBuilder")},t.CreateCylinder=function(t){throw X.WarnImport("cylinderBuilder")},t.CreateTorus=function(t){throw X.WarnImport("torusBuilder")},t.CreateLineSystem=function(t){throw X.WarnImport("linesBuilder")},t.CreateDashedLines=function(t){throw X.WarnImport("linesBuilder")},t.CreateGround=function(t){throw X.WarnImport("groundBuilder")},t.CreateTiledGround=function(t){throw X.WarnImport("groundBuilder")},t.CreateGroundFromHeightMap=function(t){throw X.WarnImport("groundBuilder")},t.CreatePlane=function(t){throw X.WarnImport("planeBuilder")},t.CreateDisc=function(t){throw X.WarnImport("discBuilder")},t.CreatePolygon=function(t,i,n,s,h,r,e){throw X.WarnImport("polygonBuilder")},t.CreateIcoSphere=function(t){throw X.WarnImport("icoSphereBuilder")},t.CreatePolyhedron=function(t){throw X.WarnImport("polyhedronBuilder")},t.CreateTorusKnot=function(t){throw X.WarnImport("torusKnotBuilder")},t.ComputeNormals=function(t,i,n,s){var h=0,r=0,e=0,u=0,f=0,c=0,a=0,l=0,v=0,b=0,d=0,g=0,w=0,m=0,j=0,O=0,y=0,A=0,p=0,M=0,K=!1,P=!1,x=!1,k=!1,E=1,T=0,B=null;if(s&&(K=!!s.facetNormals,P=!!s.facetPositions,x=!!s.facetPartitioning,E=!0===s.useRightHandedSystem?-1:1,T=s.ratio||0,k=!!s.depthSort,B=s.distanceTo,k)){void 0===B&&(B=o.Zero());var F=s.depthSortedFacets}var C=0,_=0,U=0,R=0;if(x&&s&&s.bbSize){var S=0,L=0,D=0,I=0,N=0,X=0,W=0,G=0,q=0,Q=0,Y=0,V=0,H=0,z=0,Z=0,J=0,$=s.bbSize.x>s.bbSize.y?s.bbSize.x:s.bbSize.y;$=$>s.bbSize.z?$:s.bbSize.z,C=s.subDiv.X*T/s.bbSize.x,_=s.subDiv.Y*T/s.bbSize.y,U=s.subDiv.Z*T/s.bbSize.z,R=s.subDiv.max*s.subDiv.max,s.facetPartitioning.length=0}for(h=0;h<t.length;h++)n[h]=0;var tt=i.length/3|0;for(h=0;h<tt;h++){if(w=(g=3*i[3*h])+1,m=g+2,O=(j=3*i[3*h+1])+1,y=j+2,p=(A=3*i[3*h+2])+1,M=A+2,r=t[g]-t[j],e=t[w]-t[O],u=t[m]-t[y],f=t[A]-t[j],c=t[p]-t[O],l=E*(e*(a=t[M]-t[y])-u*c),v=E*(u*f-r*a),b=E*(r*c-e*f),l/=d=0===(d=Math.sqrt(l*l+v*v+b*b))?1:d,v/=d,b/=d,K&&s&&(s.facetNormals[h].x=l,s.facetNormals[h].y=v,s.facetNormals[h].z=b),P&&s&&(s.facetPositions[h].x=(t[g]+t[j]+t[A])/3,s.facetPositions[h].y=(t[w]+t[O]+t[p])/3,s.facetPositions[h].z=(t[m]+t[y]+t[M])/3),x&&s&&(S=Math.floor((s.facetPositions[h].x-s.bInfo.minimum.x*T)*C),L=Math.floor((s.facetPositions[h].y-s.bInfo.minimum.y*T)*_),D=Math.floor((s.facetPositions[h].z-s.bInfo.minimum.z*T)*U),I=Math.floor((t[g]-s.bInfo.minimum.x*T)*C),N=Math.floor((t[w]-s.bInfo.minimum.y*T)*_),X=Math.floor((t[m]-s.bInfo.minimum.z*T)*U),W=Math.floor((t[j]-s.bInfo.minimum.x*T)*C),G=Math.floor((t[O]-s.bInfo.minimum.y*T)*_),q=Math.floor((t[y]-s.bInfo.minimum.z*T)*U),Q=Math.floor((t[A]-s.bInfo.minimum.x*T)*C),Y=Math.floor((t[p]-s.bInfo.minimum.y*T)*_),V=Math.floor((t[M]-s.bInfo.minimum.z*T)*U),z=I+s.subDiv.max*N+R*X,Z=W+s.subDiv.max*G+R*q,J=Q+s.subDiv.max*Y+R*V,H=S+s.subDiv.max*L+R*D,s.facetPartitioning[H]=s.facetPartitioning[H]?s.facetPartitioning[H]:new Array,s.facetPartitioning[z]=s.facetPartitioning[z]?s.facetPartitioning[z]:new Array,s.facetPartitioning[Z]=s.facetPartitioning[Z]?s.facetPartitioning[Z]:new Array,s.facetPartitioning[J]=s.facetPartitioning[J]?s.facetPartitioning[J]:new Array,s.facetPartitioning[z].push(h),Z!=z&&s.facetPartitioning[Z].push(h),J!=Z&&J!=z&&s.facetPartitioning[J].push(h),H!=z&&H!=Z&&H!=J&&s.facetPartitioning[H].push(h)),k&&s&&s.facetPositions){var it=F[h];it.ind=3*h,it.sqDistance=o.DistanceSquared(s.facetPositions[h],B)}n[g]+=l,n[w]+=v,n[m]+=b,n[j]+=l,n[O]+=v,n[y]+=b,n[A]+=l,n[p]+=v,n[M]+=b}for(h=0;h<n.length/3;h++)l=n[3*h],v=n[3*h+1],b=n[3*h+2],l/=d=0===(d=Math.sqrt(l*l+v*v+b*b))?1:d,v/=d,b/=d,n[3*h]=l,n[3*h+1]=v,n[3*h+2]=b},t.Pf=function(i,n,s,h,r,e,u){var o,c,a=s.length,l=h.length;switch(i=i||t.DEFAULTSIDE){case t.FRONTSIDE:break;case t.BACKSIDE:var v;for(o=0;o<a;o+=3)v=s[o],s[o]=s[o+2],s[o+2]=v;for(c=0;c<l;c++)h[c]=-h[c];break;case t.DOUBLESIDE:for(var b=n.length,d=b/3,g=0;g<b;g++)n[b+g]=n[g];for(o=0;o<a;o+=3)s[o+a]=s[o+2]+d,s[o+1+a]=s[o+1]+d,s[o+2+a]=s[o]+d;for(c=0;c<l;c++)h[l+c]=-h[c];var w=r.length,m=0;for(m=0;m<w;m++)r[m+w]=r[m];for(e=e||new f(0,0,1,1),u=u||new f(0,0,1,1),m=0,o=0;o<w/2;o++)r[m]=e.x+(e.z-e.x)*r[m],r[m+1]=e.y+(e.w-e.y)*r[m+1],r[m+w]=u.x+(u.z-u.x)*r[m+w],r[m+w+1]=u.y+(u.w-u.y)*r[m+w+1],m+=2}},t.ImportVertexData=function(i,n){var s=new t,h=i.positions;h&&s.set(h,K.PositionKind);var r=i.normals;r&&s.set(r,K.NormalKind);var e=i.tangents;e&&s.set(e,K.TangentKind);var u=i.uvs;u&&s.set(u,K.UVKind);var o=i.uv2s;o&&s.set(o,K.UV2Kind);var f=i.uv3s;f&&s.set(f,K.UV3Kind);var c=i.uv4s;c&&s.set(c,K.UV4Kind);var a=i.uv5s;a&&s.set(a,K.UV5Kind);var l=i.uv6s;l&&s.set(l,K.UV6Kind);var v=i.colors;v&&s.set(g.CheckColors4(v,h.length/3),K.ColorKind);var b=i.matricesIndices;b&&s.set(b,K.MatricesIndicesKind);var d=i.matricesWeights;d&&s.set(d,K.MatricesWeightsKind);var w=i.indices;w&&(s.indices=w),n.setAllVerticesData(s,i.updatable)},t.FRONTSIDE=0,t.BACKSIDE=1,t.DOUBLESIDE=2,t.DEFAULTSIDE=0,t}(),ti=function(){function t(t,i,n){this.vectors=r.BuildArray(8,o.Zero),this.center=o.Zero(),this.centerWorld=o.Zero(),this.extendSize=o.Zero(),this.extendSizeWorld=o.Zero(),this.directions=r.BuildArray(3,o.Zero),this.vectorsWorld=r.BuildArray(8,o.Zero),this.minimumWorld=o.Zero(),this.maximumWorld=o.Zero(),this.minimum=o.Zero(),this.maximum=o.Zero(),this.reConstruct(t,i,n)}return t.prototype.reConstruct=function(t,i,n){var s=t.x,h=t.y,r=t.z,e=i.x,u=i.y,o=i.z,f=this.vectors;this.minimum.copyFromFloats(s,h,r),this.maximum.copyFromFloats(e,u,o),f[0].copyFromFloats(s,h,r),f[1].copyFromFloats(e,u,o),f[2].copyFromFloats(e,h,r),f[3].copyFromFloats(s,u,r),f[4].copyFromFloats(s,h,o),f[5].copyFromFloats(e,u,r),f[6].copyFromFloats(s,u,o),f[7].copyFromFloats(e,h,o),i.addToRef(t,this.center).scaleInPlace(.5),i.subtractToRef(t,this.extendSize).scaleInPlace(.5),this.$e=n||a.IdentityReadOnly,this.yf(this.$e)},t.prototype.scale=function(i){var n=t.TmpVector3,s=this.maximum.subtractToRef(this.minimum,n[0]),h=s.length();s.normalizeFromLength(h);var r=h*i,e=s.scaleInPlace(.5*r),u=this.center.subtractToRef(e,n[1]),o=this.center.addToRef(e,n[2]);return this.reConstruct(u,o,this.$e),this},t.prototype.getWorldMatrix=function(){return this.$e},t.prototype.yf=function(t){var i=this.minimumWorld,n=this.maximumWorld,s=this.directions,h=this.vectorsWorld,r=this.vectors;if(t.isIdentity()){i.copyFrom(this.minimum),n.copyFrom(this.maximum);for(e=0;e<8;++e)h[e].copyFrom(r[e]);this.extendSizeWorld.copyFrom(this.extendSize),this.centerWorld.copyFrom(this.center)}else{i.setAll(Number.MAX_VALUE),n.setAll(-Number.MAX_VALUE);for(var e=0;e<8;++e){var u=h[e];o.TransformCoordinatesToRef(r[e],t,u),i.minimizeInPlace(u),n.maximizeInPlace(u)}n.subtractToRef(i,this.extendSizeWorld).scaleInPlace(.5),n.addToRef(i,this.centerWorld).scaleInPlace(.5)}o.FromArrayToRef(t.m,0,s[0]),o.FromArrayToRef(t.m,4,s[1]),o.FromArrayToRef(t.m,8,s[2]),this.$e=t},t.prototype.isInFrustum=function(i){return t.IsInFrustum(this.vectorsWorld,i)},t.prototype.isCompletelyInFrustum=function(i){return t.IsCompletelyInFrustum(this.vectorsWorld,i)},t.prototype.intersectsPoint=function(t){var i=this.minimumWorld,n=this.maximumWorld,s=i.x,h=i.y,r=i.z,e=n.x,u=n.y,o=n.z,f=t.x,c=t.y,a=t.z;return!(e-f<-.001||-.001>f-s)&&(!(u-c<-.001||-.001>c-h)&&!(o-a<-.001||-.001>a-r))},t.prototype.intersectsSphere=function(i){return t.IntersectsSphere(this.minimumWorld,this.maximumWorld,i.centerWorld,i.radiusWorld)},t.prototype.intersectsMinMax=function(t,i){var n=this.minimumWorld,s=this.maximumWorld,h=n.x,r=n.y,e=n.z,u=s.x,o=s.y,f=s.z,c=t.x,a=t.y,l=t.z,v=i.x,b=i.y,d=i.z;return!(u<c||h>v)&&(!(o<a||r>b)&&!(f<l||e>d))},t.Intersects=function(t,i){return t.intersectsMinMax(i.minimumWorld,i.maximumWorld)},t.IntersectsSphere=function(i,n,s,h){var r=t.TmpVector3[0];return o.ClampToRef(s,i,n,r),o.DistanceSquared(s,r)<=h*h},t.IsCompletelyInFrustum=function(t,i){for(var n=0;n<6;++n)for(var s=i[n],h=0;h<8;++h)if(s.dotCoordinate(t[h])<0)return!1;return!0},t.IsInFrustum=function(t,i){for(var n=0;n<6;++n){for(var s=!0,h=i[n],r=0;r<8;++r)if(h.dotCoordinate(t[r])>=0){s=!1;break}if(s)return!1}return!0},t.TmpVector3=r.BuildArray(3,o.Zero),t}(),ii=function(){function t(t,i,n){this.center=o.Zero(),this.centerWorld=o.Zero(),this.minimum=o.Zero(),this.maximum=o.Zero(),this.reConstruct(t,i,n)}return t.prototype.reConstruct=function(t,i,n){this.minimum.copyFrom(t),this.maximum.copyFrom(i);var s=o.Distance(t,i);i.addToRef(t,this.center).scaleInPlace(.5),this.radius=.5*s,this.yf(n||a.IdentityReadOnly)},t.prototype.scale=function(i){var n=this.radius*i,s=t.TmpVector3,h=s[0].setAll(n),r=this.center.subtractToRef(h,s[1]),e=this.center.addToRef(h,s[2]);return this.reConstruct(r,e,this.$e),this},t.prototype.getWorldMatrix=function(){return this.$e},t.prototype.yf=function(i){if(i.isIdentity())this.centerWorld.copyFrom(this.center),this.radiusWorld=this.radius;else{o.TransformCoordinatesToRef(this.center,i,this.centerWorld);var n=t.TmpVector3[0];o.TransformNormalFromFloatsToRef(1,1,1,i,n),this.radiusWorld=Math.max(Math.abs(n.x),Math.abs(n.y),Math.abs(n.z))*this.radius}},t.prototype.isInFrustum=function(t){for(var i=this.centerWorld,n=this.radiusWorld,s=0;s<6;s++)if(t[s].dotCoordinate(i)<=-n)return!1;return!0},t.prototype.isCenterInFrustum=function(t){for(var i=this.centerWorld,n=0;n<6;n++)if(t[n].dotCoordinate(i)<0)return!1;return!0},t.prototype.intersectsPoint=function(t){var i=o.DistanceSquared(this.centerWorld,t);return!(this.radiusWorld*this.radiusWorld<i)},t.Intersects=function(t,i){var n=o.DistanceSquared(t.centerWorld,i.centerWorld),s=t.radiusWorld+i.radiusWorld;return!(s*s<n)},t.TmpVector3=r.BuildArray(3,o.Zero),t}(),ni={min:0,max:0},si={min:0,max:0},hi=function(t,i,n){var s=o.Dot(i.centerWorld,t),h=Math.abs(o.Dot(i.directions[0],t))*i.extendSize.x+Math.abs(o.Dot(i.directions[1],t))*i.extendSize.y+Math.abs(o.Dot(i.directions[2],t))*i.extendSize.z;n.min=s-h,n.max=s+h},ri=function(t,i,n){return hi(t,i,ni),hi(t,n,si),!(ni.min>si.max||si.min>ni.max)},ei=function(){function t(t,i,n){this.xf=!1,this.boundingBox=new ti(t,i,n),this.boundingSphere=new ii(t,i,n)}return t.prototype.reConstruct=function(t,i,n){this.boundingBox.reConstruct(t,i,n),this.boundingSphere.reConstruct(t,i,n)},Object.defineProperty(t.prototype,"minimum",{get:function(){return this.boundingBox.minimum},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maximum",{get:function(){return this.boundingBox.maximum},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isLocked",{get:function(){return this.xf},set:function(t){this.xf=t},enumerable:!1,configurable:!0}),t.prototype.update=function(t){this.xf||(this.boundingBox.yf(t),this.boundingSphere.yf(t))},t.prototype.centerOn=function(i,n){var s=t.TmpVector3[0].copyFrom(i).subtractInPlace(n),h=t.TmpVector3[1].copyFrom(i).addInPlace(n);return this.boundingBox.reConstruct(s,h,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(s,h,this.boundingBox.getWorldMatrix()),this},t.prototype.scale=function(t){return this.boundingBox.scale(t),this.boundingSphere.scale(t),this},t.prototype.isInFrustum=function(t,i){return void 0===i&&(i=0),!(2!==i&&3!==i||!this.boundingSphere.isCenterInFrustum(t))||!!this.boundingSphere.isInFrustum(t)&&(!(1!==i&&3!==i)||this.boundingBox.isInFrustum(t))},Object.defineProperty(t.prototype,"diagonalLength",{get:function(){var i=this.boundingBox;return i.maximumWorld.subtractToRef(i.minimumWorld,t.TmpVector3[0]).length()},enumerable:!1,configurable:!0}),t.prototype.isCompletelyInFrustum=function(t){return this.boundingBox.isCompletelyInFrustum(t)},t.prototype.kf=function(t){return t.Ef(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)},t.prototype.intersectsPoint=function(t){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(t)&&!!this.boundingBox.intersectsPoint(t))},t.prototype.intersects=function(t,i){if(!ii.Intersects(this.boundingSphere,t.boundingSphere))return!1;if(!ti.Intersects(this.boundingBox,t.boundingBox))return!1;if(!i)return!0;var n=this.boundingBox,s=t.boundingBox;return!!ri(n.directions[0],n,s)&&(!!ri(n.directions[1],n,s)&&(!!ri(n.directions[2],n,s)&&(!!ri(s.directions[0],n,s)&&(!!ri(s.directions[1],n,s)&&(!!ri(s.directions[2],n,s)&&(!!ri(o.Cross(n.directions[0],s.directions[0]),n,s)&&(!!ri(o.Cross(n.directions[0],s.directions[1]),n,s)&&(!!ri(o.Cross(n.directions[0],s.directions[2]),n,s)&&(!!ri(o.Cross(n.directions[1],s.directions[0]),n,s)&&(!!ri(o.Cross(n.directions[1],s.directions[1]),n,s)&&(!!ri(o.Cross(n.directions[1],s.directions[2]),n,s)&&(!!ri(o.Cross(n.directions[2],s.directions[0]),n,s)&&(!!ri(o.Cross(n.directions[2],s.directions[1]),n,s)&&!!ri(o.Cross(n.directions[2],s.directions[2]),n,s))))))))))))))},t.TmpVector3=r.BuildArray(2,o.Zero),t}(),ui=function(){this.Tf=!1,this.Bf=-1,this.Ff=-1,this.Cf=null,this._f=null,this.Uf=new o(0,0,0),this.Rf=new o(0,0,0)};var oi=function(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=o.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1},fi=function(){this.Sf=!1,this.Lf=!0,this.Df=4,this.If=!0,this.Nf=!1,this.Xf=new oi,this.Wf=1,this.Gf=null,this.qf=268435455,this.Qf=!0,this.Yf=!1,this.Vf=!1,this.Hf=!1,this.zf=!1,this.Zf=!1},ci=function(t){function i(n,s){void 0===s&&(s=null);var h=t.call(this,n,s,!1)||this;return h.Jf=new fi,h.cullingStrategy=i.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY,h.onCollideObservable=new _,h.onCollisionPositionChangeObservable=new _,h.onMaterialChangedObservable=new _,h.definedFacingForward=!0,h.$f=null,h.tc=null,h.alphaIndex=Number.MAX_VALUE,h.isVisible=!0,h.isPickable=!0,h.showSubMeshesBoundingBox=!1,h.isBlocker=!1,h.enablePointerMoveEvents=!1,h.renderingGroupId=0,h.ic=null,h.outlineColor=d.Red(),h.outlineWidth=.02,h.overlayColor=d.Red(),h.overlayAlpha=.5,h.useOctreeForRenderingSelection=!0,h.useOctreeForPicking=!0,h.useOctreeForCollisions=!0,h.alwaysSelectAsActiveMesh=!1,h.doNotSyncBoundingInfo=!1,h.actionManager=null,h.nc=new ui,h.ellipsoid=new o(.5,1,.5),h.ellipsoidOffset=new o(0,0,0),h.edgesWidth=1,h.edgesColor=new g(1,0,0,1),h.sc=null,h.hc=null,h.rc=null,h.ec=0,h.uc=new Array,h.oc=!1,h.fc=new Array,h.cc={lods:null,actions:null,freezeWorldMatrix:null},h.ac=null,h.lc=null,h.onRebuildObservable=new _,h.vc=function(t,i,n){void 0===n&&(n=null),i.subtractToRef(h.nc.Uf,h.nc.Rf),h.nc.Rf.length()>Jt.CollisionsEpsilon&&h.position.addInPlace(h.nc.Rf),n&&h.onCollideObservable.notifyObservers(n),h.onCollisionPositionChangeObservable.notifyObservers(h.position)},h.getScene().addMesh(h),h.bc(),h}return E(i,t),Object.defineProperty(i,"BILLBOARDMODE_NONE",{get:function(){return Vt.BILLBOARDMODE_NONE},enumerable:!1,configurable:!0}),Object.defineProperty(i,"BILLBOARDMODE_X",{get:function(){return Vt.BILLBOARDMODE_X},enumerable:!1,configurable:!0}),Object.defineProperty(i,"BILLBOARDMODE_Y",{get:function(){return Vt.BILLBOARDMODE_Y},enumerable:!1,configurable:!0}),Object.defineProperty(i,"BILLBOARDMODE_Z",{get:function(){return Vt.BILLBOARDMODE_Z},enumerable:!1,configurable:!0}),Object.defineProperty(i,"BILLBOARDMODE_ALL",{get:function(){return Vt.BILLBOARDMODE_ALL},enumerable:!1,configurable:!0}),Object.defineProperty(i,"BILLBOARDMODE_USE_POSITION",{get:function(){return Vt.BILLBOARDMODE_USE_POSITION},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"facetNb",{get:function(){return this.Jf.Xf.facetNb},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"partitioningSubdivisions",{get:function(){return this.Jf.Xf.partitioningSubdivisions},set:function(t){this.Jf.Xf.partitioningSubdivisions=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"partitioningBBoxRatio",{get:function(){return this.Jf.Xf.partitioningBBoxRatio},set:function(t){this.Jf.Xf.partitioningBBoxRatio=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"mustDepthSortFacets",{get:function(){return this.Jf.Xf.facetDepthSort},set:function(t){this.Jf.Xf.facetDepthSort=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"facetDepthSortFrom",{get:function(){return this.Jf.Xf.facetDepthSortFrom},set:function(t){this.Jf.Xf.facetDepthSortFrom=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isFacetDataEnabled",{get:function(){return this.Jf.Xf.facetDataEnabled},enumerable:!1,configurable:!0}),i.prototype.zu=function(i){return!!t.prototype.zu.call(this,i)&&(this.dc(),!0)},Object.defineProperty(i.prototype,"onCollide",{set:function(t){this.nc.gc&&this.onCollideObservable.remove(this.nc.gc),this.nc.gc=this.onCollideObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onCollisionPositionChange",{set:function(t){this.nc.wc&&this.onCollisionPositionChangeObservable.remove(this.nc.wc),this.nc.wc=this.onCollisionPositionChangeObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"visibility",{get:function(){return this.Jf.Wf},set:function(t){this.Jf.Wf!==t&&(this.Jf.Wf=t,this.dc())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"material",{get:function(){return this.ic},set:function(t){this.ic!==t&&(this.ic&&this.ic.meshMap&&(this.ic.meshMap[this.uniqueId]=void 0),this.ic=t,t&&t.meshMap&&(t.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.subMeshes&&this.mc())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"receiveShadows",{get:function(){return this.Jf.Nf},set:function(t){this.Jf.Nf!==t&&(this.Jf.Nf=t,this.jc())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"hasVertexAlpha",{get:function(){return this.Jf.Sf},set:function(t){this.Jf.Sf!==t&&(this.Jf.Sf=t,this.Oc(),this.dc())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"useVertexColors",{get:function(){return this.Jf.Lf},set:function(t){this.Jf.Lf!==t&&(this.Jf.Lf=t,this.Oc())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"computeBonesUsingShaders",{get:function(){return this.Jf.Qf},set:function(t){this.Jf.Qf!==t&&(this.Jf.Qf=t,this.Oc())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"numBoneInfluencers",{get:function(){return this.Jf.Df},set:function(t){this.Jf.Df!==t&&(this.Jf.Df=t,this.Oc())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"applyFog",{get:function(){return this.Jf.If},set:function(t){this.Jf.If!==t&&(this.Jf.If=t,this.dc())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"layerMask",{get:function(){return this.Jf.qf},set:function(t){t!==this.Jf.qf&&(this.Jf.qf=t,this.bc())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"collisionMask",{get:function(){return this.nc.Bf},set:function(t){this.nc.Bf=isNaN(t)?-1:t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"collisionGroup",{get:function(){return this.nc.Ff},set:function(t){this.nc.Ff=isNaN(t)?-1:t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"surroundingMeshes",{get:function(){return this.nc.Cf},set:function(t){this.nc.Cf=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"lightSources",{get:function(){return this.fc},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"yc",{get:function(){return null},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"skeleton",{get:function(){return this.Jf.Gf},set:function(t){var i=this.Jf.Gf;i&&i.needInitialSkinMatrix&&i.Ac(this),t&&t.needInitialSkinMatrix&&t.pc(this),this.Jf.Gf=t,this.Jf.Gf||(this.ac=null),this.Oc()},enumerable:!1,configurable:!0}),i.prototype.getClassName=function(){return"AbstractMesh"},i.prototype.toString=function(t){var i="Name: "+this.name+", isInstance: "+("InstancedMesh"!==this.getClassName()?"YES":"NO");i+=", # of submeshes: "+(this.subMeshes?this.subMeshes.length:0);var n=this.Jf.Gf;return n&&(i+=", skeleton: "+n.name),t&&(i+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],i+=", freeze wrld mat: "+(this.Gu||this.cc.freezeWorldMatrix?"YES":"NO")),i},i.prototype.Ju=function(){return this.hc&&this.billboardMode!==Vt.BILLBOARDMODE_NONE?this.hc:t.prototype.Ju.call(this)},i.prototype.gu=function(t,i){if(void 0===i&&(i=!0),this.actionManager&&(i||this.actionManager.isRecursive)){if(!t)return this.actionManager;if(this.actionManager.hasSpecificTrigger(t))return this.actionManager}return this.parent?this.parent.gu(t,!1):null},i.prototype.gt=function(){if(this.onRebuildObservable.notifyObservers(this),this.$f&&(this.$f=null),this.subMeshes)for(var t=0,i=this.subMeshes;t<i.length;t++){i[t].gt()}},i.prototype.bc=function(){this.fc.length=0;for(var t=0,i=this.getScene().lights;t<i.length;t++){var n=i[t];n.isEnabled()&&(n.canAffectMesh(this)&&this.fc.push(n))}this.jc()},i.prototype.Mc=function(t){var i=t.isEnabled()&&t.canAffectMesh(this),n=this.fc.indexOf(t),s=!1;if(-1===n){if(!i)return;this.fc.push(t)}else{if(i)return;s=!0,this.fc.splice(n,1)}this.jc(s)},i.prototype.mc=function(){for(var t=0,i=this.subMeshes;t<i.length;t++){i[t].setEffect(null)}},i.prototype.Kc=function(t,i){var n=this.fc.indexOf(t);-1!==n&&(this.fc.splice(n,1),this.jc(i))},i.prototype.Pc=function(t){if(this.subMeshes)for(var i=0,n=this.subMeshes;i<n.length;i++){var s=n[i];s.xc&&t(s.xc)}},i.prototype.jc=function(t){void 0===t&&(t=!1),this.Pc((function(i){return i.markAsLightDirty(t)}))},i.prototype.Oc=function(){this.Pc((function(t){return t.markAsAttributesDirty()}))},i.prototype.dc=function(){this.Pc((function(t){return t.markAsMiscDirty()}))},Object.defineProperty(i.prototype,"scaling",{get:function(){return this.Tu},set:function(t){this.Tu=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isBlocked",{get:function(){return!1},enumerable:!1,configurable:!0}),i.prototype.getLOD=function(t){return this},i.prototype.getTotalVertices=function(){return 0},i.prototype.getTotalIndices=function(){return 0},i.prototype.getIndices=function(){return null},i.prototype.getVerticesData=function(t){return null},i.prototype.setVerticesData=function(t,i,n,s){return this},i.prototype.updateVerticesData=function(t,i,n,s){return this},i.prototype.setIndices=function(t,i){return this},i.prototype.isVerticesDataPresent=function(t){return!1},i.prototype.getBoundingInfo=function(){return this.hc?this.hc.getBoundingInfo():(this.rc||this.kc(),this.rc)},i.prototype.normalizeToUnitCube=function(i,n,s){return void 0===i&&(i=!0),void 0===n&&(n=!1),t.prototype.normalizeToUnitCube.call(this,i,n,s)},i.prototype.setBoundingInfo=function(t){return this.rc=t,this},Object.defineProperty(i.prototype,"useBones",{get:function(){return this.skeleton&&this.getScene().skeletonsEnabled&&this.isVerticesDataPresent(K.MatricesIndicesKind)&&this.isVerticesDataPresent(K.MatricesWeightsKind)},enumerable:!1,configurable:!0}),i.prototype.Ec=function(){},i.prototype.Tc=function(t){},i.prototype.Bc=function(t,i){return this.ec=t,!0},i.prototype.Fc=function(){},i.prototype.Cc=function(){},i.prototype._c=function(){},i.prototype.getWorldMatrix=function(){return this.hc&&this.billboardMode===Vt.BILLBOARDMODE_NONE?this.hc.getWorldMatrix():t.prototype.getWorldMatrix.call(this)},i.prototype.vu=function(){return this.hc?this.hc.vu():t.prototype.vu.call(this)},Object.defineProperty(i.prototype,"isAnInstance",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"hasInstances",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"hasThinInstances",{get:function(){return!1},enumerable:!1,configurable:!0}),i.prototype.movePOV=function(t,i,n){return this.position.addInPlace(this.calcMovePOV(t,i,n)),this},i.prototype.calcMovePOV=function(t,i,n){var s=new a;(this.rotationQuaternion?this.rotationQuaternion:c.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(s);var h=o.Zero(),r=this.definedFacingForward?-1:1;return o.TransformCoordinatesFromFloatsToRef(t*r,i,n*r,s,h),h},i.prototype.rotatePOV=function(t,i,n){return this.rotation.addInPlace(this.calcRotatePOV(t,i,n)),this},i.prototype.calcRotatePOV=function(t,i,n){var s=this.definedFacingForward?1:-1;return new o(t*s,i,n*s)},i.prototype.refreshBoundingInfo=function(t){return void 0===t&&(t=!1),this.rc&&this.rc.isLocked?this:(this.Uc(this.Rc(t),null),this)},i.prototype.Uc=function(t,i){if(t){var n=function(t,i,n,s,h){void 0===s&&(s=null);var r=new o(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),e=new o(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);h||(h=3);for(var u=i,f=i*h;u<i+n;u++,f+=h){var c=t[f],a=t[f+1],l=t[f+2];r.minimizeInPlaceFromFloats(c,a,l),e.maximizeInPlaceFromFloats(c,a,l)}return s&&(r.x-=r.x*s.x+s.y,r.y-=r.y*s.x+s.y,r.z-=r.z*s.x+s.y,e.x+=e.x*s.x+s.y,e.y+=e.y*s.x+s.y,e.z+=e.z*s.x+s.y),{minimum:r,maximum:e}}(t,0,this.getTotalVertices(),i);this.rc?this.rc.reConstruct(n.minimum,n.maximum):this.rc=new ei(n.minimum,n.maximum)}if(this.subMeshes)for(var s=0;s<this.subMeshes.length;s++)this.subMeshes[s].refreshBoundingInfo(t);this.kc()},i.prototype.Rc=function(t){var i=this.getVerticesData(K.PositionKind);if(i&&t&&this.skeleton){i=Et.Slice(i),this.Sc();var n=this.getVerticesData(K.MatricesIndicesKind),s=this.getVerticesData(K.MatricesWeightsKind);if(s&&n){var h=this.numBoneInfluencers>4,r=h?this.getVerticesData(K.MatricesIndicesExtraKind):null,e=h?this.getVerticesData(K.MatricesWeightsExtraKind):null;this.skeleton.prepare();for(var u=this.skeleton.getTransformMatrices(this),f=v.Vector3[0],c=v.Matrix[0],l=v.Matrix[1],b=0,d=0;d<i.length;d+=3,b+=4){var g,w;for(c.reset(),g=0;g<4;g++)(w=s[b+g])>0&&(a.FromFloat32ArrayToRefScaled(u,Math.floor(16*n[b+g]),w,l),c.addToSelf(l));if(h)for(g=0;g<4;g++)(w=e[b+g])>0&&(a.FromFloat32ArrayToRefScaled(u,Math.floor(16*r[b+g]),w,l),c.addToSelf(l));o.TransformCoordinatesFromFloatsToRef(i[d],i[d+1],i[d+2],c,f),f.toArray(i,d),this.yc&&this.yc[d/3].copyFrom(f)}}}return i},i.prototype.kc=function(){var t=this.Lc;return this.rc?this.rc.update(t.worldMatrixFromCache):this.rc=new ei(this.absolutePosition,this.absolutePosition,t.worldMatrixFromCache),this.Dc(t.worldMatrixFromCache),this},i.prototype.Dc=function(t){if(!this.subMeshes)return this;for(var i=this.subMeshes.length,n=0;n<i;n++){var s=this.subMeshes[n];(i>1||!s.IsGlobal)&&s.updateBoundingInfo(t)}return this},i.prototype.so=function(){this.doNotSyncBoundingInfo||this.kc()},Object.defineProperty(i.prototype,"Lc",{get:function(){return this.skeleton&&this.skeleton.overrideMesh||this},enumerable:!1,configurable:!0}),i.prototype.isInFrustum=function(t){return null!==this.rc&&this.rc.isInFrustum(t,this.cullingStrategy)},i.prototype.isCompletelyInFrustum=function(t){return null!==this.rc&&this.rc.isCompletelyInFrustum(t)},i.prototype.intersectsMesh=function(t,i,n){if(void 0===i&&(i=!1),!this.rc||!t.rc)return!1;if(this.rc.intersects(t.rc,i))return!0;if(n)for(var s=0,h=this.getChildMeshes();s<h.length;s++){if(h[s].intersectsMesh(t,i,!0))return!0}return!1},i.prototype.intersectsPoint=function(t){return!!this.rc&&this.rc.intersectsPoint(t)},Object.defineProperty(i.prototype,"checkCollisions",{get:function(){return this.nc.Tf},set:function(t){this.nc.Tf=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"collider",{get:function(){return this.nc._f},enumerable:!1,configurable:!0}),i.prototype.moveWithCollisions=function(t){this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this.nc.Uf);var i=this.getScene().collisionCoordinator;return this.nc._f||(this.nc._f=i.createCollider()),this.nc._f.Ic=this.ellipsoid,i.getNewPosition(this.nc.Uf,t,this.nc._f,3,this,this.vc,this.uniqueId),this},i.prototype.Nc=function(t,i,n){if(this.Sc(),!this.yc)return this;if(!t.Xc||!t.Wc.equals(i)){t.Wc=i.clone(),t.Xc=[],t.Gc=[];for(var s=t.verticesStart,h=t.verticesStart+t.verticesCount,r=s;r<h;r++)t.Xc.push(o.TransformCoordinates(this.yc[r],i))}return n.qc(t.Gc,t.Xc,this.getIndices(),t.indexStart,t.indexStart+t.indexCount,t.verticesStart,!!t.getMaterial(),this),this},i.prototype.Qc=function(t,i){for(var n=this.uu.getCollidingSubMeshCandidates(this,t),s=n.length,h=0;h<s;h++){var r=n.data[h];s>1&&!r.kf(t)||this.Nc(r,i,t)}return this},i.prototype.kf=function(t){if(!this.rc||!this.rc.kf(t))return this;var i=v.Matrix[0],n=v.Matrix[1];return a.ScalingToRef(1/t.Ic.x,1/t.Ic.y,1/t.Ic.z,i),this.worldMatrixFromCache.multiplyToRef(i,n),this.Qc(t,n),this},i.prototype.Sc=function(){return!1},i.prototype.intersects=function(t,i,n,s){void 0===s&&(s=!1);var h=new P,r="InstancedLinesMesh"===this.getClassName()||"LinesMesh"===this.getClassName()?this.intersectionThreshold:0,e=this.rc;if(!(this.subMeshes&&e&&t.intersectsSphere(e.boundingSphere,r)&&t.intersectsBox(e.boundingBox,r)))return h;if(s)return h.hit=!0,h.pickedMesh=this,h.distance=o.Distance(t.origin,e.boundingSphere.center),h.subMeshId=0,h;if(!this.Sc())return h;for(var u=null,f=this.uu.getIntersectingSubMeshCandidates(this,t),c=f.length,a=0;a<c;a++){var l=f.data[a];if(!(c>1)||l.canIntersects(t)){var b=l.intersects(t,this.yc,this.getIndices(),i,n);if(b&&(i||!u||b.distance<u.distance)&&((u=b).subMeshId=a,i))break}}if(u){var d=this.getWorldMatrix(),g=v.Vector3[0],w=v.Vector3[1];o.TransformCoordinatesToRef(t.origin,d,g),t.direction.scaleToRef(u.distance,w);var m=o.TransformNormal(w,d).addInPlace(g);return h.hit=!0,h.distance=o.Distance(g,m),h.pickedPoint=m,h.pickedMesh=this,h.bu=u.bu||0,h.bv=u.bv||0,h.subMeshFaceId=u.faceId,h.faceId=u.faceId+f.data[u.subMeshId].indexStart/(-1!==this.getClassName().indexOf("LinesMesh")?2:3),h.subMeshId=u.subMeshId,h}return h},i.prototype.clone=function(t,i,n){return null},i.prototype.releaseSubMeshes=function(){if(this.subMeshes)for(;this.subMeshes.length;)this.subMeshes[0].dispose();else this.subMeshes=new Array;return this},i.prototype.dispose=function(i,n){var s,h=this;for(void 0===n&&(n=!1),this.uu.useMaterialMeshMap&&this.ic&&this.ic.meshMap&&(this.ic.meshMap[this.uniqueId]=void 0),this.getScene().freeActiveMeshes(),this.getScene().freeRenderingGroups(),void 0!==this.actionManager&&null!==this.actionManager&&(this.actionManager.dispose(),this.actionManager=null),this.Jf.Gf=null,this.lc&&(this.lc.dispose(),this.lc=null),s=0;s<this.uc.length;s++){var r=this.uc[s],e=r.uc.indexOf(this);r.uc.splice(e,1)}this.uc=[],this.getScene().lights.forEach((function(t){var i=t.includedOnlyMeshes.indexOf(h);-1!==i&&t.includedOnlyMeshes.splice(i,1),-1!==(i=t.excludedMeshes.indexOf(h))&&t.excludedMeshes.splice(i,1);var n=t.getShadowGenerator();if(n){var s=n.getShadowMap();s&&s.renderList&&-1!==(i=s.renderList.indexOf(h))&&s.renderList.splice(i,1)}})),"InstancedMesh"===this.getClassName()&&"InstancedLinesMesh"===this.getClassName()||this.releaseSubMeshes();var u=this.getScene().getEngine();if(this.$f&&(this.isOcclusionQueryInProgress=!1,u.deleteQuery(this.$f),this.$f=null),u.wipeCaches(),this.getScene().removeMesh(this),n&&this.material&&("MultiMaterial"===this.material.getClassName()?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!i)for(s=0;s<this.getScene().particleSystems.length;s++)this.getScene().particleSystems[s].emitter===this&&(this.getScene().particleSystems[s].dispose(),s--);this.Jf.Xf.facetDataEnabled&&this.disableFacetData(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),t.prototype.dispose.call(this,i,n)},i.prototype.addChild=function(t){return t.setParent(this),this},i.prototype.removeChild=function(t){return t.setParent(null),this},i.prototype.Yc=function(){var t=this.Jf.Xf;t.facetNormals||(t.facetNormals=new Array),t.facetPositions||(t.facetPositions=new Array),t.facetPartitioning||(t.facetPartitioning=new Array),t.facetNb=this.getIndices().length/3|0,t.partitioningSubdivisions=t.partitioningSubdivisions?t.partitioningSubdivisions:10,t.partitioningBBoxRatio=t.partitioningBBoxRatio?t.partitioningBBoxRatio:1.01;for(var i=0;i<t.facetNb;i++)t.facetNormals[i]=o.Zero(),t.facetPositions[i]=o.Zero();return t.facetDataEnabled=!0,this},i.prototype.updateFacetData=function(){var t=this.Jf.Xf;t.facetDataEnabled||this.Yc();var i=this.getVerticesData(K.PositionKind),n=this.getIndices(),s=this.getVerticesData(K.NormalKind),h=this.getBoundingInfo();if(t.facetDepthSort&&!t.facetDepthSortEnabled){if(t.facetDepthSortEnabled=!0,n instanceof Uint16Array)t.depthSortedIndices=new Uint16Array(n);else if(n instanceof Uint32Array)t.depthSortedIndices=new Uint32Array(n);else{for(var r=!1,e=0;e<n.length;e++)if(n[e]>65535){r=!0;break}t.depthSortedIndices=r?new Uint32Array(n):new Uint16Array(n)}if(t.facetDepthSortFunction=function(t,i){return i.sqDistance-t.sqDistance},!t.facetDepthSortFrom){var u=this.getScene().activeCamera;t.facetDepthSortFrom=u?u.position:o.Zero()}t.depthSortedFacets=[];for(var f=0;f<t.facetNb;f++){var c={ind:3*f,sqDistance:0};t.depthSortedFacets.push(c)}t.invertedMatrix=a.Identity(),t.facetDepthSortOrigin=o.Zero()}t.bbSize.x=h.maximum.x-h.minimum.x>.001?h.maximum.x-h.minimum.x:.001,t.bbSize.y=h.maximum.y-h.minimum.y>.001?h.maximum.y-h.minimum.y:.001,t.bbSize.z=h.maximum.z-h.minimum.z>.001?h.maximum.z-h.minimum.z:.001;var l=t.bbSize.x>t.bbSize.y?t.bbSize.x:t.bbSize.y;if(l=l>t.bbSize.z?l:t.bbSize.z,t.subDiv.max=t.partitioningSubdivisions,t.subDiv.X=Math.floor(t.subDiv.max*t.bbSize.x/l),t.subDiv.Y=Math.floor(t.subDiv.max*t.bbSize.y/l),t.subDiv.Z=Math.floor(t.subDiv.max*t.bbSize.z/l),t.subDiv.X=t.subDiv.X<1?1:t.subDiv.X,t.subDiv.Y=t.subDiv.Y<1?1:t.subDiv.Y,t.subDiv.Z=t.subDiv.Z<1?1:t.subDiv.Z,t.facetParameters.facetNormals=this.getFacetLocalNormals(),t.facetParameters.facetPositions=this.getFacetLocalPositions(),t.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),t.facetParameters.bInfo=h,t.facetParameters.bbSize=t.bbSize,t.facetParameters.subDiv=t.subDiv,t.facetParameters.ratio=this.partitioningBBoxRatio,t.facetParameters.depthSort=t.facetDepthSort,t.facetDepthSort&&t.facetDepthSortEnabled&&(this.computeWorldMatrix(!0),this.$e.invertToRef(t.invertedMatrix),o.TransformCoordinatesToRef(t.facetDepthSortFrom,t.invertedMatrix,t.facetDepthSortOrigin),t.facetParameters.distanceTo=t.facetDepthSortOrigin),t.facetParameters.depthSortedFacets=t.depthSortedFacets,$t.ComputeNormals(i,n,s,t.facetParameters),t.facetDepthSort&&t.facetDepthSortEnabled){t.depthSortedFacets.sort(t.facetDepthSortFunction);var v=t.depthSortedIndices.length/3|0;for(f=0;f<v;f++){var b=t.depthSortedFacets[f].ind;t.depthSortedIndices[3*f]=n[b],t.depthSortedIndices[3*f+1]=n[b+1],t.depthSortedIndices[3*f+2]=n[b+2]}this.updateIndices(t.depthSortedIndices,void 0,!0)}return this},i.prototype.getFacetLocalNormals=function(){var t=this.Jf.Xf;return t.facetNormals||this.updateFacetData(),t.facetNormals},i.prototype.getFacetLocalPositions=function(){var t=this.Jf.Xf;return t.facetPositions||this.updateFacetData(),t.facetPositions},i.prototype.getFacetLocalPartitioning=function(){var t=this.Jf.Xf;return t.facetPartitioning||this.updateFacetData(),t.facetPartitioning},i.prototype.getFacetPosition=function(t){var i=o.Zero();return this.getFacetPositionToRef(t,i),i},i.prototype.getFacetPositionToRef=function(t,i){var n=this.getFacetLocalPositions()[t],s=this.getWorldMatrix();return o.TransformCoordinatesToRef(n,s,i),this},i.prototype.getFacetNormal=function(t){var i=o.Zero();return this.getFacetNormalToRef(t,i),i},i.prototype.getFacetNormalToRef=function(t,i){var n=this.getFacetLocalNormals()[t];return o.TransformNormalToRef(n,this.getWorldMatrix(),i),this},i.prototype.getFacetsAtLocalCoordinates=function(t,i,n){var s=this.getBoundingInfo(),h=this.Jf.Xf,r=Math.floor((t-s.minimum.x*h.partitioningBBoxRatio)*h.subDiv.X*h.partitioningBBoxRatio/h.bbSize.x),e=Math.floor((i-s.minimum.y*h.partitioningBBoxRatio)*h.subDiv.Y*h.partitioningBBoxRatio/h.bbSize.y),u=Math.floor((n-s.minimum.z*h.partitioningBBoxRatio)*h.subDiv.Z*h.partitioningBBoxRatio/h.bbSize.z);return r<0||r>h.subDiv.max||e<0||e>h.subDiv.max||u<0||u>h.subDiv.max?null:h.facetPartitioning[r+h.subDiv.max*e+h.subDiv.max*h.subDiv.max*u]},i.prototype.getClosestFacetAtCoordinates=function(t,i,n,s,h,r){void 0===h&&(h=!1),void 0===r&&(r=!0);var e=this.getWorldMatrix(),u=v.Matrix[5];e.invertToRef(u);var f=v.Vector3[8];o.TransformCoordinatesFromFloatsToRef(t,i,n,u,f);var c=this.getClosestFacetAtLocalCoordinates(f.x,f.y,f.z,s,h,r);return s&&o.TransformCoordinatesFromFloatsToRef(s.x,s.y,s.z,e,s),c},i.prototype.getClosestFacetAtLocalCoordinates=function(t,i,n,s,h,r){void 0===h&&(h=!1),void 0===r&&(r=!0);var e=null,u=0,o=0,f=0,c=0,a=0,l=0,v=0,b=0,d=this.getFacetLocalPositions(),g=this.getFacetLocalNormals(),w=this.getFacetsAtLocalCoordinates(t,i,n);if(!w)return null;for(var m,j,O,y=Number.MAX_VALUE,A=y,p=0;p<w.length;p++)j=g[m=w[p]],c=(t-(O=d[m]).x)*j.x+(i-O.y)*j.y+(n-O.z)*j.z,(!h||h&&r&&c>=0||h&&!r&&c<=0)&&(c=j.x*O.x+j.y*O.y+j.z*O.z,a=-(j.x*t+j.y*i+j.z*n-c)/(j.x*j.x+j.y*j.y+j.z*j.z),(A=(u=(l=t+j.x*a)-t)*u+(o=(v=i+j.y*a)-i)*o+(f=(b=n+j.z*a)-n)*f)<y&&(y=A,e=m,s&&(s.x=l,s.y=v,s.z=b)));return e},i.prototype.getFacetDataParameters=function(){return this.Jf.Xf.facetParameters},i.prototype.disableFacetData=function(){var t=this.Jf.Xf;return t.facetDataEnabled&&(t.facetDataEnabled=!1,t.facetPositions=new Array,t.facetNormals=new Array,t.facetPartitioning=new Array,t.facetParameters=null,t.depthSortedIndices=new Uint32Array(0)),this},i.prototype.updateIndices=function(t,i,n){return void 0===n&&(n=!1),this},i.prototype.createNormals=function(t){var i,n=this.getVerticesData(K.PositionKind),s=this.getIndices();return i=this.isVerticesDataPresent(K.NormalKind)?this.getVerticesData(K.NormalKind):[],$t.ComputeNormals(n,s,i,{useRightHandedSystem:this.getScene().useRightHandedSystem}),this.setVerticesData(K.NormalKind,i,t),this},i.prototype.alignWithNormal=function(t,i){i||(i=b.Y);var n=v.Vector3[0],s=v.Vector3[1];return o.CrossToRef(i,t,s),o.CrossToRef(t,s,n),this.rotationQuaternion?c.RotationQuaternionFromAxisToRef(n,t,s,this.rotationQuaternion):o.RotationFromAxisToRef(n,t,s,this.rotation),this},i.prototype.Vc=function(){return!1},i.prototype.disableEdgesRendering=function(){throw X.WarnImport("EdgesRenderer")},i.prototype.enableEdgesRendering=function(t,i){throw X.WarnImport("EdgesRenderer")},i.prototype.getConnectedParticleSystems=function(){var t=this;return this.uu.particleSystems.filter((function(i){return i.emitter===t}))},i.OCCLUSION_TYPE_NONE=0,i.OCCLUSION_TYPE_OPTIMISTIC=1,i.OCCLUSION_TYPE_STRICT=2,i.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,i.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,i.CULLINGSTRATEGY_STANDARD=0,i.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,i.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,i.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,i}(Vt),ai=function(t){function i(n,s,h,r){void 0===r&&(r=!0);var e=t.call(this,n,h)||this;return e.xu=o.Zero(),e.upVector=o.Up(),e.orthoLeft=null,e.orthoRight=null,e.orthoBottom=null,e.orthoTop=null,e.fov=.8,e.minZ=1,e.maxZ=1e4,e.inertia=.9,e.mode=i.PERSPECTIVE_CAMERA,e.isIntermediate=!1,e.viewport=new p(0,0,1,1),e.layerMask=268435455,e.fovMode=i.FOVMODE_VERTICAL_FIXED,e.cameraRigMode=i.RIG_MODE_NONE,e.customRenderTargets=new Array,e.outputRenderTarget=null,e.onViewMatrixChangedObservable=new _,e.onProjectionMatrixChangedObservable=new _,e.onAfterCheckInputsObservable=new _,e.onRestoreStateObservable=new _,e.isRigCamera=!1,e.Hc=new Array,e.zc=a.Identity(),e.Zc=!1,e.Jc=new a,e.bf=new Array,e.$c=new Tt(256),e.ta=o.Zero(),e.ia=a.Identity(),e.na=!1,e.sa=a.Zero(),e.ha=!0,e.ra=!0,e.ea=!1,e.ua=!1,e.getScene().addCamera(e),r&&!e.getScene().activeCamera&&(e.getScene().activeCamera=e),e.position=s,e}return E(i,t),Object.defineProperty(i.prototype,"position",{get:function(){return this.xu},set:function(t){this.xu=t},enumerable:!1,configurable:!0}),i.prototype.storeState=function(){return this.oa=!0,this.fa=this.fov,this},i.prototype.ca=function(){return!!this.oa&&(this.fov=this.fa,!0)},i.prototype.restoreState=function(){return!!this.ca()&&(this.onRestoreStateObservable.notifyObservers(this),!0)},i.prototype.getClassName=function(){return"Camera"},i.prototype.toString=function(t){var i="Name: "+this.name;if(i+=", type: "+this.getClassName(),this.animations)for(var n=0;n<this.animations.length;n++)i+=", animation[0]: "+this.animations[n].toString(t);return i},Object.defineProperty(i.prototype,"globalPosition",{get:function(){return this.ta},enumerable:!1,configurable:!0}),i.prototype.getActiveMeshes=function(){return this.$c},i.prototype.isActiveMesh=function(t){return-1!==this.$c.indexOf(t)},i.prototype.isReady=function(i){if(void 0===i&&(i=!1),i)for(var n=0,s=this.bf;n<s.length;n++){var h=s[n];if(h&&!h.isReady())return!1}return t.prototype.isReady.call(this,i)},i.prototype.ou=function(){t.prototype.ou.call(this),this.Ze.position=new o(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.Ze.upVector=new o(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.Ze.mode=void 0,this.Ze.minZ=void 0,this.Ze.maxZ=void 0,this.Ze.fov=void 0,this.Ze.fovMode=void 0,this.Ze.aspectRatio=void 0,this.Ze.orthoLeft=void 0,this.Ze.orthoRight=void 0,this.Ze.orthoBottom=void 0,this.Ze.orthoTop=void 0,this.Ze.renderWidth=void 0,this.Ze.renderHeight=void 0},i.prototype.du=function(i){i||t.prototype.du.call(this),this.Ze.position.copyFrom(this.position),this.Ze.upVector.copyFrom(this.upVector)},i.prototype.wu=function(){return this.aa()&&this.la()},i.prototype.aa=function(){return!!t.prototype.wu.call(this)&&(this.Ze.position.equals(this.position)&&this.Ze.upVector.equals(this.upVector)&&this.isSynchronizedWithParent())},i.prototype.la=function(){var t=this.Ze.mode===this.mode&&this.Ze.minZ===this.minZ&&this.Ze.maxZ===this.maxZ;if(!t)return!1;var n=this.getEngine();return t=this.mode===i.PERSPECTIVE_CAMERA?this.Ze.fov===this.fov&&this.Ze.fovMode===this.fovMode&&this.Ze.aspectRatio===n.getAspectRatio(this):this.Ze.orthoLeft===this.orthoLeft&&this.Ze.orthoRight===this.orthoRight&&this.Ze.orthoBottom===this.orthoBottom&&this.Ze.orthoTop===this.orthoTop&&this.Ze.renderWidth===n.getRenderWidth()&&this.Ze.renderHeight===n.getRenderHeight()},i.prototype.attachControl=function(t,i){},i.prototype.detachControl=function(t){},i.prototype.update=function(){this.va(),this.cameraRigMode!==i.RIG_MODE_NONE&&this.ba()},i.prototype.va=function(){this.onAfterCheckInputsObservable.notifyObservers(this)},Object.defineProperty(i.prototype,"rigCameras",{get:function(){return this.Hc},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"rigPostProcess",{get:function(){return this.da},enumerable:!1,configurable:!0}),i.prototype.ga=function(){for(var t=0;t<this.bf.length;t++)if(null!==this.bf[t])return this.bf[t];return null},i.prototype.wa=function(){var t=this.ga();t&&t.markTextureDirty();for(var i=0,n=this.Hc.length;i<n;i++){var s=this.Hc[i],h=s.da;if(h)"pass"===h.getEffectName()&&(s.isIntermediate=0===this.bf.length),s.bf=this.bf.slice(0).concat(h),h.markTextureDirty();else s.bf=this.bf.slice(0)}},i.prototype.attachPostProcess=function(t,i){return void 0===i&&(i=null),!t.isReusable()&&this.bf.indexOf(t)>-1?(R.Error("You're trying to reuse a post process not defined as reusable."),0):(null==i||i<0?this.bf.push(t):null===this.bf[i]?this.bf[i]=t:this.bf.splice(i,0,t),this.wa(),this.bf.indexOf(t))},i.prototype.detachPostProcess=function(t){var i=this.bf.indexOf(t);-1!==i&&(this.bf[i]=null),this.wa()},i.prototype.getWorldMatrix=function(){return this.aa()?this.$e:(this.getViewMatrix(),this.$e)},i.prototype.ma=function(){return a.Identity()},i.prototype.getViewMatrix=function(t){return!t&&this.aa()?this.ia:(this.updateCache(),this.ia=this.ma(),this.Ye=this.getScene().getRenderId(),this.He++,this.ha=!0,this.ja&&this.ja.vrPreViewMatrix&&this.ia.multiplyToRef(this.ja.vrPreViewMatrix,this.ia),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this.ia.invertToRef(this.$e),this.ia)},i.prototype.freezeProjectionMatrix=function(t){this.na=!0,void 0!==t&&(this.Jc=t)},i.prototype.unfreezeProjectionMatrix=function(){this.na=!1},i.prototype.getProjectionMatrix=function(t){var n,s,h,r,e,u,o,f;if(this.na||!t&&this.la())return this.Jc;this.Ze.mode=this.mode,this.Ze.minZ=this.minZ,this.Ze.maxZ=this.maxZ,this.ha=!0;var c=this.getEngine(),l=this.getScene();if(this.mode===i.PERSPECTIVE_CAMERA){this.Ze.fov=this.fov,this.Ze.fovMode=this.fovMode,this.Ze.aspectRatio=c.getAspectRatio(this),this.minZ<=0&&(this.minZ=.1);var v=c.useReverseDepthBuffer;(l.useRightHandedSystem?v?a.PerspectiveFovReverseRHToRef:a.PerspectiveFovRHToRef:v?a.PerspectiveFovReverseLHToRef:a.PerspectiveFovLHToRef)(this.fov,c.getAspectRatio(this),this.minZ,this.maxZ,this.Jc,this.fovMode===i.FOVMODE_VERTICAL_FIXED)}else{var b=c.getRenderWidth()/2,d=c.getRenderHeight()/2;l.useRightHandedSystem?a.OrthoOffCenterRHToRef(null!==(n=this.orthoLeft)&&void 0!==n?n:-b,null!==(s=this.orthoRight)&&void 0!==s?s:b,null!==(h=this.orthoBottom)&&void 0!==h?h:-d,null!==(r=this.orthoTop)&&void 0!==r?r:d,this.minZ,this.maxZ,this.Jc):a.OrthoOffCenterLHToRef(null!==(e=this.orthoLeft)&&void 0!==e?e:-b,null!==(u=this.orthoRight)&&void 0!==u?u:b,null!==(o=this.orthoBottom)&&void 0!==o?o:-d,null!==(f=this.orthoTop)&&void 0!==f?f:d,this.minZ,this.maxZ,this.Jc),this.Ze.orthoLeft=this.orthoLeft,this.Ze.orthoRight=this.orthoRight,this.Ze.orthoBottom=this.orthoBottom,this.Ze.orthoTop=this.orthoTop,this.Ze.renderWidth=c.getRenderWidth(),this.Ze.renderHeight=c.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this.Jc},i.prototype.getTransformationMatrix=function(){return this.ia.multiplyToRef(this.Jc,this.sa),this.sa},i.prototype.Oa=function(){this.ha&&(this.getTransformationMatrix(),this.ya?O.GetPlanesToRef(this.sa,this.ya):this.ya=O.GetPlanes(this.sa),this.ha=!1)},i.prototype.isInFrustum=function(t,i){if(void 0===i&&(i=!1),this.Oa(),i&&this.rigCameras.length>0){var n=!1;return this.rigCameras.forEach((function(i){i.Oa(),n=n||t.isInFrustum(i.ya)})),n}return t.isInFrustum(this.ya)},i.prototype.isCompletelyInFrustum=function(t){return this.Oa(),t.isCompletelyInFrustum(this.ya)},i.prototype.getForwardRay=function(t,i,n){throw void 0===t&&(t=100),X.WarnImport("Ray")},i.prototype.dispose=function(n,s){for(void 0===s&&(s=!1),this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.getScene().stopAnimation(this),this.getScene().removeCamera(this);this.Hc.length>0;){var h=this.Hc.pop();h&&h.dispose()}if(this.da)this.da.dispose(this),this.da=null,this.bf=[];else if(this.cameraRigMode!==i.RIG_MODE_NONE)this.da=null,this.bf=[];else for(var r=this.bf.length;--r>=0;){var e=this.bf[r];e&&e.dispose(this)}for(r=this.customRenderTargets.length;--r>=0;)this.customRenderTargets[r].dispose();this.customRenderTargets=[],this.$c.dispose(),t.prototype.dispose.call(this,n,s)},Object.defineProperty(i.prototype,"isLeftCamera",{get:function(){return this.ea},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isRightCamera",{get:function(){return this.ua},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"leftCamera",{get:function(){return this.Hc.length<1?null:this.Hc[0]},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"rightCamera",{get:function(){return this.Hc.length<2?null:this.Hc[1]},enumerable:!1,configurable:!0}),i.prototype.getLeftTarget=function(){return this.Hc.length<1?null:this.Hc[0].getTarget()},i.prototype.getRightTarget=function(){return this.Hc.length<2?null:this.Hc[1].getTarget()},i.prototype.setCameraRigMode=function(t,n){if(this.cameraRigMode!==t){for(;this.Hc.length>0;){var s=this.Hc.pop();s&&s.dispose()}if(this.cameraRigMode=t,this.ja={},this.ja.interaxialDistance=n.interaxialDistance||.0637,this.ja.stereoHalfAngle=Et.ToRadians(this.ja.interaxialDistance/.0637),this.cameraRigMode!==i.RIG_MODE_NONE){var h=this.createRigCamera(this.name+"_L",0);h&&(h.ea=!0);var r=this.createRigCamera(this.name+"_R",1);r&&(r.ua=!0),h&&r&&(this.Hc.push(h),this.Hc.push(r))}switch(this.cameraRigMode){case i.RIG_MODE_STEREOSCOPIC_ANAGLYPH:i.Aa(this);break;case i.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case i.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case i.RIG_MODE_STEREOSCOPIC_OVERUNDER:case i.RIG_MODE_STEREOSCOPIC_INTERLACED:i.pa(this);break;case i.RIG_MODE_VR:i.Ma(this,n);break;case i.RIG_MODE_WEBVR:i.Ka(this,n)}this.wa(),this.update()}},i.pa=function(t){throw"Import Cameras/RigModes/stereoscopicRigMode before using stereoscopic rig mode"},i.Aa=function(t){throw"Import Cameras/RigModes/stereoscopicAnaglyphRigMode before using stereoscopic anaglyph rig mode"},i.Ma=function(t,i){throw"Import Cameras/RigModes/vrRigMode before using VR rig mode"},i.Ka=function(t,i){throw"Import Cameras/RigModes/WebVRRigMode before using Web VR rig mode"},i.prototype.Pa=function(){return a.PerspectiveFovLHToRef(this.ja.vrMetrics.aspectRatioFov,this.ja.vrMetrics.aspectRatio,this.minZ,this.maxZ,this.ja.vrWorkMatrix),this.ja.vrWorkMatrix.multiplyToRef(this.ja.vrHMatrix,this.Jc),this.Jc},i.prototype.xa=function(){},i.prototype.ka=function(){},i.prototype.Ea=function(){return a.Identity()},i.prototype.Ta=function(){return a.Identity()},i.prototype.setCameraRigParameter=function(t,i){this.ja||(this.ja={}),this.ja[t]=i,"interaxialDistance"===t&&(this.ja.stereoHalfAngle=Et.ToRadians(i/.0637))},i.prototype.createRigCamera=function(t,i){return null},i.prototype.ba=function(){for(var t=0;t<this.Hc.length;t++)this.Hc[t].minZ=this.minZ,this.Hc[t].maxZ=this.maxZ,this.Hc[t].fov=this.fov,this.Hc[t].upVector.copyFrom(this.upVector);this.cameraRigMode===i.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this.Hc[0].viewport=this.Hc[1].viewport=this.viewport)},i.prototype.Ba=function(){},i.prototype.serialize=function(){var t=Qt.Serialize(this);return t.type=this.getClassName(),this.parent&&(t.parentId=this.parent.id),this.inputs&&this.inputs.serialize(t),Qt.AppendSerializedAnimations(this,t),t.ranges=this.serializeAnimationRanges(),t},i.prototype.clone=function(t){return Qt.Clone(i.GetConstructorFromName(this.getClassName(),t,this.getScene(),this.interaxialDistance,this.isStereoscopicSideBySide),this)},i.prototype.getDirection=function(t){var i=o.Zero();return this.getDirectionToRef(t,i),i},Object.defineProperty(i.prototype,"absoluteRotation",{get:function(){var t=c.Zero();return this.getWorldMatrix().decompose(void 0,t),t},enumerable:!1,configurable:!0}),i.prototype.getDirectionToRef=function(t,i){o.TransformNormalToRef(t,this.getWorldMatrix(),i)},i.GetConstructorFromName=function(t,n,s,h,r){void 0===h&&(h=0),void 0===r&&(r=!0);var e=Yt.Construct(t,n,s,{interaxial_distance:h,isStereoscopicSideBySide:r});return e||function(){return i.Fa(n,s)}},i.prototype.computeWorldMatrix=function(){return this.getWorldMatrix()},i.Parse=function(t,n){var s=t.type,h=i.GetConstructorFromName(s,t.name,n,t.interaxial_distance,t.isStereoscopicSideBySide),r=Qt.Parse(h,t,n);if(t.parentId&&(r.ze=t.parentId),r.inputs&&(r.inputs.parse(t),r.Ba()),r.setPosition&&(r.position.copyFromFloats(0,0,0),r.setPosition(o.FromArray(t.position))),t.target&&r.setTarget&&r.setTarget(o.FromArray(t.target)),t.cameraRigMode){var u=t.interaxial_distance?{interaxialDistance:t.interaxial_distance}:{};r.setCameraRigMode(t.cameraRigMode,u)}if(t.animations){for(var f=0;f<t.animations.length;f++){var c=t.animations[f],a=e.GetClass("BABYLON.Animation");a&&r.animations.push(a.Parse(c))}Yt.ParseAnimationRanges(r,t,n)}return t.autoAnimate&&n.beginAnimation(r,t.autoAnimateFrom,t.autoAnimateTo,t.autoAnimateLoop,t.autoAnimateSpeed||1),r},i.Fa=function(t,i){throw X.WarnImport("UniversalCamera")},i.PERSPECTIVE_CAMERA=0,i.ORTHOGRAPHIC_CAMERA=1,i.FOVMODE_VERTICAL_FIXED=0,i.FOVMODE_HORIZONTAL_FIXED=1,i.RIG_MODE_NONE=0,i.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,i.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,i.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,i.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,i.RIG_MODE_STEREOSCOPIC_INTERLACED=14,i.RIG_MODE_VR=20,i.RIG_MODE_WEBVR=21,i.RIG_MODE_CUSTOM=22,i.ForceAttachControlToAlwaysPreventDefault=!1,B([Gt("position")],i.prototype,"_position",void 0),B([Gt()],i.prototype,"upVector",void 0),B([Nt()],i.prototype,"orthoLeft",void 0),B([Nt()],i.prototype,"orthoRight",void 0),B([Nt()],i.prototype,"orthoBottom",void 0),B([Nt()],i.prototype,"orthoTop",void 0),B([Nt()],i.prototype,"fov",void 0),B([Nt()],i.prototype,"minZ",void 0),B([Nt()],i.prototype,"maxZ",void 0),B([Nt()],i.prototype,"inertia",void 0),B([Nt()],i.prototype,"mode",void 0),B([Nt()],i.prototype,"layerMask",void 0),B([Nt()],i.prototype,"fovMode",void 0),B([Nt()],i.prototype,"cameraRigMode",void 0),B([Nt()],i.prototype,"interaxialDistance",void 0),B([Nt()],i.prototype,"isStereoscopicSideBySide",void 0),i}(Yt),li=function(){function t(){this.rootNodes=new Array,this.cameras=new Array,this.lights=new Array,this.meshes=new Array,this.skeletons=new Array,this.particleSystems=new Array,this.animations=[],this.animationGroups=new Array,this.multiMaterials=new Array,this.materials=new Array,this.morphTargetManagers=new Array,this.geometries=new Array,this.transformNodes=new Array,this.actionManagers=new Array,this.textures=new Array,this.environmentTexture=null}return t.AddParser=function(t,i){this.Ca[t]=i},t.GetParser=function(t){return this.Ca[t]?this.Ca[t]:null},t.AddIndividualParser=function(t,i){this._a[t]=i},t.GetIndividualParser=function(t){return this._a[t]?this._a[t]:null},t.Parse=function(t,i,n,s){for(var h in this.Ca)this.Ca.hasOwnProperty(h)&&this.Ca[h](t,i,n,s)},t.prototype.getNodes=function(){var t=new Array;return t=(t=(t=(t=t.concat(this.meshes)).concat(this.lights)).concat(this.cameras)).concat(this.transformNodes),this.skeletons.forEach((function(i){return t=t.concat(i.bones)})),t},t.Ca={},t._a={},t}(),vi=function(){function t(){this.u=!0,this.Ua=!0,this.Ra=!1,this.Sa=!0,this.La=!0,this.Da=!0,this.Ia=!0,this.Na=!0,this.H=!1,this.Xa=!1,this.Wa=!1,this.Ga=!1}return Object.defineProperty(t.prototype,"isDirty",{get:function(){return this.u},enumerable:!1,configurable:!0}),t.prototype.markAsProcessed=function(){this.u=!1,this.Sa=!1,this.La=!1,this.Da=!1,this.Ua=!1,this.Ra=!1,this.Ia=!1,this.Na=!1},t.prototype.markAsUnprocessed=function(){this.u=!0},t.prototype.markAllAsDirty=function(){this.La=!0,this.Sa=!0,this.Ua=!0,this.Da=!0,this.Ia=!0,this.Na=!0,this.u=!0},t.prototype.markAsImageProcessingDirty=function(){this.Na=!0,this.u=!0},t.prototype.markAsLightDirty=function(t){void 0===t&&(t=!1),this.Ua=!0,this.Ra=this.Ra||t,this.u=!0},t.prototype.markAsAttributesDirty=function(){this.Sa=!0,this.u=!0},t.prototype.markAsTexturesDirty=function(){this.La=!0,this.u=!0},t.prototype.markAsFresnelDirty=function(){this.Da=!0,this.u=!0},t.prototype.markAsMiscDirty=function(){this.Ia=!0,this.u=!0},t.prototype.rebuild=function(){this.qa&&delete this.qa,this.qa=[];for(var t=0,i=Object.keys(this);t<i.length;t++){var n=i[t];"_"!==n[0]&&this.qa.push(n)}},t.prototype.isEqual=function(t){if(this.qa.length!==t.qa.length)return!1;for(var i=0;i<this.qa.length;i++){var n=this.qa[i];if(this[n]!==t[n])return!1}return!0},t.prototype.cloneTo=function(t){this.qa.length!==t.qa.length&&(t.qa=this.qa.slice(0));for(var i=0;i<this.qa.length;i++){var n=this.qa[i];t[n]=this[n]}},t.prototype.reset=function(){for(var t=0;t<this.qa.length;t++){var i=this.qa[t];switch(typeof this[i]){case"number":this[i]=0;break;case"string":this[i]="";break;default:this[i]=!1}}},t.prototype.toString=function(){for(var t="",i=0;i<this.qa.length;i++){var n=this.qa[i],s=this[n];switch(typeof s){case"number":case"string":t+="#define "+n+" "+s+"\n";break;default:s&&(t+="#define "+n+"\n")}}return t},t}(),bi=function(){function t(){this.Qa=!0,this.Ya=new g(0,0,0,0),this.Va=new g(0,0,0,0),this.Ha=new g(0,0,0,0),this.za=new g(0,0,0,0),this.Za=new g(0,0,0,0),this.Ja=new g(0,0,0,0),this.$a=new g(0,0,0,0),this.tl=30,this.il=0,this.nl=0,this.sl=0,this.hl=30,this.rl=0,this.el=0,this.ul=0,this.ol=30,this.fl=0,this.cl=0,this.al=0,this.ll=30,this.vl=0,this.bl=0,this.dl=0}return Object.defineProperty(t.prototype,"globalHue",{get:function(){return this.tl},set:function(t){this.tl=t,this.Qa=!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"globalDensity",{get:function(){return this.il},set:function(t){this.il=t,this.Qa=!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"globalSaturation",{get:function(){return this.nl},set:function(t){this.nl=t,this.Qa=!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"globalExposure",{get:function(){return this.sl},set:function(t){this.sl=t,this.Qa=!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"highlightsHue",{get:function(){return this.hl},set:function(t){this.hl=t,this.Qa=!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"highlightsDensity",{get:function(){return this.rl},set:function(t){this.rl=t,this.Qa=!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"highlightsSaturation",{get:function(){return this.el},set:function(t){this.el=t,this.Qa=!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"highlightsExposure",{get:function(){return this.ul},set:function(t){this.ul=t,this.Qa=!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"midtonesHue",{get:function(){return this.ol},set:function(t){this.ol=t,this.Qa=!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"midtonesDensity",{get:function(){return this.fl},set:function(t){this.fl=t,this.Qa=!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"midtonesSaturation",{get:function(){return this.cl},set:function(t){this.cl=t,this.Qa=!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"midtonesExposure",{get:function(){return this.al},set:function(t){this.al=t,this.Qa=!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shadowsHue",{get:function(){return this.ll},set:function(t){this.ll=t,this.Qa=!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shadowsDensity",{get:function(){return this.vl},set:function(t){this.vl=t,this.Qa=!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shadowsSaturation",{get:function(){return this.bl},set:function(t){this.bl=t,this.Qa=!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shadowsExposure",{get:function(){return this.dl},set:function(t){this.dl=t,this.Qa=!0},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"ColorCurves"},t.Bind=function(t,i,n,s,h){void 0===n&&(n="vCameraColorCurvePositive"),void 0===s&&(s="vCameraColorCurveNeutral"),void 0===h&&(h="vCameraColorCurveNegative"),t.Qa&&(t.Qa=!1,t.getColorGradingDataToRef(t.tl,t.il,t.nl,t.sl,t.Va),t.getColorGradingDataToRef(t.hl,t.rl,t.el,t.ul,t.Ya),t.Ya.multiplyToRef(t.Va,t.Ha),t.getColorGradingDataToRef(t.ol,t.fl,t.cl,t.al,t.Ya),t.Ya.multiplyToRef(t.Va,t.za),t.getColorGradingDataToRef(t.ll,t.vl,t.bl,t.dl,t.Ya),t.Ya.multiplyToRef(t.Va,t.Za),t.Ha.subtractToRef(t.za,t.Ja),t.za.subtractToRef(t.Za,t.$a)),i&&(i.setFloat4(n,t.Ja.r,t.Ja.g,t.Ja.b,t.Ja.a),i.setFloat4(s,t.za.r,t.za.g,t.za.b,t.za.a),i.setFloat4(h,t.$a.r,t.$a.g,t.$a.b,t.$a.a))},t.PrepareUniforms=function(t){t.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")},t.prototype.getColorGradingDataToRef=function(i,n,s,h,r){null!=i&&(i=t.clamp(i,0,360),n=t.clamp(n,-100,100),s=t.clamp(s,-100,100),h=t.clamp(h,-100,100),n=t.applyColorGradingSliderNonlinear(n),n*=.5,h=t.applyColorGradingSliderNonlinear(h),n<0&&(n*=-1,i=(i+180)%360),t.fromHSBToRef(i,n,50+.25*h,r),r.scaleToRef(2,r),r.a=1+.01*s)},t.applyColorGradingSliderNonlinear=function(t){t/=100;var i=Math.abs(t);return i=Math.pow(i,2),t<0&&(i*=-1),i*=100},t.fromHSBToRef=function(i,n,s,h){var r=t.clamp(i,0,360),e=t.clamp(n/100,0,1),u=t.clamp(s/100,0,1);if(0===e)h.r=u,h.g=u,h.b=u;else{r/=60;var o=Math.floor(r),f=r-o,c=u*(1-e),a=u*(1-e*f),l=u*(1-e*(1-f));switch(o){case 0:h.r=u,h.g=l,h.b=c;break;case 1:h.r=a,h.g=u,h.b=c;break;case 2:h.r=c,h.g=u,h.b=l;break;case 3:h.r=c,h.g=a,h.b=u;break;case 4:h.r=l,h.g=c,h.b=u;break;default:h.r=u,h.g=c,h.b=a}}h.a=1},t.clamp=function(t,i,n){return Math.min(Math.max(t,i),n)},t.prototype.clone=function(){return Qt.Clone((function(){return new t}),this)},t.prototype.serialize=function(){return Qt.Serialize(this)},t.Parse=function(i){return Qt.Parse((function(){return new t}),i,null,null)},B([Nt()],t.prototype,"_globalHue",void 0),B([Nt()],t.prototype,"_globalDensity",void 0),B([Nt()],t.prototype,"_globalSaturation",void 0),B([Nt()],t.prototype,"_globalExposure",void 0),B([Nt()],t.prototype,"_highlightsHue",void 0),B([Nt()],t.prototype,"_highlightsDensity",void 0),B([Nt()],t.prototype,"_highlightsSaturation",void 0),B([Nt()],t.prototype,"_highlightsExposure",void 0),B([Nt()],t.prototype,"_midtonesHue",void 0),B([Nt()],t.prototype,"_midtonesDensity",void 0),B([Nt()],t.prototype,"_midtonesSaturation",void 0),B([Nt()],t.prototype,"_midtonesExposure",void 0),t}();Qt.Ie=bi.Parse;!function(t){function i(){var i=t.call(this)||this;return i.IMAGEPROCESSING=!1,i.VIGNETTE=!1,i.VIGNETTEBLENDMODEMULTIPLY=!1,i.VIGNETTEBLENDMODEOPAQUE=!1,i.TONEMAPPING=!1,i.TONEMAPPING_ACES=!1,i.CONTRAST=!1,i.COLORCURVES=!1,i.COLORGRADING=!1,i.COLORGRADING3D=!1,i.SAMPLER3DGREENDEPTH=!1,i.SAMPLER3DBGRMAP=!1,i.IMAGEPROCESSINGPOSTPROCESS=!1,i.EXPOSURE=!1,i.rebuild(),i}E(i,t)}(vi);var di=function(){function t(){this.colorCurves=new bi,this.gl=!1,this.wl=!1,this.ml=!0,this.jl=!0,this.Ol=1,this.yl=!1,this.Al=t.TONEMAPPING_STANDARD,this.pl=1,this.vignetteStretch=0,this.vignetteCentreX=0,this.vignetteCentreY=0,this.vignetteWeight=1.5,this.vignetteColor=new g(0,0,0,0),this.vignetteCameraFov=.5,this.Ml=t.VIGNETTEMODE_MULTIPLY,this.Kl=!1,this.Pl=!1,this.qe=!0,this.onUpdateParameters=new _}var i;return Object.defineProperty(t.prototype,"colorCurvesEnabled",{get:function(){return this.gl},set:function(t){this.gl!==t&&(this.gl=t,this.xl())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"colorGradingTexture",{get:function(){return this.kl},set:function(t){this.kl!==t&&(this.kl=t,this.xl())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"colorGradingEnabled",{get:function(){return this.wl},set:function(t){this.wl!==t&&(this.wl=t,this.xl())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"colorGradingWithGreenDepth",{get:function(){return this.ml},set:function(t){this.ml!==t&&(this.ml=t,this.xl())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"colorGradingBGR",{get:function(){return this.jl},set:function(t){this.jl!==t&&(this.jl=t,this.xl())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"exposure",{get:function(){return this.Ol},set:function(t){this.Ol!==t&&(this.Ol=t,this.xl())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"toneMappingEnabled",{get:function(){return this.yl},set:function(t){this.yl!==t&&(this.yl=t,this.xl())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"toneMappingType",{get:function(){return this.Al},set:function(t){this.Al!==t&&(this.Al=t,this.xl())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"contrast",{get:function(){return this.pl},set:function(t){this.pl!==t&&(this.pl=t,this.xl())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vignetteBlendMode",{get:function(){return this.Ml},set:function(t){this.Ml!==t&&(this.Ml=t,this.xl())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vignetteEnabled",{get:function(){return this.Kl},set:function(t){this.Kl!==t&&(this.Kl=t,this.xl())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"applyByPostProcess",{get:function(){return this.Pl},set:function(t){this.Pl!==t&&(this.Pl=t,this.xl())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isEnabled",{get:function(){return this.qe},set:function(t){this.qe!==t&&(this.qe=t,this.xl())},enumerable:!1,configurable:!0}),t.prototype.xl=function(){this.onUpdateParameters.notifyObservers(this)},t.prototype.getClassName=function(){return"ImageProcessingConfiguration"},t.PrepareUniforms=function(t,i){i.EXPOSURE&&t.push("exposureLinear"),i.CONTRAST&&t.push("contrast"),i.COLORGRADING&&t.push("colorTransformSettings"),i.VIGNETTE&&(t.push("vInverseScreenSize"),t.push("vignetteSettings1"),t.push("vignetteSettings2")),i.COLORCURVES&&bi.PrepareUniforms(t)},t.PrepareSamplers=function(t,i){i.COLORGRADING&&t.push("txColorTransform")},t.prototype.prepareDefines=function(i,n){if(void 0===n&&(n=!1),n!==this.applyByPostProcess||!this.qe)return i.VIGNETTE=!1,i.TONEMAPPING=!1,i.TONEMAPPING_ACES=!1,i.CONTRAST=!1,i.EXPOSURE=!1,i.COLORCURVES=!1,i.COLORGRADING=!1,i.COLORGRADING3D=!1,i.IMAGEPROCESSING=!1,void(i.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this.qe);switch(i.VIGNETTE=this.vignetteEnabled,i.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===t.El,i.VIGNETTEBLENDMODEOPAQUE=!i.VIGNETTEBLENDMODEMULTIPLY,i.TONEMAPPING=this.toneMappingEnabled,this.Al){case t.TONEMAPPING_ACES:i.TONEMAPPING_ACES=!0;break;default:i.TONEMAPPING_ACES=!1}i.CONTRAST=1!==this.contrast,i.EXPOSURE=1!==this.exposure,i.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,i.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,i.COLORGRADING?i.COLORGRADING3D=this.colorGradingTexture.is3D:i.COLORGRADING3D=!1,i.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,i.SAMPLER3DBGRMAP=this.colorGradingBGR,i.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,i.IMAGEPROCESSING=i.VIGNETTE||i.TONEMAPPING||i.CONTRAST||i.EXPOSURE||i.COLORCURVES||i.COLORGRADING},t.prototype.isReady=function(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()},t.prototype.bind=function(t,i){if(this.gl&&this.colorCurves&&bi.Bind(this.colorCurves,t),this.Kl){var n=1/t.getEngine().getRenderWidth(),s=1/t.getEngine().getRenderHeight();t.setFloat2("vInverseScreenSize",n,s);var h=null!=i?i:s/n,r=Math.tan(.5*this.vignetteCameraFov),e=r*h,u=Math.sqrt(e*r);e=Et.Mix(e,u,this.vignetteStretch),r=Et.Mix(r,u,this.vignetteStretch),t.setFloat4("vignetteSettings1",e,r,-e*this.vignetteCentreX,-r*this.vignetteCentreY);var o=-2*this.vignetteWeight;t.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,o)}if(t.setFloat("exposureLinear",this.exposure),t.setFloat("contrast",this.contrast),this.colorGradingTexture){t.setTexture("txColorTransform",this.colorGradingTexture);var f=this.colorGradingTexture.getSize().height;t.setFloat4("colorTransformSettings",(f-1)/f,.5/f,f,this.colorGradingTexture.level)}},t.prototype.clone=function(){return Qt.Clone((function(){return new t}),this)},t.prototype.serialize=function(){return Qt.Serialize(this)},t.Parse=function(i){return Qt.Parse((function(){return new t}),i,null,null)},Object.defineProperty(t,"VIGNETTEMODE_MULTIPLY",{get:function(){return this.El},enumerable:!1,configurable:!0}),Object.defineProperty(t,"VIGNETTEMODE_OPAQUE",{get:function(){return this.Tl},enumerable:!1,configurable:!0}),t.TONEMAPPING_STANDARD=0,t.TONEMAPPING_ACES=1,t.El=0,t.Tl=1,B([Dt(7,i)],t.prototype,"colorCurves",void 0),B([Nt()],t.prototype,"_colorCurvesEnabled",void 0),B([Xt("colorGradingTexture")],t.prototype,"_colorGradingTexture",void 0),B([Nt()],t.prototype,"_colorGradingEnabled",void 0),B([Nt()],t.prototype,"_colorGradingWithGreenDepth",void 0),B([Nt()],t.prototype,"_colorGradingBGR",void 0),B([Nt()],t.prototype,"_exposure",void 0),B([Nt()],t.prototype,"_toneMappingEnabled",void 0),B([Nt()],t.prototype,"_toneMappingType",void 0),B([Nt()],t.prototype,"_contrast",void 0),B([Nt()],t.prototype,"vignetteStretch",void 0),B([Nt()],t.prototype,"vignetteCentreX",void 0),B([Nt()],t.prototype,"vignetteCentreY",void 0),B([Nt()],t.prototype,"vignetteWeight",void 0),B([qt()],t.prototype,"vignetteColor",void 0),B([Nt()],t.prototype,"vignetteCameraFov",void 0),B([Nt()],t.prototype,"_vignetteBlendMode",void 0),B([Nt()],t.prototype,"_vignetteEnabled",void 0),B([Nt()],t.prototype,"_applyByPostProcess",void 0),B([Nt()],t.prototype,"_isEnabled",void 0),t}();Qt.Ne=di.Parse,mt.prototype.createUniformBuffer=function(t){var i=this.gh.createBuffer();if(!i)throw new Error("Unable to create uniform buffer");var n=new bt(i);return this.bindUniformBuffer(n),t instanceof Float32Array?this.gh.bufferData(this.gh.UNIFORM_BUFFER,t,this.gh.STATIC_DRAW):this.gh.bufferData(this.gh.UNIFORM_BUFFER,new Float32Array(t),this.gh.STATIC_DRAW),this.bindUniformBuffer(null),n.references=1,n},mt.prototype.createDynamicUniformBuffer=function(t){var i=this.gh.createBuffer();if(!i)throw new Error("Unable to create dynamic uniform buffer");var n=new bt(i);return this.bindUniformBuffer(n),t instanceof Float32Array?this.gh.bufferData(this.gh.UNIFORM_BUFFER,t,this.gh.DYNAMIC_DRAW):this.gh.bufferData(this.gh.UNIFORM_BUFFER,new Float32Array(t),this.gh.DYNAMIC_DRAW),this.bindUniformBuffer(null),n.references=1,n},mt.prototype.updateUniformBuffer=function(t,i,n,s){this.bindUniformBuffer(t),void 0===n&&(n=0),void 0===s?i instanceof Float32Array?this.gh.bufferSubData(this.gh.UNIFORM_BUFFER,n,i):this.gh.bufferSubData(this.gh.UNIFORM_BUFFER,n,new Float32Array(i)):i instanceof Float32Array?this.gh.bufferSubData(this.gh.UNIFORM_BUFFER,0,i.subarray(n,n+s)):this.gh.bufferSubData(this.gh.UNIFORM_BUFFER,0,new Float32Array(i).subarray(n,n+s)),this.bindUniformBuffer(null)},mt.prototype.bindUniformBuffer=function(t){this.gh.bindBuffer(this.gh.UNIFORM_BUFFER,t?t.underlyingResource:null)},mt.prototype.bindUniformBufferBase=function(t,i){this.gh.bindBufferBase(this.gh.UNIFORM_BUFFER,i,t?t.underlyingResource:null)},mt.prototype.bindUniformBlock=function(t,i,n){var s=t.program,h=this.gh.getUniformBlockIndex(s,i);this.gh.uniformBlockBinding(s,h,n)};var gi=function(){function t(t,i,n){this.Bl=!1,this.Mi={},this.ct=t,this.Fl=!t.supportsUniformBuffers,this.Cl=n,this.bt=i||[],this._l={},this.Ul={},this.Rl=0,this.Sl=!1,this.Fl?(this.updateMatrix3x3=this.Ll,this.updateMatrix2x2=this.Dl,this.updateFloat=this.Il,this.updateFloat2=this.Nl,this.updateFloat3=this.Xl,this.updateFloat4=this.Wl,this.updateMatrix=this.Gl,this.updateVector3=this.ql,this.updateVector4=this.Ql,this.updateColor3=this.Yl,this.updateColor4=this.Vl):(this.ct.Ts.push(this),this.updateMatrix3x3=this.Hl,this.updateMatrix2x2=this.zl,this.updateFloat=this.Zl,this.updateFloat2=this.Jl,this.updateFloat3=this.$l,this.updateFloat4=this.tv,this.updateMatrix=this.iv,this.updateVector3=this.nv,this.updateVector4=this.sv,this.updateColor3=this.hv,this.updateColor4=this.rv)}return Object.defineProperty(t.prototype,"useUbo",{get:function(){return!this.Fl},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isSync",{get:function(){return!this.Sl},enumerable:!1,configurable:!0}),t.prototype.isDynamic=function(){return void 0!==this.Cl},t.prototype.getData=function(){return this.ev},t.prototype.getBuffer=function(){return this.dt},t.prototype.ov=function(t){var i;if(i=t<=2?t:4,this.Rl%i!=0){var n=this.Rl;this.Rl+=i-this.Rl%i;for(var s=this.Rl-n,h=0;h<s;h++)this.bt.push(0)}},t.prototype.addUniform=function(t,i){if(!this.Fl&&void 0===this._l[t]){var n;if(i instanceof Array)i=(n=i).length;else{i=i,n=[];for(var s=0;s<i;s++)n.push(0)}this.ov(i),this.Ul[t]=i,this._l[t]=this.Rl,this.Rl+=i;for(s=0;s<i;s++)this.bt.push(n[s]);this.Sl=!0}},t.prototype.addMatrix=function(t,i){this.addUniform(t,Array.prototype.slice.call(i.toArray()))},t.prototype.addFloat2=function(t,i,n){var s=[i,n];this.addUniform(t,s)},t.prototype.addFloat3=function(t,i,n,s){var h=[i,n,s];this.addUniform(t,h)},t.prototype.addColor3=function(t,i){var n=new Array;i.toArray(n),this.addUniform(t,n)},t.prototype.addColor4=function(t,i,n){var s=new Array;i.toArray(s),s.push(n),this.addUniform(t,s)},t.prototype.addVector3=function(t,i){var n=new Array;i.toArray(n),this.addUniform(t,n)},t.prototype.addMatrix3x3=function(t){this.addUniform(t,12)},t.prototype.addMatrix2x2=function(t){this.addUniform(t,8)},t.prototype.create=function(){this.Fl||this.dt||(this.ov(4),this.ev=new Float32Array(this.bt),this.gt(),this.Sl=!0)},t.prototype.gt=function(){!this.Fl&&this.ev&&(this.Cl?this.dt=this.ct.createDynamicUniformBuffer(this.ev):this.dt=this.ct.createUniformBuffer(this.ev))},t.prototype.update=function(){this.dt?(this.Cl||this.Sl)&&(this.ct.updateUniformBuffer(this.dt,this.ev),this.Sl=!1):this.create()},t.prototype.updateUniform=function(t,i,n){var s=this._l[t];if(void 0===s){if(this.dt)return void R.Error("Cannot add an uniform after UBO has been created.");this.addUniform(t,n),s=this._l[t]}if(this.dt||this.create(),this.Cl)for(r=0;r<n;r++)this.ev[s+r]=i[r];else{for(var h=!1,r=0;r<n;r++)16!==n&&this.ev[s+r]===i[r]||(h=!0,this.ev[s+r]=i[r]);this.Sl=this.Sl||h}},t.prototype.Zi=function(t,i){var n=this.Mi[t],s=i.updateFlag;return(void 0===n||n!==s)&&(this.Mi[t]=s,!0)},t.prototype.Hl=function(i,n){for(var s=0;s<3;s++)t.fv[4*s]=n[3*s],t.fv[4*s+1]=n[3*s+1],t.fv[4*s+2]=n[3*s+2],t.fv[4*s+3]=0;this.updateUniform(i,t.fv,12)},t.prototype.Ll=function(t,i){this.cr.setMatrix3x3(t,i)},t.prototype.Dl=function(t,i){this.cr.setMatrix2x2(t,i)},t.prototype.zl=function(i,n){for(var s=0;s<2;s++)t.fv[4*s]=n[2*s],t.fv[4*s+1]=n[2*s+1],t.fv[4*s+2]=0,t.fv[4*s+3]=0;this.updateUniform(i,t.fv,8)},t.prototype.Il=function(t,i){this.cr.setFloat(t,i)},t.prototype.Zl=function(i,n){t.fv[0]=n,this.updateUniform(i,t.fv,1)},t.prototype.Nl=function(t,i,n,s){void 0===s&&(s=""),this.cr.setFloat2(t+s,i,n)},t.prototype.Jl=function(i,n,s){t.fv[0]=n,t.fv[1]=s,this.updateUniform(i,t.fv,2)},t.prototype.Xl=function(t,i,n,s,h){void 0===h&&(h=""),this.cr.setFloat3(t+h,i,n,s)},t.prototype.$l=function(i,n,s,h){t.fv[0]=n,t.fv[1]=s,t.fv[2]=h,this.updateUniform(i,t.fv,3)},t.prototype.Wl=function(t,i,n,s,h,r){void 0===r&&(r=""),this.cr.setFloat4(t+r,i,n,s,h)},t.prototype.tv=function(i,n,s,h,r){t.fv[0]=n,t.fv[1]=s,t.fv[2]=h,t.fv[3]=r,this.updateUniform(i,t.fv,4)},t.prototype.Gl=function(t,i){this.cr.setMatrix(t,i)},t.prototype.iv=function(t,i){this.Zi(t,i)&&this.updateUniform(t,i.toArray(),16)},t.prototype.ql=function(t,i){this.cr.setVector3(t,i)},t.prototype.nv=function(i,n){n.toArray(t.fv),this.updateUniform(i,t.fv,3)},t.prototype.Ql=function(t,i){this.cr.setVector4(t,i)},t.prototype.sv=function(i,n){n.toArray(t.fv),this.updateUniform(i,t.fv,4)},t.prototype.Yl=function(t,i,n){void 0===n&&(n=""),this.cr.setColor3(t+n,i)},t.prototype.hv=function(i,n){n.toArray(t.fv),this.updateUniform(i,t.fv,3)},t.prototype.Vl=function(t,i,n,s){void 0===s&&(s=""),this.cr.setColor4(t+s,i,n)},t.prototype.rv=function(i,n,s){n.toArray(t.fv),t.fv[3]=s,this.updateUniform(i,t.fv,4)},t.prototype.setTexture=function(t,i){this.cr.setTexture(t,i)},t.prototype.updateUniformDirectly=function(t,i){this.updateUniform(t,i,i.length),this.update()},t.prototype.bindToEffect=function(t,i){this.cr=t,!this.Fl&&this.dt&&(this.Bl=!0,t.bindUniformBuffer(this.dt,i))},t.prototype.dispose=function(){if(!this.Fl){var t=this.ct.Ts,i=t.indexOf(this);-1!==i&&(t[i]=t[t.length-1],t.pop()),this.dt&&this.ct.wt(this.dt)&&(this.dt=null)}},t.cv=256,t.fv=new Float32Array(t.cv),t}(),wi=function(t){function i(n,s){var h=t.call(this,n,s)||this;return h.diffuse=new d(1,1,1),h.specular=new d(1,1,1),h.falloffType=i.FALLOFF_DEFAULT,h.intensity=1,h.av=Number.MAX_VALUE,h.lv=0,h.vv=1,h.dv=i.INTENSITYMODE_AUTOMATIC,h.Ic=1e-5,h.renderPriority=0,h.gv=!0,h.wv=0,h.mv=0,h.jv=0,h.Ov=new Array,h.yv=new Array,h.Av=!0,h.getScene().addLight(h),h.pv=new gi(h.getScene().getEngine()),h.Mv(),h.includedOnlyMeshes=new Array,h.excludedMeshes=new Array,h.Kv(),h}return E(i,t),Object.defineProperty(i.prototype,"range",{get:function(){return this.av},set:function(t){this.av=t,this.lv=1/(this.range*this.range)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"intensityMode",{get:function(){return this.dv},set:function(t){this.dv=t,this.Pv()},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"radius",{get:function(){return this.Ic},set:function(t){this.Ic=t,this.Pv()},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"shadowEnabled",{get:function(){return this.gv},set:function(t){this.gv!==t&&(this.gv=t,this.xv())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"includedOnlyMeshes",{get:function(){return this.kv},set:function(t){this.kv=t,this.Ev(t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"excludedMeshes",{get:function(){return this.Tv},set:function(t){this.Tv=t,this.Bv(t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"excludeWithLayerMask",{get:function(){return this.wv},set:function(t){this.wv=t,this.Kv()},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"includeOnlyWithLayerMask",{get:function(){return this.mv},set:function(t){this.mv=t,this.Kv()},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"lightmapMode",{get:function(){return this.jv},set:function(t){this.jv!==t&&(this.jv=t,this.xv())},enumerable:!1,configurable:!0}),i.prototype.transferTexturesToEffect=function(t,i){return this},i.prototype.Fv=function(t,i,n,s,h){void 0===h&&(h=!1);var r=t.toString(),e=!1;if(!h||!this.pv.Bl){if(this.pv.bindToEffect(n,"Light"+r),this.ec!==i.getRenderId()||!this.pv.useUbo){this.ec=i.getRenderId();var u=this.getScaledIntensity();this.transferToEffect(n,r),this.diffuse.scaleToRef(u,w.Color3[0]),this.pv.updateColor4("vLightDiffuse",w.Color3[0],this.range,r),s&&(this.specular.scaleToRef(u,w.Color3[1]),this.pv.updateColor4("vLightSpecular",w.Color3[1],this.radius,r)),e=!0}if(this.transferTexturesToEffect(n,r),i.shadowsEnabled&&this.shadowEnabled){var o=this.getShadowGenerator();o&&(o.bindShadowLight(r,n),e=!0)}e&&this.pv.update()}},i.prototype.getClassName=function(){return"Light"},i.prototype.toString=function(t){var i="Name: "+this.name;if(i+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(var n=0;n<this.animations.length;n++)i+=", animation[0]: "+this.animations[n].toString(t);return i},i.prototype.lu=function(){t.prototype.lu.call(this),this.isDisposed()||this.Kv()},i.prototype.setEnabled=function(i){t.prototype.setEnabled.call(this,i),this.Kv()},i.prototype.getShadowGenerator=function(){return this.Cv},i.prototype.getAbsolutePosition=function(){return o.Zero()},i.prototype.canAffectMesh=function(t){return!t||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(t))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(t))&&((0===this.includeOnlyWithLayerMask||0!=(this.includeOnlyWithLayerMask&t.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&t.layerMask)))},i.CompareLightsPriority=function(t,i){return t.shadowEnabled!==i.shadowEnabled?(i.shadowEnabled?1:0)-(t.shadowEnabled?1:0):i.renderPriority-t.renderPriority},i.prototype.dispose=function(i,n){void 0===n&&(n=!1),this.Cv&&(this.Cv.dispose(),this.Cv=null),this.getScene().stopAnimation(this);for(var s=0,h=this.getScene().meshes;s<h.length;s++){h[s].Kc(this,!0)}this.pv.dispose(),this.getScene().removeLight(this),t.prototype.dispose.call(this,i,n)},i.prototype.getTypeID=function(){return 0},i.prototype.getScaledIntensity=function(){return this.vv*this.intensity},i.prototype.clone=function(t,n){void 0===n&&(n=null);var s=i.GetConstructorFromName(this.getTypeID(),t,this.getScene());if(!s)return null;var h=Qt.Clone(s,this);return n&&(h.parent=n),h.setEnabled(this.isEnabled()),h},i.prototype.serialize=function(){var t=Qt.Serialize(this);return t.type=this.getTypeID(),this.parent&&(t.parentId=this.parent.id),this.excludedMeshes.length>0&&(t.excludedMeshesIds=[],this.excludedMeshes.forEach((function(i){t.excludedMeshesIds.push(i.id)}))),this.includedOnlyMeshes.length>0&&(t.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach((function(i){t.includedOnlyMeshesIds.push(i.id)}))),Qt.AppendSerializedAnimations(this,t),t.ranges=this.serializeAnimationRanges(),t},i.GetConstructorFromName=function(t,i,n){var s=Yt.Construct("Light_Type_"+t,i,n);return s||null},i.Parse=function(t,n){var s=i.GetConstructorFromName(t.type,t.name,n);if(!s)return null;var h=Qt.Parse(s,t,n);if(t.excludedMeshesIds&&(h.Ov=t.excludedMeshesIds),t.includedOnlyMeshesIds&&(h.yv=t.includedOnlyMeshesIds),t.parentId&&(h.ze=t.parentId),void 0!==t.falloffType&&(h.falloffType=t.falloffType),void 0!==t.lightmapMode&&(h.lightmapMode=t.lightmapMode),t.animations){for(var r=0;r<t.animations.length;r++){var u=t.animations[r],o=e.GetClass("BABYLON.Animation");o&&h.animations.push(o.Parse(u))}Yt.ParseAnimationRanges(h,t,n)}return t.autoAnimate&&n.beginAnimation(h,t.autoAnimateFrom,t.autoAnimateTo,t.autoAnimateLoop,t.autoAnimateSpeed||1),h},i.prototype.Bv=function(t){var i=this,n=t.push;t.push=function(){for(var s=[],h=0;h<arguments.length;h++)s[h]=arguments[h];for(var r=n.apply(t,s),e=0,u=s;e<u.length;e++){var o=u[e];o.Mc(i)}return r};var s=t.splice;t.splice=function(n,h){for(var r=s.apply(t,[n,h]),e=0,u=r;e<u.length;e++){u[e].Mc(i)}return r};for(var h=0,r=t;h<r.length;h++){r[h].Mc(this)}},i.prototype.Ev=function(t){var i=this,n=t.push;t.push=function(){for(var s=[],h=0;h<arguments.length;h++)s[h]=arguments[h];var r=n.apply(t,s);return i.Kv(),r};var s=t.splice;t.splice=function(n,h){var r=s.apply(t,[n,h]);return i.Kv(),r},this.Kv()},i.prototype.Kv=function(){for(var t=0,i=this.getScene().meshes;t<i.length;t++){i[t].Mc(this)}},i.prototype.xv=function(){for(var t=0,i=this.getScene().meshes;t<i.length;t++){var n=i[t];-1!==n.lightSources.indexOf(this)&&n.jc()}},i.prototype.Pv=function(){this.vv=this._v(),this.getScene().resetCachedMaterial()},i.prototype._v=function(){var t=0,n=this.getTypeID(),s=this.intensityMode;switch(s===i.INTENSITYMODE_AUTOMATIC&&(s=n===i.LIGHTTYPEID_DIRECTIONALLIGHT?i.INTENSITYMODE_ILLUMINANCE:i.INTENSITYMODE_LUMINOUSINTENSITY),n){case i.LIGHTTYPEID_POINTLIGHT:case i.LIGHTTYPEID_SPOTLIGHT:switch(s){case i.INTENSITYMODE_LUMINOUSPOWER:t=1/(4*Math.PI);break;case i.INTENSITYMODE_LUMINOUSINTENSITY:t=1;break;case i.INTENSITYMODE_LUMINANCE:t=this.radius*this.radius}break;case i.LIGHTTYPEID_DIRECTIONALLIGHT:switch(s){case i.INTENSITYMODE_ILLUMINANCE:t=1;break;case i.INTENSITYMODE_LUMINANCE:var h=this.radius;h=Math.max(h,.001),t=2*Math.PI*(1-Math.cos(h))}break;case i.LIGHTTYPEID_HEMISPHERICLIGHT:t=1}return t},i.prototype.Uv=function(){var t=this.getScene();0!=this.Rv&&(t.requireLightSorting=!0),this.getScene().sortLightsByPriority()},i.FALLOFF_DEFAULT=0,i.FALLOFF_PHYSICAL=1,i.FALLOFF_GLTF=2,i.FALLOFF_STANDARD=3,i.LIGHTMAP_DEFAULT=0,i.LIGHTMAP_SPECULAR=1,i.LIGHTMAP_SHADOWSONLY=2,i.INTENSITYMODE_AUTOMATIC=0,i.INTENSITYMODE_LUMINOUSPOWER=1,i.INTENSITYMODE_LUMINOUSINTENSITY=2,i.INTENSITYMODE_ILLUMINANCE=3,i.INTENSITYMODE_LUMINANCE=4,i.LIGHTTYPEID_POINTLIGHT=0,i.LIGHTTYPEID_DIRECTIONALLIGHT=1,i.LIGHTTYPEID_SPOTLIGHT=2,i.LIGHTTYPEID_HEMISPHERICLIGHT=3,B([Wt()],i.prototype,"diffuse",void 0),B([Wt()],i.prototype,"specular",void 0),B([Nt()],i.prototype,"falloffType",void 0),B([Nt()],i.prototype,"intensity",void 0),B([Nt()],i.prototype,"range",null),B([Nt()],i.prototype,"intensityMode",null),B([Nt()],i.prototype,"radius",null),B([Nt()],i.prototype,"_renderPriority",void 0),B([It("_reorderLightsInScene")],i.prototype,"renderPriority",void 0),B([Nt("shadowEnabled")],i.prototype,"_shadowEnabled",void 0),B([Nt("excludeWithLayerMask")],i.prototype,"_excludeWithLayerMask",void 0),B([Nt("includeOnlyWithLayerMask")],i.prototype,"_includeOnlyWithLayerMask",void 0),B([Nt("lightmapMode")],i.prototype,"_lightmapMode",void 0),i}(Yt),mi=function(){function t(t,i,n,s,h,r){this.source=t,this.pointerX=i,this.pointerY=n,this.meshUnderPointer=s,this.sourceEvent=h,this.additionalData=r}return t.CreateNew=function(i,n,s){var h=i.getScene();return new t(i,h.pointerX,h.pointerY,h.meshUnderPointer||i,n,s)},t.CreateNewFromSprite=function(i,n,s,h){return new t(i,n.pointerX,n.pointerY,n.meshUnderPointer,s,h)},t.CreateNewFromScene=function(i,n){return new t(null,i.pointerX,i.pointerY,i.meshUnderPointer,n)},t.CreateNewFromPrimitive=function(i,n,s,h){return new t(i,n.x,n.y,null,s,h)},t}(),ji=function(){function t(t,i,n,s,h,r,e,u,o){void 0===u&&(u=!0),void 0===o&&(o=!0),this.materialIndex=t,this.verticesStart=i,this.verticesCount=n,this.indexStart=s,this.indexCount=h,this.xc=null,this.Sv=null,this.Lv=null,this.Dv=0,this.Iv=null,this.Xc=null,this.Wc=null,this.ec=0,this.Nv=0,this.Xv=0,this.Wv=null,this.Gv=r,this.qv=e||r,o&&r.subMeshes.push(this),this.Gc=[],this.ke=r.subMeshes.length-1,u&&(this.refreshBoundingInfo(),r.computeWorldMatrix(!0))}return Object.defineProperty(t.prototype,"materialDefines",{get:function(){return this.xc},set:function(t){this.xc=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"effect",{get:function(){var t;return null!==(t=this.Lv)&&void 0!==t?t:this.Sv},enumerable:!1,configurable:!0}),t.prototype.setEffect=function(t,i){void 0===i&&(i=null),this.Sv!==t?(this.xc=i,this.Sv=t):t||(this.xc=null)},t.AddToMesh=function(i,n,s,h,r,e,u,o){return void 0===o&&(o=!0),new t(i,n,s,h,r,e,u,o)},Object.defineProperty(t.prototype,"IsGlobal",{get:function(){return 0===this.verticesStart&&this.verticesCount===this.Gv.getTotalVertices()},enumerable:!1,configurable:!0}),t.prototype.getBoundingInfo=function(){return this.IsGlobal?this.Gv.getBoundingInfo():this.rc},t.prototype.setBoundingInfo=function(t){return this.rc=t,this},t.prototype.getMesh=function(){return this.Gv},t.prototype.getRenderingMesh=function(){return this.qv},t.prototype.getReplacementMesh=function(){return this.Gv.Jf.Zf?this.Gv:null},t.prototype.getEffectiveMesh=function(){var t=this.Gv.Jf.Zf?this.Gv:null;return t||this.qv},t.prototype.getMaterial=function(){var t=this.qv.material;if(null==t)return this.Gv.getScene().defaultMaterial;if(this.Qv(t)){var i=t.getSubMaterial(this.materialIndex);return this.Wv!==i&&(this.Wv=i,this.xc=null),i}return t},t.prototype.Qv=function(t){return void 0!==t.getSubMaterial},t.prototype.refreshBoundingInfo=function(t){if(void 0===t&&(t=null),this.Xc=null,this.IsGlobal||!this.qv||!this.qv.geometry)return this;if(t||(t=this.qv.getVerticesData(K.PositionKind)),!t)return this.rc=this.Gv.getBoundingInfo(),this;var i,n=this.qv.getIndices();if(0===this.indexStart&&this.indexCount===n.length){var s=this.qv.getBoundingInfo();i={minimum:s.minimum.clone(),maximum:s.maximum.clone()}}else i=function(t,i,n,s,h){void 0===h&&(h=null);for(var r=new o(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),e=new o(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),u=n;u<n+s;u++){var f=3*i[u],c=t[f],a=t[f+1],l=t[f+2];r.minimizeInPlaceFromFloats(c,a,l),e.maximizeInPlaceFromFloats(c,a,l)}return h&&(r.x-=r.x*h.x+h.y,r.y-=r.y*h.x+h.y,r.z-=r.z*h.x+h.y,e.x+=e.x*h.x+h.y,e.y+=e.y*h.x+h.y,e.z+=e.z*h.x+h.y),{minimum:r,maximum:e}}(t,n,this.indexStart,this.indexCount,this.qv.geometry.boundingBias);return this.rc?this.rc.reConstruct(i.minimum,i.maximum):this.rc=new ei(i.minimum,i.maximum),this},t.prototype.kf=function(t){return this.getBoundingInfo().kf(t)},t.prototype.updateBoundingInfo=function(t){var i=this.getBoundingInfo();return i||(this.refreshBoundingInfo(),i=this.getBoundingInfo()),i&&i.update(t),this},t.prototype.isInFrustum=function(t){var i=this.getBoundingInfo();return!!i&&i.isInFrustum(t,this.Gv.cullingStrategy)},t.prototype.isCompletelyInFrustum=function(t){var i=this.getBoundingInfo();return!!i&&i.isCompletelyInFrustum(t)},t.prototype.render=function(t){return this.qv.render(this,t,this.Gv.Jf.Zf?this.Gv:void 0),this},t.prototype.Yv=function(t,i){if(!this.Iv){for(var n=[],s=this.indexStart;s<this.indexStart+this.indexCount;s+=3)n.push(t[s],t[s+1],t[s+1],t[s+2],t[s+2],t[s]);this.Iv=i.createIndexBuffer(n),this.Dv=n.length}return this.Iv},t.prototype.canIntersects=function(t){var i=this.getBoundingInfo();return!!i&&t.intersectsBox(i.boundingBox)},t.prototype.intersects=function(t,i,n,s,h){var r=this.getMaterial();if(!r)return null;var e=3,u=!1;switch(r.fillMode){case 3:case 4:case 5:case 6:case 8:return null;case 7:e=1,u=!0}return"InstancedLinesMesh"===this.Gv.getClassName()||"LinesMesh"===this.Gv.getClassName()?n.length?this.Vv(t,i,n,this.Gv.intersectionThreshold,s):this.Hv(t,i,n,this.Gv.intersectionThreshold,s):!n.length&&this.Gv.oc?this.zv(t,i,n,s,h):this.Zv(t,i,n,e,u,s,h)},t.prototype.Vv=function(t,i,n,s,h){for(var r=null,e=this.indexStart;e<this.indexStart+this.indexCount;e+=2){var u=i[n[e]],o=i[n[e+1]],f=t.intersectionSegment(u,o,s);if(!(f<0)&&((h||!r||f<r.distance)&&((r=new x(null,null,f)).faceId=e/2,h)))break}return r},t.prototype.Hv=function(t,i,n,s,h){for(var r=null,e=this.verticesStart;e<this.verticesStart+this.verticesCount;e+=2){var u=i[e],o=i[e+1],f=t.intersectionSegment(u,o,s);if(!(f<0)&&((h||!r||f<r.distance)&&((r=new x(null,null,f)).faceId=e/2,h)))break}return r},t.prototype.Zv=function(t,i,n,s,h,r,e){for(var u=null,o=-1,f=this.indexStart;f<this.indexStart+this.indexCount;f+=s){o++;var c=n[f],a=n[f+1],l=n[f+2];if(h&&4294967295===l)f+=2;else{var v=i[c],b=i[a],d=i[l];if(!e||e(v,b,d,t)){var g=t.intersectsTriangle(v,b,d);if(g){if(g.distance<0)continue;if((r||!u||g.distance<u.distance)&&((u=g).faceId=o,r))break}}}}return u},t.prototype.zv=function(t,i,n,s,h){for(var r=null,e=this.verticesStart;e<this.verticesStart+this.verticesCount;e+=3){var u=i[e],o=i[e+1],f=i[e+2];if(!h||h(u,o,f,t)){var c=t.intersectsTriangle(u,o,f);if(c){if(c.distance<0)continue;if((s||!r||c.distance<r.distance)&&((r=c).faceId=e/3,s))break}}}return r},t.prototype.gt=function(){this.Iv&&(this.Iv=null)},t.prototype.clone=function(i,n){var s=new t(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,i,n,!1);if(!this.IsGlobal){var h=this.getBoundingInfo();if(!h)return s;s.rc=new ei(h.minimum,h.maximum)}return s},t.prototype.dispose=function(){this.Iv&&(this.Gv.getScene().getEngine().wt(this.Iv),this.Iv=null);var t=this.Gv.subMeshes.indexOf(this);this.Gv.subMeshes.splice(t,1)},t.prototype.getClassName=function(){return"SubMesh"},t.CreateFromIndices=function(i,n,s,h,r){for(var e=Number.MAX_VALUE,u=-Number.MAX_VALUE,o=(r||h).getIndices(),f=n;f<n+s;f++){var c=o[f];c<e&&(e=c),c>u&&(u=c)}return new t(i,e,u-e+1,n,s,h,r)},t}(),Oi=function(){function t(i,n,s){this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this.Jv=1,this.$v=!0,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this.tb=!1,this.animations=null,this.onDisposeObservable=new _,this.ru=null,this.ib=null,this.nb=null,this.qs=2,this.sb=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this.hb=!0,this.pointSize=1,this.zOffset=0,this.rb=null,this.eb=!1,this.ub=t.TriangleFillMode,this.ob=!1,this.fb=!1,this.cb=0,this.ab=-1,this.meshMap=null,this.lb=!1,this.vb=null,this.name=i,this.id=i||Et.RandomId(),this.uu=n||G.LastCreatedScene,this.uniqueId=this.uu.getUniqueId(),this.uu.useRightHandedSystem?this.sideOrientation=t.ClockWiseSideOrientation:this.sideOrientation=t.CounterClockWiseSideOrientation,this.pv=new gi(this.uu.getEngine()),this.eb=this.getScene().getEngine().supportsUniformBuffers,s||this.uu.addMaterial(this),this.uu.useMaterialMeshMap&&(this.meshMap={})}return Object.defineProperty(t.prototype,"shouldRenderToMRT",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"alpha",{get:function(){return this.Jv},set:function(i){this.Jv!==i&&(this.Jv=i,this.markAsDirty(t.MiscDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"backFaceCulling",{get:function(){return this.$v},set:function(i){this.$v!==i&&(this.$v=i,this.markAsDirty(t.TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasRenderTargetTextures",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onDispose",{set:function(t){this.ru&&this.onDisposeObservable.remove(this.ru),this.ru=this.onDisposeObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onBindObservable",{get:function(){return this.ei||(this.ei=new _),this.ei},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onBind",{set:function(t){this.nb&&this.onBindObservable.remove(this.nb),this.nb=this.onBindObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onUnBindObservable",{get:function(){return this.ib||(this.ib=new _),this.ib},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onEffectCreatedObservable",{get:function(){return this.bb||(this.bb=new _),this.bb},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"alphaMode",{get:function(){return this.qs},set:function(i){this.qs!==i&&(this.qs=i,this.markAsDirty(t.TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"needDepthPrePass",{get:function(){return this.sb},set:function(t){this.sb!==t&&(this.sb=t,this.sb&&(this.checkReadyOnEveryCall=!0))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fogEnabled",{get:function(){return this.hb},set:function(i){this.hb!==i&&(this.hb=i,this.markAsDirty(t.MiscDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wireframe",{get:function(){switch(this.ub){case t.WireFrameFillMode:case t.LineListDrawMode:case t.LineLoopDrawMode:case t.LineStripDrawMode:return!0}return this.uu.forceWireframe},set:function(i){this.fillMode=i?t.WireFrameFillMode:t.TriangleFillMode},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pointsCloud",{get:function(){switch(this.ub){case t.PointFillMode:case t.PointListDrawMode:return!0}return this.uu.forcePointsCloud},set:function(i){this.fillMode=i?t.PointFillMode:t.TriangleFillMode},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fillMode",{get:function(){return this.ub},set:function(i){this.ub!==i&&(this.ub=i,this.markAsDirty(t.MiscDirtyFlag))},enumerable:!1,configurable:!0}),t.prototype.toString=function(t){return"Name: "+this.name},t.prototype.getClassName=function(){return"Material"},Object.defineProperty(t.prototype,"isFrozen",{get:function(){return this.checkReadyOnlyOnce},enumerable:!1,configurable:!0}),t.prototype.freeze=function(){this.markDirty(),this.checkReadyOnlyOnce=!0},t.prototype.unfreeze=function(){this.markDirty(),this.checkReadyOnlyOnce=!1},t.prototype.isReady=function(t,i){return!0},t.prototype.isReadyForSubMesh=function(t,i,n){return!1},t.prototype.getEffect=function(){return this.rb},t.prototype.getScene=function(){return this.uu},Object.defineProperty(t.prototype,"transparencyMode",{get:function(){return this.vb},set:function(i){this.vb!==i&&(this.vb=i,this.lb=i===t.MATERIAL_ALPHATESTANDBLEND,this.gb())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wb",{get:function(){return this.vb===t.MATERIAL_OPAQUE||this.vb===t.MATERIAL_ALPHATEST},enumerable:!1,configurable:!0}),t.prototype.needAlphaBlending=function(){return!this.wb&&this.alpha<1},t.prototype.needAlphaBlendingForMesh=function(t){return!(this.wb&&t.visibility>=1)&&(this.needAlphaBlending()||t.visibility<1||t.hasVertexAlpha)},t.prototype.needAlphaTesting=function(){return!!this.lb},t.prototype.mb=function(t){return!this.needAlphaBlendingForMesh(t)&&this.needAlphaTesting()},t.prototype.getAlphaTestTexture=function(){return null},t.prototype.markDirty=function(){for(var t=0,i=this.getScene().meshes;t<i.length;t++){var n=i[t];if(n.subMeshes)for(var s=0,h=n.subMeshes;s<h.length;s++){var r=h[s];r.getMaterial()===this&&(r.effect&&(r.effect.ui=!1))}}},t.prototype.jb=function(i,n){void 0===n&&(n=null);var s=this.uu.getEngine(),h=(null==n?this.sideOrientation:n)===t.ClockWiseSideOrientation;return s.enableEffect(i||this.rb),s.setState(this.backFaceCulling,this.zOffset,!1,h),h},t.prototype.bind=function(t,i){},t.prototype.bindForSubMesh=function(t,i,n){},t.prototype.bindOnlyWorldMatrix=function(t){},t.prototype.bindSceneUniformBuffer=function(t,i){i.bindToEffect(t,"Scene")},t.prototype.bindView=function(t){this.eb?this.bindSceneUniformBuffer(t,this.getScene().getSceneUniformBuffer()):t.setMatrix("view",this.getScene().getViewMatrix())},t.prototype.bindViewProjection=function(t){this.eb?this.bindSceneUniformBuffer(t,this.getScene().getSceneUniformBuffer()):t.setMatrix("viewProjection",this.getScene().getTransformMatrix())},t.prototype.Ob=function(t){if(this.uu.yb=this,this.uu.Ab=t?t.visibility:1,this.ei&&t&&this.ei.notifyObservers(t),this.disableDepthWrite){var i=this.uu.getEngine();this.ob=i.getDepthWrite(),i.setDepthWrite(!1)}if(this.disableColorWrite){i=this.uu.getEngine();this.fb=i.getColorWrite(),i.setColorWrite(!1)}if(0!==this.depthFunction){i=this.uu.getEngine();this.cb=i.getDepthFunction()||0,i.setDepthFunction(this.depthFunction)}},t.prototype.unbind=function(){(this.ib&&this.ib.notifyObservers(this),0!==this.depthFunction)&&this.uu.getEngine().setDepthFunction(this.cb);this.disableDepthWrite&&this.uu.getEngine().setDepthWrite(this.ob);this.disableColorWrite&&this.uu.getEngine().setColorWrite(this.fb)},t.prototype.getActiveTextures=function(){return[]},t.prototype.hasTexture=function(t){return!1},t.prototype.clone=function(t){return null},t.prototype.getBindedMeshes=function(){var t=this;if(this.meshMap){var i=new Array;for(var n in this.meshMap){var s=this.meshMap[n];s&&i.push(s)}return i}return this.uu.meshes.filter((function(i){return i.material===t}))},t.prototype.forceCompilation=function(t,i,n,s){var h=this,r=T({clipPlane:!1,useInstances:!1},n),e=this.getScene(),u=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;var o=function(){if(h.uu&&h.uu.getEngine()){var n=e.clipPlane;if(r.clipPlane&&(e.clipPlane=new j(0,0,0,1)),h.tb){var f=!0,c=null;if(t.subMeshes){var a=new ji(0,0,0,0,0,t,void 0,!1,!1);a.xc&&(a.xc.ec=-1),h.isReadyForSubMesh(t,a,r.useInstances)||(a.effect&&a.effect.getCompilationError()&&a.effect.allFallbacksProcessed()?c=a.effect.getCompilationError():(f=!1,setTimeout(o,16)))}f&&(h.allowShaderHotSwapping=u,c&&s&&s(c),i&&i(h))}else h.isReady()?(h.allowShaderHotSwapping=u,i&&i(h)):setTimeout(o,16);r.clipPlane&&(e.clipPlane=n)}};o()},t.prototype.forceCompilationAsync=function(t,i){var n=this;return new Promise((function(s,h){n.forceCompilation(t,(function(){s()}),i,(function(t){h(t)}))}))},t.prototype.markAsDirty=function(i){this.getScene().blockMaterialDirtyMechanism||(t.pb.length=0,i&t.TextureDirtyFlag&&t.pb.push(t.Mb),i&t.LightDirtyFlag&&t.pb.push(t.Kb),i&t.FresnelDirtyFlag&&t.pb.push(t.Pb),i&t.AttributesDirtyFlag&&t.pb.push(t.xb),i&t.MiscDirtyFlag&&t.pb.push(t.kb),t.pb.length&&this.Eb(t.Tb),this.getScene().resetCachedMaterial())},t.prototype.Eb=function(t){if(!this.getScene().blockMaterialDirtyMechanism)for(var i=0,n=this.getScene().meshes;i<n.length;i++){var s=n[i];if(s.subMeshes)for(var h=0,r=s.subMeshes;h<r.length;h++){var e=r[h];e.getMaterial()===this&&(e.xc&&t(e.xc))}}},t.prototype.Bb=function(){if(!this.getScene().blockMaterialDirtyMechanism){var t=this.getScene().enablePrePassRenderer();t&&t.markAsDirty()}},t.prototype.Fb=function(){this.Eb(t.Cb)},t.prototype._b=function(){this.Eb(t.Ub)},t.prototype.Rb=function(){this.Eb(t.Mb)},t.prototype.Sb=function(){this.Eb(t.Pb)},t.prototype.Lb=function(){this.Eb(t.Db)},t.prototype.Ib=function(){this.Eb(t.Kb)},t.prototype.Nb=function(){this.Eb(t.xb)},t.prototype.Xb=function(){this.Eb(t.kb)},t.prototype.gb=function(){this.Eb(t.Wb)},t.prototype.dispose=function(t,i,n){var s=this.getScene();if(s.stopAnimation(this),s.freeProcessedMaterials(),s.removeMaterial(this),!0!==n)if(this.meshMap)for(var h in this.meshMap){(u=this.meshMap[h])&&(u.material=null,this.releaseVertexArrayObject(u,t))}else for(var r=0,e=s.meshes;r<e.length;r++){var u;(u=e[r]).material!==this||u.sourceMesh||(u.material=null,this.releaseVertexArrayObject(u,t))}this.pv.dispose(),t&&this.rb&&(this.tb||this.rb.dispose(),this.rb=null),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.ei&&this.ei.clear(),this.ib&&this.ib.clear(),this.bb&&this.bb.clear()},t.prototype.releaseVertexArrayObject=function(t,i){if(t.geometry){var n=t.geometry;if(this.tb)for(var s=0,h=t.subMeshes;s<h.length;s++){var r=h[s];n.Gb(r.Sv),i&&r.Sv&&r.Sv.dispose()}else n.Gb(this.rb)}},t.prototype.serialize=function(){return Qt.Serialize(this)},t.Parse=function(t,i,n){if(t.customType){if("BABYLON.PBRMaterial"===t.customType&&t.overloadedAlbedo&&(t.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return R.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else t.customType="BABYLON.StandardMaterial";return Et.Instantiate(t.customType).Parse(t,i,n)},t.TriangleFillMode=0,t.WireFrameFillMode=1,t.PointFillMode=2,t.PointListDrawMode=3,t.LineListDrawMode=4,t.LineLoopDrawMode=5,t.LineStripDrawMode=6,t.TriangleStripDrawMode=7,t.TriangleFanDrawMode=8,t.ClockWiseSideOrientation=0,t.CounterClockWiseSideOrientation=1,t.TextureDirtyFlag=1,t.LightDirtyFlag=2,t.FresnelDirtyFlag=4,t.AttributesDirtyFlag=8,t.MiscDirtyFlag=16,t.AllDirtyFlag=31,t.MATERIAL_OPAQUE=0,t.MATERIAL_ALPHATEST=1,t.MATERIAL_ALPHABLEND=2,t.MATERIAL_ALPHATESTANDBLEND=3,t.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,t.MATERIAL_NORMALBLENDMETHOD_RNM=1,t.Cb=function(t){return t.markAllAsDirty()},t.Ub=function(t){return t.markAsImageProcessingDirty()},t.Mb=function(t){return t.markAsTexturesDirty()},t.Pb=function(t){return t.markAsFresnelDirty()},t.kb=function(t){return t.markAsMiscDirty()},t.Kb=function(t){return t.markAsLightDirty()},t.xb=function(t){return t.markAsAttributesDirty()},t.Db=function(i){t.Pb(i),t.kb(i)},t.Wb=function(i){t.Mb(i),t.kb(i)},t.pb=[],t.Tb=function(i){for(var n=0,s=t.pb;n<s.length;n++){(0,s[n])(i)}},B([Nt()],t.prototype,"id",void 0),B([Nt()],t.prototype,"uniqueId",void 0),B([Nt()],t.prototype,"name",void 0),B([Nt()],t.prototype,"checkReadyOnEveryCall",void 0),B([Nt()],t.prototype,"checkReadyOnlyOnce",void 0),B([Nt()],t.prototype,"state",void 0),B([Nt("alpha")],t.prototype,"_alpha",void 0),B([Nt("backFaceCulling")],t.prototype,"_backFaceCulling",void 0),B([Nt()],t.prototype,"sideOrientation",void 0),B([Nt("alphaMode")],t.prototype,"_alphaMode",void 0),B([Nt()],t.prototype,"_needDepthPrePass",void 0),B([Nt()],t.prototype,"disableDepthWrite",void 0),B([Nt()],t.prototype,"disableColorWrite",void 0),B([Nt()],t.prototype,"forceDepthWrite",void 0),B([Nt()],t.prototype,"depthFunction",void 0),B([Nt()],t.prototype,"separateCullingPass",void 0),B([Nt("fogEnabled")],t.prototype,"_fogEnabled",void 0),B([Nt()],t.prototype,"pointSize",void 0),B([Nt()],t.prototype,"zOffset",void 0),B([Nt()],t.prototype,"pointsCloud",null),B([Nt()],t.prototype,"fillMode",null),B([Nt()],t.prototype,"transparencyMode",null),t}(),yi=function(){function t(t){this.qb={},this.uu=t}return t.prototype.Qb=function(){if(!this.qb[K.PositionKind]){var t=[];t.push(1,1),t.push(-1,1),t.push(-1,-1),t.push(1,-1),this.qb[K.PositionKind]=new K(this.uu.getEngine(),t,K.PositionKind,!1,!1,2),this.Yb()}},t.prototype.Yb=function(){var t=[];t.push(0),t.push(1),t.push(2),t.push(0),t.push(2),t.push(3),this.Vb=this.uu.getEngine().createIndexBuffer(t)},t.prototype.gt=function(){var t=this.qb[K.PositionKind];t&&(t.gt(),this.Yb())},t.prototype.Hb=function(t,i){void 0===t&&(t=null),void 0===i&&(i=null);var n=this.uu.activeCamera;return!!n&&(!(!(i=i||n.bf.filter((function(t){return null!=t})))||0===i.length||!this.uu.postProcessesEnabled)&&(i[0].activate(n,t,null!=i),!0))},t.prototype.directRender=function(t,i,n,s,h,r){void 0===i&&(i=null),void 0===n&&(n=!1),void 0===s&&(s=0),void 0===h&&(h=0),void 0===r&&(r=!1);for(var e=this.uu.getEngine(),u=0;u<t.length;u++){u<t.length-1?t[u+1].activate(this.uu.activeCamera,i):i?e.bindFramebuffer(i,s,void 0,void 0,n,h):r||e.restoreDefaultFramebuffer();var o=t[u],f=o.apply();f&&(o.onBeforeRenderObservable.notifyObservers(f),this.Qb(),e.bindBuffers(this.qb,this.Vb,f),e.drawElementsType(Oi.TriangleFillMode,0,6),o.onAfterRenderObservable.notifyObservers(f))}e.setDepthBuffer(!0),e.setDepthWrite(!0)},t.prototype.zb=function(t,i,n,s,h){void 0===h&&(h=!1);var r=this.uu.activeCamera;if(r&&0!==(s=s||r.bf.filter((function(t){return null!=t}))).length&&this.uu.postProcessesEnabled){for(var e=this.uu.getEngine(),u=0,o=s.length;u<o;u++){var f=s[u];if(u<o-1?f.hf=s[u+1].activate(r,i):i?(e.bindFramebuffer(i,n,void 0,void 0,h),f.hf=i):(e.restoreDefaultFramebuffer(),f.hf=null),t)break;var c=f.apply();c&&(f.onBeforeRenderObservable.notifyObservers(c),this.Qb(),e.bindBuffers(this.qb,this.Vb,c),e.drawElementsType(Oi.TriangleFillMode,0,6),f.onAfterRenderObservable.notifyObservers(c))}e.setDepthBuffer(!0),e.setDepthWrite(!0),e.setAlphaMode(0)}},t.prototype.dispose=function(){var t=this.qb[K.PositionKind];t&&(t.dispose(),this.qb[K.PositionKind]=null),this.Vb&&(this.uu.getEngine().wt(this.Vb),this.Vb=null)},t}(),Ai=function(){function t(t,i,n,s,h){void 0===n&&(n=null),void 0===s&&(s=null),void 0===h&&(h=null),this.index=t,this.Zb=new Tt(256),this.Jb=new Tt(256),this.$b=new Tt(256),this.td=new Tt(256),this.nd=new Tt(256),this.sd=new Tt(256),this.hd=new Bt(16),this.uu=i,this.opaqueSortCompareFn=n,this.alphaTestSortCompareFn=s,this.transparentSortCompareFn=h}return Object.defineProperty(t.prototype,"opaqueSortCompareFn",{set:function(i){this.rd=i,this.ed=i?this.renderOpaqueSorted:t.renderUnsorted},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"alphaTestSortCompareFn",{set:function(i){this.ud=i,this.od=i?this.renderAlphaTestSorted:t.renderUnsorted},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"transparentSortCompareFn",{set:function(i){this.fd=i||t.defaultTransparentSortCompare,this.ad=this.renderTransparentSorted},enumerable:!1,configurable:!0}),t.prototype.render=function(t,i,n,s){if(t)t(this.Zb,this.$b,this.Jb,this.td);else{var h=this.uu.getEngine();0!==this.td.length&&(h.setColorWrite(!1),this.od(this.td),h.setColorWrite(!0)),0!==this.Zb.length&&this.ed(this.Zb),0!==this.$b.length&&this.od(this.$b);var r=h.getStencilBuffer();if(h.setStencilBuffer(!1),i&&this.ld(),n&&this.vd(s),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this.Jb.length&&(h.setStencilBuffer(r),this.ad(this.Jb),h.setAlphaMode(0)),h.setStencilBuffer(!1),this.hd.length){for(var e=0;e<this.hd.length;e++)this.hd.data[e].render();h.setAlphaMode(0)}h.setStencilBuffer(r)}},t.prototype.renderOpaqueSorted=function(i){return t.renderSorted(i,this.rd,this.uu.activeCamera,!1)},t.prototype.renderAlphaTestSorted=function(i){return t.renderSorted(i,this.ud,this.uu.activeCamera,!1)},t.prototype.renderTransparentSorted=function(i){return t.renderSorted(i,this.fd,this.uu.activeCamera,!0)},t.renderSorted=function(i,n,s,h){for(var r,e=0,u=s?s.globalPosition:t.bd;e<i.length;e++)(r=i.data[e]).Nv=r.getMesh().alphaIndex,r.Xv=o.Distance(r.getBoundingInfo().boundingSphere.centerWorld,u);var f=i.data.slice(0,i.length);for(n&&f.sort(n),e=0;e<f.length;e++){if(r=f[e],h){var c=r.getMaterial();if(c&&c.needDepthPrePass){var a=c.getScene().getEngine();a.setColorWrite(!1),a.setAlphaMode(0),r.render(!1),a.setColorWrite(!0)}}r.render(h)}},t.renderUnsorted=function(t){for(var i=0;i<t.length;i++){t.data[i].render(!1)}},t.defaultTransparentSortCompare=function(i,n){return i.Nv>n.Nv?1:i.Nv<n.Nv?-1:t.backToFrontSortCompare(i,n)},t.backToFrontSortCompare=function(t,i){return t.Xv<i.Xv?1:t.Xv>i.Xv?-1:0},t.frontToBackSortCompare=function(t,i){return t.Xv<i.Xv?-1:t.Xv>i.Xv?1:0},t.prototype.prepare=function(){this.Zb.reset(),this.Jb.reset(),this.$b.reset(),this.td.reset(),this.nd.reset(),this.sd.reset(),this.hd.reset()},t.prototype.dispose=function(){this.Zb.dispose(),this.Jb.dispose(),this.$b.dispose(),this.td.dispose(),this.nd.dispose(),this.sd.dispose(),this.hd.dispose()},t.prototype.dispatch=function(t,i,n){void 0===i&&(i=t.getMesh()),void 0===n&&(n=t.getMaterial()),null!=n&&(n.needAlphaBlendingForMesh(i)?this.Jb.push(t):n.needAlphaTesting()?(n.needDepthPrePass&&this.td.push(t),this.$b.push(t)):(n.needDepthPrePass&&this.td.push(t),this.Zb.push(t)),i.tc=this,i.sc&&i.sc.isEnabled&&this.hd.pushNoDuplicate(i.sc))},t.prototype.dispatchSprites=function(t){this.sd.push(t)},t.prototype.dispatchParticles=function(t){this.nd.push(t)},t.prototype.vd=function(t){if(0!==this.nd.length){var i=this.uu.activeCamera;this.uu.onBeforeParticlesRenderingObservable.notifyObservers(this.uu);for(var n=0;n<this.nd.length;n++){var s=this.nd.data[n];if(0!==(i&&i.layerMask&s.layerMask)){var h=s.emitter;h.position&&t&&-1===t.indexOf(h)||this.uu.dd.addCount(s.render(),!1)}}this.uu.onAfterParticlesRenderingObservable.notifyObservers(this.uu)}},t.prototype.ld=function(){if(this.uu.spritesEnabled&&0!==this.sd.length){var t=this.uu.activeCamera;this.uu.onBeforeSpritesRenderingObservable.notifyObservers(this.uu);for(var i=0;i<this.sd.length;i++){var n=this.sd.data[i];0!==(t&&t.layerMask&n.layerMask)&&n.render()}this.uu.onAfterSpritesRenderingObservable.notifyObservers(this.uu)}},t.bd=o.Zero(),t}(),pi=function(){},Mi=function(){function t(i){this.gd=!1,this.wd=new Array,this.md={},this.jd={},this.Od={},this.yd={},this.Ad=new pi,this.uu=i;for(var n=t.MIN_RENDERINGGROUPS;n<t.MAX_RENDERINGGROUPS;n++)this.md[n]={autoClear:!0,depth:!0,stencil:!0}}return t.prototype.pd=function(t,i){void 0===t&&(t=!0),void 0===i&&(i=!0),this.Md||(this.uu.getEngine().clear(null,!1,t,i),this.Md=!0)},t.prototype.render=function(i,n,s,h){var r=this.Ad;if(r.scene=this.uu,r.camera=this.uu.activeCamera,this.uu.spriteManagers&&h)for(var e=0;e<this.uu.spriteManagers.length;e++){var u=this.uu.spriteManagers[e];this.dispatchSprites(u)}for(e=t.MIN_RENDERINGGROUPS;e<t.MAX_RENDERINGGROUPS;e++){this.Md=e===t.MIN_RENDERINGGROUPS;var o=this.wd[e];if(o){var f=Math.pow(2,e);if(r.renderingGroupId=e,this.uu.onBeforeRenderingGroupObservable.notifyObservers(r,f),t.AUTOCLEAR){var c=this.gd?this.uu.getAutoClearDepthStencilSetup(e):this.md[e];c&&c.autoClear&&this.pd(c.depth,c.stencil)}for(var a=0,l=this.uu.Kd;a<l.length;a++){l[a].action(e)}o.render(i,h,s,n);for(var v=0,b=this.uu.Pd;v<b.length;v++){b[v].action(e)}this.uu.onAfterRenderingGroupObservable.notifyObservers(r,f)}}},t.prototype.reset=function(){for(var i=t.MIN_RENDERINGGROUPS;i<t.MAX_RENDERINGGROUPS;i++){var n=this.wd[i];n&&n.prepare()}},t.prototype.dispose=function(){this.freeRenderingGroups(),this.wd.length=0,this.Ad=null},t.prototype.freeRenderingGroups=function(){for(var i=t.MIN_RENDERINGGROUPS;i<t.MAX_RENDERINGGROUPS;i++){var n=this.wd[i];n&&n.dispose()}},t.prototype.xd=function(t){void 0===this.wd[t]&&(this.wd[t]=new Ai(t,this.uu,this.jd[t],this.Od[t],this.yd[t]))},t.prototype.dispatchSprites=function(t){var i=t.renderingGroupId||0;this.xd(i),this.wd[i].dispatchSprites(t)},t.prototype.dispatchParticles=function(t){var i=t.renderingGroupId||0;this.xd(i),this.wd[i].dispatchParticles(t)},t.prototype.dispatch=function(t,i,n){void 0===i&&(i=t.getMesh());var s=i.renderingGroupId||0;this.xd(s),this.wd[s].dispatch(t,i,n)},t.prototype.setRenderingOrder=function(t,i,n,s){if(void 0===i&&(i=null),void 0===n&&(n=null),void 0===s&&(s=null),this.jd[t]=i,this.Od[t]=n,this.yd[t]=s,this.wd[t]){var h=this.wd[t];h.opaqueSortCompareFn=this.jd[t],h.alphaTestSortCompareFn=this.Od[t],h.transparentSortCompareFn=this.yd[t]}},t.prototype.setRenderingAutoClearDepthStencil=function(t,i,n,s){void 0===n&&(n=!0),void 0===s&&(s=!0),this.md[t]={autoClear:i,depth:n,stencil:s}},t.prototype.getAutoClearDepthStencilSetup=function(t){return this.md[t]},t.MAX_RENDERINGGROUPS=4,t.MIN_RENDERINGGROUPS=0,t.AUTOCLEAR=!0,t}(),Ki=(function(){function t(){}t.NAME_EFFECTLAYER="EffectLayer",t.NAME_LAYER="Layer",t.NAME_LENSFLARESYSTEM="LensFlareSystem",t.NAME_BOUNDINGBOXRENDERER="BoundingBoxRenderer",t.NAME_PARTICLESYSTEM="ParticleSystem",t.NAME_GAMEPAD="Gamepad",t.NAME_SIMPLIFICATIONQUEUE="SimplificationQueue",t.NAME_GEOMETRYBUFFERRENDERER="GeometryBufferRenderer",t.NAME_PREPASSRENDERER="PrePassRenderer",t.NAME_DEPTHRENDERER="DepthRenderer",t.NAME_POSTPROCESSRENDERPIPELINEMANAGER="PostProcessRenderPipelineManager",t.NAME_SPRITE="Sprite",t.NAME_OUTLINERENDERER="Outline",t.NAME_PROCEDURALTEXTURE="ProceduralTexture",t.NAME_SHADOWGENERATOR="ShadowGenerator",t.NAME_OCTREE="Octree",t.NAME_PHYSICSENGINE="PhysicsEngine",t.NAME_AUDIO="Audio",t.STEP_ISREADYFORMESH_EFFECTLAYER=0,t.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER=0,t.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER=0,t.STEP_ACTIVEMESH_BOUNDINGBOXRENDERER=0,t.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER=1,t.STEP_BEFORECAMERADRAW_EFFECTLAYER=0,t.STEP_BEFORECAMERADRAW_LAYER=1,t.STEP_BEFORECAMERADRAW_PREPASS=2,t.STEP_BEFORERENDERTARGETDRAW_LAYER=0,t.STEP_BEFORERENDERINGMESH_OUTLINE=0,t.STEP_AFTERRENDERINGMESH_OUTLINE=0,t.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW=0,t.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER=1,t.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE=0,t.STEP_BEFORECAMERAUPDATE_GAMEPAD=1,t.STEP_BEFORECLEAR_PROCEDURALTEXTURE=0,t.STEP_AFTERRENDERTARGETDRAW_LAYER=0,t.STEP_AFTERCAMERADRAW_EFFECTLAYER=0,t.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM=1,t.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW=2,t.STEP_AFTERCAMERADRAW_LAYER=3,t.STEP_AFTERCAMERADRAW_PREPASS=4,t.STEP_AFTERRENDER_AUDIO=0,t.STEP_GATHERRENDERTARGETS_DEPTHRENDERER=0,t.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER=1,t.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR=2,t.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER=3,t.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER=0,t.STEP_BEFORECLEARSTAGE_PREPASS=0,t.STEP_POINTERMOVE_SPRITE=0,t.STEP_POINTERDOWN_SPRITE=0,t.STEP_POINTERUP_SPRITE=0}(),function(t){function i(i){return t.apply(this,i)||this}return E(i,t),i.Create=function(){return Object.create(i.prototype)},i.prototype.registerStep=function(t,i,n){var s=0;for(Number.MAX_VALUE;s<this.length;s++){if(t<this[s].index)break}this.splice(s,0,{index:t,component:i,action:n.bind(i)})},i.prototype.clear=function(){this.length=0},i}(Array)),Pi=function(){function t(){}return t.POINTERDOWN=1,t.POINTERUP=2,t.POINTERMOVE=4,t.POINTERWHEEL=8,t.POINTERPICK=16,t.POINTERTAP=32,t.POINTERDOUBLETAP=64,t}(),xi=function(t,i){this.type=t,this.event=i},ki=function(t){function i(i,n,s,h){var r=t.call(this,i,n)||this;return r.ray=null,r.skipOnPointerObservable=!1,r.localPosition=new u(s,h),r}return E(i,t),i}(xi),Ei=function(t){function i(i,n,s){var h=t.call(this,i,n)||this;return h.pickInfo=s,h}return E(i,t),i}(xi),Ti=function(){function t(){this.hoverCursor="",this.actions=new Array,this.isRecursive=!1}return Object.defineProperty(t,"HasTriggers",{get:function(){for(var i in t.Triggers)if(t.Triggers.hasOwnProperty(i))return!0;return!1},enumerable:!1,configurable:!0}),Object.defineProperty(t,"HasPickTriggers",{get:function(){for(var i in t.Triggers)if(t.Triggers.hasOwnProperty(i)){var n=parseInt(i);if(n>=1&&n<=7)return!0}return!1},enumerable:!1,configurable:!0}),t.HasSpecificTrigger=function(i){for(var n in t.Triggers){if(t.Triggers.hasOwnProperty(n))if(parseInt(n)===i)return!0}return!1},t.Triggers={},t}(),Bi=function(){function t(){}return t.KEYDOWN=1,t.KEYUP=2,t}(),Fi=function(t,i){this.type=t,this.event=i},Ci=function(t){function i(i,n){var s=t.call(this,i,n)||this;return s.type=i,s.event=n,s.skipOnPointerObservable=!1,s}return E(i,t),i}(Fi),_i=function(){function t(){this.kd=!1,this.Ed=!1,this.Td=!1,this.Bd=!1}return Object.defineProperty(t.prototype,"singleClick",{get:function(){return this.kd},set:function(t){this.kd=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"doubleClick",{get:function(){return this.Ed},set:function(t){this.Ed=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasSwiped",{get:function(){return this.Td},set:function(t){this.Td=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ignore",{get:function(){return this.Bd},set:function(t){this.Bd=t},enumerable:!1,configurable:!0}),t}(),Ui=function(){function t(t){this.Fd="",this.Cd=!1,this._d=null,this.Ud=null,this.Rd=0,this.Sd=!1,this.Ld=0,this.Dd=0,this.Id=new u(0,0),this.Nd=new u(0,0),this.Xd=0,this.Wd=0,this.Gd={},this.uu=t}return Object.defineProperty(t.prototype,"meshUnderPointer",{get:function(){return this.qd},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"unTranslatedPointer",{get:function(){return new u(this.Qd,this.Yd)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pointerX",{get:function(){return this.Ld},set:function(t){this.Ld=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pointerY",{get:function(){return this.Dd},set:function(t){this.Dd=t},enumerable:!1,configurable:!0}),t.prototype.Vd=function(t){var i=this.uu.getEngine().getInputElementClientRect();i&&(this.Ld=t.clientX-i.left,this.Dd=t.clientY-i.top,this.Qd=this.Ld,this.Yd=this.Dd)},t.prototype.Hd=function(t,i){var n=this.uu,s=n.getEngine(),h=s.getInputElement();if(h){h.tabIndex=s.canvasTabIndex,n.doNotHandleCursors||(h.style.cursor=n.defaultCursor);var r=!!(t&&t.hit&&t.pickedMesh);r?(n.setPointerOverMesh(t.pickedMesh),this.qd&&this.qd.actionManager&&this.qd.actionManager.hasPointerTriggers&&(n.doNotHandleCursors||(this.qd.actionManager.hoverCursor?h.style.cursor=this.qd.actionManager.hoverCursor:h.style.cursor=n.hoverCursor))):n.setPointerOverMesh(null);for(var e=0,u=n.zd;e<u.length;e++){t=u[e].action(this.Qd,this.Yd,t,r,h)}if(t){var o=i.type===this.Fd?Pi.POINTERWHEEL:Pi.POINTERMOVE;if(n.onPointerMove&&n.onPointerMove(i,t,o),n.onPointerObservable.hasObservers()){var f=new Ei(o,i,t);this.Zd(f),n.onPointerObservable.notifyObservers(f,o)}}}},t.prototype.Zd=function(t){var i=this.uu;t.pickInfo&&!t.pickInfo.Mt&&(t.pickInfo.ray||(t.pickInfo.ray=i.createPickingRay(t.event.offsetX,t.event.offsetY,a.Identity(),i.activeCamera)))},t.prototype.Jd=function(t,i,n){var s=this.uu,h=new ki(n,i,this.Qd,this.Yd);return t&&(h.ray=t.ray),s.onPrePointerObservable.notifyObservers(h,n),!!h.skipOnPointerObservable},t.prototype.simulatePointerMove=function(t,i){var n=new PointerEvent("pointermove",i);this.Jd(t,n,Pi.POINTERMOVE)||this.Hd(t,n)},t.prototype.simulatePointerDown=function(t,i){var n=new PointerEvent("pointerdown",i);this.Jd(t,n,Pi.POINTERDOWN)||this.$d(t,n)},t.prototype.$d=function(i,n){var s=this,h=this.uu;if(i&&i.hit&&i.pickedMesh){this.tg=i.pickedMesh;var r=i.pickedMesh.gu();if(r){if(r.hasPickTriggers)switch(r.processTrigger(5,mi.CreateNew(i.pickedMesh,n)),n.button){case 0:r.processTrigger(2,mi.CreateNew(i.pickedMesh,n));break;case 1:r.processTrigger(4,mi.CreateNew(i.pickedMesh,n));break;case 2:r.processTrigger(3,mi.CreateNew(i.pickedMesh,n))}r.hasSpecificTrigger(8)&&window.setTimeout((function(){var i=h.pick(s.Qd,s.Yd,(function(t){return t.isPickable&&t.isVisible&&t.isReady()&&t.actionManager&&t.actionManager.hasSpecificTrigger(8)&&t==s.tg}),!1,h.cameraToUseForPointers);i&&i.hit&&i.pickedMesh&&r&&0!==s.Rd&&Date.now()-s.Xd>t.LongPressDelay&&!s.ig()&&(s.Xd=0,r.processTrigger(8,mi.CreateNew(i.pickedMesh,n)))}),t.LongPressDelay)}}else for(var e=0,u=h.ng;e<u.length;e++){i=u[e].action(this.Qd,this.Yd,i,n)}if(i){var o=Pi.POINTERDOWN;if(h.onPointerDown&&h.onPointerDown(n,i,o),h.onPointerObservable.hasObservers()){var f=new Ei(o,n,i);this.Zd(f),h.onPointerObservable.notifyObservers(f,o)}}},t.prototype.ig=function(){return Math.abs(this.Id.x-this.Ld)>t.DragMovementThreshold||Math.abs(this.Id.y-this.Dd)>t.DragMovementThreshold},t.prototype.simulatePointerUp=function(t,i,n){var s=new PointerEvent("pointerup",i),h=new _i;n?h.doubleClick=!0:h.singleClick=!0,this.Jd(t,s,Pi.POINTERUP)||this.sg(t,s,h)},t.prototype.sg=function(t,i,n){var s=this.uu;if(t&&t&&t.pickedMesh){if(this.hg=t.pickedMesh,this.tg===this.hg&&(s.onPointerPick&&s.onPointerPick(i,t),n.singleClick&&!n.ignore&&s.onPointerObservable.hasObservers())){var h=Pi.POINTERPICK,r=new Ei(h,i,t);this.Zd(r),s.onPointerObservable.notifyObservers(r,h)}var e=t.pickedMesh.gu();if(e&&!n.ignore){e.processTrigger(7,mi.CreateNew(t.pickedMesh,i)),!n.hasSwiped&&n.singleClick&&e.processTrigger(1,mi.CreateNew(t.pickedMesh,i));var u=t.pickedMesh.gu(6);n.doubleClick&&u&&u.processTrigger(6,mi.CreateNew(t.pickedMesh,i))}}else if(!n.ignore)for(var o=0,f=s.rg;o<f.length;o++){t=f[o].action(this.Qd,this.Yd,t,i)}if(this.tg&&this.tg!==this.hg){var c=this.tg.gu(16);c&&c.processTrigger(16,mi.CreateNew(this.tg,i))}var a=0;if(s.onPointerObservable.hasObservers()){if(!n.ignore&&!n.hasSwiped&&(n.singleClick&&s.onPointerObservable.hasSpecificMask(Pi.POINTERTAP)?a=Pi.POINTERTAP:n.doubleClick&&s.onPointerObservable.hasSpecificMask(Pi.POINTERDOUBLETAP)&&(a=Pi.POINTERDOUBLETAP),a)){r=new Ei(a,i,t);this.Zd(r),s.onPointerObservable.notifyObservers(r,a)}if(!n.ignore){a=Pi.POINTERUP;r=new Ei(a,i,t);this.Zd(r),s.onPointerObservable.notifyObservers(r,a)}}s.onPointerUp&&!n.ignore&&s.onPointerUp(i,t,a)},t.prototype.isPointerCaptured=function(t){return void 0===t&&(t=0),this.Gd[t]},t.prototype.attachControl=function(i,n,s,h){var r=this;void 0===i&&(i=!0),void 0===n&&(n=!0),void 0===s&&(s=!0),void 0===h&&(h=null);var e=this.uu;if(h||(h=e.getEngine().getInputElement()),h){var u,o=e.getEngine();this.eg=function(t,i){if(!r.Cd){var n=e.pick(r.Qd,r.Yd,e.pointerDownPredicate,!1,e.cameraToUseForPointers);r._d=n,n&&(t=n.hit&&n.pickedMesh?n.pickedMesh.gu():null),r.Cd=!0}return t},this.ug=function(i,n,s){(Date.now()-r.Wd>t.DoubleClickDelay&&!r.Sd||i!==r.og)&&(r.Sd=!1,n.singleClick=!0,n.ignore=!1,s(n,r._d))},this.fg=function(i,n,s,h){var e=new _i;r._d=null;var u=null,o=i.hasSpecificMask(Pi.POINTERPICK)||n.hasSpecificMask(Pi.POINTERPICK)||i.hasSpecificMask(Pi.POINTERTAP)||n.hasSpecificMask(Pi.POINTERTAP)||i.hasSpecificMask(Pi.POINTERDOUBLETAP)||n.hasSpecificMask(Pi.POINTERDOUBLETAP);!o&&Ti&&(u=r.eg(u,e))&&(o=u.hasPickTriggers);var f=!1;if(o){var c=s.button;if(e.hasSwiped=r.ig(),!e.hasSwiped){var a=!t.ExclusiveDoubleClickMode;a||(a=!i.hasSpecificMask(Pi.POINTERDOUBLETAP)&&!n.hasSpecificMask(Pi.POINTERDOUBLETAP))&&!Ti.HasSpecificTrigger(6)&&(u=r.eg(u,e))&&(a=!u.hasSpecificTrigger(6)),a?(Date.now()-r.Wd>t.DoubleClickDelay||c!==r.og)&&(e.singleClick=!0,h(e,r._d),f=!0):(r.cg=r.ag,r.ag=window.setTimeout(r.ug.bind(r,c,e,h),t.DoubleClickDelay));var l=i.hasSpecificMask(Pi.POINTERDOUBLETAP)||n.hasSpecificMask(Pi.POINTERDOUBLETAP);!l&&Ti.HasSpecificTrigger(6)&&(u=r.eg(u,e))&&(l=u.hasSpecificTrigger(6)),l&&(c===r.og&&Date.now()-r.Wd<t.DoubleClickDelay&&!r.Sd?(e.hasSwiped||r.ig()?(r.Sd=!1,r.Wd=r.Xd,r.Nd.x=r.Id.x,r.Nd.y=r.Id.y,r.og=c,t.ExclusiveDoubleClickMode?(r.cg&&clearTimeout(r.cg),r.cg=r.ag,h(e,r.Ud)):h(e,r._d)):(r.Wd=0,r.Sd=!0,e.doubleClick=!0,e.ignore=!1,t.ExclusiveDoubleClickMode&&r.cg&&clearTimeout(r.cg),r.cg=r.ag,h(e,r._d)),f=!0):(r.Sd=!1,r.Wd=r.Xd,r.Nd.x=r.Id.x,r.Nd.y=r.Id.y,r.og=c))}}f||h(e,r._d)},this.lg=function(t){if(r.Vd(t),!r.Jd(null,t,t.type===r.Fd?Pi.POINTERWHEEL:Pi.POINTERMOVE)&&(e.cameraToUseForPointers||e.activeCamera)){e.pointerMovePredicate||(e.pointerMovePredicate=function(t){return t.isPickable&&t.isVisible&&t.isReady()&&t.isEnabled()&&(t.enablePointerMoveEvents||e.constantlyUpdateMeshUnderPointer||null!=t.gu())&&(!e.cameraToUseForPointers||0!=(e.cameraToUseForPointers.layerMask&t.layerMask))});var i=e.pick(r.Qd,r.Yd,e.pointerMovePredicate,!1,e.cameraToUseForPointers);r.Hd(i,t)}},this.vg=function(t){if(r.Rd++,r.tg=null,r.Cd=!1,r.Vd(t),e.preventDefaultOnPointerDown&&h&&(t.preventDefault(),h.focus()),r.Id.x=r.Ld,r.Id.y=r.Dd,r.Xd=Date.now(),!r.Jd(null,t,Pi.POINTERDOWN)&&(e.cameraToUseForPointers||e.activeCamera)){r.Gd[t.pointerId]=!0,e.pointerDownPredicate||(e.pointerDownPredicate=function(t){return t.isPickable&&t.isVisible&&t.isReady()&&t.isEnabled()&&(!e.cameraToUseForPointers||0!=(e.cameraToUseForPointers.layerMask&t.layerMask))}),r.tg=null;var i=e.pick(r.Qd,r.Yd,e.pointerDownPredicate,!1,e.cameraToUseForPointers);r.$d(i,t)}},this.bg=function(t){0!==r.Rd&&(r.Rd--,r.hg=null,r.Cd=!1,r.Vd(t),e.preventDefaultOnPointerUp&&h&&(t.preventDefault(),h.focus()),r.fg(e.onPrePointerObservable,e.onPointerObservable,t,(function(i,n){if(e.onPrePointerObservable.hasObservers()&&!i.ignore){if(!i.hasSwiped){if(i.singleClick&&e.onPrePointerObservable.hasSpecificMask(Pi.POINTERTAP)&&r.Jd(null,t,Pi.POINTERTAP))return;if(i.doubleClick&&e.onPrePointerObservable.hasSpecificMask(Pi.POINTERDOUBLETAP)&&r.Jd(null,t,Pi.POINTERDOUBLETAP))return}if(r.Jd(null,t,Pi.POINTERUP))return}r.Gd[t.pointerId]&&(r.Gd[t.pointerId]=!1,(e.cameraToUseForPointers||e.activeCamera)&&(e.pointerUpPredicate||(e.pointerUpPredicate=function(t){return t.isPickable&&t.isVisible&&t.isReady()&&t.isEnabled()&&(!e.cameraToUseForPointers||0!=(e.cameraToUseForPointers.layerMask&t.layerMask))}),!r.Cd&&(Ti&&Ti.HasTriggers||e.onPointerObservable.hasObservers())&&r.eg(null,i),n||(n=r._d),r.sg(n,t,i),r.Ud=r._d))})))},this.dg=function(t){var i=Bi.KEYDOWN;if(e.onPreKeyboardObservable.hasObservers()){var n=new Ci(i,t);if(e.onPreKeyboardObservable.notifyObservers(n,i),n.skipOnPointerObservable)return}if(e.onKeyboardObservable.hasObservers()){n=new Fi(i,t);e.onKeyboardObservable.notifyObservers(n,i)}e.actionManager&&e.actionManager.processTrigger(14,mi.CreateNewFromScene(e,t))},this.gg=function(t){var i=Bi.KEYUP;if(e.onPreKeyboardObservable.hasObservers()){var n=new Ci(i,t);if(e.onPreKeyboardObservable.notifyObservers(n,i),n.skipOnPointerObservable)return}if(e.onKeyboardObservable.hasObservers()){n=new Fi(i,t);e.onKeyboardObservable.notifyObservers(n,i)}e.actionManager&&e.actionManager.processTrigger(15,mi.CreateNewFromScene(e,t))},this.wg=o.onCanvasFocusObservable.add((u=function(){h&&(h.addEventListener("keydown",r.dg,!1),h.addEventListener("keyup",r.gg,!1))},document.activeElement===h&&u(),u)),this.mg=o.onCanvasBlurObservable.add((function(){h&&(h.removeEventListener("keydown",r.dg),h.removeEventListener("keyup",r.gg))}));var f=Et.GetPointerPrefix(o);if(s&&(h.addEventListener(f+"move",this.lg,!1),this.Fd="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",h.addEventListener(this.Fd,this.lg,!1)),n&&h.addEventListener(f+"down",this.vg,!1),i){var c=e.getEngine().getHostWindow();c&&c.addEventListener(f+"up",this.bg,!1)}}},t.prototype.detachControl=function(){var t=this.uu.getEngine().getInputElement(),i=this.uu.getEngine(),n=Et.GetPointerPrefix(i);t&&(t.removeEventListener(n+"move",this.lg),t.removeEventListener(this.Fd,this.lg),t.removeEventListener(n+"down",this.vg),window.removeEventListener(n+"up",this.bg),this.mg&&i.onCanvasBlurObservable.remove(this.mg),this.wg&&i.onCanvasFocusObservable.remove(this.wg),t.removeEventListener("keydown",this.dg),t.removeEventListener("keyup",this.gg),this.uu.doNotHandleCursors||(t.style.cursor=this.uu.defaultCursor))},t.prototype.setPointerOverMesh=function(t){var i;this.qd!==t&&(this.qd&&(i=this.qd.gu(10))&&i.processTrigger(10,mi.CreateNew(this.qd)),this.qd=t,this.qd&&(i=this.qd.gu(9))&&i.processTrigger(9,mi.CreateNew(this.qd)))},t.prototype.getPointerOverMesh=function(){return this.qd},t.DragMovementThreshold=10,t.LongPressDelay=500,t.DoubleClickDelay=300,t.ExclusiveDoubleClickMode=!1,t}(),Ri=function(){function t(){}return Object.defineProperty(t,"UniqueId",{get:function(){var t=this.jg;return this.jg++,t},enumerable:!1,configurable:!0}),t.jg=0,t}(),Si=function(t){function i(n,s){var h=t.call(this)||this;h.Og=new Ui(h),h.cameraToUseForPointers=null,h.yg=!0,h.Ag=!1,h.autoClear=!0,h.autoClearDepthAndStencil=!0,h.clearColor=new g(.2,.2,.3,1),h.ambientColor=new d(0,0,0),h.pg=1,h.Mg=!1,h.Kg=!1,h.Pg=!1,h.animationsEnabled=!0,h.su=null,h.useConstantAnimationDeltaTime=!1,h.constantlyUpdateMeshUnderPointer=!1,h.hoverCursor="pointer",h.defaultCursor="",h.doNotHandleCursors=!1,h.preventDefaultOnPointerDown=!0,h.preventDefaultOnPointerUp=!0,h.metadata=null,h.reservedDataStore=null,h.disableOfflineSupportExceptionRules=new Array,h.onDisposeObservable=new _,h.ru=null,h.onBeforeRenderObservable=new _,h.xg=null,h.onAfterRenderObservable=new _,h.onAfterRenderCameraObservable=new _,h.kg=null,h.onBeforeAnimationsObservable=new _,h.onAfterAnimationsObservable=new _,h.onBeforeDrawPhaseObservable=new _,h.onAfterDrawPhaseObservable=new _,h.onReadyObservable=new _,h.onBeforeCameraRenderObservable=new _,h.Eg=null,h.onAfterCameraRenderObservable=new _,h.Tg=null,h.onBeforeActiveMeshesEvaluationObservable=new _,h.onAfterActiveMeshesEvaluationObservable=new _,h.onBeforeParticlesRenderingObservable=new _,h.onAfterParticlesRenderingObservable=new _,h.onDataLoadedObservable=new _,h.onNewCameraAddedObservable=new _,h.onCameraRemovedObservable=new _,h.onNewLightAddedObservable=new _,h.onLightRemovedObservable=new _,h.onNewGeometryAddedObservable=new _,h.onGeometryRemovedObservable=new _,h.onNewTransformNodeAddedObservable=new _,h.onTransformNodeRemovedObservable=new _,h.onNewMeshAddedObservable=new _,h.onMeshRemovedObservable=new _,h.onNewSkeletonAddedObservable=new _,h.onSkeletonRemovedObservable=new _,h.onNewMaterialAddedObservable=new _,h.onMaterialRemovedObservable=new _,h.onNewTextureAddedObservable=new _,h.onTextureRemovedObservable=new _,h.onBeforeRenderTargetsRenderObservable=new _,h.onAfterRenderTargetsRenderObservable=new _,h.onBeforeStepObservable=new _,h.onAfterStepObservable=new _,h.onActiveCameraChanged=new _,h.onBeforeRenderingGroupObservable=new _,h.onAfterRenderingGroupObservable=new _,h.onMeshImportedObservable=new _,h.onAnimationFileImportedObservable=new _,h.Bg=new Bt(256),h.onPrePointerObservable=new _,h.onPointerObservable=new _,h.onPreKeyboardObservable=new _,h.onKeyboardObservable=new _,h.Fg=!1,h.Cg=0,h._g=0,h.Ug=0,h.hb=!0,h.Rg=i.FOGMODE_NONE,h.fogColor=new d(.2,.2,.3),h.fogDensity=.1,h.fogStart=0,h.fogEnd=1e3,h.prePass=!1,h.Sg=!0,h.Lg=!0,h.activeCameras=new Array,h.Dg=!0,h.physicsEnabled=!0,h.particlesEnabled=!0,h.spritesEnabled=!0,h.Ig=!0,h.lensFlaresEnabled=!0,h.collisionsEnabled=!0,h.gravity=new o(0,-9.807,0),h.postProcessesEnabled=!0,h.postProcesses=new Array,h.renderTargetsEnabled=!0,h.dumpNextRenderTargets=!1,h.customRenderTargets=new Array,h.importedMeshesFiles=new Array,h.probesEnabled=!0,h.Ng=new Bt(256),h.proceduralTexturesEnabled=!0,h.Xg=new Zt,h.Wg=new Zt,h.dd=new Zt,h.Gg=new Zt,h.qg=0,h.animationTimeScale=1,h.ec=0,h.Qg=0,h.Yg=-1,h.Vg=!1,h.Hg=-1,h.zg=-1,h.Zg=new Array(256),h.ah=new Array,h.Jg=new Array,h.We=!1,h.dispatchAllSubMeshesOfActiveMeshes=!1,h.$c=new Tt(256),h.$g=new Tt(256),h.tw=new Bt(256),h.iw=new Tt(256),h.nw=new Bt(32),h.sw=new Bt(32),h.hw=new Array,h.sa=a.Zero(),h.requireLightSorting=!1,h.rw=[],h.ew=[],h.uw=[],h.ow=Ki.Create(),h.fw=Ki.Create(),h.cw=Ki.Create(),h.aw=Ki.Create(),h.lw=Ki.Create(),h.vw=Ki.Create(),h.bw=Ki.Create(),h.dw=Ki.Create(),h.gw=Ki.Create(),h.ww=Ki.Create(),h.mw=Ki.Create(),h.Kd=Ki.Create(),h.jw=Ki.Create(),h.Ow=Ki.Create(),h.Pd=Ki.Create(),h.yw=Ki.Create(),h.Aw=Ki.Create(),h.pw=Ki.Create(),h.zd=Ki.Create(),h.ng=Ki.Create(),h.rg=Ki.Create(),h.geometriesByUniqueId=null,h.Mw={data:[],length:0},h.Kw={data:[],length:0},h.Pw=!1,h.xw=!1,h.kw=!1,h.Ew=!0,h.getDeterministicFrameTime=function(){return h.ct.getTimeStep()},h.Tw=!1;var r=T({useGeometryUniqueIdsMap:!0,useMaterialMeshMap:!0,useClonedMeshMap:!0,virtual:!1},s);return h.ct=n||G.LastCreatedEngine,r.virtual||(G.Wt=h,h.ct.scenes.push(h)),h.Bw=null,h.Fw=new Mi(h),yi&&(h.postProcessManager=new yi(h)),U.IsWindowObjectExist()&&h.attachControl(),h.Cw(),di&&(h._w=new di),h.setDefaultCandidateProviders(),r.useGeometryUniqueIdsMap&&(h.geometriesByUniqueId={}),h.useMaterialMeshMap=r.useMaterialMeshMap,h.useClonedMeshMap=r.useClonedMeshMap,s&&s.virtual||h.ct.onNewSceneAddedObservable.notifyObservers(h),h}return E(i,t),i.DefaultMaterialFactory=function(t){throw X.WarnImport("StandardMaterial")},i.CollisionCoordinatorFactory=function(){throw X.WarnImport("DefaultCollisionCoordinator")},Object.defineProperty(i.prototype,"environmentTexture",{get:function(){return this.Uw},set:function(t){this.Uw!==t&&(this.Uw=t,this.markAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"environmentIntensity",{get:function(){return this.pg},set:function(t){this.pg!==t&&(this.pg=t,this.markAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"imageProcessingConfiguration",{get:function(){return this._w},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"forceWireframe",{get:function(){return this.Mg},set:function(t){this.Mg!==t&&(this.Mg=t,this.markAllMaterialsAsDirty(16))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"skipFrustumClipping",{get:function(){return this.Kg},set:function(t){this.Kg!==t&&(this.Kg=t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"forcePointsCloud",{get:function(){return this.Pg},set:function(t){this.Pg!==t&&(this.Pg=t,this.markAllMaterialsAsDirty(16))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"animationPropertiesOverride",{get:function(){return this.su},set:function(t){this.su=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onDispose",{set:function(t){this.ru&&this.onDisposeObservable.remove(this.ru),this.ru=this.onDisposeObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"beforeRender",{set:function(t){this.xg&&this.onBeforeRenderObservable.remove(this.xg),t&&(this.xg=this.onBeforeRenderObservable.add(t))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"afterRender",{set:function(t){this.kg&&this.onAfterRenderObservable.remove(this.kg),t&&(this.kg=this.onAfterRenderObservable.add(t))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"beforeCameraRender",{set:function(t){this.Eg&&this.onBeforeCameraRenderObservable.remove(this.Eg),this.Eg=this.onBeforeCameraRenderObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"afterCameraRender",{set:function(t){this.Tg&&this.onAfterCameraRenderObservable.remove(this.Tg),this.Tg=this.onAfterCameraRenderObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"unTranslatedPointer",{get:function(){return this.Og.unTranslatedPointer},enumerable:!1,configurable:!0}),Object.defineProperty(i,"DragMovementThreshold",{get:function(){return Ui.DragMovementThreshold},set:function(t){Ui.DragMovementThreshold=t},enumerable:!1,configurable:!0}),Object.defineProperty(i,"LongPressDelay",{get:function(){return Ui.LongPressDelay},set:function(t){Ui.LongPressDelay=t},enumerable:!1,configurable:!0}),Object.defineProperty(i,"DoubleClickDelay",{get:function(){return Ui.DoubleClickDelay},set:function(t){Ui.DoubleClickDelay=t},enumerable:!1,configurable:!0}),Object.defineProperty(i,"ExclusiveDoubleClickMode",{get:function(){return Ui.ExclusiveDoubleClickMode},set:function(t){Ui.ExclusiveDoubleClickMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"useRightHandedSystem",{get:function(){return this.Fg},set:function(t){this.Fg!==t&&(this.Fg=t,this.markAllMaterialsAsDirty(16))},enumerable:!1,configurable:!0}),i.prototype.setStepId=function(t){this._g=t},i.prototype.getStepId=function(){return this._g},i.prototype.getInternalStep=function(){return this.Ug},Object.defineProperty(i.prototype,"fogEnabled",{get:function(){return this.hb},set:function(t){this.hb!==t&&(this.hb=t,this.markAllMaterialsAsDirty(16))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"fogMode",{get:function(){return this.Rg},set:function(t){this.Rg!==t&&(this.Rg=t,this.markAllMaterialsAsDirty(16))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"shadowsEnabled",{get:function(){return this.Sg},set:function(t){this.Sg!==t&&(this.Sg=t,this.markAllMaterialsAsDirty(2))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"lightsEnabled",{get:function(){return this.Lg},set:function(t){this.Lg!==t&&(this.Lg=t,this.markAllMaterialsAsDirty(2))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"activeCamera",{get:function(){return this.Rw},set:function(t){t!==this.Rw&&(this.Rw=t,this.onActiveCameraChanged.notifyObservers(this))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"defaultMaterial",{get:function(){return this.Sw||(this.Sw=i.DefaultMaterialFactory(this)),this.Sw},set:function(t){this.Sw=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"texturesEnabled",{get:function(){return this.Dg},set:function(t){this.Dg!==t&&(this.Dg=t,this.markAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"skeletonsEnabled",{get:function(){return this.Ig},set:function(t){this.Ig!==t&&(this.Ig=t,this.markAllMaterialsAsDirty(8))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"collisionCoordinator",{get:function(){return this.Lw||(this.Lw=i.CollisionCoordinatorFactory(),this.Lw.init(this)),this.Lw},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"frustumPlanes",{get:function(){return this.ya},enumerable:!1,configurable:!0}),i.prototype.Dw=function(){if(this.uw.length>0){for(var t=0,i=this.uw;t<i.length;t++){i[t].register()}this.uw=[]}},i.prototype.Iw=function(t){this.rw.push(t),this.uw.push(t);var i=t;i.addFromContainer&&i.serialize&&this.ew.push(i)},i.prototype.Nw=function(t){for(var i=0,n=this.rw;i<n.length;i++){var s=n[i];if(s.name===t)return s}return null},i.prototype.getClassName=function(){return"Scene"},i.prototype.Xw=function(){return this.Mw.data=this.meshes,this.Mw.length=this.meshes.length,this.Mw},i.prototype.Ww=function(t){return this.Kw.data=t.subMeshes,this.Kw.length=t.subMeshes.length,this.Kw},i.prototype.setDefaultCandidateProviders=function(){this.getActiveMeshCandidates=this.Xw.bind(this),this.getActiveSubMeshCandidates=this.Ww.bind(this),this.getIntersectingSubMeshCandidates=this.Ww.bind(this),this.getCollidingSubMeshCandidates=this.Ww.bind(this)},Object.defineProperty(i.prototype,"meshUnderPointer",{get:function(){return this.Og.meshUnderPointer},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"pointerX",{get:function(){return this.Og.pointerX},set:function(t){this.Og.pointerX=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"pointerY",{get:function(){return this.Og.pointerY},set:function(t){this.Og.pointerY=t},enumerable:!1,configurable:!0}),i.prototype.getCachedMaterial=function(){return this.yb},i.prototype.getCachedEffect=function(){return this.Gw},i.prototype.getCachedVisibility=function(){return this.Ab},i.prototype.isCachedMaterialInvalid=function(t,i,n){return void 0===n&&(n=1),this.Gw!==i||this.yb!==t||this.Ab!==n},i.prototype.getEngine=function(){return this.ct},i.prototype.getTotalVertices=function(){return this.Xg.current},Object.defineProperty(i.prototype,"totalVerticesPerfCounter",{get:function(){return this.Xg},enumerable:!1,configurable:!0}),i.prototype.getActiveIndices=function(){return this.Wg.current},Object.defineProperty(i.prototype,"totalActiveIndicesPerfCounter",{get:function(){return this.Wg},enumerable:!1,configurable:!0}),i.prototype.getActiveParticles=function(){return this.dd.current},Object.defineProperty(i.prototype,"activeParticlesPerfCounter",{get:function(){return this.dd},enumerable:!1,configurable:!0}),i.prototype.getActiveBones=function(){return this.Gg.current},Object.defineProperty(i.prototype,"activeBonesPerfCounter",{get:function(){return this.Gg},enumerable:!1,configurable:!0}),i.prototype.getActiveMeshes=function(){return this.$c},i.prototype.getAnimationRatio=function(){return void 0!==this.qw?this.qw:1},i.prototype.getRenderId=function(){return this.ec},i.prototype.getFrameId=function(){return this.Qg},i.prototype.incrementRenderId=function(){this.ec++},i.prototype.Cw=function(){this.Qw=new gi(this.ct,void 0,!0),this.Qw.addUniform("viewProjection",16),this.Qw.addUniform("view",16)},i.prototype.simulatePointerMove=function(t,i){return this.Og.simulatePointerMove(t,i),this},i.prototype.simulatePointerDown=function(t,i){return this.Og.simulatePointerDown(t,i),this},i.prototype.simulatePointerUp=function(t,i,n){return this.Og.simulatePointerUp(t,i,n),this},i.prototype.isPointerCaptured=function(t){return void 0===t&&(t=0),this.Og.isPointerCaptured(t)},i.prototype.attachControl=function(t,i,n){void 0===t&&(t=!0),void 0===i&&(i=!0),void 0===n&&(n=!0),this.Og.attachControl(t,i,n)},i.prototype.detachControl=function(){this.Og.detachControl()},i.prototype.isReady=function(){if(this.We)return!1;var t,i=this.getEngine();if(!i.areAllEffectsReady())return!1;if(this.Jg.length>0)return!1;for(t=0;t<this.meshes.length;t++){var n=this.meshes[t];if(n.isEnabled()&&(n.subMeshes&&0!==n.subMeshes.length)){if(!n.isReady(!0))return!1;for(var s=n.hasThinInstances||"InstancedMesh"===n.getClassName()||"InstancedLinesMesh"===n.getClassName()||i.getCaps().instancedArrays&&n.instances.length>0,h=0,r=this.lw;h<r.length;h++){if(!r[h].action(n,s))return!1}}}for(t=0;t<this.geometries.length;t++){if(2===this.geometries[t].delayLoadState)return!1}if(this.activeCameras&&this.activeCameras.length>0)for(var e=0,u=this.activeCameras;e<u.length;e++){if(!u[e].isReady(!0))return!1}else if(this.activeCamera&&!this.activeCamera.isReady(!0))return!1;for(var o=0,f=this.particleSystems;o<f.length;o++){if(!f[o].isReady())return!1}return!0},i.prototype.resetCachedMaterial=function(){this.yb=null,this.Gw=null,this.Ab=null},i.prototype.registerBeforeRender=function(t){this.onBeforeRenderObservable.add(t)},i.prototype.unregisterBeforeRender=function(t){this.onBeforeRenderObservable.removeCallback(t)},i.prototype.registerAfterRender=function(t){this.onAfterRenderObservable.add(t)},i.prototype.unregisterAfterRender=function(t){this.onAfterRenderObservable.removeCallback(t)},i.prototype.Yw=function(t){var i=this,n=function(){t(),setTimeout((function(){i.unregisterBeforeRender(n)}))};this.registerBeforeRender(n)},i.prototype.executeOnceBeforeRender=function(t,i){var n=this;void 0!==i?setTimeout((function(){n.Yw(t)}),i):this.Yw(t)},i.prototype.Ar=function(t){this.Jg.push(t)},i.prototype.pr=function(t){var i=this.isLoading,n=this.Jg.indexOf(t);-1!==n&&this.Jg.splice(n,1),i&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)},i.prototype.getWaitingItemsCount=function(){return this.Jg.length},Object.defineProperty(i.prototype,"isLoading",{get:function(){return this.Jg.length>0},enumerable:!1,configurable:!0}),i.prototype.executeWhenReady=function(t){var i=this;this.onReadyObservable.add(t),-1===this.Yg&&(this.Yg=setTimeout((function(){i.Di()}),150))},i.prototype.whenReadyAsync=function(){var t=this;return new Promise((function(i){t.executeWhenReady((function(){i()}))}))},i.prototype.Di=function(){var t=this;return this.Dw(),this.isReady()?(this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),void(this.Yg=-1)):this.We?(this.onReadyObservable.clear(),void(this.Yg=-1)):void(this.Yg=setTimeout((function(){t.Di()}),150))},Object.defineProperty(i.prototype,"animatables",{get:function(){return this.hw},enumerable:!1,configurable:!0}),i.prototype.resetLastAnimationTimeFrame=function(){this.Vw=N.Now},i.prototype.getViewMatrix=function(){return this.Hw},i.prototype.getProjectionMatrix=function(){return this.Jc},i.prototype.getTransformMatrix=function(){return this.sa},i.prototype.setTransformMatrix=function(t,i,n,s){this.Hg===t.updateFlag&&this.zg===i.updateFlag||(this.Hg=t.updateFlag,this.zg=i.updateFlag,this.Hw=t,this.Jc=i,this.Hw.multiplyToRef(this.Jc,this.sa),this.ya?O.GetPlanesToRef(this.sa,this.ya):this.ya=O.GetPlanes(this.sa),this.zw&&this.zw.useUbo?this.Zw(n,s):this.Qw.useUbo&&(this.Qw.updateMatrix("viewProjection",this.sa),this.Qw.updateMatrix("view",this.Hw),this.Qw.update()))},i.prototype.getSceneUniformBuffer=function(){return this.zw?this.zw:this.Qw},i.prototype.getUniqueId=function(){return Ri.UniqueId},i.prototype.addMesh=function(t,i){var n=this;void 0===i&&(i=!1),this.Ag||(this.meshes.push(t),t.bc(),t.parent||t.cu(),this.onNewMeshAddedObservable.notifyObservers(t),i&&t.getChildMeshes().forEach((function(t){n.addMesh(t)})))},i.prototype.removeMesh=function(t,i){var n=this;void 0===i&&(i=!1);var s=this.meshes.indexOf(t);return-1!==s&&(this.meshes[s]=this.meshes[this.meshes.length-1],this.meshes.pop(),t.parent||t.au()),this.onMeshRemovedObservable.notifyObservers(t),i&&t.getChildMeshes().forEach((function(t){n.removeMesh(t)})),s},i.prototype.addTransformNode=function(t){this.Ag||(t.qu=this.transformNodes.length,this.transformNodes.push(t),t.parent||t.cu(),this.onNewTransformNodeAddedObservable.notifyObservers(t))},i.prototype.removeTransformNode=function(t){var i=t.qu;if(-1!==i){if(i!==this.transformNodes.length-1){var n=this.transformNodes[this.transformNodes.length-1];this.transformNodes[i]=n,n.qu=i}t.qu=-1,this.transformNodes.pop(),t.parent||t.au()}return this.onTransformNodeRemovedObservable.notifyObservers(t),i},i.prototype.removeSkeleton=function(t){var i=this.skeletons.indexOf(t);return-1!==i&&(this.skeletons.splice(i,1),this.onSkeletonRemovedObservable.notifyObservers(t)),i},i.prototype.removeMorphTargetManager=function(t){var i=this.morphTargetManagers.indexOf(t);return-1!==i&&this.morphTargetManagers.splice(i,1),i},i.prototype.removeLight=function(t){var i=this.lights.indexOf(t);if(-1!==i){for(var n=0,s=this.meshes;n<s.length;n++){s[n].Kc(t,!1)}this.lights.splice(i,1),this.sortLightsByPriority(),t.parent||t.au()}return this.onLightRemovedObservable.notifyObservers(t),i},i.prototype.removeCamera=function(t){var i=this.cameras.indexOf(t);-1!==i&&(this.cameras.splice(i,1),t.parent||t.au());var n=this.activeCameras.indexOf(t);return-1!==n&&this.activeCameras.splice(n,1),this.activeCamera===t&&(this.cameras.length>0?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(t),i},i.prototype.removeParticleSystem=function(t){var i=this.particleSystems.indexOf(t);return-1!==i&&this.particleSystems.splice(i,1),i},i.prototype.removeAnimation=function(t){var i=this.animations.indexOf(t);return-1!==i&&this.animations.splice(i,1),i},i.prototype.stopAnimation=function(t,i,n){},i.prototype.removeAnimationGroup=function(t){var i=this.animationGroups.indexOf(t);return-1!==i&&this.animationGroups.splice(i,1),i},i.prototype.removeMultiMaterial=function(t){var i=this.multiMaterials.indexOf(t);return-1!==i&&this.multiMaterials.splice(i,1),i},i.prototype.removeMaterial=function(t){var i=t.ab;if(-1!==i&&i<this.materials.length){if(i!==this.materials.length-1){var n=this.materials[this.materials.length-1];this.materials[i]=n,n.ab=i}t.ab=-1,this.materials.pop()}return this.onMaterialRemovedObservable.notifyObservers(t),i},i.prototype.removeActionManager=function(t){var i=this.actionManagers.indexOf(t);return-1!==i&&this.actionManagers.splice(i,1),i},i.prototype.removeTexture=function(t){var i=this.textures.indexOf(t);return-1!==i&&this.textures.splice(i,1),this.onTextureRemovedObservable.notifyObservers(t),i},i.prototype.addLight=function(t){if(!this.Ag){this.lights.push(t),this.sortLightsByPriority(),t.parent||t.cu();for(var i=0,n=this.meshes;i<n.length;i++){var s=n[i];-1===s.lightSources.indexOf(t)&&(s.lightSources.push(t),s.bc())}this.onNewLightAddedObservable.notifyObservers(t)}},i.prototype.sortLightsByPriority=function(){this.requireLightSorting&&this.lights.sort(wi.CompareLightsPriority)},i.prototype.addCamera=function(t){this.Ag||(this.cameras.push(t),this.onNewCameraAddedObservable.notifyObservers(t),t.parent||t.cu())},i.prototype.addSkeleton=function(t){this.Ag||(this.skeletons.push(t),this.onNewSkeletonAddedObservable.notifyObservers(t))},i.prototype.addParticleSystem=function(t){this.Ag||this.particleSystems.push(t)},i.prototype.addAnimation=function(t){this.Ag||this.animations.push(t)},i.prototype.addAnimationGroup=function(t){this.Ag||this.animationGroups.push(t)},i.prototype.addMultiMaterial=function(t){this.Ag||this.multiMaterials.push(t)},i.prototype.addMaterial=function(t){this.Ag||(t.ab=this.materials.length,this.materials.push(t),this.onNewMaterialAddedObservable.notifyObservers(t))},i.prototype.addMorphTargetManager=function(t){this.Ag||this.morphTargetManagers.push(t)},i.prototype.addGeometry=function(t){this.Ag||(this.geometriesByUniqueId&&(this.geometriesByUniqueId[t.uniqueId]=this.geometries.length),this.geometries.push(t))},i.prototype.addActionManager=function(t){this.actionManagers.push(t)},i.prototype.addTexture=function(t){this.Ag||(this.textures.push(t),this.onNewTextureAddedObservable.notifyObservers(t))},i.prototype.switchActiveCamera=function(t,i){void 0===i&&(i=!0);var n=this.ct.getInputElement();n&&(this.activeCamera&&this.activeCamera.detachControl(n),this.activeCamera=t,i&&t.attachControl(n))},i.prototype.setActiveCameraByID=function(t){var i=this.getCameraByID(t);return i?(this.activeCamera=i,i):null},i.prototype.setActiveCameraByName=function(t){var i=this.getCameraByName(t);return i?(this.activeCamera=i,i):null},i.prototype.getAnimationGroupByName=function(t){for(var i=0;i<this.animationGroups.length;i++)if(this.animationGroups[i].name===t)return this.animationGroups[i];return null},i.prototype.getMaterialByUniqueID=function(t){for(var i=0;i<this.materials.length;i++)if(this.materials[i].uniqueId===t)return this.materials[i];return null},i.prototype.getMaterialByID=function(t){for(var i=0;i<this.materials.length;i++)if(this.materials[i].id===t)return this.materials[i];return null},i.prototype.getLastMaterialByID=function(t){for(var i=this.materials.length-1;i>=0;i--)if(this.materials[i].id===t)return this.materials[i];return null},i.prototype.getMaterialByName=function(t){for(var i=0;i<this.materials.length;i++)if(this.materials[i].name===t)return this.materials[i];return null},i.prototype.getTextureByUniqueID=function(t){for(var i=0;i<this.textures.length;i++)if(this.textures[i].uniqueId===t)return this.textures[i];return null},i.prototype.getCameraByID=function(t){for(var i=0;i<this.cameras.length;i++)if(this.cameras[i].id===t)return this.cameras[i];return null},i.prototype.getCameraByUniqueID=function(t){for(var i=0;i<this.cameras.length;i++)if(this.cameras[i].uniqueId===t)return this.cameras[i];return null},i.prototype.getCameraByName=function(t){for(var i=0;i<this.cameras.length;i++)if(this.cameras[i].name===t)return this.cameras[i];return null},i.prototype.getBoneByID=function(t){for(var i=0;i<this.skeletons.length;i++)for(var n=this.skeletons[i],s=0;s<n.bones.length;s++)if(n.bones[s].id===t)return n.bones[s];return null},i.prototype.getBoneByName=function(t){for(var i=0;i<this.skeletons.length;i++)for(var n=this.skeletons[i],s=0;s<n.bones.length;s++)if(n.bones[s].name===t)return n.bones[s];return null},i.prototype.getLightByName=function(t){for(var i=0;i<this.lights.length;i++)if(this.lights[i].name===t)return this.lights[i];return null},i.prototype.getLightByID=function(t){for(var i=0;i<this.lights.length;i++)if(this.lights[i].id===t)return this.lights[i];return null},i.prototype.getLightByUniqueID=function(t){for(var i=0;i<this.lights.length;i++)if(this.lights[i].uniqueId===t)return this.lights[i];return null},i.prototype.getParticleSystemByID=function(t){for(var i=0;i<this.particleSystems.length;i++)if(this.particleSystems[i].id===t)return this.particleSystems[i];return null},i.prototype.getGeometryByID=function(t){for(var i=0;i<this.geometries.length;i++)if(this.geometries[i].id===t)return this.geometries[i];return null},i.prototype.Jw=function(t){if(this.geometriesByUniqueId){var i=this.geometriesByUniqueId[t];if(void 0!==i)return this.geometries[i]}else for(var n=0;n<this.geometries.length;n++)if(this.geometries[n].uniqueId===t)return this.geometries[n];return null},i.prototype.pushGeometry=function(t,i){return!(!i&&this.Jw(t.uniqueId))&&(this.addGeometry(t),this.onNewGeometryAddedObservable.notifyObservers(t),!0)},i.prototype.removeGeometry=function(t){var i;if(this.geometriesByUniqueId){if(void 0===(i=this.geometriesByUniqueId[t.uniqueId]))return!1}else if((i=this.geometries.indexOf(t))<0)return!1;if(i!==this.geometries.length-1){var n=this.geometries[this.geometries.length-1];this.geometries[i]=n,this.geometriesByUniqueId&&(this.geometriesByUniqueId[n.uniqueId]=i,this.geometriesByUniqueId[t.uniqueId]=void 0)}return this.geometries.pop(),this.onGeometryRemovedObservable.notifyObservers(t),!0},i.prototype.getGeometries=function(){return this.geometries},i.prototype.getMeshByID=function(t){for(var i=0;i<this.meshes.length;i++)if(this.meshes[i].id===t)return this.meshes[i];return null},i.prototype.getMeshesByID=function(t){return this.meshes.filter((function(i){return i.id===t}))},i.prototype.getTransformNodeByID=function(t){for(var i=0;i<this.transformNodes.length;i++)if(this.transformNodes[i].id===t)return this.transformNodes[i];return null},i.prototype.getTransformNodeByUniqueID=function(t){for(var i=0;i<this.transformNodes.length;i++)if(this.transformNodes[i].uniqueId===t)return this.transformNodes[i];return null},i.prototype.getTransformNodesByID=function(t){return this.transformNodes.filter((function(i){return i.id===t}))},i.prototype.getMeshByUniqueID=function(t){for(var i=0;i<this.meshes.length;i++)if(this.meshes[i].uniqueId===t)return this.meshes[i];return null},i.prototype.getLastMeshByID=function(t){for(var i=this.meshes.length-1;i>=0;i--)if(this.meshes[i].id===t)return this.meshes[i];return null},i.prototype.getLastEntryByID=function(t){var i;for(i=this.meshes.length-1;i>=0;i--)if(this.meshes[i].id===t)return this.meshes[i];for(i=this.transformNodes.length-1;i>=0;i--)if(this.transformNodes[i].id===t)return this.transformNodes[i];for(i=this.cameras.length-1;i>=0;i--)if(this.cameras[i].id===t)return this.cameras[i];for(i=this.lights.length-1;i>=0;i--)if(this.lights[i].id===t)return this.lights[i];return null},i.prototype.getNodeByID=function(t){var i=this.getMeshByID(t);if(i)return i;var n=this.getTransformNodeByID(t);if(n)return n;var s=this.getLightByID(t);if(s)return s;var h=this.getCameraByID(t);if(h)return h;var r=this.getBoneByID(t);return r||null},i.prototype.getNodeByName=function(t){var i=this.getMeshByName(t);if(i)return i;var n=this.getTransformNodeByName(t);if(n)return n;var s=this.getLightByName(t);if(s)return s;var h=this.getCameraByName(t);if(h)return h;var r=this.getBoneByName(t);return r||null},i.prototype.getMeshByName=function(t){for(var i=0;i<this.meshes.length;i++)if(this.meshes[i].name===t)return this.meshes[i];return null},i.prototype.getTransformNodeByName=function(t){for(var i=0;i<this.transformNodes.length;i++)if(this.transformNodes[i].name===t)return this.transformNodes[i];return null},i.prototype.getLastSkeletonByID=function(t){for(var i=this.skeletons.length-1;i>=0;i--)if(this.skeletons[i].id===t)return this.skeletons[i];return null},i.prototype.getSkeletonByUniqueId=function(t){for(var i=0;i<this.skeletons.length;i++)if(this.skeletons[i].uniqueId===t)return this.skeletons[i];return null},i.prototype.getSkeletonById=function(t){for(var i=0;i<this.skeletons.length;i++)if(this.skeletons[i].id===t)return this.skeletons[i];return null},i.prototype.getSkeletonByName=function(t){for(var i=0;i<this.skeletons.length;i++)if(this.skeletons[i].name===t)return this.skeletons[i];return null},i.prototype.getMorphTargetManagerById=function(t){for(var i=0;i<this.morphTargetManagers.length;i++)if(this.morphTargetManagers[i].uniqueId===t)return this.morphTargetManagers[i];return null},i.prototype.getMorphTargetById=function(t){for(var i=0;i<this.morphTargetManagers.length;++i)for(var n=this.morphTargetManagers[i],s=0;s<n.numTargets;++s){var h=n.getTarget(s);if(h.id===t)return h}return null},i.prototype.getMorphTargetByName=function(t){for(var i=0;i<this.morphTargetManagers.length;++i)for(var n=this.morphTargetManagers[i],s=0;s<n.numTargets;++s){var h=n.getTarget(s);if(h.name===t)return h}return null},i.prototype.isActiveMesh=function(t){return-1!==this.$c.indexOf(t)},Object.defineProperty(i.prototype,"uid",{get:function(){return this.Bw||(this.Bw=Et.RandomId()),this.Bw},enumerable:!1,configurable:!0}),i.prototype.addExternalData=function(t,i){return this.$w||(this.$w=new Ft),this.$w.add(t,i)},i.prototype.getExternalData=function(t){return this.$w?this.$w.get(t):null},i.prototype.getOrAddExternalDataWithFactory=function(t,i){return this.$w||(this.$w=new Ft),this.$w.getOrAddWithFactory(t,i)},i.prototype.removeExternalData=function(t){return this.$w.remove(t)},i.prototype.tm=function(t,i,n){if(n.hasInstances||n.isAnInstance||this.dispatchAllSubMeshesOfActiveMeshes||this.Kg||i.alwaysSelectAsActiveMesh||1===i.subMeshes.length||t.isInFrustum(this.ya)){for(var s=0,h=this.bw;s<h.length;s++){h[s].action(i,t)}var r=t.getMaterial();null!=r&&(r.hasRenderTargetTextures&&null!=r.getRenderTargetTextures&&-1===this.$g.indexOf(r)&&(this.$g.push(r),this.tw.concatWithNoDuplicate(r.getRenderTargetTextures())),this.Fw.dispatch(t,i,r))}},i.prototype.freeProcessedMaterials=function(){this.$g.dispose()},Object.defineProperty(i.prototype,"blockfreeActiveMeshesAndRenderingGroups",{get:function(){return this.Pw},set:function(t){this.Pw!==t&&(t&&(this.freeActiveMeshes(),this.freeRenderingGroups()),this.Pw=t)},enumerable:!1,configurable:!0}),i.prototype.freeActiveMeshes=function(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this.$c.dispose(),this.activeCamera&&this.activeCamera.$c&&this.activeCamera.$c.dispose(),this.activeCameras))for(var t=0;t<this.activeCameras.length;t++){var i=this.activeCameras[t];i&&i.$c&&i.$c.dispose()}},i.prototype.freeRenderingGroups=function(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this.Fw&&this.Fw.freeRenderingGroups(),this.textures))for(var t=0;t<this.textures.length;t++){var i=this.textures[t];i&&i.renderList&&i.freeRenderingGroups()}},i.prototype.im=function(){return this.Vg},i.prototype.freezeActiveMeshes=function(t){var i=this;return void 0===t&&(t=!1),this.executeWhenReady((function(){if(i.activeCamera){i.ya||i.setTransformMatrix(i.activeCamera.getViewMatrix(),i.activeCamera.getProjectionMatrix()),i.nm(),i.xw=!0,i.kw=t;for(var n=0;n<i.$c.length;n++)i.$c.data[n].Cc()}})),this},i.prototype.unfreezeActiveMeshes=function(){for(var t=0;t<this.meshes.length;t++){var i=this.meshes[t];i.Jf&&(i.Jf.Yf=!1)}for(t=0;t<this.$c.length;t++)this.$c.data[t]._c();return this.xw=!1,this},i.prototype.nm=function(){if(this.xw&&this.$c.length){if(!this.kw)for(var t=this.$c.length,i=0;i<t;i++){(u=this.$c.data[i]).computeWorldMatrix()}if(this.iw){var n=this.iw.length;for(i=0;i<n;i++)this.iw.data[i].animate()}}else if(this.activeCamera){this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera.$c.reset(),this.$c.reset(),this.Fw.reset(),this.$g.reset(),this.iw.reset(),this.nw.reset(),this.sw.reset();for(var s=0,h=this.vw;s<h.length;s++){h[s].action()}var r=this.getActiveMeshCandidates(),e=r.length;for(i=0;i<e;i++){var u;if(!(u=r.data[i]).isBlocked&&(this.Xg.addCount(u.getTotalVertices(),!1),u.isReady()&&u.isEnabled()&&0!==u.scaling.lengthSquared())){u.computeWorldMatrix(),u.actionManager&&u.actionManager.hasSpecificTriggers2(12,13)&&this.Ng.pushNoDuplicate(u);var o=this.customLODSelector?this.customLODSelector(u,this.activeCamera):u.getLOD(this.activeCamera);null!=o&&(o!==u&&o.billboardMode!==Vt.BILLBOARDMODE_NONE&&o.computeWorldMatrix(),u.Ec(),u.isVisible&&u.visibility>0&&0!=(u.layerMask&this.activeCamera.layerMask)&&(this.Kg||u.alwaysSelectAsActiveMesh||u.isInFrustum(this.ya))&&(this.$c.push(u),this.activeCamera.$c.push(u),o!==u&&o.Bc(this.ec,!1),u.Bc(this.ec,!1)&&(u.isAnInstance?u.Jf.Zf&&(o=u):o.Jf.Vf=!1,o.Jf.Yf=!0,this.sm(u,o)),u.Fc()))}}if(this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this),this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(var f=0;f<this.particleSystems.length;f++){var c=this.particleSystems[f];if(c.isStarted()&&c.emitter){var a=c.emitter;a.position&&!a.isEnabled()||(this.iw.push(c),c.animate(),this.Fw.dispatchParticles(c))}}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}},i.prototype.sm=function(t,i){this.Ig&&null!==i.skeleton&&void 0!==i.skeleton&&(this.nw.pushNoDuplicate(i.skeleton)&&i.skeleton.prepare(),i.computeBonesUsingShaders||this.sw.pushNoDuplicate(i));for(var n=0,s=this.dw;n<s.length;n++){s[n].action(t,i)}if(null!=i&&void 0!==i.subMeshes&&null!==i.subMeshes&&i.subMeshes.length>0)for(var h=this.getActiveSubMeshCandidates(i),r=h.length,e=0;e<r;e++){var u=h.data[e];this.tm(u,i,t)}},i.prototype.updateTransformMatrix=function(t){this.activeCamera&&this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(t))},i.prototype.hm=function(){if(this.activeCamera&&this.activeCamera.rm)this.activeCamera.rm.hm();else if(this.activeCamera&&this.activeCamera.outputRenderTarget){if(this.getEngine().getCaps().multiview&&this.activeCamera.outputRenderTarget&&this.activeCamera.outputRenderTarget.getViewCount()>1)this.activeCamera.outputRenderTarget.hm();else{var t=this.activeCamera.outputRenderTarget.getInternalTexture();t?this.getEngine().bindFramebuffer(t):R.Error("Camera contains invalid customDefaultRenderTarget")}}else this.getEngine().restoreDefaultFramebuffer()},i.prototype.em=function(t,i){if(!t||!t.Zc){var n=this.ct;if(this.Rw=t,!this.activeCamera)throw new Error("Active camera not set");n.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this.ec++,this.getEngine().getCaps().multiview&&t.outputRenderTarget&&t.outputRenderTarget.getViewCount()>1?this.setTransformMatrix(t.Hc[0].getViewMatrix(),t.Hc[0].getProjectionMatrix(),t.Hc[1].getViewMatrix(),t.Hc[1].getProjectionMatrix()):this.updateTransformMatrix(),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this.nm();for(var s=0;s<this.sw.length;s++){var h=this.sw.data[s];h.applySkeleton(h.skeleton)}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),t.customRenderTargets&&t.customRenderTargets.length>0&&this.tw.concatWithNoDuplicate(t.customRenderTargets),i&&i.customRenderTargets&&i.customRenderTargets.length>0&&this.tw.concatWithNoDuplicate(i.customRenderTargets);for(var r=0,e=this.aw;r<e.length;r++){e[r].action(this.tw)}var u=!1;if(this.renderTargetsEnabled){if(this.Vg=!0,this.tw.length>0){Et.StartPerformanceCounter("Render targets",this.tw.length>0);for(var o=0;o<this.tw.length;o++){var f=this.tw.data[o];if(f.um()){this.ec++;var c=f.activeCamera&&f.activeCamera!==this.activeCamera;f.render(c,this.dumpNextRenderTargets),u=!0}}Et.EndPerformanceCounter("Render targets",this.tw.length>0),this.ec++}for(var a=0,l=this.gw;a<l.length;a++){u=l[a].action(this.activeCamera)||u}this.Vg=!1,this.activeCamera&&this.activeCamera.outputRenderTarget&&(u=!0)}u&&!this.prePass&&this.hm(),this.onAfterRenderTargetsRenderObservable.notifyObservers(this),!this.postProcessManager||t.rm||this.prePass||this.postProcessManager.Hb();for(var v=0,b=this.ww;v<b.length;v++){b[v].action(this.activeCamera)}this.onBeforeDrawPhaseObservable.notifyObservers(this),this.Fw.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this);for(var d=0,g=this.yw;d<g.length;d++){g[d].action(this.activeCamera)}this.postProcessManager&&!t.rm&&this.postProcessManager.zb(t.isIntermediate),this.tw.reset(),this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)}},i.prototype.om=function(t){if(t.cameraRigMode===ai.RIG_MODE_NONE||t.outputRenderTarget&&t.outputRenderTarget.getViewCount()>1&&this.getEngine().getCaps().multiview)return this.em(t),void this.onAfterRenderCameraObservable.notifyObservers(t);if(t.fm)this.cm(t);else for(var i=0;i<t.Hc.length;i++)this.em(t.Hc[i],t);this.Rw=t,this.setTransformMatrix(this.Rw.getViewMatrix(),this.Rw.getProjectionMatrix()),this.onAfterRenderCameraObservable.notifyObservers(t)},i.prototype.am=function(){for(var t=0;t<this.Ng.length;t++){var i=this.Ng.data[t];if(i.actionManager)for(var n=0;i.actionManager&&n<i.actionManager.actions.length;n++){var s=i.actionManager.actions[n];if(12===s.trigger||13===s.trigger){var h=s.getTriggerParameter(),r=h instanceof ci?h:h.mesh,e=r.intersectsMesh(i,h.usePreciseIntersection),u=i.uc.indexOf(r);e&&-1===u?12===s.trigger?(s.lm(mi.CreateNew(i,void 0,r)),i.uc.push(r)):13===s.trigger&&i.uc.push(r):!e&&u>-1&&(13===s.trigger&&s.lm(mi.CreateNew(i,void 0,r)),i.actionManager.hasSpecificTrigger(13,(function(t){var i=t instanceof ci?t:t.mesh;return r===i}))&&13!==s.trigger||i.uc.splice(u,1))}}}},i.prototype.vm=function(t){},i.prototype.bm=function(){},i.prototype.animate=function(){if(this.ct.isDeterministicLockStep()){var t=Math.max(i.MinDeltaTime,Math.min(this.ct.getDeltaTime(),i.MaxDeltaTime))+this.Cg,n=this.ct.getTimeStep(),s=1e3/n/1e3,h=0,r=this.ct.getLockstepMaxSteps(),e=Math.floor(t/n);for(e=Math.min(e,r);t>0&&h<e;)this.onBeforeStepObservable.notifyObservers(this),this.qw=n*s,this.bm(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this.vm(n),this.onAfterStepObservable.notifyObservers(this),this._g++,h++,t-=n;this.Cg=t<0?0:t}else{t=this.useConstantAnimationDeltaTime?16:Math.max(i.MinDeltaTime,Math.min(this.ct.getDeltaTime(),i.MaxDeltaTime));this.qw=.06*t,this.bm(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this.vm(t)}},i.prototype.render=function(t,i){if(void 0===t&&(t=!0),void 0===i&&(i=!1),!this.isDisposed){this.onReadyObservable.hasObservers()&&-1===this.Yg&&this.Di(),this.Qg++,this.Dw(),this.dd.fetchNewFrame(),this.Xg.fetchNewFrame(),this.Wg.fetchNewFrame(),this.Gg.fetchNewFrame(),this.Ng.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(11),i||this.animate();for(var n=0,s=this.ow;n<s.length;n++){s[n].action()}if(t)if(this.activeCameras.length>0)for(var h=0;h<this.activeCameras.length;h++){var r=this.activeCameras[h];if(r.update(),r.cameraRigMode!==ai.RIG_MODE_NONE)for(var e=0;e<r.Hc.length;e++)r.Hc[e].update()}else if(this.activeCamera&&(this.activeCamera.update(),this.activeCamera.cameraRigMode!==ai.RIG_MODE_NONE))for(e=0;e<this.activeCamera.Hc.length;e++)this.activeCamera.Hc[e].update();this.onBeforeRenderObservable.notifyObservers(this),this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);var u=this.getEngine(),o=this.activeCamera;if(this.renderTargetsEnabled){Et.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this.Vg=!0;for(var f=0;f<this.customRenderTargets.length;f++){var c=this.customRenderTargets[f];if(c.um()){if(this.ec++,this.activeCamera=c.activeCamera||this.activeCamera,!this.activeCamera)throw new Error("Active camera not set");u.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),c.render(o!==this.activeCamera,this.dumpNextRenderTargets)}}Et.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this.Vg=!1,this.ec++}this.activeCamera=o,this.Rw&&this.Rw.cameraRigMode!==ai.RIG_MODE_CUSTOM&&!this.prePass&&this.hm(),this.onAfterRenderTargetsRenderObservable.notifyObservers(this);for(var a=0,l=this.fw;a<l.length;a++){l[a].action()}!this.autoClearDepthAndStencil&&!this.autoClear||this.prePass||this.ct.clear(this.clearColor,this.autoClear||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil);for(var v=0,b=this.cw;v<b.length;v++){b[v].action(this.tw)}if(this.activeCameras.length>0)for(h=0;h<this.activeCameras.length;h++)h>0&&this.ct.clear(null,!1,!0,!0),this.om(this.activeCameras[h]);else{if(!this.activeCamera)throw new Error("No camera defined");this.om(this.activeCamera)}this.am();for(var d=0,g=this.pw;d<g.length;d++){g[d].action()}if(this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this),this.Zg.length){for(e=0;e<this.Zg.length;e++){var w=this.Zg[e];w&&w.dispose()}this.Zg=[]}this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this.Gg.addCount(0,!0),this.Wg.addCount(0,!0),this.dd.addCount(0,!0)}},i.prototype.freezeMaterials=function(){for(var t=0;t<this.materials.length;t++)this.materials[t].freeze()},i.prototype.unfreezeMaterials=function(){for(var t=0;t<this.materials.length;t++)this.materials[t].unfreeze()},i.prototype.dispose=function(){this.beforeRender=null,this.afterRender=null,G.Wt===this&&(G.Wt=null),this.skeletons=[],this.morphTargetManagers=[],this.uw=[],this.lw.clear(),this.vw.clear(),this.bw.clear(),this.dw.clear(),this.gw.clear(),this.ww.clear(),this.mw.clear(),this.Kd.clear(),this.jw.clear(),this.Ow.clear(),this.Pd.clear(),this.yw.clear(),this.Aw.clear(),this.pw.clear(),this.ow.clear(),this.fw.clear(),this.cw.clear(),this.aw.clear(),this.zd.clear(),this.ng.clear(),this.rg.clear();for(var t=0,i=this.rw;t<i.length;t++){i[t].dispose()}this.importedMeshesFiles=new Array,this.stopAllAnimations&&this.stopAllAnimations(),this.resetCachedMaterial(),this.activeCamera&&(this.activeCamera.$c.dispose(),this.activeCamera=null),this.$c.dispose(),this.Fw.dispose(),this.$g.dispose(),this.iw.dispose(),this.nw.dispose(),this.sw.dispose(),this.tw.dispose(),this.Bg.dispose(),this.Ng.dispose(),this.Zg=[];for(var n=0,s=this.ah;n<s.length;n++){s[n].abort()}this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderTargetsRenderObservable.clear(),this.onAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.onBeforeRenderingGroupObservable.clear(),this.onAfterRenderingGroupObservable.clear(),this.onMeshImportedObservable.clear(),this.onBeforeCameraRenderObservable.clear(),this.onAfterCameraRenderObservable.clear(),this.onReadyObservable.clear(),this.onNewCameraAddedObservable.clear(),this.onCameraRemovedObservable.clear(),this.onNewLightAddedObservable.clear(),this.onLightRemovedObservable.clear(),this.onNewGeometryAddedObservable.clear(),this.onGeometryRemovedObservable.clear(),this.onNewTransformNodeAddedObservable.clear(),this.onTransformNodeRemovedObservable.clear(),this.onNewMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onNewSkeletonAddedObservable.clear(),this.onSkeletonRemovedObservable.clear(),this.onNewMaterialAddedObservable.clear(),this.onMaterialRemovedObservable.clear(),this.onNewTextureAddedObservable.clear(),this.onTextureRemovedObservable.clear(),this.onPrePointerObservable.clear(),this.onPointerObservable.clear(),this.onPreKeyboardObservable.clear(),this.onKeyboardObservable.clear(),this.onActiveCameraChanged.clear(),this.detachControl();var h,r=this.ct.getInputElement();if(r)for(h=0;h<this.cameras.length;h++)this.cameras[h].detachControl(r);for(;this.animationGroups.length;)this.animationGroups[0].dispose();for(;this.lights.length;)this.lights[0].dispose();for(;this.meshes.length;)this.meshes[0].dispose(!0);for(;this.transformNodes.length;)this.transformNodes[0].dispose(!0);for(;this.cameras.length;)this.cameras[0].dispose();for(this.Sw&&this.Sw.dispose();this.multiMaterials.length;)this.multiMaterials[0].dispose();for(;this.materials.length;)this.materials[0].dispose();for(;this.particleSystems.length;)this.particleSystems[0].dispose();for(;this.postProcesses.length;)this.postProcesses[0].dispose();for(;this.textures.length;)this.textures[0].dispose();this.Qw.dispose(),this.zw&&this.zw.dispose(),this.postProcessManager.dispose(),(h=this.ct.scenes.indexOf(this))>-1&&this.ct.scenes.splice(h,1),this.ct.wipeCaches(!0),this.We=!0},Object.defineProperty(i.prototype,"isDisposed",{get:function(){return this.We},enumerable:!1,configurable:!0}),i.prototype.clearCachedVertexData=function(){for(var t=0;t<this.meshes.length;t++){var i=this.meshes[t].geometry;if(i)for(var n in i.dm=[],i.qb)i.qb.hasOwnProperty(n)&&(i.qb[n].dt.bt=null)}},i.prototype.cleanCachedTextureBuffer=function(){for(var t=0,i=this.textures;t<i.length;t++){var n=i[t];n.dt&&(n.dt=null)}},i.prototype.getWorldExtends=function(t){var i=new o(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),n=new o(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return t=t||function(){return!0},this.meshes.filter(t).forEach((function(t){if(t.computeWorldMatrix(!0),t.subMeshes&&0!==t.subMeshes.length&&!t.infiniteDistance){var s=t.getBoundingInfo(),h=s.boundingBox.minimumWorld,r=s.boundingBox.maximumWorld;o.CheckExtends(h,i,n),o.CheckExtends(r,i,n)}})),{min:i,max:n}},i.prototype.createPickingRay=function(t,i,n,s,h){throw void 0===h&&(h=!1),X.WarnImport("Ray")},i.prototype.createPickingRayToRef=function(t,i,n,s,h,r){throw void 0===r&&(r=!1),X.WarnImport("Ray")},i.prototype.createPickingRayInCameraSpace=function(t,i,n){throw X.WarnImport("Ray")},i.prototype.createPickingRayInCameraSpaceToRef=function(t,i,n,s){throw X.WarnImport("Ray")},i.prototype.pick=function(t,i,n,s,h,r){var e=new P;return e.Mt=!0,e},i.prototype.pickWithBoundingInfo=function(t,i,n,s,h){var r=new P;return r.Mt=!0,r},i.prototype.pickWithRay=function(t,i,n,s){throw X.WarnImport("Ray")},i.prototype.multiPick=function(t,i,n,s,h){throw X.WarnImport("Ray")},i.prototype.multiPickWithRay=function(t,i,n){throw X.WarnImport("Ray")},i.prototype.setPointerOverMesh=function(t){this.Og.setPointerOverMesh(t)},i.prototype.getPointerOverMesh=function(){return this.Og.getPointerOverMesh()},i.prototype.rf=function(){for(var t=0,i=this.geometries;t<i.length;t++){i[t].gt()}for(var n=0,s=this.meshes;n<s.length;n++){s[n].gt()}this.postProcessManager&&this.postProcessManager.gt();for(var h=0,r=this.rw;h<r.length;h++){r[h].rebuild()}for(var e=0,u=this.particleSystems;e<u.length;e++){u[e].rebuild()}},i.prototype.ef=function(){for(var t=0,i=this.textures;t<i.length;t++){i[t].gt()}this.markAllMaterialsAsDirty(1)},i.prototype.gm=function(t,i,n){if(void 0===i)return t;var s=[];for(var h in n=n||function(t){},t){var r=t[h];_t&&_t.MatchesQuery(r,i)&&(s.push(r),n(r))}return s},i.prototype.getMeshesByTags=function(t,i){return this.gm(this.meshes,t,i)},i.prototype.getCamerasByTags=function(t,i){return this.gm(this.cameras,t,i)},i.prototype.getLightsByTags=function(t,i){return this.gm(this.lights,t,i)},i.prototype.getMaterialByTags=function(t,i){return this.gm(this.materials,t,i).concat(this.gm(this.multiMaterials,t,i))},i.prototype.setRenderingOrder=function(t,i,n,s){void 0===i&&(i=null),void 0===n&&(n=null),void 0===s&&(s=null),this.Fw.setRenderingOrder(t,i,n,s)},i.prototype.setRenderingAutoClearDepthStencil=function(t,i,n,s){void 0===n&&(n=!0),void 0===s&&(s=!0),this.Fw.setRenderingAutoClearDepthStencil(t,i,n,s)},i.prototype.getAutoClearDepthStencilSetup=function(t){return this.Fw.getAutoClearDepthStencilSetup(t)},Object.defineProperty(i.prototype,"blockMaterialDirtyMechanism",{get:function(){return this.Tw},set:function(t){this.Tw!==t&&(this.Tw=t,t||this.markAllMaterialsAsDirty(31))},enumerable:!1,configurable:!0}),i.prototype.markAllMaterialsAsDirty=function(t,i){if(!this.Tw)for(var n=0,s=this.materials;n<s.length;n++){var h=s[n];i&&!i(h)||h.markAsDirty(t)}},i.prototype.Ni=function(t,i,n,s,h,r){var e=this,u=At.LoadFile(t,i,n,s?this.offlineProvider:void 0,h,r);return this.ah.push(u),u.onCompleteObservable.add((function(t){e.ah.splice(e.ah.indexOf(t),1)})),u},i.prototype.if=function(t,i,n,s){var h=this;return new Promise((function(r,e){h.Ni(t,(function(t){r(t)}),i,n,s,(function(t,i){e(i)}))}))},i.prototype.wm=function(t,i,n,s,h,r,e){var u=this,o=At.RequestFile(t,i,n,s?this.offlineProvider:void 0,h,r,e);return this.ah.push(o),o.onCompleteObservable.add((function(t){u.ah.splice(u.ah.indexOf(t),1)})),o},i.prototype.mm=function(t,i,n,s,h){var r=this;return new Promise((function(e,u){r.wm(t,(function(t){e(t)}),i,n,s,(function(t){u(t)}),h)}))},i.prototype.jm=function(t,i,n,s,h){var r=this,e=At.ReadFile(t,i,n,s,h);return this.ah.push(e),e.onCompleteObservable.add((function(t){r.ah.splice(r.ah.indexOf(t),1)})),e},i.prototype.Om=function(t,i,n){var s=this;return new Promise((function(h,r){s.jm(t,(function(t){h(t)}),i,n,(function(t){r(t)}))}))},i.FOGMODE_NONE=0,i.FOGMODE_EXP=1,i.FOGMODE_EXP2=2,i.FOGMODE_LINEAR=3,i.MinDeltaTime=1,i.MaxDeltaTime=1e3,i}(li),Li=function(){function t(t,i,n){void 0===n&&(n=Number.MAX_VALUE),this.origin=t,this.direction=i,this.length=n}return t.prototype.intersectsBoxMinMax=function(i,n,s){void 0===s&&(s=0);var h,r,e,u,o=t.TmpVector3[0].copyFromFloats(i.x-s,i.y-s,i.z-s),f=t.TmpVector3[1].copyFromFloats(n.x+s,n.y+s,n.z+s),c=0,a=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<o.x||this.origin.x>f.x)return!1}else if(h=1/this.direction.x,r=(o.x-this.origin.x)*h,(e=(f.x-this.origin.x)*h)===-1/0&&(e=1/0),r>e&&(u=r,r=e,e=u),(c=Math.max(r,c))>(a=Math.min(e,a)))return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<o.y||this.origin.y>f.y)return!1}else if(h=1/this.direction.y,r=(o.y-this.origin.y)*h,(e=(f.y-this.origin.y)*h)===-1/0&&(e=1/0),r>e&&(u=r,r=e,e=u),(c=Math.max(r,c))>(a=Math.min(e,a)))return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<o.z||this.origin.z>f.z)return!1}else if(h=1/this.direction.z,r=(o.z-this.origin.z)*h,(e=(f.z-this.origin.z)*h)===-1/0&&(e=1/0),r>e&&(u=r,r=e,e=u),(c=Math.max(r,c))>(a=Math.min(e,a)))return!1;return!0},t.prototype.intersectsBox=function(t,i){return void 0===i&&(i=0),this.intersectsBoxMinMax(t.minimum,t.maximum,i)},t.prototype.intersectsSphere=function(t,i){void 0===i&&(i=0);var n=t.center.x-this.origin.x,s=t.center.y-this.origin.y,h=t.center.z-this.origin.z,r=n*n+s*s+h*h,e=t.radius+i,u=e*e;if(r<=u)return!0;var o=n*this.direction.x+s*this.direction.y+h*this.direction.z;return!(o<0)&&r-o*o<=u},t.prototype.intersectsTriangle=function(i,n,s){var h=t.TmpVector3[0],r=t.TmpVector3[1],e=t.TmpVector3[2],u=t.TmpVector3[3],f=t.TmpVector3[4];n.subtractToRef(i,h),s.subtractToRef(i,r),o.CrossToRef(this.direction,r,e);var c=o.Dot(h,e);if(0===c)return null;var a=1/c;this.origin.subtractToRef(i,u);var l=o.Dot(u,e)*a;if(l<0||l>1)return null;o.CrossToRef(u,h,f);var v=o.Dot(this.direction,f)*a;if(v<0||l+v>1)return null;var b=o.Dot(r,f)*a;return b>this.length?null:new x(1-l-v,l,b)},t.prototype.intersectsPlane=function(t){var i,n=o.Dot(t.normal,this.direction);if(Math.abs(n)<9.99999997475243e-7)return null;var s=o.Dot(t.normal,this.origin);return(i=(-t.d-s)/n)<0?i<-9.99999997475243e-7?null:0:i},t.prototype.intersectsAxis=function(t,i){switch(void 0===i&&(i=0),t){case"y":return(n=(this.origin.y-i)/this.direction.y)>0?null:new o(this.origin.x+this.direction.x*-n,i,this.origin.z+this.direction.z*-n);case"x":return(n=(this.origin.x-i)/this.direction.x)>0?null:new o(i,this.origin.y+this.direction.y*-n,this.origin.z+this.direction.z*-n);case"z":var n;return(n=(this.origin.z-i)/this.direction.z)>0?null:new o(this.origin.x+this.direction.x*-n,this.origin.y+this.direction.y*-n,i);default:return null}},t.prototype.intersectsMesh=function(i,n){var s=v.Matrix[0];return i.getWorldMatrix().invertToRef(s),this.ym?t.TransformToRef(this,s,this.ym):this.ym=t.Transform(this,s),i.intersects(this.ym,n)},t.prototype.intersectsMeshes=function(t,i,n){n?n.length=0:n=[];for(var s=0;s<t.length;s++){var h=this.intersectsMesh(t[s],i);h.hit&&n.push(h)}return n.sort(this.Am),n},t.prototype.Am=function(t,i){return t.distance<i.distance?-1:t.distance>i.distance?1:0},t.prototype.intersectionSegment=function(i,n,s){var h=this.origin,r=v.Vector3[0],e=v.Vector3[1],u=v.Vector3[2],f=v.Vector3[3];n.subtractToRef(i,r),this.direction.scaleToRef(t.rayl,u),h.addToRef(u,e),i.subtractToRef(h,f);var c,a,l,b,d=o.Dot(r,r),g=o.Dot(r,u),w=o.Dot(u,u),m=o.Dot(r,f),j=o.Dot(u,f),O=d*w-g*g,y=O,A=O;O<t.smallnum?(a=0,y=1,b=j,A=w):(b=d*j-g*m,(a=g*j-w*m)<0?(a=0,b=j,A=w):a>y&&(a=y,b=j+g,A=w)),b<0?(b=0,-m<0?a=0:-m>d?a=y:(a=-m,y=d)):b>A&&(b=A,-m+g<0?a=0:-m+g>d?a=y:(a=-m+g,y=d)),c=Math.abs(a)<t.smallnum?0:a/y,l=Math.abs(b)<t.smallnum?0:b/A;var p=v.Vector3[4];u.scaleToRef(l,p);var M=v.Vector3[5];r.scaleToRef(c,M),M.addInPlace(f);var K=v.Vector3[6];return M.subtractToRef(p,K),l>0&&l<=this.length&&K.lengthSquared()<s*s?M.length():-1},t.prototype.update=function(t,i,n,s,h,r,e){return this.unprojectRayToRef(t,i,n,s,h,r,e),this},t.Zero=function(){return new t(o.Zero(),o.Zero())},t.CreateNew=function(i,n,s,h,r,e,u){return t.Zero().update(i,n,s,h,r,e,u)},t.CreateNewFromTo=function(i,n,s){void 0===s&&(s=a.IdentityReadOnly);var h=n.subtract(i),r=Math.sqrt(h.x*h.x+h.y*h.y+h.z*h.z);return h.normalize(),t.Transform(new t(i,h,r),s)},t.Transform=function(i,n){var s=new t(new o(0,0,0),new o(0,0,0));return t.TransformToRef(i,n,s),s},t.TransformToRef=function(t,i,n){o.TransformCoordinatesToRef(t.origin,i,n.origin),o.TransformNormalToRef(t.direction,i,n.direction),n.length=t.length;var s=n.direction,h=s.length();if(0!==h&&1!==h){var r=1/h;s.x*=r,s.y*=r,s.z*=r,n.length*=h}},t.prototype.unprojectRayToRef=function(t,i,n,s,h,r,e){var u=v.Matrix[0];h.multiplyToRef(r,u),u.multiplyToRef(e,u),u.invert();var f=v.Vector3[0];f.x=t/n*2-1,f.y=-(i/s*2-1),f.z=-1;var c=v.Vector3[1].copyFromFloats(f.x,f.y,1),a=v.Vector3[2],l=v.Vector3[3];o.K(f,u,a),o.K(c,u,l),this.origin.copyFrom(a),l.subtractToRef(a,this.direction),this.direction.normalize()},t.TmpVector3=r.BuildArray(6,o.Zero),t.smallnum=1e-8,t.rayl=1e9,t}();Si.prototype.createPickingRay=function(t,i,n,s,h){void 0===h&&(h=!1);var r=Li.Zero();return this.createPickingRayToRef(t,i,n,r,s,h),r},Si.prototype.createPickingRayToRef=function(t,i,n,s,h,r){void 0===r&&(r=!1);var e=this.getEngine();if(!h){if(!this.activeCamera)return this;h=this.activeCamera}var u=h.viewport.toGlobal(e.getRenderWidth(),e.getRenderHeight());return t=t/e.getHardwareScalingLevel()-u.x,i=i/e.getHardwareScalingLevel()-(e.getRenderHeight()-u.y-u.height),s.update(t,i,u.width,u.height,n||a.IdentityReadOnly,r?a.IdentityReadOnly:h.getViewMatrix(),h.getProjectionMatrix()),this},Si.prototype.createPickingRayInCameraSpace=function(t,i,n){var s=Li.Zero();return this.createPickingRayInCameraSpaceToRef(t,i,s,n),s},Si.prototype.createPickingRayInCameraSpaceToRef=function(t,i,n,s){if(!P)return this;var h=this.getEngine();if(!s){if(!this.activeCamera)throw new Error("Active camera not set");s=this.activeCamera}var r=s.viewport.toGlobal(h.getRenderWidth(),h.getRenderHeight()),e=a.Identity();return t=t/h.getHardwareScalingLevel()-r.x,i=i/h.getHardwareScalingLevel()-(h.getRenderHeight()-r.y-r.height),n.update(t,i,r.width,r.height,e,e,s.getProjectionMatrix()),this},Si.prototype.pm=function(t,i,n,s,h){if(!P)return null;for(var r=null,e=0;e<this.meshes.length;e++){var u=this.meshes[e];if(i){if(!i(u))continue}else if(!u.isEnabled()||!u.isVisible||!u.isPickable)continue;var o=t(u.skeleton&&u.skeleton.overrideMesh?u.skeleton.overrideMesh.getWorldMatrix():u.getWorldMatrix()),f=u.intersects(o,n,h,s);if(f&&f.hit&&((n||null==r||!(f.distance>=r.distance))&&(r=f,n)))break}return r||new P},Si.prototype.Mm=function(t,i,n){if(!P)return null;for(var s=new Array,h=0;h<this.meshes.length;h++){var r=this.meshes[h];if(i){if(!i(r))continue}else if(!r.isEnabled()||!r.isVisible||!r.isPickable)continue;var e=t(r.getWorldMatrix()),u=r.intersects(e,!1,n);u&&u.hit&&s.push(u)}return s},Si.prototype.pickWithBoundingInfo=function(t,i,n,s,h){var r=this;if(!P)return null;var e=this.pm((function(n){return r.Km||(r.Km=Li.Zero()),r.createPickingRayToRef(t,i,n,r.Km,h||null),r.Km}),n,s,!0);return e&&(e.ray=this.createPickingRay(t,i,a.Identity(),h||null)),e},Si.prototype.pick=function(t,i,n,s,h,r){var e=this;if(!P)return null;var u=this.pm((function(n){return e.Km||(e.Km=Li.Zero()),e.createPickingRayToRef(t,i,n,e.Km,h||null),e.Km}),n,s,!1,r);return u&&(u.ray=this.createPickingRay(t,i,a.Identity(),h||null)),u},Si.prototype.pickWithRay=function(t,i,n,s){var h=this,r=this.pm((function(i){return h.Pm||(h.Pm=a.Identity()),i.invertToRef(h.Pm),h.xm||(h.xm=Li.Zero()),Li.TransformToRef(t,h.Pm,h.xm),h.xm}),i,n,!1,s);return r&&(r.ray=t),r},Si.prototype.multiPick=function(t,i,n,s,h){var r=this;return this.Mm((function(n){return r.createPickingRay(t,i,n,s||null)}),n,h)},Si.prototype.multiPickWithRay=function(t,i,n){var s=this;return this.Mm((function(i){return s.Pm||(s.Pm=a.Identity()),i.invertToRef(s.Pm),s.xm||(s.xm=Li.Zero()),Li.TransformToRef(t,s.Pm,s.xm),s.xm}),i,n)},ai.prototype.getForwardRay=function(t,i,n){void 0===t&&(t=100),i||(i=this.getWorldMatrix()),n||(n=this.position);var s=this.uu.useRightHandedSystem?new o(0,0,-1):new o(0,0,1),h=o.TransformNormal(s,i),r=o.Normalize(h);return new Li(n,r,t)};var Di=function(){function t(t,i,n,s,h){var r=this;void 0===h&&(h=!1),this.km=3,this.Em=2*this.km,this.Tm=2*this.km,this.Bm=this.km/2,this.Fm=2*this.Bm,this.Cm=2*this.km,this._m=this.km/2,this.Um=2*this._m,this.Rm=this.km/2,this.Sm=2*this.Rm,this.Lm=Math.PI/8,this.Dm=2*this.Lm,this.Im=9.8,this.Nm=30,this.Xm=45,this.Wm=Math.PI*this.Nm/180,this.Gm=Math.PI*this.Xm/180,this.qm=.25,this.Qm=0,this.Ym=o.Zero(),this.Vm=new Ii("walk"),this.Hm=new Ii("walkBack"),this.zm=new Ii("walkBackFast"),this.Zm=new Ii("idle"),this.Jm=new Ii("idleJump"),this.$m=new Ii("run"),this.tj=new Ii("runJump"),this.ij=new Ii("fall"),this.nj=new Ii("turnLeft"),this.sj=new Ii("turnLeftFast"),this.hj=new Ii("turnRight"),this.rj=new Ii("turnRightFast"),this.ej=new Ii("strafeLeft"),this.uj=new Ii("strafeLeftFast"),this.oj=new Ii("strafeRight"),this.fj=new Ii("strafeRightFast"),this.cj=new Ii("slideBack"),this.aj=[this.Vm,this.Hm,this.zm,this.Zm,this.Jm,this.$m,this.tj,this.ij,this.nj,this.sj,this.hj,this.rj,this.ej,this.uj,this.oj,this.fj,this.cj],this.lj="w",this.vj="s",this.bj="a",this.dj="d",this.gj="q",this.wj="e",this.mj=" ",this.jj=!0,this.Oj=o.Zero(),this.yj=!1,this.mode=0,this.Aj=0,this.pj=!1,this.Mj=-1,this.Kj=!1,this.Pj=!1,this.xj=null,this.kj=o.Zero(),this.Ej=!1,this.Tj=0,this.Bj=50,this.Fj=0,this.Cj=!1,this._j=!1,this.Uj=!1,this.Rj=0,this.Sj=0,this.Lj=0,this.Dj=1,this.Ij=!1,this.Nj=!1,this.Xj=0,this.Wj=0,this.Gj=10,this.qj=!0,this.Qj=!1,this.Yj=new Li(o.Zero(),o.One(),1),this.Vj=o.Zero(),this.Hj=.5,this.zj=0,this.Zj=!1,this.Jj=!1,this.$j=!1,this.tO=t,this.iO(t),this.setFaceForward(h),this.uu=n,null!=s&&(this.Jj=!0,this.setAnimationGroups(s)),(this.Jj||null!==this.Gf)&&(this.$j=!0),this.Jj||(this.Gf=t.skeleton),this.Jj||null==this.Gf||this.checkAnims(this.Gf),this.nO=i,this.qj=this.nO.checkCollisions,this.sO=new Ni,this.hO=function(){r.rO()},this.eO=function(t){r.gg(t)},this.uO=function(t){r.dg(t)}}return t.prototype.setAvatar=function(t){this.tO=t},t.prototype.setAvatarSkeleton=function(t){this.Gf=t,this.checkAnims(t)},t.prototype.setSlopeLimit=function(t,i){this.Nm=t,this.Xm=i,this.Wm=Math.PI*t/180,this.Gm=Math.PI*this.Xm/180},t.prototype.setStepOffset=function(t){this.qm=t},t.prototype.setWalkSpeed=function(t){this.km=t},t.prototype.setRunSpeed=function(t){this.Tm=t},t.prototype.setBackSpeed=function(t){this.Bm=t},t.prototype.setBackFastSpeed=function(t){this.Fm=t},t.prototype.setJumpSpeed=function(t){this.Cm=t},t.prototype.setLeftSpeed=function(t){this._m=t},t.prototype.setLeftFastSpeed=function(t){this.Um=t},t.prototype.setRightSpeed=function(t){this.Rm=t},t.prototype.setRightFastSpeed=function(t){this.Sm=t},t.prototype.setTurnSpeed=function(t){this.Lm=t*Math.PI/180},t.prototype.setTurnFastSpeed=function(t){this.Dm=t*Math.PI/180},t.prototype.setGravity=function(t){this.Im=t},t.prototype.setAnimationGroups=function(t){this.Jj=!0;for(var i=0,n=this.aj;i<n.length;i++){var s=n[i];null!=t[s.oO]&&(s.fO=t[s.oO],s.cO=!0,s.fO.name)}this.aO()},t.prototype.setAnimationRanges=function(t){var i;this.Jj=!1;for(var n=0,s=this.aj;n<s.length;n++){var h=s[n];null!=(i=t[h.oO])&&(i instanceof Object?(i.name&&(h.oO=i.name),i.loop&&(h.lO=i.loop),i.rate&&(h.lO=i.rate)):h.oO=i,h.cO=!0)}},t.prototype.vO=function(t,i,n,s){(this.Jj||null!=this.Gf)&&(null!=s&&(t.lO=s),this.Jj?(null!=i&&(t.fO=i,t.cO=!0),null!=n&&t.cO&&(t.bO=n,t.fO.speedRatio=n)):(null!=i&&(t.oO=i),null!=n&&(t.bO=n),null!=this.Gf.getAnimationRange(t.oO)?t.cO=!0:t.cO=!1))},t.prototype.enableBlending=function(t){if(this.Jj)for(var i=0,n=this.aj;i<n.length;i++){var s=n[i];if(s.cO)for(var h=0,r=s.fO.targetedAnimations;h<r.length;h++){var e=r[h];e.animation.enableBlending=!0,e.animation.blendingSpeed=t}}else this.Gf.enableBlending(t)},t.prototype.disableBlending=function(){if(this.Jj)for(var t=0,i=this.aj;t<i.length;t++){var n=i[t];if(n.cO)for(var s=0,h=n.fO.targetedAnimations;s<h.length;s++){h[s].animation.enableBlending=!1}}},t.prototype.setWalkAnim=function(t,i,n){this.vO(this.Vm,t,i,n)},t.prototype.setRunAnim=function(t,i,n){this.vO(this.$m,t,i,n)},t.prototype.setWalkBackAnim=function(t,i,n){this.vO(this.Hm,t,i,n),this.dO(this.zm,this.Hm)},t.prototype.setWalkBackFastAnim=function(t,i,n){this.vO(this.zm,t,i,n)},t.prototype.setSlideBackAnim=function(t,i,n){this.vO(this.cj,t,i,n)},t.prototype.setIdleAnim=function(t,i,n){this.vO(this.Zm,t,i,n)},t.prototype.setTurnRightAnim=function(t,i,n){this.vO(this.hj,t,i,n),this.dO(this.rj,this.hj)},t.prototype.setTurnRightFastAnim=function(t,i,n){this.vO(this.rj,t,i,n)},t.prototype.setTurnLeftAnim=function(t,i,n){this.vO(this.nj,t,i,n),this.dO(this.sj,this.nj)},t.prototype.setTurnLeftFastAnim=function(t,i,n){this.vO(this.sj,t,i,n)},t.prototype.setStrafeRightAnim=function(t,i,n){this.vO(this.oj,t,i,n),this.dO(this.fj,this.oj)},t.prototype.setStrafeRightFastAnim=function(t,i,n){this.vO(this.fj,t,i,n)},t.prototype.setStrafeLeftAnim=function(t,i,n){this.vO(this.ej,t,i,n),this.dO(this.uj,this.ej)},t.prototype.setStrafeLeftFastAnim=function(t,i,n){this.vO(this.uj,t,i,n)},t.prototype.setIdleJumpAnim=function(t,i,n){this.vO(this.Jm,t,i,n)},t.prototype.setRunJumpAnim=function(t,i,n){this.vO(this.tj,t,i,n)},t.prototype.setFallAnim=function(t,i,n){this.vO(this.ij,t,i,n)},t.prototype.setWalkKey=function(t){this.lj=t.toLowerCase()},t.prototype.setWalkBackKey=function(t){this.vj=t.toLowerCase()},t.prototype.setTurnLeftKey=function(t){this.bj=t.toLowerCase()},t.prototype.setTurnRightKey=function(t){this.dj=t.toLowerCase()},t.prototype.setStrafeLeftKey=function(t){this.gj=t.toLowerCase()},t.prototype.setStrafeRightKey=function(t){this.wj=t.toLowerCase()},t.prototype.setJumpKey=function(t){this.mj=t.toLowerCase()},t.prototype.setCameraElasticity=function(t){this.jj=t},t.prototype.setCameraTarget=function(t){this.Oj.copyFrom(t)},t.prototype.cameraCollisionChanged=function(){this.qj=this.nO.checkCollisions},t.prototype.setNoFirstPerson=function(t){this.yj=t},t.prototype.checkAnims=function(t){for(var i=0,n=this.aj;i<n.length;i++){var s=n[i];null!=t?null!=t.getAnimationRange(s.oO)&&(s.cO=!0):s.cO=!1}this.aO()},t.prototype.aO=function(){this.dO(this.zm,this.Hm),this.dO(this.rj,this.rj),this.dO(this.sj,this.nj),this.dO(this.fj,this.oj),this.dO(this.uj,this.ej)},t.prototype.dO=function(t,i){t.cO||i.cO&&(t.cO=!0,t.fO=i.fO,t.oO=i.oO,t.bO=2*i.bO)},t.prototype.setMode=function(t){this.mode=t,this.Aj=t},t.prototype.setTurningOff=function(t){this.Nj=t},t.prototype.iO=function(t){var i=t.getWorldMatrix(),n=o.FromFloatArray(i.m,0),s=o.FromFloatArray(i.m,4),h=o.FromFloatArray(i.m,8),r=o.Cross(n,s);o.Dot(r,h)<0?(this.pj=!0,this.Mj=1):(this.pj=!1,this.Mj=-1)},t.prototype.setFaceForward=function(t){this.pj?(this.gO=t?Math.PI/2:3*Math.PI/2,this.wO=t?1:-1):(this.gO=t?3*Math.PI/2:Math.PI/2,this.wO=t?-1:1)},t.prototype.checkAGs=function(t){for(var i=0,n=this.aj;i<n.length;i++){var s=n[i];null!=t[s.oO]&&(s.fO=t[s.oO],s.cO=!0)}},t.prototype.start=function(){this.Kj||(this.Kj=!0,this.sO.reset(),this.Lj=0,this.Xj=.001,this.Ej=!1,this.mO(),this.enableKeyBoard(!0),this.uu.registerBeforeRender(this.hO))},t.prototype.stop=function(){this.Kj&&(this.Kj=!1,this.uu.unregisterBeforeRender(this.hO),this.enableKeyBoard(!1),this.xj=null)},t.prototype.pauseAnim=function(){this.Pj=!0},t.prototype.resumeAnim=function(){this.Pj=!1},t.prototype.jO=function(){return o.Dot(this.tO.forward,this.tO.position.subtract(this.nO.position))<0?1:-1},t.prototype.rO=function(){this.kj.copyFrom(this.tO.position);var t=null,i=this.uu.getEngine().getDeltaTime()/1e3;this.sO.OO&&!this.Cj?(this.Ej=!1,this.Xj=0,t=this.yO(i)):this.anyMovement()||this.Cj?(this.Ej=!1,this.Xj=0,t=this.AO(i)):this.Cj||(t=this.pO(i)),!this.Pj&&this.$j&&null!=t&&this.xj!==t&&(t.cO&&(this.Jj?(null!=this.xj&&this.xj.cO&&this.xj.fO.stop(),t.fO.play(t.lO),t.fO.speedRatio=t.bO):this.Gf.beginAnimation(t.oO,t.lO,t.bO)),this.xj=t),this.mO()},t.prototype.yO=function(t){var i=null;i=this.tj,0===this.Sj&&(this.Rj=this.tO.position.y);var n=(this.Cm-this.Im*this.Sj)*t-.5*this.Im*t*t;this.Sj=this.Sj+t;var s,h=0;if(1==this.mode||this.Nj||(this.tO.rotation.y=this.gO-this.nO.alpha),this.Uj||this._j?(this.Uj?h=this.Tm*t:this._j&&(h=this.km*t),(s=this.MO.clone()).y=0,(s=s.normalize()).scaleToRef(h,s),s.y=n):(s=new o(0,n,0),i=this.Jm),this.tO.moveWithCollisions(s),n<0)if(this.tO.position.y>this.kj.y||this.tO.position.y===this.kj.y&&s.length()>.001)this.KO();else if(this.tO.position.y<this.Rj){var r=this.tO.position.subtract(this.kj);this.PO(r,s,.001)?i=this.ij:this.xO(r)<=this.Wm&&this.KO()}return i},t.prototype.KO=function(){this.sO.OO=!1,this.Sj=0,this._j=!1,this.Uj=!1},t.prototype.PO=function(t,i,n){return Math.abs(t.x-i.x)<n&&Math.abs(t.y-i.y)<n&&Math.abs(t.z-i.z)<n},t.prototype.xO=function(t){return Math.atan(Math.abs(t.y/Math.sqrt(t.x*t.x+t.z*t.z)))},t.prototype.AO=function(t){var i=this.Lj*this.Im;this.Tj=i*t+this.Im*t*t/2,this.Lj=this.Lj+t;var n=!1,s=null;if(this.Cj)this.MO.y=-this.Tj,n=!0;else{this._j=!1,this.Uj=!1;var h=void 0,r=0;switch(!0){case this.sO.kO:h=this.Mj*this.jO(),r=this._m*t,this.sO.EO?(r=this.Um*t,s=-this.wO*h>0?this.uj:this.fj):s=-this.wO*h>0?this.ej:this.oj,this.MO=this.tO.calcMovePOV(h*r,-this.Tj,0),n=!0;break;case this.sO.TO:h=-this.Mj*this.jO(),r=this.Rm*t,this.sO.EO?(r=this.Sm*t,s=-this.wO*h>0?this.uj:this.fj):s=-this.wO*h>0?this.ej:this.oj,this.MO=this.tO.calcMovePOV(h*r,-this.Tj,0),n=!0;break;case this.sO.Vm||this.Nj&&0==this.mode:this.sO.EO?(this.Uj=!0,r=this.Em*t,s=this.$m):(this._j=!0,r=this.km*t,s=this.Vm),this.MO=this.tO.calcMovePOV(0,-this.Tj,this.wO*r),n=!0;break;case this.sO.BO:r=this.Bm*t,this.sO.EO?(r=this.Fm*t,s=this.zm):s=this.Hm,this.MO=this.tO.calcMovePOV(0,-this.Tj,-this.wO*r),n=!0}}if((!this.Nj||0!=this.mode)&&!this.sO.kO&&!this.sO.TO&&(this.sO.nj||this.sO.hj)){var e=this.Lm*t;if(this.sO.EO&&(e*=2),1==this.mode){this.Ij||(this.Dj=-this.wO*this.jO(),this.pj&&(this.Dj=-this.Dj),this.Ij=!0);var u=this.Dj;this.sO.nj?this.sO.Vm||(this.sO.BO?u=-this.Dj:s=this.Dj>0?this.hj:this.nj):this.sO.Vm?u=-this.Dj:this.sO.BO||(u=-this.Dj,s=this.Dj>0?this.nj:this.hj),this.tO.rotation.y=this.tO.rotation.y+e*u}else{u=1;this.sO.nj?(this.sO.BO&&(u=-1),n||(s=this.nj)):(this.sO.Vm&&(u=-1),n||(u=-1,s=this.hj)),this.nO.alpha=this.nO.alpha+e*u}}if(1!=this.mode)if(this.Nj)switch(!0){case this.sO.Vm&&this.sO.hj:this.tO.rotation.y=this.gO-this.nO.alpha+Math.PI/4;break;case this.sO.Vm&&this.sO.nj:this.tO.rotation.y=this.gO-this.nO.alpha-Math.PI/4;break;case this.sO.BO&&this.sO.hj:this.tO.rotation.y=this.gO-this.nO.alpha+3*Math.PI/4;break;case this.sO.BO&&this.sO.nj:this.tO.rotation.y=this.gO-this.nO.alpha-3*Math.PI/4;break;case this.sO.Vm:this.tO.rotation.y=this.gO-this.nO.alpha;break;case this.sO.BO:this.tO.rotation.y=this.gO-this.nO.alpha+Math.PI;break;case this.sO.hj:this.tO.rotation.y=this.gO-this.nO.alpha+Math.PI/2;break;case this.sO.nj:this.tO.rotation.y=this.gO-this.nO.alpha-Math.PI/2}else this.tO.rotation.y=this.gO-this.nO.alpha;if(n&&this.MO.length()>.001)if(this.tO.moveWithCollisions(this.MO),this.tO.position.y>this.kj.y){var o=this.tO.position.subtract(this.kj),f=this.xO(o);f>=this.Gm?this.qm>0?(0==this.Qm&&this.Ym.copyFrom(this.kj),this.Qm=this.Qm+(this.tO.position.y-this.kj.y),this.Qm>this.qm&&(this.Qm=0,this.tO.position.copyFrom(this.Ym),this.FO())):(this.tO.position.copyFrom(this.kj),this.FO()):(this.Qm=0,f>this.Wm?(this.Fj=0,this.Cj=!1):this.FO())}else if(this.tO.position.y<this.kj.y){o=this.tO.position.subtract(this.kj);this.PO(o,this.MO,.001)?(this.Cj=!0,this.Fj++,this.Fj>this.Bj&&(s=this.ij)):this.xO(o)<=this.Wm?this.FO():(this.Fj=0,this.Cj=!1)}else this.FO();return s},t.prototype.FO=function(){this.Lj=0,this.Fj=0,this.Cj=!1},t.prototype.pO=function(t){if(this.Ej)return this.Zm;this._j=!1,this.Uj=!1,this.Lj=0;var i=this.Zm;if(this.Fj=0,0===t)this.Tj=5;else{var n=this.Xj*this.Im;this.Tj=n*t+this.Im*t*t/2,this.Xj=this.Xj+t}if(this.Tj<.01)return i;var s=new o(0,-this.Tj,0);if(1==this.mode||this.Nj||(this.tO.rotation.y=this.gO-this.nO.alpha),this.tO.moveWithCollisions(s),this.tO.position.y>this.kj.y||this.tO.position.y===this.kj.y)this.CO();else if(this.tO.position.y<this.kj.y){var h=this.tO.position.subtract(this.kj);this.PO(h,s,.001)||(this.xO(h)<=this.Wm?(this.CO(),this.tO.position.copyFrom(this.kj)):(this._O(),i=this.cj))}return i},t.prototype.CO=function(){this.Wj++,this.Wj>this.Gj&&(this.Ej=!0,this.Xj=0)},t.prototype._O=function(){this.Ej=!1,this.Wj=0},t.prototype.mO=function(){0==this.Qm&&this.tO.position.addToRef(this.Oj,this.nO.target),this.nO.radius>this.nO.lowerRadiusLimit&&this.jj&&this.UO(),this.nO.radius<=this.nO.lowerRadiusLimit?this.yj||this.Qj||(this.tO.visibility=0,this.nO.checkCollisions=!1,this.Aj=this.mode,this.mode=0,this.Qj=!0):(this.Qj=!1,this.mode=this.Aj,this.tO.visibility=1,this.nO.checkCollisions=this.qj)},t.prototype.UO=function(){var t=this;this.nO.position.subtractToRef(this.nO.target,this.Vj),this.Yj.origin=this.nO.target,this.Yj.length=this.Vj.length(),this.Yj.direction=this.Vj.normalize();var i=this.uu.pickWithRay(this.Yj,(function(i){return!(i==t.tO||!i.checkCollisions)}),!0);if(i.hit)if(this.nO.checkCollisions){var n=this.nO.target.subtract(i.pickedPoint).normalize().scale(this.Hj);i.pickedPoint.addToRef(n,this.nO.position)}else{var s=i.pickedPoint.subtract(this.nO.target).length();this.nO.radius=s-this.Hj}},t.prototype.anyMovement=function(){return this.sO.Vm||this.sO.BO||this.sO.nj||this.sO.hj||this.sO.kO||this.sO.TO},t.prototype.dg=function(t){if(t.key&&!t.repeat){switch(t.key.toLowerCase()){case this.mj:this.sO.OO=!0;break;case"capslock":this.sO.EO=!this.sO.EO;break;case"shift":this.sO.EO=!0;break;case"up":case"arrowup":case this.lj:this.sO.Vm=!0;break;case"left":case"arrowleft":case this.bj:this.sO.nj=!0;break;case"right":case"arrowright":case this.dj:this.sO.hj=!0;break;case"down":case"arrowdown":case this.vj:this.sO.BO=!0;break;case this.gj:this.sO.kO=!0;break;case this.wj:this.sO.TO=!0}this.Zj=this.anyMovement()}},t.prototype.gg=function(t){if(t.key){switch(t.key.toLowerCase()){case"shift":this.sO.EO=!1;break;case"up":case"arrowup":case this.lj:this.sO.Vm=!1;break;case"left":case"arrowleft":case this.bj:this.sO.nj=!1,this.Ij=!1;break;case"right":case"arrowright":case this.dj:this.sO.hj=!1,this.Ij=!1;break;case"down":case"arrowdown":case this.vj:this.sO.BO=!1;break;case this.gj:this.sO.kO=!1;break;case this.wj:this.sO.TO=!1}this.Zj=this.anyMovement()}},t.prototype.enableKeyBoard=function(t){var i=this.uu.getEngine().getRenderingCanvas();t?(i.addEventListener("keyup",this.eO,!1),i.addEventListener("keydown",this.uO,!1)):(i.removeEventListener("keyup",this.eO,!1),i.removeEventListener("keydown",this.uO,!1))},t.prototype.walk=function(t){this.sO.Vm=t},t.prototype.walkBack=function(t){this.sO.BO=t},t.prototype.walkBackFast=function(t){this.sO.BO=t,this.sO.EO=t},t.prototype.run=function(t){this.sO.Vm=t,this.sO.EO=t},t.prototype.turnLeft=function(t){this.sO.nj=t,t||(this.Ij=t)},t.prototype.turnLeftFast=function(t){this.sO.nj=t,t||(this.Ij=t),this.sO.EO=t},t.prototype.turnRight=function(t){this.sO.hj=t,t||(this.Ij=t)},t.prototype.turnRightFast=function(t){this.sO.hj=t,t||(this.Ij=t),this.sO.EO=t},t.prototype.strafeLeft=function(t){this.sO.kO=t},t.prototype.strafeLeftFast=function(t){this.sO.kO=t,this.sO.EO=t},t.prototype.strafeRight=function(t){this.sO.TO=t},t.prototype.strafeRightFast=function(t){this.sO.TO=t,this.sO.EO=t},t.prototype.jump=function(){this.sO.OO=!0},t.prototype.idle=function(){this.sO.reset()},t}(),Ii=function(t){this.lO=!0,this.bO=1,this.cO=!1,this.oO=t},Ni=function(){function t(){this.Vm=!1,this.BO=!1,this.EO=!1,this.hj=!1,this.nj=!1,this.TO=!1,this.kO=!1,this.OO=!1,this.reset()}return t.prototype.reset=function(){this.Vm=!1,this.BO=!1,this.hj=!1,this.nj=!1,this.TO=!1,this.kO=!1,this.OO=!1,this.EO=!1},t}()}])}));
//# sourceMappingURL=CharacterController-babylonjs-4.2.0.js.map