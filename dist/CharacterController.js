!function(t,i){if("object"==typeof exports&&"object"==typeof module)module.exports=i(require("babylonjs"));else if("function"==typeof define&&define.amd)define(["babylonjs"],i);else{var s="object"==typeof exports?i(require("babylonjs")):i(t.BABYLON);for(var h in s)("object"==typeof exports?exports:t)[h]=s[h]}}(self,(t=>(()=>{"use strict";var i={247:i=>{i.exports=t}},s={};function h(t){var n=s[t];if(void 0!==n)return n.exports;var e=s[t]={exports:{}};return i[t](e,e.exports,h),e.exports}h.n=t=>{var i=t&&t.t?()=>t.default:()=>t;return h.d(i,{a:i}),i},h.d=(t,i)=>{for(var s in i)h.o(i,s)&&!h.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:i[s]})},h.o=(t,i)=>Object.prototype.hasOwnProperty.call(t,i),h.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"t",{value:!0})};var n={};return(()=>{h.r(n),h.d(n,{ActionData:()=>e,ActionMap:()=>r,CCSettings:()=>u,CharacterController:()=>i});var t=h(247),i=function(){function i(i,h,n,e,u){void 0===u&&(u=!1);var f=this;this.i=null,this.h=null,this.u=9.8,this.l=30,this.v=45,this.k=Math.PI*this.l/180,this.M=Math.PI*this.v/180,this.p=.25,this.j=0,this.O=t.Vector3.Zero(),this.g=new r,this.C=!0,this.F=t.Vector3.Zero(),this.A=!1,this.L=0,this.R=0,this.S=!1,this.q=-1,this.B=!1,this.I=!1,this.J=null,this._=t.Vector3.Zero(),this.D=!1,this.T=0,this.G=50,this.H=0,this.K=!1,this.N=!1,this.P=!1,this.U=700,this.V=null,this.W=0,this.X=0,this.Y=0,this.Z=1,this.$=!1,this.tt=!1,this.it=0,this.st=0,this.ht=10,this.nt=!0,this.et=!1,this.rt=new Map,this.ut=new t.Ray(t.Vector3.Zero(),t.Vector3.One(),1),this.ft=t.Vector3.Zero(),this.ot=.5,this.ct=new Array,this.lt=!1,this.vt=50,this.bt=!1,this.wt=!0,this.kt=!1,this.Mt=!1,this.dt=!0,this.jt=h,null==this.jt&&(this.dt=!1,this.setMode(1)),this.yt=n,this.setAvatar(i,u)||console.error("unable to set avatar");null!=e&&this.setActionMap(e),this.kt||null==this.h||this.Ot(this.h),this.kt,this.dt&&(this.nt=this.jt.checkCollisions),this.gt=new s,this.xt=function(){f.Ct()},this.Ft=function(t){f.At(t)},this.Lt=function(t){f.Rt(t)}}return i.prototype.getScene=function(){return this.yt},i.prototype.setSlopeLimit=function(t,i){this.l=t,this.v=i,this.k=Math.PI*this.l/180,this.M=Math.PI*this.v/180},i.prototype.setStepOffset=function(t){this.p=t},i.prototype.setWalkSpeed=function(t){this.g.walk.speed=t},i.prototype.setRunSpeed=function(t){this.g.run.speed=t},i.prototype.setBackSpeed=function(t){this.g.walkBack.speed=t},i.prototype.setBackFastSpeed=function(t){this.g.walkBackFast.speed=t},i.prototype.setJumpSpeed=function(t){this.g.idleJump.speed=t,this.g.runJump.speed=t},i.prototype.setLeftSpeed=function(t){this.g.strafeLeft.speed=t},i.prototype.setLeftFastSpeed=function(t){this.g.strafeLeftFast.speed=t},i.prototype.setRightSpeed=function(t){this.g.strafeRight.speed=t},i.prototype.setRightFastSpeed=function(t){this.g.strafeLeftFast.speed=t},i.prototype.setTurnSpeed=function(t){this.g.turnLeft.speed=t*Math.PI/180,this.g.turnRight.speed=t*Math.PI/180},i.prototype.setTurnFastSpeed=function(t){this.g.turnLeftFast.speed=t*Math.PI/180,this.g.turnRightFast.speed=t*Math.PI/180},i.prototype.setGravity=function(t){this.u=t},i.prototype.setAnimationGroups=function(t){null!=this.J&&this.J.exist&&this.J.ag.stop(),this.kt=!0,this.setActionMap(t)},i.prototype.setAnimationRanges=function(t){this.kt=!1,this.setActionMap(t)},i.prototype.setActionMap=function(i){for(var s,h=!1,n=0,r=Object.keys(this.g);n<r.length;n++){var u=r[n],f=this.g[u];f instanceof e&&(f.exist=!1,null!=(s=i[f.id])&&(s instanceof t.AnimationGroup?(f.ag=s,f.name=f.ag.name,f.exist=!0,h=!0,this.Mt=!0):s.exist&&(this.Mt=!0,f.exist=!0,s instanceof Object?(s.ag&&(f.ag=s.ag,h=!0),s.name&&(f.name=s.name),null!=s.loop&&(f.loop=s.loop),s.rate&&(f.rate=s.rate),s.speed&&(f.speed=s.speed),s.sound&&(f.sound=s.sound)):f.name=s)))}return this.St(),this.J=null,h?"ag":"ar"},i.prototype.getActionMap=function(){for(var t=new r,i=0,s=Object.keys(this.g);i<s.length;i++){var h=s[i],n=this.g[h];if(n instanceof e&&n.exist){var u=t[n.id];u.ag=n.ag,u.name=n.name,u.loop=n.loop,u.rate=n.rate,u.speed=n.speed,u.key=n.key,u.sound=n.sound,u.exist=n.exist}}return t},i.prototype.getSettings=function(){var t=new u;return t.faceForward=this.isFaceForward(),t.topDown=1==this.getMode(),t.turningOff=this.isTurningOff(),t.cameraTarget=this.F.clone(),t.cameraElastic=this.C,t.elasticSteps=this.vt,t.makeInvisble=this.lt,t.gravity=this.u,t.keyboard=this.wt,t.maxSlopeLimit=this.v,t.minSlopeLimit=this.l,t.noFirstPerson=this.A,t.stepOffset=this.p,t.sound=this.qt,t},i.prototype.setSettings=function(t){this.setFaceForward(t.faceForward),this.setMode(t.topDown?1:0),this.setTurningOff(t.turningOff),this.setCameraTarget(t.cameraTarget),this.setCameraElasticity(t.cameraElastic),this.setElasticiSteps(t.elasticSteps),this.makeObstructionInvisible(t.makeInvisble),this.setGravity(t.gravity),this.enableKeyBoard(t.keyboard),this.setSlopeLimit(t.minSlopeLimit,t.maxSlopeLimit),this.setNoFirstPerson(t.noFirstPerson),this.setStepOffset(t.stepOffset),this.setSound(t.sound)},i.prototype.Bt=function(i,s,h,n){if(this.kt||null!=this.h){if(null!=s)if(this.kt){if(!(s instanceof t.AnimationGroup))return;i.ag=s,i.exist=!0}else{if(null==this.h.getAnimationRange(i.name))return void(i.exist=!1);i.name=s,i.exist=!0}null!=n&&(i.loop=n),null!=h&&(i.rate=h)}},i.prototype.enableBlending=function(t){if(this.kt)for(var i=0,s=Object.keys(this.g);i<s.length;i++){var h=s[i],n=this.g[h];if(n instanceof e&&n.exist)for(var r=0,u=n.ag.targetedAnimations;r<u.length;r++){var f=u[r];f.animation.enableBlending=!0,f.animation.blendingSpeed=t}}else null!==this.h&&this.h.enableBlending(t)},i.prototype.disableBlending=function(){if(this.kt)for(var t=0,i=Object.keys(this.g);t<i.length;t++){var s=i[t],h=this.g[s];if(h instanceof e&&h.exist)for(var n=0,r=h.ag.targetedAnimations;n<r.length;n++){r[n].animation.enableBlending=!1}}},i.prototype.setWalkAnim=function(t,i,s){this.Bt(this.g.walk,t,i,s)},i.prototype.setRunAnim=function(t,i,s){this.Bt(this.g.run,t,i,s)},i.prototype.setWalkBackAnim=function(t,i,s){this.Bt(this.g.walkBack,t,i,s),this.It(this.g.walkBackFast,this.g.walkBack)},i.prototype.setWalkBackFastAnim=function(t,i,s){this.Bt(this.g.walkBackFast,t,i,s)},i.prototype.setSlideBackAnim=function(t,i,s){this.Bt(this.g.slideBack,t,i,s)},i.prototype.setIdleAnim=function(t,i,s){this.Bt(this.g.idle,t,i,s)},i.prototype.setTurnRightAnim=function(t,i,s){this.Bt(this.g.turnRight,t,i,s),this.It(this.g.turnRightFast,this.g.turnRight)},i.prototype.setTurnRightFastAnim=function(t,i,s){this.Bt(this.g.turnRightFast,t,i,s)},i.prototype.setTurnLeftAnim=function(t,i,s){this.Bt(this.g.turnLeft,t,i,s),this.It(this.g.turnLeftFast,this.g.turnLeft)},i.prototype.setTurnLeftFastAnim=function(t,i,s){this.Bt(this.g.turnLeftFast,t,i,s)},i.prototype.setStrafeRightAnim=function(t,i,s){this.Bt(this.g.strafeRight,t,i,s),this.It(this.g.strafeRightFast,this.g.strafeRight)},i.prototype.setStrafeRightFastAnim=function(t,i,s){this.Bt(this.g.strafeRightFast,t,i,s)},i.prototype.setStrafeLeftAnim=function(t,i,s){this.Bt(this.g.strafeLeft,t,i,s),this.It(this.g.strafeLeftFast,this.g.strafeLeft)},i.prototype.setStrafeLeftFastAnim=function(t,i,s){this.Bt(this.g.strafeLeftFast,t,i,s)},i.prototype.setIdleJumpAnim=function(t,i,s){this.Bt(this.g.idleJump,t,i,s)},i.prototype.setRunJumpAnim=function(t,i,s){this.Bt(this.g.runJump,t,i,s)},i.prototype.setFallAnim=function(t,i,s){this.Bt(this.g.fall,t,i,s)},i.prototype.setSound=function(t){if(null!=t){this.qt=t;var i=Object.keys(this.g);t.loop=!1;for(var s=0,h=i;s<h.length;s++){var n=h[s],r=this.g[n];r instanceof e&&(r.sound=t,r.sound.attachToMesh(this.i))}this.g.idle.sound=null,this.g.fall.sound=null,this.g.slideBack.sound=null}},i.prototype.setWalkKey=function(t){this.g.walk.key=t.toLowerCase()},i.prototype.setWalkBackKey=function(t){this.g.walkBack.key=t.toLowerCase()},i.prototype.setTurnLeftKey=function(t){this.g.turnLeft.key=t.toLowerCase()},i.prototype.setTurnRightKey=function(t){this.g.turnRight.key=t.toLowerCase()},i.prototype.setStrafeLeftKey=function(t){this.g.strafeLeft.key=t.toLowerCase()},i.prototype.setStrafeRightKey=function(t){this.g.strafeRight.key=t.toLowerCase()},i.prototype.setJumpKey=function(t){this.g.idleJump.key=t.toLowerCase()},i.prototype.setCameraElasticity=function(t){this.C=t},i.prototype.setElasticiSteps=function(t){this.vt=t},i.prototype.makeObstructionInvisible=function(t){this.lt=t},i.prototype.setCameraTarget=function(t){this.F.copyFrom(t)},i.prototype.cameraCollisionChanged=function(){this.nt=this.jt.checkCollisions},i.prototype.setNoFirstPerson=function(t){this.A=t},i.prototype.Ot=function(t){for(var i=0,s=Object.keys(this.g);i<s.length;i++){var h=s[i],n=this.g[h];n instanceof e&&(null!=t?null!=t.getAnimationRange(n.id)&&(n.name=n.id,n.exist=!0,this.Mt=!0):n.exist=!1)}this.St()},i.prototype.St=function(){this.It(this.g.walkBackFast,this.g.walkBack),this.It(this.g.turnRightFast,this.g.turnRight),this.It(this.g.turnLeftFast,this.g.turnLeft),this.It(this.g.strafeRightFast,this.g.strafeRight),this.It(this.g.strafeLeftFast,this.g.strafeLeft)},i.prototype.It=function(t,i){t.exist||i.exist&&(t.exist=!0,t.ag=i.ag,t.name=i.name,t.rate=2*i.rate)},i.prototype.setMode=function(t){this.dt?(this.L=t,this.R=t):(this.L=1,this.R=1)},i.prototype.getMode=function(){return this.L},i.prototype.setTurningOff=function(t){this.tt=t},i.prototype.isTurningOff=function(){return this.tt},i.prototype.Jt=function(i){var s=i.getWorldMatrix(),h=t.Vector3.FromArray(s.m,0),n=t.Vector3.FromArray(s.m,4),e=t.Vector3.FromArray(s.m,8),r=t.Vector3.Cross(h,n);t.Vector3.Dot(r,e)<0?(this.S=!0,this.q=1):(this.S=!1,this.q=-1)},i.prototype.setFaceForward=function(t){if(this._t=t,this.Dt=this.yt.useRightHandedSystem?-1:1,!this.dt)return this.Tt=0,void(this.zt=1);this.S?(this.Tt=t?Math.PI/2:3*Math.PI/2,this.zt=t?1:-1):(this.Tt=t?3*Math.PI/2:Math.PI/2,this.zt=t?-1:1)},i.prototype.isFaceForward=function(){return this._t},i.prototype.checkAGs=function(t){for(var i=0,s=Object.keys(this.g);i<s.length;i++){var h=s[i],n=this.g[h];n instanceof e&&(null!=t[n.name]&&(n.ag=t[n.name],n.exist=!0))}},i.prototype.Et=function(i,s,h){var n;n=h?this.Gt(i).getChildren((function(i){return i instanceof t.TransformNode}),!1):[i];for(var e=0,r=s;e<r.length;e++)for(var u=0,f=r[e].targetedAnimations;u<f.length;u++){var a=f[u];if(n.indexOf(a.target)>-1)return!0}return!1},i.prototype.Gt=function(t){return null==t.parent?t:this.Gt(t.parent)},i.prototype.start=function(){this.B||(this.B=!0,this.gt.reset(),this.Y=0,this.it=.001,this.D=!1,this.Ht(),this.wt&&this.Kt(),this.yt.registerBeforeRender(this.xt))},i.prototype.stop=function(){this.B&&(this.B=!1,this.yt.unregisterBeforeRender(this.xt),this.Nt(),this.J=null)},i.prototype.pauseAnim=function(){this.I=!0,null!=this.J&&this.J.exist&&(this.kt?this.J.ag.stop():this.yt.stopAnimation(this.h),null!=this.J.sound&&this.J.sound.stop(),clearInterval(this.V),this.yt.unregisterBeforeRender(this.xt))},i.prototype.resumeAnim=function(){this.I=!1,this.J=null,this.yt.registerBeforeRender(this.xt)},i.prototype.Pt=function(){return this.dt?t.Vector3.Dot(this.i.forward,this.i.position.subtract(this.jt.position))<0?1:-1:1},i.prototype.Ct=function(){this._.copyFrom(this.i.position);var t=null,i=this.yt.getEngine().getDeltaTime()/1e3;if(this.gt.Qt&&!this.K?(this.D=!1,this.it=0,t=this.Ut(i)):this.anyMovement()||this.K?(this.D=!1,this.it=0,t=this.Vt(i)):this.K||(t=this.Wt(i)),!this.I&&this.Mt&&null!=t&&this.J!==t){if(t.exist){var s=void 0,h=30;if(this.kt)null!=this.J&&this.J.exist&&this.J.ag.stop(),t.ag.start(t.loop,t.rate),h=t.ag.targetedAnimations[0].animation.framePerSecond,s=t.ag.to-t.ag.from;else h=this.h.beginAnimation(t.name,t.loop,t.rate).getAnimations()[0].animation.framePerSecond,s=this.h.getAnimationRange(t.name).to-this.h.getAnimationRange(t.name).from;null!=this.J&&null!=this.J.sound&&this.J.sound.stop(),clearInterval(this.V),null!=t.sound&&(t.sound.play(),this.V=setInterval((function(){t.sound.play()}),1e3*s/(h*Math.abs(t.rate)*2)))}this.J=t}this.Ht()},i.prototype.Ut=function(i){var s=null;s=this.g.runJump,0===this.X&&(this.W=this.i.position.y),this.X=this.X+i;var h,n=0,e=0;if(this.dt&&1!=this.L&&!this.tt&&(this.i.rotation.y=this.Tt-this.jt.alpha),this.P||this.N?(this.P?n=this.g.run.speed*i:this.N&&(n=this.g.walk.speed*i),(h=this.Xt.clone()).y=0,(h=h.normalize()).scaleToRef(n,h),e=this.Yt(this.g.runJump.speed,i),h.y=e):(e=this.Yt(this.g.idleJump.speed,i),h=new t.Vector3(0,e,0),s=this.g.idleJump),this.i.moveWithCollisions(h),e<0)if(this.i.position.y>this._.y||this.i.position.y===this._.y&&h.length()>.001)this.Zt();else if(this.i.position.y<this.W){var r=this.i.position.subtract(this._);this.$t(r,h,.001)?s=this.g.fall:this.ti(r)<=this.k&&this.Zt()}return s},i.prototype.Yt=function(t,i){return(t-this.u*this.X)*i-.5*this.u*i*i},i.prototype.Zt=function(){this.gt.Qt=!1,this.X=0,this.N=!1,this.P=!1},i.prototype.$t=function(t,i,s){return Math.abs(t.x-i.x)<s&&Math.abs(t.y-i.y)<s&&Math.abs(t.z-i.z)<s},i.prototype.ti=function(t){return Math.atan(Math.abs(t.y/Math.sqrt(t.x*t.x+t.z*t.z)))},i.prototype.Vt=function(t){var i=this.Y*this.u;this.T=i*t+this.u*t*t/2,this.Y=this.Y+t;var s=!1,h=null;if(this.K&&(this.Xt.y=-this.T,s=!0),this.ii(),h=this.si(h,s,t),!this.K){this.N=!1,this.P=!1;var n=void 0,e=0;switch(!0){case this.gt.hi:n=this.q*this.Pt(),e=this.g.strafeLeft.speed*t,this.gt.ni?(e=this.g.strafeLeftFast.speed*t,h=-this.zt*n>0?this.g.strafeLeftFast:this.g.strafeRightFast):h=-this.zt*n>0?this.g.strafeLeft:this.g.strafeRight,this.Xt=this.i.calcMovePOV(n*e,-this.T,0),s=!0;break;case this.gt.ei:n=-this.q*this.Pt(),e=this.g.strafeRight.speed*t,this.gt.ni?(e=this.g.strafeRightFast.speed*t,h=-this.zt*n>0?this.g.strafeLeftFast:this.g.strafeRightFast):h=-this.zt*n>0?this.g.strafeLeft:this.g.strafeRight,this.Xt=this.i.calcMovePOV(n*e,-this.T,0),s=!0;break;case this.gt.ri||this.tt&&0==this.L:this.gt.ni?(this.P=!0,e=this.g.run.speed*t,h=this.g.run):(this.N=!0,e=this.g.walk.speed*t,h=this.g.walk),this.Xt=this.i.calcMovePOV(0,-this.T,this.zt*e),s=!0;break;case this.gt.ui:e=this.g.walkBack.speed*t,this.gt.ni?(e=this.g.walkBackFast.speed*t,h=this.g.walkBackFast):h=this.g.walkBack,this.Xt=this.i.calcMovePOV(0,-this.T,-this.zt*e),s=!0}}if(s&&this.Xt.length()>.001)if(this.i.moveWithCollisions(this.Xt),this.i.position.y>this._.y){var r=this.i.position.subtract(this._),u=this.ti(r);u>=this.M?this.p>0?(0==this.j&&this.O.copyFrom(this._),this.j=this.j+(this.i.position.y-this._.y),this.j>this.p&&(this.j=0,this.i.position.copyFrom(this.O),this.fi())):(this.i.position.copyFrom(this._),this.fi()):(this.j=0,u>this.k?(this.H=0,this.K=!1):this.fi())}else if(this.i.position.y<this._.y){r=this.i.position.subtract(this._);this.$t(r,this.Xt,.001)?(this.K=!0,this.H++,this.H>this.G&&(h=this.g.fall)):this.ti(r)<=this.k?this.fi():(this.H=0,this.K=!1)}else this.fi();return h},i.prototype.ii=function(){if(this.dt&&1!=this.L){var t=this.dt?this.Tt-this.jt.alpha:0;if(this.tt)switch(!0){case this.gt.ri&&this.gt.ai:this.i.rotation.y=t+this.Dt*Math.PI/4;break;case this.gt.ri&&this.gt.oi:this.i.rotation.y=t-this.Dt*Math.PI/4;break;case this.gt.ui&&this.gt.ai:this.i.rotation.y=t+3*this.Dt*Math.PI/4;break;case this.gt.ui&&this.gt.oi:this.i.rotation.y=t-3*this.Dt*Math.PI/4;break;case this.gt.ri:this.i.rotation.y=t;break;case this.gt.ui:this.i.rotation.y=t+Math.PI;break;case this.gt.ai:this.i.rotation.y=t+this.Dt*Math.PI/2;break;case this.gt.oi:this.i.rotation.y=t-this.Dt*Math.PI/2}else this.dt&&(this.i.rotation.y=t)}},i.prototype.si=function(t,i,s){if((!this.tt||0!=this.L)&&!this.gt.hi&&!this.gt.ei&&(this.gt.oi||this.gt.ai)){var h=this.g.turnLeft.speed*s;this.gt.ni&&(h*=2);var n=void 0;1==this.L?(this.$||(this.Z=-this.zt*this.Pt(),this.S&&(this.Z=-this.Z),this.$=!0),n=this.Z,this.gt.oi?this.gt.ri||(this.gt.ui?n=-this.Z:t=this.Z>0?this.g.turnRight:this.g.turnLeft):this.gt.ri?n=-this.Z:this.gt.ui||(n=-this.Z,t=this.Z>0?this.g.turnLeft:this.g.turnRight)):(n=1,this.gt.oi?(this.gt.ui&&(n=-1),i||(t=this.g.turnLeft)):(this.gt.ri&&(n=-1),i||(n=-1,t=this.g.turnRight)),this.dt&&(this.jt.alpha=this.jt.alpha+this.Dt*h*n)),this.i.rotation.y=this.i.rotation.y+h*n}return t},i.prototype.fi=function(){this.Y=0,this.H=0,this.K=!1},i.prototype.Wt=function(i){if(this.D)return this.g.idle;this.N=!1,this.P=!1,this.Y=0;var s=this.g.idle;if(this.H=0,0===i)this.T=5;else{var h=this.it*this.u;this.T=h*i+this.u*i*i/2,this.it=this.it+i}if(this.T<.01)return s;var n=new t.Vector3(0,-this.T,0);if(this.dt&&1!=this.L&&!this.tt&&(this.i.rotation.y=this.Tt-this.jt.alpha),this.i.moveWithCollisions(n),this.i.position.y>this._.y||this.i.position.y===this._.y)this.ci();else if(this.i.position.y<this._.y){var e=this.i.position.subtract(this._);this.$t(e,n,.001)||(this.ti(e)<=this.k?(this.ci(),this.i.position.copyFrom(this._)):(this.li(),s=this.g.slideBack))}return s},i.prototype.ci=function(){this.st++,this.st>this.ht&&(this.D=!0,this.it=0)},i.prototype.li=function(){this.D=!1,this.st=0},i.prototype.Ht=function(){this.dt&&(0==this.j&&this.i.position.addToRef(this.F,this.jt.target),this.jt.radius>this.jt.lowerRadiusLimit&&(this.C||this.lt)&&this.vi(),this.jt.radius<=this.jt.lowerRadiusLimit?this.A||this.et||(this.bi(this.i),this.jt.checkCollisions=!1,this.R=this.L,this.L=0,this.et=!0):this.et&&(this.et=!1,this.L=this.R,this.wi(this.i),this.jt.checkCollisions=this.nt))},i.prototype.bi=function(i){var s=this;this.rt.set(i,i.visibility),i.visibility=0,i.getChildMeshes(!1,(function(i){return i instanceof t.Mesh&&(s.rt.set(i,i.visibility),i.visibility=0),!1}))},i.prototype.wi=function(i){var s=this;i.visibility=this.rt.get(i),i.getChildMeshes(!1,(function(i){return i instanceof t.Mesh&&(i.visibility=s.rt.get(i)),!1}))},i.prototype.vi=function(){var t=this;this.jt.position.subtractToRef(this.jt.target,this.ft),this.ut.origin=this.jt.target,this.ut.length=this.ft.length(),this.ut.direction=this.ft.normalize();var i=this.yt.multiPickWithRay(this.ut,(function(i){return i!=t.i}));if(this.lt)if(this.ki=this.ct,i.length>0){this.ct=new Array;for(var s=0,h=i;s<h.length;s++){var n=h[s];(n.pickedMesh.isVisible||this.ki.includes(n.pickedMesh))&&(n.pickedMesh.isVisible=!1,this.ct.push(n.pickedMesh))}for(var e=0,r=this.ki;e<r.length;e++){var u=r[e];this.ct.includes(u)||(u.isVisible=!0)}}else{for(var f=0,a=this.ki;f<a.length;f++){(u=a[f]).isVisible=!0}this.ki.length=0}if(this.C&&i.length>0){if(!(1!=i.length||this.Mi(i[0].pickedMesh)||i[0].pickedMesh.checkCollisions&&this.jt.checkCollisions))return;for(var o=null,c=0;c<i.length;c++){u=i[c].pickedMesh;if(this.Mi(u)){o=i[c].pickedPoint;break}if(u.checkCollisions){o=i[c].pickedPoint;break}}if(null==o)return;var l=this.jt.position.subtract(o),v=l.length();if(this.jt.checkCollisions){var b=void 0;b=v<=1?l.addInPlace(l.normalizeToNew().scaleInPlace(this.ot)):l.normalize().scaleInPlace(v/this.vt),this.jt.position=this.jt.position.subtract(b)}else{b=void 0;b=v<=1?v+this.ot:v/this.vt,this.jt.radius=this.jt.radius-b}}},i.prototype.Mi=function(t){return!!t.isVisible&&(0!=t.visibility&&(null==t.material||0==t.material.alphaMode||0!=t.material.alpha))},i.prototype.anyMovement=function(){return this.gt.ri||this.gt.ui||this.gt.oi||this.gt.ai||this.gt.hi||this.gt.ei},i.prototype.Rt=function(t){if(t.key&&!t.repeat){switch(t.key.toLowerCase()){case this.g.idleJump.key:this.gt.Qt=!0;break;case"capslock":this.gt.ni=!this.gt.ni;break;case"shift":this.gt.ni=!0;break;case"up":case"arrowup":case this.g.walk.key:this.gt.ri=!0;break;case"left":case"arrowleft":case this.g.turnLeft.key:this.gt.oi=!0;break;case"right":case"arrowright":case this.g.turnRight.key:this.gt.ai=!0;break;case"down":case"arrowdown":case this.g.walkBack.key:this.gt.ui=!0;break;case this.g.strafeLeft.key:this.gt.hi=!0;break;case this.g.strafeRight.key:this.gt.ei=!0}this.bt=this.anyMovement()}},i.prototype.At=function(t){if(t.key){switch(t.key.toLowerCase()){case"shift":this.gt.ni=!1;break;case"up":case"arrowup":case this.g.walk.key:this.gt.ri=!1;break;case"left":case"arrowleft":case this.g.turnLeft.key:this.gt.oi=!1,this.$=!1;break;case"right":case"arrowright":case this.g.turnRight.key:this.gt.ai=!1,this.$=!1;break;case"down":case"arrowdown":case this.g.walkBack.key:this.gt.ui=!1;break;case this.g.strafeLeft.key:this.gt.hi=!1;break;case this.g.strafeRight.key:this.gt.ei=!1}this.bt=this.anyMovement()}},i.prototype.isKeyBoardEnabled=function(){return this.wt},i.prototype.enableKeyBoard=function(t){this.wt=t,t?this.Kt():this.Nt()},i.prototype.Kt=function(){var t=this.yt.getEngine().getRenderingCanvas();t.addEventListener("keyup",this.Ft,!1),t.addEventListener("keydown",this.Lt,!1)},i.prototype.Nt=function(){var t=this.yt.getEngine().getRenderingCanvas();t.removeEventListener("keyup",this.Ft,!1),t.removeEventListener("keydown",this.Lt,!1)},i.prototype.walk=function(t){this.gt.ri=t},i.prototype.walkBack=function(t){this.gt.ui=t},i.prototype.walkBackFast=function(t){this.gt.ui=t,this.gt.ni=t},i.prototype.run=function(t){this.gt.ri=t,this.gt.ni=t},i.prototype.turnLeft=function(t){this.gt.oi=t,t||(this.$=t)},i.prototype.turnLeftFast=function(t){this.gt.oi=t,t||(this.$=t),this.gt.ni=t},i.prototype.turnRight=function(t){this.gt.ai=t,t||(this.$=t)},i.prototype.turnRightFast=function(t){this.gt.ai=t,t||(this.$=t),this.gt.ni=t},i.prototype.strafeLeft=function(t){this.gt.hi=t},i.prototype.strafeLeftFast=function(t){this.gt.hi=t,this.gt.ni=t},i.prototype.strafeRight=function(t){this.gt.ei=t},i.prototype.strafeRightFast=function(t){this.gt.ei=t,this.gt.ni=t},i.prototype.jump=function(){this.gt.Qt=!0},i.prototype.idle=function(){this.gt.reset()},i.prototype.isAg=function(){return this.kt},i.prototype.di=function(i){var s=this.pi(i);if(s instanceof t.Mesh&&s.skeleton)return s.skeleton;var h=s.getChildMeshes(!1,(function(i){return!!(i instanceof t.Mesh&&i.skeleton)}));return h.length>0?h[0].skeleton:null},i.prototype.pi=function(t){return null==t.parent?t:this.pi(t.parent)},i.prototype.setAvatar=function(i,s){void 0===s&&(s=!1);var h=this.pi(i);return h instanceof t.Mesh?(this.i=h,this.h=this.di(i),this.kt=this.Et(i,this.yt.animationGroups,!0),this.g.reset(),this.kt||null==this.h||this.Ot(this.h),this.Jt(i),this.setFaceForward(s),!0):(console.error("Cannot move this mesh. The root node of the mesh provided is not a mesh"),!1)},i.prototype.getAvatar=function(){return this.i},i.prototype.setAvatarSkeleton=function(t){this.h=t,null!=this.h&&this.ji(t)?this.kt=!0:this.kt=!1,this.kt||null==this.h||this.Ot(this.h)},i.prototype.ji=function(t){var i=this;return t.animations.some((function(t){return i.yt.animationGroups.some((function(i){return i.children.some((function(i){return i.animation==t}))}))}))},i.prototype.getSkeleton=function(){return this.h},i}(),s=function(){function t(){this.ri=!1,this.ui=!1,this.ai=!1,this.oi=!1,this.ei=!1,this.hi=!1,this.Qt=!1,this.ni=!1,this.reset()}return t.prototype.reset=function(){this.ri=!1,this.ui=!1,this.ai=!1,this.oi=!1,this.ei=!1,this.hi=!1,this.Qt=!1,this.ni=!1},t}(),e=function(){function t(t,i,s){void 0===i&&(i=1),this.name="",this.loop=!0,this.rate=1,this.exist=!1,this.id=t,this.speed=i,this.ds=i,this.key=s,this.dk=s}return t.prototype.reset=function(){this.name="",this.speed=this.ds,this.key=this.dk,this.loop=!0,this.rate=1,this.sound=null,this.exist=!1},t}(),r=function(){function t(){this.walk=new e("walk",3,"w"),this.walkBack=new e("walkBack",1.5,"s"),this.walkBackFast=new e("walkBackFast",3,"na"),this.idle=new e("idle",0,"na"),this.idleJump=new e("idleJump",6," "),this.run=new e("run",6,"na"),this.runJump=new e("runJump",6,"na"),this.fall=new e("fall",0,"na"),this.turnLeft=new e("turnLeft",Math.PI/8,"a"),this.turnLeftFast=new e("turnLeftFast",Math.PI/4,"na"),this.turnRight=new e("turnRight",Math.PI/8,"d"),this.turnRightFast=new e("turnRightFast",Math.PI/4,"na"),this.strafeLeft=new e("strafeLeft",1.5,"q"),this.strafeLeftFast=new e("strafeLeftFast",3,"na"),this.strafeRight=new e("strafeRight",1.5,"e"),this.strafeRightFast=new e("strafeRightFast",3,"na"),this.slideBack=new e("slideBack",0,"na")}return t.prototype.reset=function(){for(var t=0,i=Object.keys(this);t<i.length;t++){var s=this[i[t]];s instanceof e&&s.reset()}},t}(),u=function(){this.cameraElastic=!0,this.makeInvisble=!0,this.cameraTarget=t.Vector3.Zero(),this.noFirstPerson=!1,this.topDown=!0,this.turningOff=!0,this.keyboard=!0}})(),n})()));
//# sourceMappingURL=CharacterController.js.map