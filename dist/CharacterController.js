!function(t,i){if("object"==typeof exports&&"object"==typeof module)module.exports=i(require("babylonjs"));else if("function"==typeof define&&define.amd)define(["babylonjs"],i);else{var s="object"==typeof exports?i(require("babylonjs")):i(t.BABYLON);for(var h in s)("object"==typeof exports?exports:t)[h]=s[h]}}(self,(t=>(()=>{"use strict";var i={247:i=>{i.exports=t}},s={};function h(t){var n=s[t];if(void 0!==n)return n.exports;var e=s[t]={exports:{}};return i[t](e,e.exports,h),e.exports}h.n=t=>{var i=t&&t.t?()=>t.default:()=>t;return h.d(i,{a:i}),i},h.d=(t,i)=>{for(var s in i)h.o(i,s)&&!h.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:i[s]})},h.o=(t,i)=>Object.prototype.hasOwnProperty.call(t,i),h.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"t",{value:!0})};var n={};return(()=>{h.r(n),h.d(n,{ActionData:()=>e,ActionMap:()=>u,Actions:()=>r,CCSettings:()=>a,CharacterController:()=>i});var t=h(247),i=function(){function i(i,h,n,e,r){void 0===r&&(r=!1);var a=this;this.i=null,this.h=null,this.u=9.8,this.l=30,this.v=45,this.M=Math.PI*this.l/180,this.k=Math.PI*this.v/180,this.p=.25,this.A=new u,this.j=!0,this.T=t.Vector3.Zero(),this.F=!1,this.R=t.Vector3.DownReadOnly,this.g=0,this.L=0,this.O=!1,this.S=-1,this.I=!1,this.B=!1,this.C=null,this.U=t.Vector3.Zero(),this.N=0,this.K=!1,this.D=0,this.G=!1,this.H=!1,this.J=!1,this.q=t.Vector3.Zero(),this.W=700,this.P=null,this._=0,this.Y=0,this.V=0,this.X=1,this.Z=!1,this.$=!1,this.tt=!0,this.it=!1,this.st=null,this.ht={},this.nt=0,this.et=0,this.rt=10,this.ut=!0,this.ft=!1,this.ot=new Map,this.ct=new t.Ray(t.Vector3.Zero(),t.Vector3.One(),1),this.lt=t.Vector3.Zero(),this.vt=.5,this.bt=new Array,this.wt=!1,this.Mt=50,this.dt=!1,this.kt=!0,this.At=!1,this.yt=null,this.jt=!1,this.Tt=!0,this.Ft=h,null==this.Ft&&(this.Tt=!1,this.setMode(1)),this.Rt=n,this.setAvatar(i,r)||console.error("unable to set avatar");null!=e&&this.setActionMap(e),this.At||null==this.h||this.gt(this.h),this.At,this.Tt&&(this.ut=this.Ft.checkCollisions),this.Lt=new s,this.Ot=function(){a.St()},this.Et=function(t){a.It(t)},this.Bt=function(t){a.Ct(t)}}return i.prototype.getScene=function(){return this.Rt},i.prototype.setSlopeLimit=function(t,i){this.l=t,this.v=i,this.M=Math.PI*this.l/180,this.k=Math.PI*this.v/180},i.prototype.setStepOffset=function(t){this.p=t},i.prototype.setWalkSpeed=function(t){this.A.walk.speed=t},i.prototype.setRunSpeed=function(t){this.A.run.speed=t},i.prototype.setBackSpeed=function(t){this.A.walkBack.speed=t},i.prototype.setBackFastSpeed=function(t){this.A.walkBackFast.speed=t},i.prototype.setJumpSpeed=function(t){this.A.idleJump.speed=t,this.A.runJump.speed=t},i.prototype.setLeftSpeed=function(t){this.A.strafeLeft.speed=t},i.prototype.setLeftFastSpeed=function(t){this.A.strafeLeftFast.speed=t},i.prototype.setRightSpeed=function(t){this.A.strafeRight.speed=t},i.prototype.setRightFastSpeed=function(t){this.A.strafeLeftFast.speed=t},i.prototype.setTurnSpeed=function(t){this.A.turnLeft.speed=t*Math.PI/180,this.A.turnRight.speed=t*Math.PI/180},i.prototype.setTurnFastSpeed=function(t){this.A.turnLeftFast.speed=t*Math.PI/180,this.A.turnRightFast.speed=t*Math.PI/180},i.prototype.setGravity=function(t){this.u=t},i.prototype.setAnimationGroups=function(t){null!=this.C&&this.C.exist&&this.C.ag.stop(),this.At=!0,this.setActionMap(t)},i.prototype.setAnimationRanges=function(t){this.At=!1,this.setActionMap(t)},i.prototype.setActionMap=function(i){for(var s,h=!1,n=0,r=Object.keys(this.A);n<r.length;n++){var u=r[n],a=this.A[u];a instanceof e&&(a.exist=!1,null!=(s=i[a.id])&&(s instanceof t.AnimationGroup?(a.ag=s,a.name=a.ag.name,a.exist=!0,h=!0,this.jt=!0):s.exist&&(this.jt=!0,a.exist=!0,s instanceof Object?(s.ag&&(a.ag=s.ag,h=!0),s.name&&(a.name=s.name),null!=s.loop&&(a.loop=s.loop),s.rate&&(a.rate=s.rate),s.speed&&(a.speed=s.speed),s.sound&&(a.sound=s.sound)):a.name=s)))}return this.Ut(),this.C=null,h?"ag":"ar"},i.prototype.getActionMap=function(){for(var t=new u,i=0,s=Object.keys(this.A);i<s.length;i++){var h=s[i],n=this.A[h];if(n instanceof e&&n.exist){var r=t[n.id];r.ag=n.ag,r.name=n.name,r.loop=n.loop,r.rate=n.rate,r.speed=n.speed,r.key=n.key,r.sound=n.sound,r.exist=n.exist}}return t},i.prototype.getSettings=function(){var t=new a;return t.faceForward=this.isFaceForward(),t.topDown=1==this.getMode(),t.turningOff=this.isTurningOff(),t.cameraTarget=this.T.clone(),t.cameraElastic=this.j,t.elasticSteps=this.Mt,t.makeInvisble=this.wt,t.gravity=this.u,t.keyboard=this.kt,t.maxSlopeLimit=this.v,t.minSlopeLimit=this.l,t.noFirstPerson=this.F,t.stepOffset=this.p,t.sound=this.Nt,t.animBlend=this.Kt,t.ellipsoid=this.i.ellipsoid,t.ellipsoidOffset=this.i.ellipsoidOffset,t},i.prototype.setSettings=function(t){this.setFaceForward(t.faceForward),this.setMode(t.topDown?1:0),this.setTurningOff(t.turningOff),this.setCameraTarget(t.cameraTarget),this.setCameraElasticity(t.cameraElastic),this.setElasticiSteps(t.elasticSteps),this.makeObstructionInvisible(t.makeInvisble),this.setGravity(t.gravity),this.enableKeyBoard(t.keyboard),this.setSlopeLimit(t.minSlopeLimit,t.maxSlopeLimit),this.setNoFirstPerson(t.noFirstPerson),this.setStepOffset(t.stepOffset),this.setSound(t.sound),this.enableBlending(t.animBlend),this.i.ellipsoid=t.ellipsoid,this.i.ellipsoidOffset=t.ellipsoidOffset},i.prototype.xt=function(i,s,h,n){if(this.At||null!=this.h){if(null!=s)if(this.At){if(!(s instanceof t.AnimationGroup))return;i.ag=s,i.exist=!0}else{if(null==this.h.getAnimationRange(i.name))return void(i.exist=!1);i.name=s,i.exist=!0}null!=n&&(i.loop=n),null!=h&&(i.rate=h)}},i.prototype.enableBlending=function(t){if(this.At)for(var i=0,s=Object.keys(this.A);i<s.length;i++){var h=s[i],n=this.A[h];if(n instanceof e&&n.exist){var r=n.ag;this.Kt=t;for(var u=0,a=r.targetedAnimations;u<a.length;u++){var f=a[u];f.animation.enableBlending=!0,f.animation.blendingSpeed=t}}}else null!==this.h&&(this.h.enableBlending(t),this.Kt=t)},i.prototype.disableBlending=function(){if(this.At)for(var t=0,i=Object.keys(this.A);t<i.length;t++){var s=i[t],h=this.A[s];if(h instanceof e&&h.exist)for(var n=0,r=h.ag.targetedAnimations;n<r.length;n++){r[n].animation.enableBlending=!1}}},i.prototype.setWalkAnim=function(t,i,s){this.xt(this.A.walk,t,i,s)},i.prototype.setRunAnim=function(t,i,s){this.xt(this.A.run,t,i,s)},i.prototype.setWalkBackAnim=function(t,i,s){this.xt(this.A.walkBack,t,i,s),this.Dt(this.A.walkBackFast,this.A.walkBack)},i.prototype.setWalkBackFastAnim=function(t,i,s){this.xt(this.A.walkBackFast,t,i,s)},i.prototype.setSlideBackAnim=function(t,i,s){this.xt(this.A.slideBack,t,i,s)},i.prototype.setIdleAnim=function(t,i,s){this.xt(this.A.idle,t,i,s)},i.prototype.setTurnRightAnim=function(t,i,s){this.xt(this.A.turnRight,t,i,s),this.Dt(this.A.turnRightFast,this.A.turnRight)},i.prototype.setTurnRightFastAnim=function(t,i,s){this.xt(this.A.turnRightFast,t,i,s)},i.prototype.setTurnLeftAnim=function(t,i,s){this.xt(this.A.turnLeft,t,i,s),this.Dt(this.A.turnLeftFast,this.A.turnLeft)},i.prototype.setTurnLeftFastAnim=function(t,i,s){this.xt(this.A.turnLeftFast,t,i,s)},i.prototype.setStrafeRightAnim=function(t,i,s){this.xt(this.A.strafeRight,t,i,s),this.Dt(this.A.strafeRightFast,this.A.strafeRight)},i.prototype.setStrafeRightFastAnim=function(t,i,s){this.xt(this.A.strafeRightFast,t,i,s)},i.prototype.setStrafeLeftAnim=function(t,i,s){this.xt(this.A.strafeLeft,t,i,s),this.Dt(this.A.strafeLeftFast,this.A.strafeLeft)},i.prototype.setStrafeLeftFastAnim=function(t,i,s){this.xt(this.A.strafeLeftFast,t,i,s)},i.prototype.setIdleJumpAnim=function(t,i,s){this.xt(this.A.idleJump,t,i,s)},i.prototype.setRunJumpAnim=function(t,i,s){this.xt(this.A.runJump,t,i,s)},i.prototype.setFallAnim=function(t,i,s){this.xt(this.A.fall,t,i,s)},i.prototype.setSound=function(t){if(null!=t){this.Nt=t;var i=Object.keys(this.A);t.loop=!1;for(var s=0,h=i;s<h.length;s++){var n=h[s],r=this.A[n];r instanceof e&&(r.sound=t,r.sound.attachToMesh(this.i))}this.A.idle.sound=null,this.A.fall.sound=null,this.A.slideBack.sound=null}},i.prototype.setWalkKey=function(t){this.A.walk.key=t.toLowerCase()},i.prototype.setWalkBackKey=function(t){this.A.walkBack.key=t.toLowerCase()},i.prototype.setTurnLeftKey=function(t){this.A.turnLeft.key=t.toLowerCase()},i.prototype.setTurnRightKey=function(t){this.A.turnRight.key=t.toLowerCase()},i.prototype.setStrafeLeftKey=function(t){this.A.strafeLeft.key=t.toLowerCase()},i.prototype.setStrafeRightKey=function(t){this.A.strafeRight.key=t.toLowerCase()},i.prototype.setJumpKey=function(t){this.A.idleJump.key=t.toLowerCase()},i.prototype.setCameraElasticity=function(t){this.j=t},i.prototype.setElasticiSteps=function(t){this.Mt=t},i.prototype.makeObstructionInvisible=function(t){this.wt=t},i.prototype.setCameraTarget=function(t){this.T.copyFrom(t)},i.prototype.cameraCollisionChanged=function(){this.ut=this.Ft.checkCollisions},i.prototype.setNoFirstPerson=function(t){this.F=t},i.prototype.gt=function(t){for(var i=0,s=Object.keys(this.A);i<s.length;i++){var h=s[i],n=this.A[h];n instanceof e&&(null!=t?null!=t.getAnimationRange(n.id)&&(n.name=n.id,n.exist=!0,this.jt=!0):n.exist=!1)}this.Ut()},i.prototype.Ut=function(){this.Dt(this.A.walkBackFast,this.A.walkBack),this.Dt(this.A.turnRightFast,this.A.turnRight),this.Dt(this.A.turnLeftFast,this.A.turnLeft),this.Dt(this.A.strafeRightFast,this.A.strafeRight),this.Dt(this.A.strafeLeftFast,this.A.strafeLeft)},i.prototype.Dt=function(t,i){t.exist||i.exist&&(t.exist=!0,t.ag=i.ag,t.name=i.name,t.rate=2*i.rate)},i.prototype.setMode=function(t){this.Tt?(this.g=t,this.L=t):(this.g=1,this.L=1)},i.prototype.getMode=function(){return this.g},i.prototype.setTurningOff=function(t){this.$=t},i.prototype.isTurningOff=function(){return this.$},i.prototype.Gt=function(i){var s=i.getWorldMatrix(),h=t.Vector3.FromArray(s.m,0),n=t.Vector3.FromArray(s.m,4),e=t.Vector3.FromArray(s.m,8),r=t.Vector3.Cross(h,n);t.Vector3.Dot(r,e)<0?(this.O=!0,this.S=1):(this.O=!1,this.S=-1)},i.prototype.setFaceForward=function(t){this.Ht=t,this.Jt=this.Rt.useRightHandedSystem?-1:1,this.O?(this.qt=t?Math.PI/2:3*Math.PI/2,this.Wt=t?1:-1):(this.qt=t?3*Math.PI/2:Math.PI/2,this.Wt=t?-1:1),this.Tt||(this.qt=0)},i.prototype.isFaceForward=function(){return this.Ht},i.prototype.checkAGs=function(t){for(var i=0,s=Object.keys(this.A);i<s.length;i++){var h=s[i],n=this.A[h];n instanceof e&&(null!=t[n.name]&&(n.ag=t[n.name],n.exist=!0))}},i.prototype.Pt=function(i,s,h){var n;n=h?this._t(i).getChildren((function(i){return i instanceof t.TransformNode}),!1):[i];for(var e=0,r=s;e<r.length;e++)for(var u=0,a=r[e].targetedAnimations;u<a.length;u++){var f=a[u];if(n.indexOf(f.target)>-1)return!0}return!1},i.prototype._t=function(t){return null==t.parent?t:this._t(t.parent)},i.prototype.start=function(){this.I||(this.I=!0,this.Lt.reset(),this.V=0,this.nt=.001,this.K=!1,this.Yt(),this.kt&&this.zt(),this.Rt.registerBeforeRender(this.Ot))},i.prototype.stop=function(){this.I&&(this.I=!1,this.Rt.unregisterBeforeRender(this.Ot),this.Qt(),this.C=null)},i.prototype.pauseAnim=function(){this.B=!0,null!=this.C&&this.C.exist&&(this.At?this.C.ag.stop():this.Rt.stopAnimation(this.h),null!=this.C.sound&&this.C.sound.stop(),clearInterval(this.P),this.Rt.unregisterBeforeRender(this.Ot))},i.prototype.resumeAnim=function(){this.B=!1,this.C=null,this.Rt.registerBeforeRender(this.Ot)},i.prototype.Vt=function(){return this.Tt&&t.Vector3.Dot(this.i.forward,this.i.position.subtract(this.Ft.position))<0?1:-1},i.prototype.St=function(){this.U.copyFrom(this.i.position);var t=null,i=this.Rt.getEngine().getDeltaTime()/1e3;if(this.Lt.Xt&&!this.G?(this.K=!1,this.nt=0,t=this.Zt(i)):this.anyMovement()||this.G?(this.K=!1,this.nt=0,t=this.$t(i)):this.G||(t=this.ti(i)),!this.B&&this.jt&&null!=t&&this.C!==t){if(t.exist){var s=void 0,h=30;if(this.At)null!=this.C&&this.C.exist&&this.C.ag.stop(),t.ag.start(t.loop,t.rate),h=t.ag.targetedAnimations[0].animation.framePerSecond,s=t.ag.to-t.ag.from;else h=this.h.beginAnimation(t.name,t.loop,t.rate).getAnimations()[0].animation.framePerSecond,s=this.h.getAnimationRange(t.name).to-this.h.getAnimationRange(t.name).from;null!=this.C&&null!=this.C.sound&&this.C.sound.stop(),clearInterval(this.P),null!=t.sound&&(t.sound.play(),this.P=setInterval((function(){t.sound.play()}),1e3*s/(h*Math.abs(t.rate)*2)))}this.C=t}this.Yt()},i.prototype.Zt=function(i){var s=null;s=this.A.runJump,0===this.Y&&(this._=this.i.position.y),this.Y=this.Y+i;var h,n=0,e=0;if(this.J||this.H?(this.J?n=this.A.run.speed*i:this.H&&(n=this.A.walk.speed*i),(h=this.q.clone()).y=0,(h=h.normalize()).scaleToRef(n,h),e=this.ii(this.A.runJump.speed,i),h.y=e):(e=this.ii(this.A.idleJump.speed,i),h=new t.Vector3(0,e,0),s=this.A.idleJump),this.i.moveWithCollisions(h),e<0)if(this.i.position.y>this.U.y||this.i.position.y===this.U.y&&h.length()>.001)this.si();else if(this.i.position.y<this._){var r=this.i.position.subtract(this.U);if(this.hi(r,h,.001))s=this.A.fall;else this.ni(r).slope<=this.M&&this.si()}return s},i.prototype.ii=function(t,i){return(t-this.u*this.Y)*i-.5*this.u*i*i},i.prototype.si=function(){this.Lt.Xt=!1,this.Y=0,this.H=!1,this.J=!1},i.prototype.hi=function(t,i,s){return Math.abs(t.x-i.x)<s&&Math.abs(t.y-i.y)<s&&Math.abs(t.z-i.z)<s},i.prototype.ei=function(t){return Math.atan(Math.abs(t.y/Math.sqrt(t.x*t.x+t.z*t.z)))},i.prototype.$t=function(t){var i=this.u*this.V;this.D=i*t+this.u*t*t/2,this.V=this.V+t;var s=!1,h=null;if(this.q.x=0,this.q.y=0,this.q.z=0,this.G&&(this.q.y=-this.D,s=!0),this.ri(),h=this.ui(h,s,t),!this.G){this.H=!1,this.J=!1;var n=void 0,e=0;switch(!0){case this.Lt.ai:n=this.S*this.Vt(),e=this.A.strafeLeft.speed*t,this.Lt.fi?(e=this.A.strafeLeftFast.speed*t,h=-this.Wt*n>0?this.A.strafeLeftFast:this.A.strafeRightFast):h=-this.Wt*n>0?this.A.strafeLeft:this.A.strafeRight,this.q=this.i.calcMovePOV(n*e,-this.D,0),s=!0;break;case this.Lt.oi:n=-this.S*this.Vt(),e=this.A.strafeRight.speed*t,this.Lt.fi?(e=this.A.strafeRightFast.speed*t,h=-this.Wt*n>0?this.A.strafeLeftFast:this.A.strafeRightFast):h=-this.Wt*n>0?this.A.strafeLeft:this.A.strafeRight,this.q=this.i.calcMovePOV(n*e,-this.D,0),s=!0;break;case this.Lt.ci||this.$&&0==this.g:this.Lt.fi?(this.J=!0,e=this.A.run.speed*t,h=this.A.run):(this.H=!0,e=this.A.walk.speed*t,h=this.A.walk),this.q=this.i.calcMovePOV(0,-this.D,this.Wt*e),s=!0;break;case this.Lt.li:e=this.A.walkBack.speed*t,this.Lt.fi?(e=this.A.walkBackFast.speed*t,h=this.A.walkBackFast):h=this.A.walkBack,this.q=this.i.calcMovePOV(0,-this.D,-this.Wt*e),s=!0}}if(s&&this.q.length()>.001){this.i.moveWithCollisions(this.q);var r=this.i.position.subtract(this.U),u=this.ni(r);if(this.i.position.y-this.U.y>.01)if(u.hit&&0==u.slope){if(this.p>0)u.y-this.U.y>this.p?this.it=!0:this.it=!1,this.it?this.i.position.copyFrom(this.U):(this.i.position.y=u.y,this.V=0)}else{var a=u.slope;a>=this.k&&u.y>this.N?(this.i.position.copyFrom(this.U),this.vi(),this.N=0):(this.N=u.y,a>this.M?this.G=!1:this.vi())}else if(this.i.position.y<this.U.y){var f=this.i.position.subtract(this.U);this.hi(f,this.q,.001)&&!u.hit?(this.G=!0,h=this.A.fall):(u.slope,this.M,this.G=!1)}else this.G=!1}return h},i.prototype.ni=function(i){var s,h=this,n=this.i.position.y-this.U.y,e=!0;(e=Math.abs(n)<.006||n>.01,i.y=0,0==i.x&&0==i.z)?s=!0:s=t.Vector3.Dot(this.i.forward,i.normalize())>=0;var r=e&&s||!e&&!s?1:-1;this.i.forward.scaleToRef(this.i.ellipsoid.x*r,this.ct.origin),this.ct.origin.addToRef(this.i.position,this.ct.origin),this.ct.origin.addToRef(this.i.ellipsoidOffset,this.ct.origin),this.ct.length=2*this.i.ellipsoid.y,this.ct.direction=this.R,null!=this.yt&&this.bi(this.ct.origin,this.ct.origin.add(new t.Vector3(0,-this.ct.length,0)));var u=this.Rt.pickWithRay(this.ct,(function(t){return!h.wi.includes(t)&&!!t.checkCollisions}));if(null!=u&&u.hit){var a=u.getNormal(!0,!0),f=Math.PI/2-Math.asin(Math.abs(a.y));return{name:u.pickedMesh.name,ground:!0,slope:f,y:u.pickedPoint.y,hit:!0}}return{name:"",ground:!1,slope:0,y:0,hit:!1}},i.prototype.Mi=function(){var t=this;this.i.position.addToRef(this.i.ellipsoidOffset,this.ct.origin),this.ct.origin.y=this.ct.origin.y-this.i.ellipsoid.y,this.ct.length=this.i.ellipsoid.y/2,this.ct.direction=this.R;var i=this.Rt.multiPickWithRay(this.ct,(function(i){return i!=t.i&&!!i.checkCollisions}));if(i.length>0){var s=i[0],h=s.getNormal(!0,!0),n=Math.PI/2-Math.asin(Math.abs(h.y));return{name:s.pickedMesh.name,ground:!0,slope:n}}return{name:"",ground:!1,slope:0}},i.prototype.bi=function(i,s){if(null==this.st){var h=[i,s];this.ht={points:h,updatable:!0},this.st=t.MeshBuilder.CreateLines("lines",this.ht)}else this.ht.points[0]=i,this.ht.points[1]=s,this.ht.instance=this.st,this.st=t.MeshBuilder.CreateLines("lines",this.ht)},i.prototype.ri=function(){if(this.Tt&&1!=this.g){var t=this.Tt?this.qt-this.Ft.alpha:0;if(this.$)switch(!0){case this.Lt.ci&&this.Lt.di:this.i.rotation.y=t+this.Jt*Math.PI/4;break;case this.Lt.ci&&this.Lt.ki:this.i.rotation.y=t-this.Jt*Math.PI/4;break;case this.Lt.li&&this.Lt.di:this.i.rotation.y=t+3*this.Jt*Math.PI/4;break;case this.Lt.li&&this.Lt.ki:this.i.rotation.y=t-3*this.Jt*Math.PI/4;break;case this.Lt.ci:this.i.rotation.y=t;break;case this.Lt.li:this.i.rotation.y=t+Math.PI;break;case this.Lt.di:this.i.rotation.y=t+this.Jt*Math.PI/2;break;case this.Lt.ki:this.i.rotation.y=t-this.Jt*Math.PI/2}else this.Tt&&(this.i.rotation.y=t)}},i.prototype.ui=function(t,i,s){if((!this.$||0!=this.g)&&!this.Lt.ai&&!this.Lt.oi&&(this.Lt.ki||this.Lt.di)){var h=this.A.turnLeft.speed*s;this.Lt.fi&&(h*=2);var n=void 0;1==this.g?(this.Z||(this.X=-this.Wt*this.Vt(),this.O&&(this.X=-this.X),this.Z=!0),n=this.X,this.Lt.ki?this.Lt.ci||(this.Lt.li?n=-this.X:t=this.X>0?this.A.turnRight:this.A.turnLeft):this.Lt.ci?n=-this.X:this.Lt.li||(n=-this.X,t=this.X>0?this.A.turnLeft:this.A.turnRight)):(n=1,this.Lt.ki?(this.Lt.li&&(n=-1),i||(t=this.A.turnLeft)):(this.Lt.ci&&(n=-1),i||(n=-1,t=this.A.turnRight)),this.Tt&&(this.Ft.alpha=this.Ft.alpha+this.Jt*h*n)),this.i.rotation.y=this.i.rotation.y+h*n}return t},i.prototype.vi=function(){this.V=0,this.G=!1},i.prototype.ti=function(i){if(this.K)return this.A.idle;this.H=!1,this.J=!1,this.V=0;var s=this.A.idle;if(0===i)this.D=5;else{var h=this.nt*this.u;this.D=h*i+this.u*i*i/2,this.nt=this.nt+i}if(this.D<.01)return s;var n=new t.Vector3(0,-this.D,0);if(this.i.moveWithCollisions(n),this.i.position.y>this.U.y||this.i.position.y===this.U.y){var e=this.i.position.subtract(this.U);this.ni(e).slope<=this.M?(this.pi(),this.i.position.copyFrom(this.U)):(this.Ai(),s=this.A.slideBack)}else if(this.i.position.y<this.U.y){e=this.i.position.subtract(this.U);if(this.hi(e,n,.001))s=this.A.fall;else this.ni(e).slope<=this.M?(this.pi(),this.i.position.copyFrom(this.U)):(this.Ai(),s=this.A.slideBack)}return s},i.prototype.pi=function(){this.et++,this.et>this.rt&&(this.K=!0,this.nt=0)},i.prototype.Ai=function(){this.K=!1,this.et=0},i.prototype.Yt=function(){this.Tt&&(this.i.position.addToRef(this.T,this.Ft.target),this.Ft.radius>this.Ft.lowerRadiusLimit&&(this.j||this.wt)&&this.yi(),this.Ft.radius<=this.Ft.lowerRadiusLimit?this.F||this.ft||(this.ji(this.i),this.Ft.checkCollisions=!1,this.L=this.g,this.g=0,this.ft=!0):this.ft&&(this.ft=!1,this.g=this.L,this.Ti(this.i),this.Ft.checkCollisions=this.ut))},i.prototype.ji=function(i){var s=this;this.ot.set(i,i.visibility),i.visibility=0,i.getChildMeshes(!1,(function(i){return i instanceof t.Mesh&&(s.ot.set(i,i.visibility),i.visibility=0),!1}))},i.prototype.Ti=function(i){var s=this;i.visibility=this.ot.get(i),i.getChildMeshes(!1,(function(i){return i instanceof t.Mesh&&(i.visibility=s.ot.get(i)),!1}))},i.prototype.yi=function(){var t=this;this.Ft.position.subtractToRef(this.Ft.target,this.lt),this.ct.origin=this.Ft.target,this.ct.length=this.lt.length(),this.ct.direction=this.lt.normalize();var i=this.Rt.multiPickWithRay(this.ct,(function(i){return!t.wi.includes(i)&&!!i.isPickable}));if(this.wt)if(this.Fi=this.bt,i.length>0){this.bt=new Array;for(var s=0,h=i;s<h.length;s++){var n=h[s];(n.pickedMesh.isVisible||this.Fi.includes(n.pickedMesh))&&(n.pickedMesh.isVisible=!1,this.bt.push(n.pickedMesh))}for(var e=0,r=this.Fi;e<r.length;e++){var u=r[e];this.bt.includes(u)||(u.isVisible=!0)}}else{for(var a=0,f=this.Fi;a<f.length;a++){(u=f[a]).isVisible=!0}this.Fi.length=0}if(this.j&&i.length>0){if(!(1!=i.length||this.Ri(i[0].pickedMesh)||i[0].pickedMesh.checkCollisions&&this.Ft.checkCollisions))return;for(var o=null,c=0;c<i.length;c++){u=i[c].pickedMesh;if(this.Ri(u)){o=i[c].pickedPoint;break}if(u.checkCollisions){o=i[c].pickedPoint;break}}if(null==o)return;var l=this.Ft.position.subtract(o),v=l.length();if(this.Ft.checkCollisions){var b=void 0;b=v<=1?l.addInPlace(l.normalizeToNew().scaleInPlace(this.vt)):l.normalize().scaleInPlace(v/this.Mt),this.Ft.position=this.Ft.position.subtract(b)}else{b=void 0;b=v<=1?v+this.vt:v/this.Mt,this.Ft.radius=this.Ft.radius-b}}},i.prototype.Ri=function(t){return!!t.isVisible&&(0!=t.visibility&&(null==t.material||0==t.material.alphaMode||0!=t.material.alpha))},i.prototype.anyMovement=function(){return this.Lt.ci||this.Lt.li||this.Lt.ki||this.Lt.di||this.Lt.ai||this.Lt.oi},i.prototype.Ct=function(t){if(t.key&&!t.repeat){switch(t.key.toLowerCase()){case this.A.idleJump.key:this.Lt.Xt=!0;break;case"capslock":this.Lt.fi=!this.Lt.fi;break;case"shift":this.Lt.fi=!0;break;case"up":case"arrowup":case this.A.walk.key:this.Lt.ci=!0;break;case"left":case"arrowleft":case this.A.turnLeft.key:this.Lt.ki=!0;break;case"right":case"arrowright":case this.A.turnRight.key:this.Lt.di=!0;break;case"down":case"arrowdown":case this.A.walkBack.key:this.Lt.li=!0;break;case this.A.strafeLeft.key:this.Lt.ai=!0;break;case this.A.strafeRight.key:this.Lt.oi=!0}this.dt=this.anyMovement()}},i.prototype.It=function(t){if(t.key){switch(t.key.toLowerCase()){case"shift":this.Lt.fi=!1;break;case"up":case"arrowup":case this.A.walk.key:this.Lt.ci=!1;break;case"left":case"arrowleft":case this.A.turnLeft.key:this.Lt.ki=!1,this.Z=!1;break;case"right":case"arrowright":case this.A.turnRight.key:this.Lt.di=!1,this.Z=!1;break;case"down":case"arrowdown":case this.A.walkBack.key:this.Lt.li=!1;break;case this.A.strafeLeft.key:this.Lt.ai=!1;break;case this.A.strafeRight.key:this.Lt.oi=!1}this.dt=this.anyMovement()}},i.prototype.isKeyBoardEnabled=function(){return this.kt},i.prototype.enableKeyBoard=function(t){this.kt=t,t?this.zt():this.Qt()},i.prototype.zt=function(){var t=this.Rt.getEngine().getRenderingCanvas();t.addEventListener("keyup",this.Et,!1),t.addEventListener("keydown",this.Bt,!1)},i.prototype.Qt=function(){var t=this.Rt.getEngine().getRenderingCanvas();t.removeEventListener("keyup",this.Et,!1),t.removeEventListener("keydown",this.Bt,!1)},i.prototype.walk=function(t){this.Lt.reset(),this.Lt.ci=t},i.prototype.walkBack=function(t){this.Lt.reset(),this.Lt.li=t},i.prototype.walkBackFast=function(t){this.Lt.reset(),this.Lt.li=t,this.Lt.fi=t},i.prototype.run=function(t){this.Lt.reset(),this.Lt.ci=t,this.Lt.fi=t},i.prototype.turnLeft=function(t){this.Lt.reset(),this.Lt.ki=t,t||(this.Z=t)},i.prototype.turnLeftFast=function(t){this.Lt.reset(),this.Lt.ki=t,t||(this.Z=t),this.Lt.fi=t},i.prototype.turnRight=function(t){this.Lt.reset(),this.Lt.di=t,t||(this.Z=t)},i.prototype.turnRightFast=function(t){this.Lt.reset(),this.Lt.di=t,t||(this.Z=t),this.Lt.fi=t},i.prototype.strafeLeft=function(t){this.Lt.reset(),this.Lt.ai=t},i.prototype.strafeLeftFast=function(t){this.Lt.reset(),this.Lt.ai=t,this.Lt.fi=t},i.prototype.strafeRight=function(t){this.Lt.reset(),this.Lt.oi=t},i.prototype.strafeRightFast=function(t){this.Lt.reset(),this.Lt.oi=t,this.Lt.fi=t},i.prototype.jump=function(){this.Lt.reset(),this.Lt.Xt=!0},i.prototype.fall=function(){this.Lt.reset(),this.K=!1},i.prototype.idle=function(){this.Lt.reset()},i.prototype.isAg=function(){return this.At},i.prototype.gi=function(i){var s=this.Li(i);if(s instanceof t.Mesh&&s.skeleton)return s.skeleton;var h=s.getChildMeshes(!1,(function(i){return!!(i instanceof t.Mesh&&i.skeleton)}));return h.length>0?h[0].skeleton:null},i.prototype.Li=function(t){return null==t.parent?t:this.Li(t.parent)},i.prototype.mi=function(i){var s=new Array;return i instanceof t.AbstractMesh&&s.push(i),i.getChildren((function(i){return i instanceof t.AbstractMesh&&s.push(i),!1}),!1),s},i.prototype.setAvatar=function(i,s){void 0===s&&(s=!1);var h=this.Li(i);return h instanceof t.Mesh?(this.i=h,this.wi=this.mi(h),this.h=this.gi(i),this.At=this.Pt(i,this.Rt.animationGroups,!0),this.A.reset(),this.At||null==this.h||this.gt(this.h),this.Gt(i),this.setFaceForward(s),!0):(console.error("Cannot move this mesh. The root node of the mesh provided is not a mesh"),!1)},i.prototype.showEllipsoid=function(i){if(!i)return null!=this.yt&&this.yt.dispose(),this.yt=null,void(null!=this.st&&(this.st.dispose(),this.st=null));if(null===this.yt){for(var s=new t.TransformNode("ellipsoid",this.Rt),h=this.i.ellipsoid.x,n=this.i.ellipsoid.y,e=[],r=-Math.PI/2;r<Math.PI/2;r+=Math.PI/36)e.push(new BABYLON.Vector3(0,n*Math.sin(r),h*Math.cos(r)));var u=[];u[0]=t.MeshBuilder.CreateLines("e",{points:e},this.Rt),u[0].color=t.Color3.Red(),u[0].parent=s,u[0].isPickable=!1;for(var a=2*Math.PI/12,f=1;f<12;f++)u[f]=u[0].clone("el"+f),u[f].parent=s,u[f].rotation.y=f*a,u[f].isPickable=!1;s.parent=this.i,s.position=this.i.ellipsoidOffset,this.yt=s}},i.prototype.getAvatar=function(){return this.i},i.prototype.setAvatarSkeleton=function(t){this.h=t,null!=this.h&&this.Oi(t)?this.At=!0:this.At=!1,this.At||null==this.h||this.gt(this.h)},i.prototype.Oi=function(t){var i=this;return t.animations.some((function(t){return i.Rt.animationGroups.some((function(i){return i.children.some((function(i){return i.animation==t}))}))}))},i.prototype.getSkeleton=function(){return this.h},i}(),s=function(){function t(){this.ci=!1,this.li=!1,this.di=!1,this.ki=!1,this.oi=!1,this.ai=!1,this.Xt=!1,this.fi=!1,this.reset()}return t.prototype.reset=function(){this.ci=!1,this.li=!1,this.di=!1,this.ki=!1,this.oi=!1,this.ai=!1,this.Xt=!1,this.fi=!1},t}(),e=function(){function t(t,i,s){void 0===i&&(i=1),this.name="",this.loop=!0,this.rate=1,this.exist=!1,this.id=t,this.speed=i,this.ds=i,this.key=s,this.dk=s}return t.prototype.reset=function(){this.name="",this.speed=this.ds,this.key=this.dk,this.loop=!0,this.rate=1,this.sound=null,this.exist=!1},t}(),r={WALK:"walk",WALKBACK:"walkBack",WALKBACKFAST:"walkBackFast",IDLE:"idle",IDLEJUMP:"idleJump",RUN:"run",RUNJUMP:"runJump",FALL:"fall",TURNLEFT:"turnLeft",TURNLEFTFAST:"turnLeftFast",TURNRIGHT:"turnRight",TURNRIGHTFAST:"turnRightFast",STRAFELEFT:"strafeLeft",STRAFELEFTFAST:"strafeLeftFast",STRAFERIGHT:"strafeRight",STRAFERIGHTFAST:"strafeRightFast",SLIDEBACK:"slideBack",getAll:function(){return Object.values(r).filter((function(t){return"string"==typeof t}))}},u=function(){function t(){this.walk=new e(r.WALK,3,"w"),this.walkBack=new e(r.WALKBACK,1.5,"s"),this.walkBackFast=new e(r.WALKBACKFAST,3,"na"),this.idle=new e(r.IDLE,0,"na"),this.idleJump=new e(r.IDLEJUMP,6," "),this.run=new e(r.RUN,6,"na"),this.runJump=new e(r.RUNJUMP,6,"na"),this.fall=new e(r.FALL,0,"na"),this.turnLeft=new e(r.TURNLEFT,Math.PI/8,"a"),this.turnLeftFast=new e(r.TURNLEFTFAST,Math.PI/4,"na"),this.turnRight=new e(r.TURNRIGHT,Math.PI/8,"d"),this.turnRightFast=new e(r.TURNRIGHTFAST,Math.PI/4,"na"),this.strafeLeft=new e(r.STRAFELEFT,1.5,"q"),this.strafeLeftFast=new e(r.STRAFELEFTFAST,3,"na"),this.strafeRight=new e(r.STRAFERIGHT,1.5,"e"),this.strafeRightFast=new e(r.STRAFERIGHTFAST,3,"na"),this.slideBack=new e(r.SLIDEBACK,0,"na")}return t.prototype.reset=function(){for(var t=0,i=Object.keys(this);t<i.length;t++){var s=this[i[t]];s instanceof e&&s.reset()}},t.prototype.actionNames=function(){for(var t=new Array,i=0,s=Object.keys(this);i<s.length;i++){var h=this[s[i]];h instanceof e&&t.push(h.id)}return t},t}(),a=function(){this.cameraElastic=!0,this.makeInvisble=!0,this.cameraTarget=t.Vector3.Zero(),this.noFirstPerson=!1,this.topDown=!0,this.turningOff=!0,this.keyboard=!0}})(),n})()));
//# sourceMappingURL=CharacterController.js.map